---
ms.openlocfilehash: eb3fa768a491f6c0ff4b15479beabd71b0670338
ms.sourcegitcommit: 0802ac583585110022beb6af8ea0b39188b77c43
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/25/2020
ms.locfileid: "96032749"
---
### <a name="hosting-https-redirection-enabled-for-iis-out-of-process-apps"></a><span data-ttu-id="3abbb-101">Hospedaje: redireccionamiento de HTTPS habilitado para aplicaciones fuera de proceso de IIS</span><span class="sxs-lookup"><span data-stu-id="3abbb-101">Hosting: HTTPS redirection enabled for IIS out-of-process apps</span></span>

<span data-ttu-id="3abbb-102">La versión 13.0.19218.0 del [módulo ASP.NET Core (ANCM)](/aspnet/core/host-and-deploy/aspnet-core-module) para el hospedaje a través de IIS fuera de proceso habilita una característica de redireccionamiento de HTTPS existente para aplicaciones ASP.NET Core 3.0 y 2.2.</span><span class="sxs-lookup"><span data-stu-id="3abbb-102">Version 13.0.19218.0 of the [ASP.NET Core Module (ANCM)](/aspnet/core/host-and-deploy/aspnet-core-module) for hosting via IIS out-of-process enables an existing HTTPS redirection feature for ASP.NET Core 3.0 and 2.2 apps.</span></span>

<span data-ttu-id="3abbb-103">Para obtener información, vea [dotnet/AspNetCore#15243](https://github.com/dotnet/AspNetCore/issues/15243).</span><span class="sxs-lookup"><span data-stu-id="3abbb-103">For discussion, see [dotnet/AspNetCore#15243](https://github.com/dotnet/AspNetCore/issues/15243).</span></span>

#### <a name="version-introduced"></a><span data-ttu-id="3abbb-104">Versión introducida</span><span class="sxs-lookup"><span data-stu-id="3abbb-104">Version introduced</span></span>

<span data-ttu-id="3abbb-105">3.0</span><span class="sxs-lookup"><span data-stu-id="3abbb-105">3.0</span></span>

#### <a name="old-behavior"></a><span data-ttu-id="3abbb-106">Comportamiento anterior</span><span class="sxs-lookup"><span data-stu-id="3abbb-106">Old behavior</span></span>

<span data-ttu-id="3abbb-107">La plantilla de proyecto de ASP.NET Core 2.1 incorporó por primera vez compatibilidad con métodos de middleware de HTTPS como <xref:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection%2A> y <xref:Microsoft.AspNetCore.Builder.HstsBuilderExtensions.UseHsts%2A>.</span><span class="sxs-lookup"><span data-stu-id="3abbb-107">The ASP.NET Core 2.1 project template first introduced support for HTTPS middleware methods like <xref:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection%2A> and <xref:Microsoft.AspNetCore.Builder.HstsBuilderExtensions.UseHsts%2A>.</span></span> <span data-ttu-id="3abbb-108">La habilitación del redireccionamiento de HTTPS exigía la adición de configuración, ya que las aplicaciones en desarrollo no usan el puerto predeterminado 443.</span><span class="sxs-lookup"><span data-stu-id="3abbb-108">Enabling HTTPS redirection required the addition of configuration, since apps in development don't use the default port of 443.</span></span> <span data-ttu-id="3abbb-109">La [seguridad de transporte estricta de HTTP (HSTS)](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html) solo está activa si la solicitud ya usa HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3abbb-109">[HTTP Strict Transport Security (HSTS)](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html) is active only if the request is already using HTTPS.</span></span> <span data-ttu-id="3abbb-110">Localhost se omite de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="3abbb-110">Localhost is skipped by default.</span></span>

#### <a name="new-behavior"></a><span data-ttu-id="3abbb-111">Comportamiento nuevo</span><span class="sxs-lookup"><span data-stu-id="3abbb-111">New behavior</span></span>

<span data-ttu-id="3abbb-112">En ASP.NET Core 3.0, el escenario de HTTPS de IIS se ha [mejorado](https://github.com/dotnet/AspNetCore/pull/4685).</span><span class="sxs-lookup"><span data-stu-id="3abbb-112">In ASP.NET Core 3.0, the IIS HTTPS scenario was [enhanced](https://github.com/dotnet/AspNetCore/pull/4685).</span></span> <span data-ttu-id="3abbb-113">Con la mejora, una aplicación puede detectar los puertos HTTPS del servidor y hacer que `UseHttpsRedirection` funcione de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="3abbb-113">With the enhancement, an app could discover the server's HTTPS ports and make `UseHttpsRedirection` work by default.</span></span> <span data-ttu-id="3abbb-114">El componente en proceso ha logrado la detección de puertos con la característica `IServerAddresses`, que solo afecta a las aplicaciones ASP.NET Core 3.0, dado que a la biblioteca en proceso se le asigna la versión del marco de trabajo.</span><span class="sxs-lookup"><span data-stu-id="3abbb-114">The in-process component accomplished port discovery with the `IServerAddresses` feature, which only affects ASP.NET Core 3.0 apps because the in-process library is versioned with the framework.</span></span> <span data-ttu-id="3abbb-115">El componente fuera de proceso ha cambiado para agregar automáticamente la variable de entorno `ASPNETCORE_HTTPS_PORT`.</span><span class="sxs-lookup"><span data-stu-id="3abbb-115">The out-of-process component changed to automatically add the `ASPNETCORE_HTTPS_PORT` environment variable.</span></span> <span data-ttu-id="3abbb-116">Este cambio afecta a las aplicaciones ASP.NET Core 2.2 y 3.0, ya que el componente fuera de proceso se comparte de forma global.</span><span class="sxs-lookup"><span data-stu-id="3abbb-116">This change affected both ASP.NET Core 2.2 and 3.0 apps because the out-of-process component is shared globally.</span></span> <span data-ttu-id="3abbb-117">Las aplicaciones ASP.NET Core 2.1 no se ven afectadas porque usan una versión anterior de ANCM de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="3abbb-117">ASP.NET Core 2.1 apps aren't affected because they use a prior version of ANCM by default.</span></span>

<span data-ttu-id="3abbb-118">El comportamiento anterior se modificó en ASP.NET Core 3.0.1 y 3.1.0 (versión preliminar 3) a fin de invertir los cambios de comportamiento en ASP.NET Core 2.x.</span><span class="sxs-lookup"><span data-stu-id="3abbb-118">The preceding behavior was modified in ASP.NET Core 3.0.1 and 3.1.0 Preview 3 to reverse the behavior changes in ASP.NET Core 2.x.</span></span> <span data-ttu-id="3abbb-119">Estos cambios solo afectan a aplicaciones fuera de proceso de IIS.</span><span class="sxs-lookup"><span data-stu-id="3abbb-119">These changes only affect IIS out-of-process apps.</span></span>

<span data-ttu-id="3abbb-120">Como se ha explicado anteriormente, la instalación de ASP.NET Core 3.0.0 tenía el efecto secundario de activar también el middleware de `UseHttpsRedirection` en las aplicaciones ASP.NET Core 2.x.</span><span class="sxs-lookup"><span data-stu-id="3abbb-120">As detailed above, installing ASP.NET Core 3.0.0 had the side effect of also activating the `UseHttpsRedirection` middleware in ASP.NET Core 2.x apps.</span></span> <span data-ttu-id="3abbb-121">Se ha realizado un cambio en ANCM en ASP.NET Core 3.0.1 y 3.1.0 (versión preliminar 3) que consiste en que su instalación ya no tiene este efecto en las aplicaciones ASP.NET Core 2.x.</span><span class="sxs-lookup"><span data-stu-id="3abbb-121">A change was made to ANCM in ASP.NET Core 3.0.1 and 3.1.0 Preview 3 such that installing them no longer has this effect on ASP.NET Core 2.x apps.</span></span> <span data-ttu-id="3abbb-122">La variable de entorno `ASPNETCORE_HTTPS_PORT` que ANCM rellenaba en ASP.NET Core 3.0.0 se ha cambiado a `ASPNETCORE_ANCM_HTTPS_PORT` en ASP.NET Core 3.0.1 y 3.1.0 (versión preliminar 3).</span><span class="sxs-lookup"><span data-stu-id="3abbb-122">The `ASPNETCORE_HTTPS_PORT` environment variable that ANCM populated in ASP.NET Core 3.0.0 was changed to `ASPNETCORE_ANCM_HTTPS_PORT` in ASP.NET Core 3.0.1 and 3.1.0 Preview 3.</span></span> <span data-ttu-id="3abbb-123">`UseHttpsRedirection` también se ha actualizado en estas versiones para comprender las variables antiguas y nuevas.</span><span class="sxs-lookup"><span data-stu-id="3abbb-123">`UseHttpsRedirection` was also updated in these releases to understand both the new and old variables.</span></span> <span data-ttu-id="3abbb-124">ASP.NET Core 2.x no se va a actualizar.</span><span class="sxs-lookup"><span data-stu-id="3abbb-124">ASP.NET Core 2.x won't be updated.</span></span> <span data-ttu-id="3abbb-125">Por eso, revierte al comportamiento anterior de estar deshabilitado de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="3abbb-125">As a result, it reverts to the previous behavior of being disabled by default.</span></span>

#### <a name="reason-for-change"></a><span data-ttu-id="3abbb-126">Motivo del cambio</span><span class="sxs-lookup"><span data-stu-id="3abbb-126">Reason for change</span></span>

<span data-ttu-id="3abbb-127">Funcionalidad mejorada de ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="3abbb-127">Improved ASP.NET Core 3.0 functionality.</span></span>

#### <a name="recommended-action"></a><span data-ttu-id="3abbb-128">Acción recomendada</span><span class="sxs-lookup"><span data-stu-id="3abbb-128">Recommended action</span></span>

<span data-ttu-id="3abbb-129">No es necesario hacer nada si se quiere que todos los clientes usen HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3abbb-129">No action is required if you want all clients to use HTTPS.</span></span> <span data-ttu-id="3abbb-130">Para permitir que algunos clientes empleen HTTP, siga uno de los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="3abbb-130">To allow some clients to use HTTP, take one of the following steps:</span></span>

* <span data-ttu-id="3abbb-131">Quite las llamadas a `UseHttpsRedirection` y `UseHsts` del método `Startup.Configure` del proyecto y vuelva a implementar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="3abbb-131">Remove the calls to `UseHttpsRedirection` and `UseHsts` from your project's `Startup.Configure` method, and redeploy the app.</span></span>
* <span data-ttu-id="3abbb-132">En el archivo *web.config*, establezca la variable de entorno `ASPNETCORE_HTTPS_PORT` en una cadena vacía.</span><span class="sxs-lookup"><span data-stu-id="3abbb-132">In your *web.config* file, set the `ASPNETCORE_HTTPS_PORT` environment variable to an empty string.</span></span> <span data-ttu-id="3abbb-133">Este cambio puede producirse directamente en el servidor sin volver a implementar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="3abbb-133">This change can occur directly on the server without redeploying the app.</span></span> <span data-ttu-id="3abbb-134">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="3abbb-134">For example:</span></span>

    ```xml
    <aspNetCore processPath="dotnet" arguments=".\WebApplication3.dll" stdoutLogEnabled="false" stdoutLogFile="\\?\%home%\LogFiles\stdout" >
        <environmentVariables>
        <environmentVariable name="ASPNETCORE_HTTPS_PORT" value="" />
        </environmentVariables>
    </aspNetCore>
    ```

<span data-ttu-id="3abbb-135">`UseHttpsRedirection` todavía se puede:</span><span class="sxs-lookup"><span data-stu-id="3abbb-135">`UseHttpsRedirection` can still be:</span></span>

* <span data-ttu-id="3abbb-136">Activar de forma manual en ASP.NET Core 2.x al establecer la variable de entorno `ASPNETCORE_HTTPS_PORT` en el número de puerto correcto (443 en la mayoría de los escenarios de producción).</span><span class="sxs-lookup"><span data-stu-id="3abbb-136">Activated manually in ASP.NET Core 2.x by setting the `ASPNETCORE_HTTPS_PORT` environment variable to the appropriate port number (443 in most production scenarios).</span></span>
* <span data-ttu-id="3abbb-137">Desactivar en ASP.NET Core 3.x al definir `ASPNETCORE_ANCM_HTTPS_PORT` con un valor de cadena vacía.</span><span class="sxs-lookup"><span data-stu-id="3abbb-137">Deactivated in ASP.NET Core 3.x by defining `ASPNETCORE_ANCM_HTTPS_PORT` with an empty string value.</span></span> <span data-ttu-id="3abbb-138">Este valor se establece de la misma manera que en el ejemplo de `ASPNETCORE_HTTPS_PORT` anterior.</span><span class="sxs-lookup"><span data-stu-id="3abbb-138">This value is set in the same fashion as the preceding `ASPNETCORE_HTTPS_PORT` example.</span></span>

<span data-ttu-id="3abbb-139">Los equipos que ejecutan aplicaciones ASP.NET Core 3.0.0 deben instalar el runtime de ASP.NET Core 3.0.1 antes de instalar el ANCM de ASP.NET Core 3.1.0 (versión preliminar 3).</span><span class="sxs-lookup"><span data-stu-id="3abbb-139">Machines running ASP.NET Core 3.0.0 apps should install the ASP.NET Core 3.0.1 runtime before installing the ASP.NET Core 3.1.0 Preview 3 ANCM.</span></span> <span data-ttu-id="3abbb-140">De este modo se garantiza que `UseHttpsRedirection` siga funcionando según lo previsto para las aplicaciones ASP.NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="3abbb-140">Doing so ensures that `UseHttpsRedirection` continues to operate as expected for the ASP.NET Core 3.0 apps.</span></span>

<span data-ttu-id="3abbb-141">En Azure App Service, ANCM se implementa conforme a una programación independiente del runtime debido a su naturaleza global.</span><span class="sxs-lookup"><span data-stu-id="3abbb-141">In Azure App Service, ANCM deploys on a separate schedule from the runtime because of its global nature.</span></span> <span data-ttu-id="3abbb-142">ANCM se implementó en Azure con estos cambios tras la implementación de ASP.NET Core 3.0.1 y 3.1.0.</span><span class="sxs-lookup"><span data-stu-id="3abbb-142">ANCM was deployed to Azure with these changes after ASP.NET Core 3.0.1 and 3.1.0 were deployed.</span></span>

#### <a name="category"></a><span data-ttu-id="3abbb-143">Categoría</span><span class="sxs-lookup"><span data-stu-id="3abbb-143">Category</span></span>

<span data-ttu-id="3abbb-144">ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="3abbb-144">ASP.NET Core</span></span>

#### <a name="affected-apis"></a><span data-ttu-id="3abbb-145">API afectadas</span><span class="sxs-lookup"><span data-stu-id="3abbb-145">Affected APIs</span></span>

<xref:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection(Microsoft.AspNetCore.Builder.IApplicationBuilder)?displayProperty=nameWithType>

<!-- 

#### Affected APIs

`M:Microsoft.AspNetCore.Builder.HttpsPolicyBuilderExtensions.UseHttpsRedirection(Microsoft.AspNetCore.Builder.IApplicationBuilder)`

-->
