---
title: Introducción a PLINQ
description: Aprenda a realizar consultas en paralelo con PLINQ en .NET. PLINQ corresponde a las siglas en inglés de Parallel Language-Integrated Query (LINQ).
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- PLINQ queries, introduction to
ms.assetid: eaa720d8-8999-4eb7-8df5-3c19ca61cad0
ms.openlocfilehash: 37414c7963a3803518b41a5c6d262740313e2b37
ms.sourcegitcommit: 6d09ae36acba0b0e2ba47999f8f1a725795462a2
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/29/2020
ms.locfileid: "92925355"
---
# <a name="introduction-to-plinq"></a><span data-ttu-id="e6383-104">Introducción a PLINQ</span><span class="sxs-lookup"><span data-stu-id="e6383-104">Introduction to PLINQ</span></span>

<span data-ttu-id="e6383-105">Parallel LINQ (PLINQ) es una implementación en paralelo del patrón [Language-Integrated Query (LINQ)](../../csharp/programming-guide/concepts/linq/index.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-105">Parallel LINQ (PLINQ) is a parallel implementation of the [Language-Integrated Query (LINQ)](../../csharp/programming-guide/concepts/linq/index.md) pattern.</span></span> <span data-ttu-id="e6383-106">PLINQ implementa el conjunto completo de operadores de consulta estándar de LINQ como métodos de extensión para el espacio de nombres <xref:System.Linq> y tiene operadores adicionales para las operaciones en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-106">PLINQ implements the full set of LINQ standard query operators as extension methods for the <xref:System.Linq> namespace and has additional operators for parallel operations.</span></span> <span data-ttu-id="e6383-107">PLINQ combina la simplicidad y legibilidad de la sintaxis de LINQ con la eficacia de la programación en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-107">PLINQ combines the simplicity and readability of LINQ syntax with the power of parallel programming.</span></span>

> [!TIP]
> <span data-ttu-id="e6383-108">Si no está familiarizado con LINQ, ofrece un modelo unificado para consultar cualquier origen de datos enumerable en un modo con seguridad de tipos.</span><span class="sxs-lookup"><span data-stu-id="e6383-108">If you're not familiar with LINQ, it features a unified model for querying any enumerable data source in a type-safe manner.</span></span> <span data-ttu-id="e6383-109">LINQ to Objects es el nombre de las consultas LINQ que se ejecutan en colecciones en memoria, como <xref:System.Collections.Generic.List%601> y matrices.</span><span class="sxs-lookup"><span data-stu-id="e6383-109">LINQ to Objects is the name for LINQ queries that are run against in-memory collections such as <xref:System.Collections.Generic.List%601> and arrays.</span></span> <span data-ttu-id="e6383-110">En este artículo, se da por echo que posee un conocimiento básico de LINQ.</span><span class="sxs-lookup"><span data-stu-id="e6383-110">This article assumes that you have a basic understanding of LINQ.</span></span> <span data-ttu-id="e6383-111">Para obtener más información, vea [Language Integrated Query (LINQ)](../../csharp/programming-guide/concepts/linq/index.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-111">For more information, see [Language-Integrated Query (LINQ)](../../csharp/programming-guide/concepts/linq/index.md).</span></span>

## <a name="what-is-a-parallel-query"></a><span data-ttu-id="e6383-112">¿Qué es una consulta en paralelo?</span><span class="sxs-lookup"><span data-stu-id="e6383-112">What is a Parallel query?</span></span>

<span data-ttu-id="e6383-113">En muchos sentidos, una consulta PLINQ se parece a una consulta LINQ to Objects no en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-113">A PLINQ query in many ways resembles a non-parallel LINQ to Objects query.</span></span> <span data-ttu-id="e6383-114">Las consultas PLINQ, al igual que las consultas LINQ secuenciales, funcionan en cualquier origen de datos <xref:System.Collections.IEnumerable> o <xref:System.Collections.Generic.IEnumerable%601> en memoria y tienen ejecución aplazada, lo que significa que no se empiezan a ejecutar hasta que se enumera la consulta.</span><span class="sxs-lookup"><span data-stu-id="e6383-114">PLINQ queries, just like sequential LINQ queries, operate on any in-memory <xref:System.Collections.IEnumerable> or <xref:System.Collections.Generic.IEnumerable%601> data source, and have deferred execution, which means they do not begin executing until the query is enumerated.</span></span> <span data-ttu-id="e6383-115">La principal diferencia es que PLINQ intenta usar completamente todos los procesadores del sistema.</span><span class="sxs-lookup"><span data-stu-id="e6383-115">The primary difference is that PLINQ attempts to make full use of all the processors on the system.</span></span> <span data-ttu-id="e6383-116">Para ello, crea particiones del origen de datos en segmentos y, luego, ejecuta la consulta en cada segmento en subprocesos de trabajo independientes en paralelo en varios procesadores.</span><span class="sxs-lookup"><span data-stu-id="e6383-116">It does this by partitioning the data source into segments, and then executing the query on each segment on separate worker threads in parallel on multiple processors.</span></span> <span data-ttu-id="e6383-117">En muchos casos, la ejecución en paralelo significa que la consulta se ejecuta considerablemente más rápido.</span><span class="sxs-lookup"><span data-stu-id="e6383-117">In many cases, parallel execution means that the query runs significantly faster.</span></span>

<span data-ttu-id="e6383-118">A través de la ejecución en paralelo, PLINQ puede alcanzar importantes mejoras de rendimiento con respecto al código heredado en ciertos tipos de consultas, a menudo solo con agregar la operación de consulta <xref:System.Linq.ParallelEnumerable.AsParallel%2A> al origen de datos.</span><span class="sxs-lookup"><span data-stu-id="e6383-118">Through parallel execution, PLINQ can achieve significant performance improvements over legacy code for certain kinds of queries, often just by adding the <xref:System.Linq.ParallelEnumerable.AsParallel%2A> query operation to the data source.</span></span> <span data-ttu-id="e6383-119">Sin embargo, el paralelismo puede presentar sus propias complejidades y no todas las operaciones de consulta se ejecutan más rápido en PLINQ.</span><span class="sxs-lookup"><span data-stu-id="e6383-119">However, parallelism can introduce its own complexities, and not all query operations run faster in PLINQ.</span></span> <span data-ttu-id="e6383-120">De hecho, la paralelización en realidad ralentiza ciertas consultas.</span><span class="sxs-lookup"><span data-stu-id="e6383-120">In fact, parallelization actually slows down certain queries.</span></span> <span data-ttu-id="e6383-121">Por lo tanto, debe entender cómo ciertos problemas, como la ordenación, afectan a las consultas en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-121">Therefore, you should understand how issues such as ordering affect parallel queries.</span></span> <span data-ttu-id="e6383-122">Para más información, consulte [Introducción a la velocidad en PLINQ](understanding-speedup-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-122">For more information, see [Understanding Speedup in PLINQ](understanding-speedup-in-plinq.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e6383-123">En esta documentación, se utilizan expresiones lambda para definir delegados en PLINQ.</span><span class="sxs-lookup"><span data-stu-id="e6383-123">This documentation uses lambda expressions to define delegates in PLINQ.</span></span> <span data-ttu-id="e6383-124">Si no está familiarizado con las expresiones lambda de C# o Visual Basic, consulte [Expresiones lambda en PLINQ y TPL](lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-124">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](lambda-expressions-in-plinq-and-tpl.md).</span></span>

<span data-ttu-id="e6383-125">En el resto del artículo se ofrece información general de las principales clases PLINQ y se analiza cómo crear consultas PLINQ.</span><span class="sxs-lookup"><span data-stu-id="e6383-125">The remainder of this article gives an overview of the main PLINQ classes and discusses how to create PLINQ queries.</span></span> <span data-ttu-id="e6383-126">Cada sección incluye vínculos a información más detallada y ejemplos de código.</span><span class="sxs-lookup"><span data-stu-id="e6383-126">Each section contains links to more detailed information and code examples.</span></span>

## <a name="the-parallelenumerable-class"></a><span data-ttu-id="e6383-127">La clase ParallelEnumerable</span><span class="sxs-lookup"><span data-stu-id="e6383-127">The ParallelEnumerable Class</span></span>

<span data-ttu-id="e6383-128">La clase <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> expone casi toda la funcionalidad de PLINQ.</span><span class="sxs-lookup"><span data-stu-id="e6383-128">The <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> class exposes almost all of PLINQ's functionality.</span></span> <span data-ttu-id="e6383-129">Junto con el resto de los tipos de espacios de nombres <xref:System.Linq?displayProperty=nameWithType>, se compilan en el ensamblado System.Core.dll.</span><span class="sxs-lookup"><span data-stu-id="e6383-129">It and the rest of the <xref:System.Linq?displayProperty=nameWithType> namespace types are compiled into the System.Core.dll assembly.</span></span> <span data-ttu-id="e6383-130">Los proyectos C# y Visual Basic predeterminados en Visual Studio hacen referencia al ensamblado e importan el espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="e6383-130">The default C# and Visual Basic projects in Visual Studio both reference the assembly and import the namespace.</span></span>

<span data-ttu-id="e6383-131"><xref:System.Linq.ParallelEnumerable> incluye implementaciones de todos los operadores de consulta estándar que LINQ to Objects admite, a pesar de que no intenta ejecutar en paralelo cada uno de ellos.</span><span class="sxs-lookup"><span data-stu-id="e6383-131"><xref:System.Linq.ParallelEnumerable> includes implementations of all the standard query operators that LINQ to Objects supports, although it does not attempt to parallelize each one.</span></span> <span data-ttu-id="e6383-132">Si no está familiarizado con LINK, consulte [Introducción a LINQ (C#)](../../csharp/programming-guide/concepts/linq/index.md) e [Introducción a LINQ (Visual Basic)](../../visual-basic/programming-guide/concepts/linq/introduction-to-linq.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-132">If you are not familiar with LINQ, see [Introduction to LINQ (C#)](../../csharp/programming-guide/concepts/linq/index.md) and [Introduction to LINQ (Visual Basic)](../../visual-basic/programming-guide/concepts/linq/introduction-to-linq.md).</span></span>

<span data-ttu-id="e6383-133">Además de los operadores de consulta estándar, la clase <xref:System.Linq.ParallelEnumerable> contiene un conjunto de métodos que permiten comportamientos específicos de la ejecución en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-133">In addition to the standard query operators, the <xref:System.Linq.ParallelEnumerable> class contains a set of methods that enable behaviors specific to parallel execution.</span></span> <span data-ttu-id="e6383-134">Estos métodos específicos de PLINQ se muestran en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="e6383-134">These PLINQ-specific methods are listed in the following table.</span></span>

|<span data-ttu-id="e6383-135">Operador ParallelEnumerable</span><span class="sxs-lookup"><span data-stu-id="e6383-135">ParallelEnumerable Operator</span></span>|<span data-ttu-id="e6383-136">Descripción</span><span class="sxs-lookup"><span data-stu-id="e6383-136">Description</span></span>|
|---------------------------------|-----------------|
|<xref:System.Linq.ParallelEnumerable.AsParallel%2A>|<span data-ttu-id="e6383-137">Punto de entrada de PLINQ.</span><span class="sxs-lookup"><span data-stu-id="e6383-137">The entry point for PLINQ.</span></span> <span data-ttu-id="e6383-138">Especifica que el resto de la consulta se debe ejecutar en paralelo, si es posible.</span><span class="sxs-lookup"><span data-stu-id="e6383-138">Specifies that the rest of the query should be parallelized, if it is possible.</span></span>|
|<xref:System.Linq.ParallelEnumerable.AsSequential%2A>|<span data-ttu-id="e6383-139">Especifica que el resto de la consulta se debe ejecutar en secuencia, como una consulta LINQ no en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-139">Specifies that the rest of the query should be run sequentially, as a non-parallel LINQ query.</span></span>|
|<xref:System.Linq.ParallelEnumerable.AsOrdered%2A>|<span data-ttu-id="e6383-140">Especifica que PLINQ debe conservar la ordenación de la secuencia de origen para el resto de la consulta o hasta que cambie la ordenación, por ejemplo, mediante el uso de una cláusula orderby (Order By en Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="e6383-140">Specifies that PLINQ should preserve the ordering of the source sequence for the rest of the query, or until the ordering is changed, for example by the use of an orderby (Order By in Visual Basic) clause.</span></span>|
|<xref:System.Linq.ParallelEnumerable.AsUnordered%2A>|<span data-ttu-id="e6383-141">Especifica que PLINQ no necesita conservar la ordenación de la secuencia de origen para el resto de la consulta.</span><span class="sxs-lookup"><span data-stu-id="e6383-141">Specifies that PLINQ for the rest of the query is not required to preserve the ordering of the source sequence.</span></span>|
|<xref:System.Linq.ParallelEnumerable.WithCancellation%2A>|<span data-ttu-id="e6383-142">Especifica que PLINQ debe supervisar periódicamente el estado del token de cancelación que se proporciona y cancelar la ejecución si se solicita.</span><span class="sxs-lookup"><span data-stu-id="e6383-142">Specifies that PLINQ should periodically monitor the state of the provided cancellation token and cancel execution if it is requested.</span></span>|
|<xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A>|<span data-ttu-id="e6383-143">Especifica la cantidad máxima de procesadores que PLINQ debe usar para ejecutar la consulta en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-143">Specifies the maximum number of processors that PLINQ should use to parallelize the query.</span></span>|
|<xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A>|<span data-ttu-id="e6383-144">Proporciona una sugerencia sobre cómo PLINQ debería, si es posible, combinar los resultados en paralelo en una sola secuencia en el subproceso utilizado.</span><span class="sxs-lookup"><span data-stu-id="e6383-144">Provides a hint about how PLINQ should, if it is possible, merge parallel results back into just one sequence on the consuming thread.</span></span>|
|<xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A>|<span data-ttu-id="e6383-145">Especifica si PLINQ debe ejecutar la consulta en paralelo incluso si el comportamiento predeterminado indica que se debería ejecutar en secuencia.</span><span class="sxs-lookup"><span data-stu-id="e6383-145">Specifies whether PLINQ should parallelize the query even when the default behavior would be to run it sequentially.</span></span>|
|<xref:System.Linq.ParallelEnumerable.ForAll%2A>|<span data-ttu-id="e6383-146">Método de enumeración multiproceso que, a diferencia de la iteración sobre los resultados de la consulta, permite procesar los resultados en paralelo sin tener que combinarlos primero en el subproceso del consumidor.</span><span class="sxs-lookup"><span data-stu-id="e6383-146">A multithreaded enumeration method that, unlike iterating over the results of the query, enables results to be processed in parallel without first merging back to the consumer thread.</span></span>|
|<span data-ttu-id="e6383-147"><xref:System.Linq.ParallelEnumerable.Aggregate%2A> overload</span><span class="sxs-lookup"><span data-stu-id="e6383-147"><xref:System.Linq.ParallelEnumerable.Aggregate%2A> overload</span></span>|<span data-ttu-id="e6383-148">Sobrecarga única para PLINQ que permite la agregación inmediata sobre particiones locales de subprocesos, además de una función de agregación local para combinar los resultados de todas las particiones.</span><span class="sxs-lookup"><span data-stu-id="e6383-148">An overload that is unique to PLINQ and enables intermediate aggregation over thread-local partitions, plus a final aggregation function to combine the results of all partitions.</span></span>|

## <a name="the-opt-in-model"></a><span data-ttu-id="e6383-149">El modelo de participación</span><span class="sxs-lookup"><span data-stu-id="e6383-149">The Opt-in Model</span></span>

<span data-ttu-id="e6383-150">Cuando escribe una consulta, participa en PLINQ al invocar el método de extensión <xref:System.Linq.ParallelEnumerable.AsParallel%2A?displayProperty=nameWithType> en el origen de datos, tal como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="e6383-150">When you write a query, opt in to PLINQ by invoking the <xref:System.Linq.ParallelEnumerable.AsParallel%2A?displayProperty=nameWithType> extension method on the data source, as shown in the following example.</span></span>

[!code-csharp[PLINQ#1](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#1)]
[!code-vb[PLINQ#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#1)]

<span data-ttu-id="e6383-151">El método de extensión <xref:System.Linq.ParallelEnumerable.AsParallel%2A> enlaza los operadores de consulta subsiguientes, en este caso, `where` y `select`, a las implementaciones <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e6383-151">The <xref:System.Linq.ParallelEnumerable.AsParallel%2A> extension method binds the subsequent query operators, in this case, `where` and `select`, to the <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> implementations.</span></span>

## <a name="execution-modes"></a><span data-ttu-id="e6383-152">Modos de ejecución</span><span class="sxs-lookup"><span data-stu-id="e6383-152">Execution Modes</span></span>

<span data-ttu-id="e6383-153">De manera predeterminada, PLINQ es conservador.</span><span class="sxs-lookup"><span data-stu-id="e6383-153">By default, PLINQ is conservative.</span></span> <span data-ttu-id="e6383-154">En tiempo de ejecución, la infraestructura de PLINQ analiza la estructura general de la consulta.</span><span class="sxs-lookup"><span data-stu-id="e6383-154">At run time, the PLINQ infrastructure analyzes the overall structure of the query.</span></span> <span data-ttu-id="e6383-155">Si existe la probabilidad de que la consulta genere aumentos de velocidad a través de la paralelización, PLINQ particiona la secuencia de origen en tareas que se pueden ejecutar en simultáneo.</span><span class="sxs-lookup"><span data-stu-id="e6383-155">If the query is likely to yield speedups by parallelization, PLINQ partitions the source sequence into tasks that can be run concurrently.</span></span> <span data-ttu-id="e6383-156">Si ejecutar una consulta en paralelo no es seguro, PLINQ simplemente la ejecuta en secuencia.</span><span class="sxs-lookup"><span data-stu-id="e6383-156">If it is not safe to parallelize a query, PLINQ just runs the query sequentially.</span></span> <span data-ttu-id="e6383-157">Si PLINQ puede elegir entre un algoritmo en paralelo posiblemente costoso y un algoritmo secuencial económico, de manera predeterminada elegirá el algoritmo secuencial.</span><span class="sxs-lookup"><span data-stu-id="e6383-157">If PLINQ has a choice between a potentially expensive parallel algorithm or an inexpensive sequential algorithm, it chooses the sequential algorithm by default.</span></span> <span data-ttu-id="e6383-158">Puede usar el método <xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A> y la enumeración <xref:System.Linq.ParallelExecutionMode?displayProperty=nameWithType> para indicar a PLINQ que seleccione el algoritmo paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-158">You can use the <xref:System.Linq.ParallelEnumerable.WithExecutionMode%2A> method and the <xref:System.Linq.ParallelExecutionMode?displayProperty=nameWithType> enumeration to instruct PLINQ to select the parallel algorithm.</span></span> <span data-ttu-id="e6383-159">Esto resulta útil cuando, a través de pruebas y mediciones, sabe que una consulta determinada se ejecuta más rápido en paralelo.</span><span class="sxs-lookup"><span data-stu-id="e6383-159">This is useful when you know by testing and measurement that a particular query executes faster in parallel.</span></span> <span data-ttu-id="e6383-160">Para obtener más información, vea [Cómo: Especificar el modo de ejecución en PLINQ](how-to-specify-the-execution-mode-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-160">For more information, see [How to: Specify the Execution Mode in PLINQ](how-to-specify-the-execution-mode-in-plinq.md).</span></span>

## <a name="degree-of-parallelism"></a><span data-ttu-id="e6383-161">Grado de paralelismo</span><span class="sxs-lookup"><span data-stu-id="e6383-161">Degree of Parallelism</span></span>

<span data-ttu-id="e6383-162">De manera predeterminada, PLINQ usa todos los procesadores del equipo host.</span><span class="sxs-lookup"><span data-stu-id="e6383-162">By default, PLINQ uses all of the processors on the host computer.</span></span> <span data-ttu-id="e6383-163">Puede indicar a PLINQ que use más de un número especificado de procesadores mediante el método <xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A>.</span><span class="sxs-lookup"><span data-stu-id="e6383-163">You can instruct PLINQ to use no more than a specified number of processors by using the <xref:System.Linq.ParallelEnumerable.WithDegreeOfParallelism%2A> method.</span></span> <span data-ttu-id="e6383-164">Esto resulta útil cuando desea asegurarse de que otros procesos que estén en ejecución en el equipo reciban cierta cantidad de tiempo de CPU.</span><span class="sxs-lookup"><span data-stu-id="e6383-164">This is useful when you want to make sure that other processes running on the computer receive a certain amount of CPU time.</span></span> <span data-ttu-id="e6383-165">El siguiente fragmento de código limita la consulta para que solo use un máximo de dos procesadores.</span><span class="sxs-lookup"><span data-stu-id="e6383-165">The following snippet limits the query to utilizing a maximum of two processors.</span></span>

[!code-csharp[PLINQ#5](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#5)]
[!code-vb[PLINQ#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#5)]

<span data-ttu-id="e6383-166">En casos en los que una consulta realiza una cantidad considerable de trabajo no enlazado a proceso, como E/S de archivo, puede se recomendable especificar un grado de paralelismo mayor que el número de núcleos de la máquina.</span><span class="sxs-lookup"><span data-stu-id="e6383-166">In cases where a query is performing a significant amount of non-compute-bound work such as File I/O, it might be beneficial to specify a degree of parallelism greater than the number of cores on the machine.</span></span>

## <a name="ordered-versus-unordered-parallel-queries"></a><span data-ttu-id="e6383-167">Comparación entre consultas en paralelo ordenadas y no ordenadas</span><span class="sxs-lookup"><span data-stu-id="e6383-167">Ordered Versus Unordered Parallel Queries</span></span>

<span data-ttu-id="e6383-168">En algunas consultas, un operador de consulta debe generar resultados que conserven la ordenación de la secuencia de origen.</span><span class="sxs-lookup"><span data-stu-id="e6383-168">In some queries, a query operator must produce results that preserve the ordering of the source sequence.</span></span> <span data-ttu-id="e6383-169">PLINQ proporciona el operador <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> para este propósito.</span><span class="sxs-lookup"><span data-stu-id="e6383-169">PLINQ provides the <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operator for this purpose.</span></span> <span data-ttu-id="e6383-170"><xref:System.Linq.ParallelEnumerable.AsOrdered%2A> es distinto de <xref:System.Linq.ParallelEnumerable.AsSequential%2A>.</span><span class="sxs-lookup"><span data-stu-id="e6383-170"><xref:System.Linq.ParallelEnumerable.AsOrdered%2A> is distinct from <xref:System.Linq.ParallelEnumerable.AsSequential%2A>.</span></span> <span data-ttu-id="e6383-171">Una secuencia <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> de todos modos se procesa en paralelo, pero sus resultados se almacenan en búfer y se ordenan.</span><span class="sxs-lookup"><span data-stu-id="e6383-171">An <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequence is still processed in parallel, but its results are buffered and sorted.</span></span> <span data-ttu-id="e6383-172">Dado que conservar el orden implica normalmente trabajo adicional, una secuencia <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> se podría procesar más despacio que la secuencia <xref:System.Linq.ParallelEnumerable.AsUnordered%2A> predeterminada.</span><span class="sxs-lookup"><span data-stu-id="e6383-172">Because order preservation typically involves extra work, an <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> sequence might be processed more slowly than the default <xref:System.Linq.ParallelEnumerable.AsUnordered%2A> sequence.</span></span> <span data-ttu-id="e6383-173">El hecho que una operación en paralelo ordenada determinada sea más rápida que una versión secuencial de la operación depende de muchos factores.</span><span class="sxs-lookup"><span data-stu-id="e6383-173">Whether a particular ordered parallel operation is faster than a sequential version of the operation depends on many factors.</span></span>

<span data-ttu-id="e6383-174">En el ejemplo de código siguiente se muestra cómo participar en conservar el orden.</span><span class="sxs-lookup"><span data-stu-id="e6383-174">The following code example shows how to opt in to order preservation.</span></span>

[!code-csharp[PLINQ#3](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#3)]
[!code-vb[PLINQ#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#3)]

<span data-ttu-id="e6383-175">Para más información, consulte cómo [conservar el orden en PLINQ](order-preservation-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-175">For more information, see [Order Preservation in PLINQ](order-preservation-in-plinq.md).</span></span>

## <a name="parallel-vs-sequential-queries"></a><span data-ttu-id="e6383-176">Comparación entre consultas en paralelo y consultas secuenciales</span><span class="sxs-lookup"><span data-stu-id="e6383-176">Parallel vs. Sequential Queries</span></span>

<span data-ttu-id="e6383-177">Algunas operaciones requieren que los datos de origen se entreguen en secuencia.</span><span class="sxs-lookup"><span data-stu-id="e6383-177">Some operations require that the source data be delivered in a sequential manner.</span></span> <span data-ttu-id="e6383-178">Los operadores de consulta <xref:System.Linq.ParallelEnumerable> vuelven automáticamente al modo secuencial cuando es necesario.</span><span class="sxs-lookup"><span data-stu-id="e6383-178">The <xref:System.Linq.ParallelEnumerable> query operators revert to sequential mode automatically when it is required.</span></span> <span data-ttu-id="e6383-179">Para los operadores de consulta definidos por el usuario y los delegados de usuario que requieren la ejecución secuencial, PLINQ proporciona el método <xref:System.Linq.ParallelEnumerable.AsSequential%2A>.</span><span class="sxs-lookup"><span data-stu-id="e6383-179">For user-defined query operators and user delegates that require sequential execution, PLINQ provides the <xref:System.Linq.ParallelEnumerable.AsSequential%2A> method.</span></span> <span data-ttu-id="e6383-180">Cuando se usa <xref:System.Linq.ParallelEnumerable.AsSequential%2A>, todos los operadores subsiguientes de la consulta se ejecutan secuencialmente hasta que se vuelve a llamar a <xref:System.Linq.ParallelEnumerable.AsParallel%2A>.</span><span class="sxs-lookup"><span data-stu-id="e6383-180">When you use <xref:System.Linq.ParallelEnumerable.AsSequential%2A>, all subsequent operators in the query are executed sequentially until <xref:System.Linq.ParallelEnumerable.AsParallel%2A> is called again.</span></span> <span data-ttu-id="e6383-181">Para obtener más información, vea [Cómo: Combinar consultas LINQ paralelas y secuenciales](how-to-combine-parallel-and-sequential-linq-queries.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-181">For more information, see [How to: Combine Parallel and Sequential LINQ Queries](how-to-combine-parallel-and-sequential-linq-queries.md).</span></span>

## <a name="options-for-merging-query-results"></a><span data-ttu-id="e6383-182">Opciones para combinar resultados de consulta</span><span class="sxs-lookup"><span data-stu-id="e6383-182">Options for Merging Query Results</span></span>

<span data-ttu-id="e6383-183">Cuando una consulta PLINQ se ejecuta en paralelo, sus resultados a partir de cada subproceso de trabajo se deben volver a combinar en el subproceso principal para que los use un bucle `foreach` (`For Each` en Visual Basic) o para su inserción en una lista o matriz.</span><span class="sxs-lookup"><span data-stu-id="e6383-183">When a PLINQ query executes in parallel, its results from each worker thread must be merged back onto the main thread for consumption by a `foreach` loop (`For Each` in Visual Basic), or insertion into a list or array.</span></span> <span data-ttu-id="e6383-184">En algunos casos, podría ser recomendable especificar un tipo determinado de operación Merge, por ejemplo, para comenzar a generar resultados más rápidamente.</span><span class="sxs-lookup"><span data-stu-id="e6383-184">In some cases, it might be beneficial to specify a particular kind of merge operation, for example, to begin producing results more quickly.</span></span> <span data-ttu-id="e6383-185">Para este propósito, PLINQ admite el método <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> y la enumeración <xref:System.Linq.ParallelMergeOptions>.</span><span class="sxs-lookup"><span data-stu-id="e6383-185">For this purpose, PLINQ supports the <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> method, and the <xref:System.Linq.ParallelMergeOptions> enumeration.</span></span> <span data-ttu-id="e6383-186">Para más información, consulte las [opciones de combinación en PLINQ](merge-options-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-186">For more information, see [Merge Options in PLINQ](merge-options-in-plinq.md).</span></span>

## <a name="the-forall-operator"></a><span data-ttu-id="e6383-187">El operador ForAll</span><span class="sxs-lookup"><span data-stu-id="e6383-187">The ForAll Operator</span></span>

<span data-ttu-id="e6383-188">En las consultas LINK secuenciales, la ejecución se aplaza hasta que la consulta se enumera en un bucle `foreach` (`For Each` en Visual Basic) o mediante la invocación de un método como <xref:System.Linq.ParallelEnumerable.ToList%2A>, <xref:System.Linq.ParallelEnumerable.ToArray%2A> o <xref:System.Linq.ParallelEnumerable.ToDictionary%2A>.</span><span class="sxs-lookup"><span data-stu-id="e6383-188">In sequential LINQ queries, execution is deferred until the query is enumerated either in a `foreach` (`For Each` in Visual Basic) loop or by invoking a method such as <xref:System.Linq.ParallelEnumerable.ToList%2A> , <xref:System.Linq.ParallelEnumerable.ToArray%2A> , or <xref:System.Linq.ParallelEnumerable.ToDictionary%2A>.</span></span> <span data-ttu-id="e6383-189">En PLINQ, también puede usar `foreach` para ejecutar la consulta e iterar a través de los resultados.</span><span class="sxs-lookup"><span data-stu-id="e6383-189">In PLINQ, you can also use `foreach` to execute the query and iterate through the results.</span></span> <span data-ttu-id="e6383-190">Sin embargo, `foreach` no se ejecuta en paralelo y, por lo tanto, requiere que el resultado de todas las tareas en paralelo se combinen nuevamente en el subproceso en el que se ejecuta el bucle.</span><span class="sxs-lookup"><span data-stu-id="e6383-190">However, `foreach` itself does not run in parallel, and therefore, it requires that the output from all parallel tasks be merged back into the thread on which the loop is running.</span></span> <span data-ttu-id="e6383-191">En PLINQ, puede usar `foreach` cuando deba conservar la ordenación final de los resultados de la consulta y también cada vez que procese los resultados de forma serial; por ejemplo, cuando llama a `Console.WriteLine` para cada elemento.</span><span class="sxs-lookup"><span data-stu-id="e6383-191">In PLINQ, you can use `foreach` when you must preserve the final ordering of the query results, and also whenever you are processing the results in a serial manner, for example when you are calling `Console.WriteLine` for each element.</span></span> <span data-ttu-id="e6383-192">Para lograr un ejecución más rápida de las consultas cuando no es necesario conservar el orden y cuando el procesamiento mismo de los resultados se puede ejecutar en paralelo, use el método <xref:System.Linq.ParallelEnumerable.ForAll%2A> para ejecutar una consulta PLINQ.</span><span class="sxs-lookup"><span data-stu-id="e6383-192">For faster query execution when order preservation is not required and when the processing of the results can itself be parallelized, use the <xref:System.Linq.ParallelEnumerable.ForAll%2A> method to execute a PLINQ query.</span></span> <span data-ttu-id="e6383-193"><xref:System.Linq.ParallelEnumerable.ForAll%2A> no lleva a cabo este paso de combinación final.</span><span class="sxs-lookup"><span data-stu-id="e6383-193"><xref:System.Linq.ParallelEnumerable.ForAll%2A> does not perform this final merge step.</span></span> <span data-ttu-id="e6383-194">En el ejemplo de código siguiente, se muestra cómo se utiliza el método <xref:System.Linq.ParallelEnumerable.ForAll%2A>.</span><span class="sxs-lookup"><span data-stu-id="e6383-194">The following code example shows how to use the <xref:System.Linq.ParallelEnumerable.ForAll%2A> method.</span></span> <span data-ttu-id="e6383-195">Aquí se usa <xref:System.Collections.Concurrent.ConcurrentBag%601?displayProperty=nameWithType> porque está optimizado para varios subprocesos, lo que agrega simultaneidad sin intentar quitar ningún elemento.</span><span class="sxs-lookup"><span data-stu-id="e6383-195"><xref:System.Collections.Concurrent.ConcurrentBag%601?displayProperty=nameWithType> is used here because it is optimized for multiple threads adding concurrently without attempting to remove any items.</span></span>

[!code-csharp[PLINQ#4](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#4)]
[!code-vb[PLINQ#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#4)]

<span data-ttu-id="e6383-196">En la ilustración siguiente se muestra la diferencia entre `foreach` y <xref:System.Linq.ParallelEnumerable.ForAll%2A> con respecto a la ejecución de la consulta.</span><span class="sxs-lookup"><span data-stu-id="e6383-196">The following illustration shows the difference between `foreach` and <xref:System.Linq.ParallelEnumerable.ForAll%2A> with regard to query execution.</span></span>

<span data-ttu-id="e6383-197">![Comparación entre ForAll ForEach](media/vs-isvnt-allvseach.png "VS_ISVNT_ALLvsEACH")</span><span class="sxs-lookup"><span data-stu-id="e6383-197">![ForAll vs. ForEach](media/vs-isvnt-allvseach.png "VS_ISVNT_ALLvsEACH")</span></span>

## <a name="cancellation"></a><span data-ttu-id="e6383-198">Cancelación</span><span class="sxs-lookup"><span data-stu-id="e6383-198">Cancellation</span></span>

<span data-ttu-id="e6383-199">PLINQ se integra con los tipos de cancelación en .NET.</span><span class="sxs-lookup"><span data-stu-id="e6383-199">PLINQ is integrated with the cancellation types in .NET.</span></span> <span data-ttu-id="e6383-200">(Para más información, consulte el tema sobre la [cancelación en subprocesos administrados](../threading/cancellation-in-managed-threads.md)). Por lo tanto, a diferencia de las consultas LINQ to Objects secuenciales, las consultas PLINQ se pueden cancelar.</span><span class="sxs-lookup"><span data-stu-id="e6383-200">(For more information, see [Cancellation in Managed Threads](../threading/cancellation-in-managed-threads.md).) Therefore, unlike sequential LINQ to Objects queries, PLINQ queries can be canceled.</span></span> <span data-ttu-id="e6383-201">Para crear una consulta PLINQ cancelable, use el operador <xref:System.Linq.ParallelEnumerable.WithCancellation%2A> en la consulta y proporcione una instancia <xref:System.Threading.CancellationToken> como argumento.</span><span class="sxs-lookup"><span data-stu-id="e6383-201">To create a cancelable PLINQ query, use the <xref:System.Linq.ParallelEnumerable.WithCancellation%2A> operator on the query and provide a <xref:System.Threading.CancellationToken> instance as the argument.</span></span> <span data-ttu-id="e6383-202">Cuando la propiedad <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> del token se establece en true, PLINQ lo tendrá en cuenta, detendrá el procesamiento de todos los subprocesos e iniciará <xref:System.OperationCanceledException>.</span><span class="sxs-lookup"><span data-stu-id="e6383-202">When the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on the token is set to true, PLINQ will notice it, stop processing on all threads, and throw an <xref:System.OperationCanceledException>.</span></span>

<span data-ttu-id="e6383-203">Es posible que una consulta PLINQ siga procesando algunos elementos una vez establecido el token de cancelación.</span><span class="sxs-lookup"><span data-stu-id="e6383-203">It is possible that a PLINQ query might continue to process some elements after the cancellation token is set.</span></span>

<span data-ttu-id="e6383-204">Para una mayor capacidad de respuesta, también puede responder a las solicitudes de cancelación en delegados de usuario de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="e6383-204">For greater responsiveness, you can also respond to cancellation requests in long-running user delegates.</span></span> <span data-ttu-id="e6383-205">Para obtener más información, vea [Cómo: Cancelar una consulta PLINQ](how-to-cancel-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-205">For more information, see [How to: Cancel a PLINQ Query](how-to-cancel-a-plinq-query.md).</span></span>

## <a name="exceptions"></a><span data-ttu-id="e6383-206">Excepciones</span><span class="sxs-lookup"><span data-stu-id="e6383-206">Exceptions</span></span>

<span data-ttu-id="e6383-207">Cuando se ejecuta una consulta PLINQ, distintos subprocesos pueden generar varias excepciones de forma simultánea.</span><span class="sxs-lookup"><span data-stu-id="e6383-207">When a PLINQ query executes, multiple exceptions might be thrown from different threads simultaneously.</span></span> <span data-ttu-id="e6383-208">Además, el código para controlar la excepción puede estar en un subproceso distinto al del código que generó la excepción.</span><span class="sxs-lookup"><span data-stu-id="e6383-208">Also, the code to handle the exception might be on a different thread than the code that threw the exception.</span></span> <span data-ttu-id="e6383-209">PLINQ usa el tipo <xref:System.AggregateException> para encapsular todas las excepciones que generó una consulta y calcular las referencias de esas excepciones nuevamente en el subproceso que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="e6383-209">PLINQ uses the <xref:System.AggregateException> type to encapsulate all the exceptions that were thrown by a query, and marshal those exceptions back to the calling thread.</span></span> <span data-ttu-id="e6383-210">En el subproceso que realiza la llamada, solo se requiere un bloque try-catch.</span><span class="sxs-lookup"><span data-stu-id="e6383-210">On the calling thread, only one try-catch block is required.</span></span> <span data-ttu-id="e6383-211">Sin embargo, puede iterar a través de todas las excepciones que están encapsuladas en <xref:System.AggregateException> y capturar cualquiera desde la que pueda realizar una recuperación de forma segura.</span><span class="sxs-lookup"><span data-stu-id="e6383-211">However, you can iterate through all of the exceptions that are encapsulated in the <xref:System.AggregateException> and catch any that you can safely recover from.</span></span> <span data-ttu-id="e6383-212">En raras ocasiones, se pueden generar algunas excepciones que no se ajustan en <xref:System.AggregateException>, y <xref:System.Threading.ThreadAbortException> tampoco se ajusta.</span><span class="sxs-lookup"><span data-stu-id="e6383-212">In rare cases, some exceptions may be thrown that are not wrapped in an <xref:System.AggregateException>, and <xref:System.Threading.ThreadAbortException>s  are also not wrapped.</span></span>

<span data-ttu-id="e6383-213">Cuando las excepciones pueden propagarse de nuevo al subproceso de unión, es posible que una consulta continúe procesando algunos elementos después de que se haya producido la excepción.</span><span class="sxs-lookup"><span data-stu-id="e6383-213">When exceptions are allowed to bubble up back to the joining thread, then it is possible that a query may continue to process some items after the exception is raised.</span></span>

<span data-ttu-id="e6383-214">Para obtener más información, vea [Cómo: Controlar excepciones en una consulta PLINQ](how-to-handle-exceptions-in-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-214">For more information, see [How to: Handle Exceptions in a PLINQ Query](how-to-handle-exceptions-in-a-plinq-query.md).</span></span>

## <a name="custom-partitioners"></a><span data-ttu-id="e6383-215">Particionadores personalizados</span><span class="sxs-lookup"><span data-stu-id="e6383-215">Custom Partitioners</span></span>

<span data-ttu-id="e6383-216">En algunos casos, puede mejorar el rendimiento de las consultas si escribe un particionador personalizado que aproveche algunas características de los datos de origen.</span><span class="sxs-lookup"><span data-stu-id="e6383-216">In some cases, you can improve query performance by writing a custom partitioner that takes advantage of some characteristic of the source data.</span></span> <span data-ttu-id="e6383-217">En la consulta, el mismo particionador personalizado es el objeto enumerable que se consulta.</span><span class="sxs-lookup"><span data-stu-id="e6383-217">In the query, the custom partitioner itself is the enumerable object that is queried.</span></span>

[!code-csharp[PLINQ#2](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinq2_cs.cs#2)]
[!code-vb[PLINQ#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq3.vb#2)]

<span data-ttu-id="e6383-218">PLINQ admite una cantidad fija de particiones (a pesar de que los datos se pueden reasignar de forma dinámica a esas particiones durante el tiempo de ejecución para el equilibrio de carga).</span><span class="sxs-lookup"><span data-stu-id="e6383-218">PLINQ supports a fixed number of partitions (although data may be dynamically reassigned to those partitions during run time for load balancing.).</span></span> <span data-ttu-id="e6383-219"><xref:System.Threading.Tasks.Parallel.For%2A> y <xref:System.Threading.Tasks.Parallel.ForEach%2A> admiten solo la partición dinámica, lo que significa que el número de particiones cambia en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="e6383-219"><xref:System.Threading.Tasks.Parallel.For%2A> and <xref:System.Threading.Tasks.Parallel.ForEach%2A> support only dynamic partitioning, which means that the number of partitions changes at run time.</span></span> <span data-ttu-id="e6383-220">Para más información, consulte [Custom Partitioners for PLINQ and TPL](custom-partitioners-for-plinq-and-tpl.md) (Particionadores personalizados para PLINQ y TPL).</span><span class="sxs-lookup"><span data-stu-id="e6383-220">For more information, see [Custom Partitioners for PLINQ and TPL](custom-partitioners-for-plinq-and-tpl.md).</span></span>

## <a name="measuring-plinq-performance"></a><span data-ttu-id="e6383-221">Medición del rendimiento de PLINQ</span><span class="sxs-lookup"><span data-stu-id="e6383-221">Measuring PLINQ Performance</span></span>

<span data-ttu-id="e6383-222">En muchos casos, una consulta se puede ejecutar en paralelo, pero la sobrecarga que implica configurar la consulta en paralelo supera el beneficio obtenido en el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="e6383-222">In many cases, a query can be parallelized, but the overhead of setting up the parallel query outweighs the performance benefit gained.</span></span> <span data-ttu-id="e6383-223">Si una consulta no realiza mucho cálculo o si el origen de datos es pequeño, una consulta PLINQ podría ser más lenta que una consulta LINQ to Objects secuencial.</span><span class="sxs-lookup"><span data-stu-id="e6383-223">If a query does not perform much computation or if the data source is small, a PLINQ query may be slower than a sequential LINQ to Objects query.</span></span> <span data-ttu-id="e6383-224">Puede usar el analizador de rendimiento en paralelo en Visual Studio Team Server para comparar el rendimiento de diversas consultas, ubicar cuellos de botella en el procesamiento y determinar si la consulta se ejecuta en paralelo o secuencialmente.</span><span class="sxs-lookup"><span data-stu-id="e6383-224">You can use the Parallel Performance Analyzer in Visual Studio Team Server to compare the performance of various queries, to locate processing bottlenecks, and to determine whether your query is running in parallel or sequentially.</span></span> <span data-ttu-id="e6383-225">Para más información, vea [Visualizador de simultaneidad](/visualstudio/profiling/concurrency-visualizer) y [Cómo: Medir el rendimiento de consultas PLINQ](how-to-measure-plinq-query-performance.md).</span><span class="sxs-lookup"><span data-stu-id="e6383-225">For more information, see [Concurrency Visualizer](/visualstudio/profiling/concurrency-visualizer) and [How to: Measure PLINQ Query Performance](how-to-measure-plinq-query-performance.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="e6383-226">Vea también</span><span class="sxs-lookup"><span data-stu-id="e6383-226">See also</span></span>

- [<span data-ttu-id="e6383-227">Parallel LINQ (PLINQ)</span><span class="sxs-lookup"><span data-stu-id="e6383-227">Parallel LINQ (PLINQ)</span></span>](introduction-to-plinq.md)
- [<span data-ttu-id="e6383-228">Introducción a la velocidad en PLINQ</span><span class="sxs-lookup"><span data-stu-id="e6383-228">Understanding Speedup in PLINQ</span></span>](understanding-speedup-in-plinq.md)
