---
title: 'Programación asincrónica basada en tareas: .NET'
description: En este artículo, conocerá la programación asincrónica basada en tareas a través de la biblioteca TPL de .NET.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- parallelism, task
ms.assetid: 458b5e69-5210-45e5-bc44-3888f86abd6f
ms.openlocfilehash: d735cb56c5914dd33ba694c95a8e92446ca47088
ms.sourcegitcommit: 6d09ae36acba0b0e2ba47999f8f1a725795462a2
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/29/2020
ms.locfileid: "92925251"
---
# <a name="task-based-asynchronous-programming"></a><span data-ttu-id="51719-103">Programación asincrónica basada en tareas</span><span class="sxs-lookup"><span data-stu-id="51719-103">Task-based asynchronous programming</span></span>

<span data-ttu-id="51719-104">La biblioteca TPL se basa en el concepto de *tarea* , que representa una operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="51719-104">The Task Parallel Library (TPL) is based on the concept of a *task* , which represents an asynchronous operation.</span></span> <span data-ttu-id="51719-105">De cierta forma, una tarea recuerda a un subproceso o elemento de trabajo <xref:System.Threading.ThreadPool>, pero en un nivel más alto de abstracción.</span><span class="sxs-lookup"><span data-stu-id="51719-105">In some ways, a task resembles a thread or <xref:System.Threading.ThreadPool> work item, but at a higher level of abstraction.</span></span> <span data-ttu-id="51719-106">El término *paralelismo de tareas* hace referencia a la ejecución simultánea de una o varias tareas independientes.</span><span class="sxs-lookup"><span data-stu-id="51719-106">The term *task parallelism* refers to one or more independent tasks running concurrently.</span></span> <span data-ttu-id="51719-107">Las tareas proporcionan dos ventajas fundamentales:</span><span class="sxs-lookup"><span data-stu-id="51719-107">Tasks provide two primary benefits:</span></span>

- <span data-ttu-id="51719-108">Un uso más eficaz y más escalable de los recursos del sistema.</span><span class="sxs-lookup"><span data-stu-id="51719-108">More efficient and more scalable use of system resources.</span></span>

     <span data-ttu-id="51719-109">En segundo plano, las tareas se ponen en la cola del elemento <xref:System.Threading.ThreadPool>, que se ha mejorado con algoritmos que determinan y ajustan el número de subprocesos y que ofrecen el equilibrio de carga para maximizar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="51719-109">Behind the scenes, tasks are queued to the <xref:System.Threading.ThreadPool>, which has been enhanced with algorithms  that determine and adjust to the number of threads and that provide load balancing to maximize throughput.</span></span> <span data-ttu-id="51719-110">Esto hace que las tareas resulten relativamente ligeras y que, por tanto, pueda crearse un gran número de ellas para habilitar un paralelismo pormenorizado.</span><span class="sxs-lookup"><span data-stu-id="51719-110">This makes tasks relatively lightweight, and you can create many of them to enable fine-grained parallelism.</span></span>

- <span data-ttu-id="51719-111">Un mayor control mediante programación del que se puede conseguir con un subproceso o un elemento de trabajo.</span><span class="sxs-lookup"><span data-stu-id="51719-111">More programmatic control than is possible with a thread or work item.</span></span>

     <span data-ttu-id="51719-112">Las tareas y el marco que se crea en torno a ellas proporcionan un amplio conjunto de API que admiten el uso de esperas, cancelaciones, continuaciones, control robusto de excepciones, estado detallado, programación personalizada, y más.</span><span class="sxs-lookup"><span data-stu-id="51719-112">Tasks and the framework built around them provide a rich set of APIs that support waiting, cancellation, continuations, robust exception handling, detailed status, custom scheduling, and more.</span></span>

<span data-ttu-id="51719-113">Por estos dos motivos, en .NET, TPL es la API preferida para escribir código multiproceso, asincrónico y en paralelo.</span><span class="sxs-lookup"><span data-stu-id="51719-113">For both of these reasons, TPL is the preferred API for writing multi-threaded, asynchronous, and parallel code in .NET.</span></span>

## <a name="creating-and-running-tasks-implicitly"></a><span data-ttu-id="51719-114">Crear y ejecutar tareas implícitamente</span><span class="sxs-lookup"><span data-stu-id="51719-114">Creating and running tasks implicitly</span></span>

<span data-ttu-id="51719-115">El método <xref:System.Threading.Tasks.Parallel.Invoke%2A?displayProperty=nameWithType> proporciona una manera conveniente de ejecutar cualquier número de instrucciones arbitrarias simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="51719-115">The <xref:System.Threading.Tasks.Parallel.Invoke%2A?displayProperty=nameWithType> method provides a convenient way to run any number of arbitrary statements concurrently.</span></span> <span data-ttu-id="51719-116">Pase un delegado <xref:System.Action> por cada elemento de trabajo.</span><span class="sxs-lookup"><span data-stu-id="51719-116">Just pass in an <xref:System.Action> delegate for each item of work.</span></span> <span data-ttu-id="51719-117">La manera más fácil de crear estos delegados es con expresiones lambda.</span><span class="sxs-lookup"><span data-stu-id="51719-117">The easiest way to create these delegates is to use lambda expressions.</span></span> <span data-ttu-id="51719-118">La expresión lambda puede llamar a un método con nombre o proporcionar el código alineado.</span><span class="sxs-lookup"><span data-stu-id="51719-118">The lambda expression can either call a named method or provide the code inline.</span></span> <span data-ttu-id="51719-119">En el siguiente ejemplo se muestra una llamada a <xref:System.Threading.Tasks.Parallel.Invoke%2A> básica que crea e inicia dos tareas que se ejecutan a la vez.</span><span class="sxs-lookup"><span data-stu-id="51719-119">The following example shows a basic <xref:System.Threading.Tasks.Parallel.Invoke%2A> call that creates and starts two tasks that run concurrently.</span></span> <span data-ttu-id="51719-120">La primera tarea se representa mediante una expresión lambda que llama a un método denominado `DoSomeWork` y la segunda tarea se representa mediante una expresión lambda que llama a un método denominado `DoSomeOtherWork`.</span><span class="sxs-lookup"><span data-stu-id="51719-120">The first task is represented by a lambda expression that calls a method named `DoSomeWork`, and the second task is represented by a lambda expression that calls a method named `DoSomeOtherWork`.</span></span>

> [!NOTE]
> <span data-ttu-id="51719-121">En esta documentación, se utilizan expresiones lambda para definir delegados en la TPL.</span><span class="sxs-lookup"><span data-stu-id="51719-121">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="51719-122">Si no está familiarizado con las expresiones lambda de C# o Visual Basic, consulte [Expresiones lambda en PLINQ y TPL](lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="51719-122">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](lambda-expressions-in-plinq-and-tpl.md).</span></span>

[!code-csharp[TPL#21](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl/cs/tpl.cs#21)]
[!code-vb[TPL#21](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl/vb/tpl_vb.vb#21)]

> [!NOTE]
> <span data-ttu-id="51719-123">El número de instancias de <xref:System.Threading.Tasks.Task> que <xref:System.Threading.Tasks.Parallel.Invoke%2A> crea en segundo plano no es necesariamente igual al número de delegados que se proporcionan.</span><span class="sxs-lookup"><span data-stu-id="51719-123">The number of <xref:System.Threading.Tasks.Task> instances that are created behind the scenes by <xref:System.Threading.Tasks.Parallel.Invoke%2A> is not necessarily equal to the number of delegates that are provided.</span></span> <span data-ttu-id="51719-124">La TPL puede emplear varias optimizaciones, sobre todo con grandes números de delegados.</span><span class="sxs-lookup"><span data-stu-id="51719-124">The TPL may employ various optimizations, especially with large numbers of delegates.</span></span>

<span data-ttu-id="51719-125">Para obtener más información, vea [Cómo: Usar Parallel.Invoke para ejecutar operaciones en paralelo](how-to-use-parallel-invoke-to-execute-parallel-operations.md).</span><span class="sxs-lookup"><span data-stu-id="51719-125">For more information, see [How to: Use Parallel.Invoke to Execute Parallel Operations](how-to-use-parallel-invoke-to-execute-parallel-operations.md).</span></span>

<span data-ttu-id="51719-126">Para tener un mayor control de la ejecución de tareas o para devolver un valor de la tarea, debe trabajar con objetos <xref:System.Threading.Tasks.Task> más explícitamente.</span><span class="sxs-lookup"><span data-stu-id="51719-126">For greater control over task execution or to return a value from the task, you have to work with <xref:System.Threading.Tasks.Task> objects more explicitly.</span></span>

## <a name="creating-and-running-tasks-explicitly"></a><span data-ttu-id="51719-127">Crear y ejecutar tareas explícitamente</span><span class="sxs-lookup"><span data-stu-id="51719-127">Creating and running tasks explicitly</span></span>

<span data-ttu-id="51719-128">Una tarea que no devuelve un valor se representa mediante la clase <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="51719-128">A task that does not return a value is represented by the <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> class.</span></span> <span data-ttu-id="51719-129">Una tarea que devuelve un valor se representa mediante la clase <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>, que se hereda de <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="51719-129">A task that returns a value is represented by the <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> class, which inherits from <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="51719-130">El objeto de tarea controla los detalles de la infraestructura y proporciona métodos y propiedades a los que se puede obtener acceso desde el subproceso que realiza la llamada a lo largo de la duración de la tarea.</span><span class="sxs-lookup"><span data-stu-id="51719-130">The task object handles the infrastructure details and provides methods and properties that are accessible from the calling thread throughout the lifetime of the task.</span></span> <span data-ttu-id="51719-131">Por ejemplo, se puede tener acceso a la propiedad <xref:System.Threading.Tasks.Task.Status%2A> de una tarea en cualquier momento para determinar si ha empezado a ejecutarse, si se ha ejecutado hasta su finalización, si se ha cancelado o si se ha producido una excepción.</span><span class="sxs-lookup"><span data-stu-id="51719-131">For example, you can access the <xref:System.Threading.Tasks.Task.Status%2A> property of a task at any time to determine whether it has started running, ran to completion, was canceled, or has thrown an exception.</span></span> <span data-ttu-id="51719-132">El estado se representa mediante la enumeración <xref:System.Threading.Tasks.TaskStatus>.</span><span class="sxs-lookup"><span data-stu-id="51719-132">The status is represented by a <xref:System.Threading.Tasks.TaskStatus> enumeration.</span></span>

<span data-ttu-id="51719-133">Cuando se crea una tarea, se proporciona un delegado de usuario que encapsula el código que la tarea va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="51719-133">When you create a task, you give it a user delegate that encapsulates the code that the task will execute.</span></span> <span data-ttu-id="51719-134">El delegado se puede expresar como un delegado con nombre, un método anónimo o una expresión lambda.</span><span class="sxs-lookup"><span data-stu-id="51719-134">The delegate can be expressed as a named delegate, an anonymous method, or a lambda expression.</span></span> <span data-ttu-id="51719-135">Las expresiones lambda pueden contener una llamada a un método con nombre, tal y como se muestra en el siguiente ejemplo.</span><span class="sxs-lookup"><span data-stu-id="51719-135">Lambda expressions can contain a call to a named method, as shown in the following example.</span></span> <span data-ttu-id="51719-136">Observe que el ejemplo incluye una llamada al método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> para garantizar que la ejecución de la tarea se complete antes de que finalice la aplicación de modo de consola.</span><span class="sxs-lookup"><span data-stu-id="51719-136">Note that the example includes a call to the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to ensure that the task completes execution before the console mode application ends.</span></span>

[!code-csharp[TPL_TaskIntro#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/lambda1.cs#1)]
[!code-vb[TPL_TaskIntro#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/lambda1.vb#1)]

<span data-ttu-id="51719-137">También se pueden usar los métodos <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> para crear e iniciar una tarea en una sola operación.</span><span class="sxs-lookup"><span data-stu-id="51719-137">You can also use the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> methods to create and start a task in one operation.</span></span> <span data-ttu-id="51719-138">Para administrar la tarea, los métodos <xref:System.Threading.Tasks.Task.Run%2A> usan el programador de tareas predeterminado, independientemente qué programador de tareas esté asociado al subproceso actual.</span><span class="sxs-lookup"><span data-stu-id="51719-138">To manage the task, the <xref:System.Threading.Tasks.Task.Run%2A> methods use the default  task scheduler, regardless of which task scheduler is associated with the current thread.</span></span> <span data-ttu-id="51719-139">Los métodos <xref:System.Threading.Tasks.Task.Run%2A> son el modo preferido para crear e iniciar tareas cuando no se necesita más control sobre la creación y la programación de la tarea.</span><span class="sxs-lookup"><span data-stu-id="51719-139">The <xref:System.Threading.Tasks.Task.Run%2A> methods are the preferred way to create and start tasks when more control over the creation and scheduling of the task is not needed.</span></span>

[!code-csharp[TPL_TaskIntro#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/run1.cs#2)]
[!code-vb[TPL_TaskIntro#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/run1.vb#2)]

<span data-ttu-id="51719-140">También se puede usar el método <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> para crear e iniciar una tarea en una sola operación.</span><span class="sxs-lookup"><span data-stu-id="51719-140">You can also use the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method to create and start a task in one operation.</span></span> <span data-ttu-id="51719-141">Utilice este método cuando la creación y la programación no tengan que ser independientes y necesite opciones de creación de tareas adicionales o el uso de un programador concreto, o cuando necesita pasar información de estado adicional en la tarea que se puede recuperar mediante su propiedad <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType>, como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="51719-141">Use this method when creation and scheduling do not have to be separated and you require additional task creation options or the use of a specific scheduler, or when you need to pass additional state into the task that you can retrieve through its <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property, as shown in the following example.</span></span>

[!code-csharp[TPL_TaskIntro#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/asyncstate.cs#23)]
[!code-vb[TPL_TaskIntro#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/asyncstate.vb#23)]

<span data-ttu-id="51719-142"><xref:System.Threading.Tasks.Task> y <xref:System.Threading.Tasks.Task%601> exponen en cada caso una propiedad <xref:System.Threading.Tasks.Task.Factory%2A> estática que devuelve una instancia predeterminada de <xref:System.Threading.Tasks.TaskFactory>, por lo que se puede llamar al método como `Task.Factory.StartNew()`.</span><span class="sxs-lookup"><span data-stu-id="51719-142"><xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> each expose a static <xref:System.Threading.Tasks.Task.Factory%2A> property that returns a default instance of <xref:System.Threading.Tasks.TaskFactory>, so that you can call the method as `Task.Factory.StartNew()`.</span></span> <span data-ttu-id="51719-143">Asimismo, en el siguiente ejemplo, dado que las tareas son de tipo <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>, cada una tiene una propiedad <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> pública que contiene el resultado del cálculo.</span><span class="sxs-lookup"><span data-stu-id="51719-143">Also, in the following example, because the tasks are of type <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>, they each have a public <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property that contains the result of the computation.</span></span> <span data-ttu-id="51719-144">Las tareas se ejecutan de forma asincrónica y pueden completarse en cualquier orden.</span><span class="sxs-lookup"><span data-stu-id="51719-144">The tasks run asynchronously and may complete in any order.</span></span> <span data-ttu-id="51719-145">Si se obtiene acceso a la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A> antes de que el cálculo se complete, la propiedad bloqueará el subproceso hasta que el valor esté disponible.</span><span class="sxs-lookup"><span data-stu-id="51719-145">If the <xref:System.Threading.Tasks.Task%601.Result%2A> property is accessed before the computation finishes, the property blocks the calling thread until the value is available.</span></span>

[!code-csharp[TPL_TaskIntro#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/result1.cs#4)]
[!code-vb[TPL_TaskIntro#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/result1.vb#4)]

<span data-ttu-id="51719-146">Para obtener más información, vea [Cómo: Devolver un valor a partir de una tarea](how-to-return-a-value-from-a-task.md).</span><span class="sxs-lookup"><span data-stu-id="51719-146">For more information, see [How to: Return a Value from a Task](how-to-return-a-value-from-a-task.md).</span></span>

<span data-ttu-id="51719-147">Cuando se usa una expresión lambda para crear un delegado, se obtiene acceso a todas las variables que están visibles en ese momento en el código fuente.</span><span class="sxs-lookup"><span data-stu-id="51719-147">When you use a lambda expression to create a delegate, you have access to all the variables that are visible at that point in your source code.</span></span> <span data-ttu-id="51719-148">Sin embargo, en algunos casos, sobre todo en los bucles, una expresión lambda no captura la variable como cabría esperar.</span><span class="sxs-lookup"><span data-stu-id="51719-148">However, in some cases, most notably within loops, a lambda doesn't capture the variable as expected.</span></span> <span data-ttu-id="51719-149">Captura solo el valor final, no el valor tal y como se transforma después de cada iteración.</span><span class="sxs-lookup"><span data-stu-id="51719-149">It only captures the final value, not the value as it mutates after each iteration.</span></span> <span data-ttu-id="51719-150">En el siguiente ejemplo se ilustra el problema.</span><span class="sxs-lookup"><span data-stu-id="51719-150">The following example illustrates the problem.</span></span> <span data-ttu-id="51719-151">Pasa un contador de bucle a una expresión lambda que crea instancias de un objeto `CustomData` y usa el contador de bucle como identificador del objeto.</span><span class="sxs-lookup"><span data-stu-id="51719-151">It passes a loop counter to a lambda expression that instantiates a `CustomData` object and uses the loop counter as the object's identifier.</span></span> <span data-ttu-id="51719-152">Como muestra la salida del ejemplo, cada objeto `CustomData` tiene un identificador idéntico.</span><span class="sxs-lookup"><span data-stu-id="51719-152">As the output from the example shows, each `CustomData` object has an identical identifier.</span></span>

[!code-csharp[TPL_TaskIntro#22](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/iteration1b.cs#22)]
[!code-vb[TPL_TaskIntro#22](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/iteration1b.vb#22)]

<span data-ttu-id="51719-153">Puede obtener acceso al valor en cada iteración si proporciona un objeto de estado a una tarea a través de su constructor.</span><span class="sxs-lookup"><span data-stu-id="51719-153">You can access the value on each iteration by providing a state object to a task through its constructor.</span></span> <span data-ttu-id="51719-154">En el ejemplo siguiente se modifica el ejemplo anterior utilizando el contador de bucle al crear el objeto `CustomData` que, a su vez, se pasa a la expresión lambda.</span><span class="sxs-lookup"><span data-stu-id="51719-154">The following example modifies the previous example by using the loop counter when creating the `CustomData` object, which, in turn, is passed to the lambda expression.</span></span>  <span data-ttu-id="51719-155">Como muestra el resultado del ejemplo, cada objeto `CustomData` tiene ahora un identificador único basado en el valor del contador de bucle cuando se creó la instancia del objeto.</span><span class="sxs-lookup"><span data-stu-id="51719-155">As the output from the example shows, each `CustomData` object now has a unique identifier based on the value of the loop counter at the time the object was instantiated.</span></span>

[!code-csharp[TPL_TaskIntro#21](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/iteration1a.cs#21)]
[!code-vb[TPL_TaskIntro#21](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/iteration1a.vb#21)]

<span data-ttu-id="51719-156">Este estado se pasa como argumento al delegado de la tarea y permite tener acceso desde el objeto de tarea mediante la propiedad <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-156">This state is passed as an argument to the task delegate, and it can be accessed from the task object by using the <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="51719-157">El ejemplo siguiente es una variación del ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="51719-157">The following example is a variation on the previous example.</span></span> <span data-ttu-id="51719-158">Utiliza la propiedad <xref:System.Threading.Tasks.Task.AsyncState%2A> para mostrar información sobre los objetos `CustomData` pasados a la expresión lambda.</span><span class="sxs-lookup"><span data-stu-id="51719-158">It uses the <xref:System.Threading.Tasks.Task.AsyncState%2A> property to display information about the `CustomData` objects passed to the lambda expression.</span></span>

[!code-csharp[TPL_TaskIntro#23](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/asyncstate.cs#23)]
[!code-vb[TPL_TaskIntro#23](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/asyncstate.vb#23)]

## <a name="task-id"></a><span data-ttu-id="51719-159">Identificador de tarea</span><span class="sxs-lookup"><span data-stu-id="51719-159">Task ID</span></span>

<span data-ttu-id="51719-160">Cada tarea recibe un identificador entero que la identifica de manera inequívoca en un dominio de aplicación y al que se puede obtener acceso mediante la propiedad <xref:System.Threading.Tasks.Task.Id%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-160">Every task receives an integer ID that uniquely identifies it in an application domain and can be accessed by using the <xref:System.Threading.Tasks.Task.Id%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="51719-161">El identificador resulta útil para ver información sobre la tarea en las ventanas **Pilas paralelas** y **Tareas** del depurador de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="51719-161">The ID is useful for viewing task information in the Visual Studio debugger **Parallel Stacks** and **Tasks** windows.</span></span> <span data-ttu-id="51719-162">El identificador se crea de forma diferida, lo que significa que no se crea hasta que se solicita; por tanto, una tarea podrá tener un identificador diferente cada vez que se ejecute el programa.</span><span class="sxs-lookup"><span data-stu-id="51719-162">The ID is lazily created, which means that it isn't created until it is requested; therefore, a task may have a different ID every time the program is run.</span></span> <span data-ttu-id="51719-163">Para más información sobre cómo ver los identificadores de tarea en el depurador, consulte [Usar la ventana Tareas](/visualstudio/debugger/using-the-tasks-window) y [Usar la ventana Pilas paralelas](/visualstudio/debugger/using-the-parallel-stacks-window).</span><span class="sxs-lookup"><span data-stu-id="51719-163">For more information about how to view task IDs in the debugger, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window) and [Using the Parallel Stacks Window](/visualstudio/debugger/using-the-parallel-stacks-window).</span></span>

## <a name="task-creation-options"></a><span data-ttu-id="51719-164">Opciones de creación de tareas</span><span class="sxs-lookup"><span data-stu-id="51719-164">Task creation options</span></span>

<span data-ttu-id="51719-165">La mayoría de las API que crean tareas proporcionan sobrecargas que aceptan un parámetro <xref:System.Threading.Tasks.TaskCreationOptions>.</span><span class="sxs-lookup"><span data-stu-id="51719-165">Most APIs that create tasks provide overloads that accept a <xref:System.Threading.Tasks.TaskCreationOptions> parameter.</span></span> <span data-ttu-id="51719-166">Al especificar una o más de estas opciones, se le indica al programador de tareas cómo programar la tarea en el grupo de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="51719-166">By specifying one or more of these options, you tell the task scheduler how to schedule the task on the thread pool.</span></span> <span data-ttu-id="51719-167">Las opciones se pueden combinar con una operación **OR** bit a bit.</span><span class="sxs-lookup"><span data-stu-id="51719-167">Options may be combined by using a bitwise **OR** operation.</span></span>

<span data-ttu-id="51719-168">En el ejemplo siguiente se muestra una tarea que tiene las opciones <xref:System.Threading.Tasks.TaskCreationOptions.LongRunning> y <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness>.</span><span class="sxs-lookup"><span data-stu-id="51719-168">The following example shows a task that has the <xref:System.Threading.Tasks.TaskCreationOptions.LongRunning> and <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness> options.</span></span>

[!code-csharp[TPL_TaskIntro#03](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/taskintro.cs#03)]
[!code-vb[TPL_TaskIntro#03](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/tpl_intro.vb#03)]

## <a name="tasks-threads-and-culture"></a><span data-ttu-id="51719-169">Tareas, subprocesos y referencia cultural</span><span class="sxs-lookup"><span data-stu-id="51719-169">Tasks, threads, and culture</span></span>

<span data-ttu-id="51719-170">Cada subproceso tiene asociada una referencia cultural y una interfaz de usuario de referencia cultural, que se definen mediante las propiedades <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> y <xref:System.Threading.Thread.CurrentUICulture%2A?displayProperty=nameWithType>, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="51719-170">Each thread has an associated culture and UI culture, which are defined by the <xref:System.Threading.Thread.CurrentCulture%2A?displayProperty=nameWithType> and <xref:System.Threading.Thread.CurrentUICulture%2A?displayProperty=nameWithType> properties, respectively.</span></span> <span data-ttu-id="51719-171">La referencia cultural de un subproceso se usa en operaciones como dar formato, analizar, ordenar y comparar cadenas.</span><span class="sxs-lookup"><span data-stu-id="51719-171">A thread's culture is used in such operations as formatting, parsing, sorting, and string comparison.</span></span> <span data-ttu-id="51719-172">La referencia cultural de la interfaz de usuario de un subproceso se usa en la búsqueda de recursos.</span><span class="sxs-lookup"><span data-stu-id="51719-172">A thread's UI culture is used in resource lookup.</span></span>

<span data-ttu-id="51719-173">A menos que especifique una referencia cultural predeterminada para todos los subprocesos de un dominio de la aplicación con las propiedades <xref:System.Globalization.CultureInfo.DefaultThreadCurrentCulture%2A?displayProperty=nameWithType> y <xref:System.Globalization.CultureInfo.DefaultThreadCurrentUICulture%2A?displayProperty=nameWithType>, la referencia cultural del sistema define la predeterminada y la de la interfaz de usuario de un subproceso.</span><span class="sxs-lookup"><span data-stu-id="51719-173">Unless you specify a default culture for all the threads in an application domain by using the <xref:System.Globalization.CultureInfo.DefaultThreadCurrentCulture%2A?displayProperty=nameWithType> and <xref:System.Globalization.CultureInfo.DefaultThreadCurrentUICulture%2A?displayProperty=nameWithType> properties, the default culture and UI culture of a thread is defined by the system culture.</span></span> <span data-ttu-id="51719-174">Si establece explícitamente la referencia cultural de un subproceso e inicia un nuevo subproceso, el nuevo subproceso no hereda la referencia cultural del subproceso que realiza la llamada; en su lugar, su referencia cultural es la referencia cultural predeterminada del sistema.</span><span class="sxs-lookup"><span data-stu-id="51719-174">If you explicitly set a thread's culture and launch a new thread, the new thread does not inherit the culture of the calling thread; instead, its culture is the default system culture.</span></span> <span data-ttu-id="51719-175">Pero en la programación basada en tareas, las tareas usan la referencia cultural del subproceso que realiza la llamada, aunque la tarea se ejecute de forma asincrónica en otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="51719-175">However, in task-based programming, tasks use the calling thread's culture, even if the task runs asynchronously on a different thread.</span></span>

<span data-ttu-id="51719-176">Esto se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="51719-176">The following example provides a simple illustration.</span></span> <span data-ttu-id="51719-177">Cambia la referencia cultural actual de la aplicación al francés (Francia), o bien al inglés (Estados Unidos), si el francés (Francia) es la referencia cultural actual.</span><span class="sxs-lookup"><span data-stu-id="51719-177">It changes the app's current culture to French (France) (or, if French (France) is already the current culture, to English (United States)).</span></span> <span data-ttu-id="51719-178">Después, invoca un delegado llamado `formatDelegate` que devuelve algunos números con el formato de valores de moneda de la nueva referencia cultural.</span><span class="sxs-lookup"><span data-stu-id="51719-178">It then invokes a delegate named `formatDelegate` that returns some numbers formatted as currency values in the new culture.</span></span> <span data-ttu-id="51719-179">Si una tarea invoca el delegado de forma sincrónica o asincrónica, la tarea usa la referencia cultural del subproceso que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="51719-179">Whether the delegate is invoked by a task either synchronously or asynchronously, the task uses the culture of the calling thread.</span></span>

:::code language="csharp" source="snippets/cs/asyncculture1.cs" id="1":::

:::code language="vbnet" source="snippets/vb/asyncculture1.vb" id="1":::

> [!NOTE]
> <span data-ttu-id="51719-180">En las versiones de .NET Framework anteriores a .NET Framework 4.6, la referencia cultural de una tarea viene determinada por la referencia cultural del subproceso en el que se *ejecuta* , no por la del *subproceso que realiza la llamada*.</span><span class="sxs-lookup"><span data-stu-id="51719-180">In versions of .NET Framework prior to .NET Framework 4.6, a task's culture is determined by the culture of the thread on which it *runs* , not the culture of the *calling thread*.</span></span> <span data-ttu-id="51719-181">En el caso de las tareas asincrónicas, esto significa que la referencia cultural que usa la tarea podría ser diferente a la del subproceso que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="51719-181">For asynchronous tasks, this means the culture used by the task could be different to the calling thread's culture.</span></span>

<span data-ttu-id="51719-182">Para obtener más información sobre las tareas asincrónicas y la referencia cultural, consulte la sección "Referencia cultural y operaciones asincrónicas basadas en tareas" en el tema <xref:System.Globalization.CultureInfo>.</span><span class="sxs-lookup"><span data-stu-id="51719-182">For more information on asynchronous tasks and culture, see the "Culture and asynchronous task-based operations" section in the <xref:System.Globalization.CultureInfo> topic.</span></span>

## <a name="creating-task-continuations"></a><span data-ttu-id="51719-183">Crear continuaciones de tareas</span><span class="sxs-lookup"><span data-stu-id="51719-183">Creating task continuations</span></span>

<span data-ttu-id="51719-184">Los métodos <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> y <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType> permiten especificar una tarea que se iniciará cuando finalice la *tarea anterior*.</span><span class="sxs-lookup"><span data-stu-id="51719-184">The <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType> methods let you specify a task to start when the *antecedent task* finishes.</span></span> <span data-ttu-id="51719-185">Al delegado de la tarea de continuación se le pasa una referencia a la tarea antecedente para que pueda examinar el estado de dicha tarea y, al recuperar el valor de la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>, puede usar la salida del antecedente como entrada de la continuación.</span><span class="sxs-lookup"><span data-stu-id="51719-185">The delegate of the continuation task is passed a reference to the antecedent task so that it can examine the antecedent task's status and, by retrieving the value of the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property, can use the output of the antecedent as input for the continuation.</span></span>

<span data-ttu-id="51719-186">En el ejemplo siguiente, la tarea `getData` se inicia llamando al método <xref:System.Threading.Tasks.TaskFactory.StartNew%60%601%28System.Func%7B%60%600%7D%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-186">In the following example, the `getData` task is started by a call to the <xref:System.Threading.Tasks.TaskFactory.StartNew%60%601%28System.Func%7B%60%600%7D%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="51719-187">La tarea `processData` se inicia automáticamente cuando finaliza `getData` y `displayData` se inicia cuando finaliza `processData`.</span><span class="sxs-lookup"><span data-stu-id="51719-187">The `processData` task is started automatically when `getData` finishes, and `displayData` is started when `processData` finishes.</span></span> <span data-ttu-id="51719-188">`getData` genera una matriz de enteros, accesible a la tarea `processData` mediante la propiedad `getData` de la tarea <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-188">`getData` produces an integer array, which is accessible to the `processData` task through the `getData` task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="51719-189">La tarea `processData` procesa dicha matriz y devuelve un resultado cuyo tipo se deduce del tipo de valor devuelto de la expresión lambda pasada al método <xref:System.Threading.Tasks.Task%601.ContinueWith%60%601%28System.Func%7BSystem.Threading.Tasks.Task%7B%600%7D%2C%60%600%7D%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-189">The `processData` task processes that array and returns a result whose type is inferred from the return type of the lambda expression passed to the <xref:System.Threading.Tasks.Task%601.ContinueWith%60%601%28System.Func%7BSystem.Threading.Tasks.Task%7B%600%7D%2C%60%600%7D%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="51719-190">La tarea `displayData` se ejecuta automáticamente cuando finaliza `processData` y el objeto <xref:System.Tuple%603> devuelto por la expresión lambda `processData` es accesible para la tarea `displayData` mediante la propiedad `processData` de la tarea <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-190">The `displayData` task executes automatically when `processData` finishes, and the <xref:System.Tuple%603> object returned by the `processData` lambda expression is accessible to the `displayData` task through the `processData` task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="51719-191">La tarea `displayData` toma el resultado de la tarea `processData` y genera un resultado cuyo tipo se deduce de forma similar y que se pone a disposición del programa en la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-191">The `displayData` task takes the result of the `processData` task and produces a result whose type is inferred in a similar manner and which is made available to the program in the <xref:System.Threading.Tasks.Task%601.Result%2A> property.</span></span>

[!code-csharp[TPL_TaskIntro#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/continuations1.cs#5)]
[!code-vb[TPL_TaskIntro#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/continuations1.vb#5)]

<span data-ttu-id="51719-192">Dado que <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> es un método de instancia, puede encadenar llamadas a métodos en lugar de crear instancias de un objeto <xref:System.Threading.Tasks.Task%601> para cada tarea antecedente.</span><span class="sxs-lookup"><span data-stu-id="51719-192">Because <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> is an instance method, you can chain method calls together instead of instantiating a <xref:System.Threading.Tasks.Task%601> object for each antecedent task.</span></span> <span data-ttu-id="51719-193">El ejemplo siguiente es funcionalmente idéntico al anterior, con la diferencia de que encadena llamadas al método <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-193">The following example is functionally identical to the previous example, except that it chains together calls to the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="51719-194">Observe que el objeto <xref:System.Threading.Tasks.Task%601> devuelto por la cadena de llamadas al método es la tarea final de continuación.</span><span class="sxs-lookup"><span data-stu-id="51719-194">Note that the <xref:System.Threading.Tasks.Task%601> object returned by the chain of method calls is the final continuation task.</span></span>

[!code-csharp[TPL_TaskIntro#24](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/continuations2.cs#24)]
[!code-vb[TPL_TaskIntro#24](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/continuations2.vb#24)]

<span data-ttu-id="51719-195">Los métodos <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> y <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> permiten continuar a partir de varias tareas.</span><span class="sxs-lookup"><span data-stu-id="51719-195">The <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> and <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> methods enable you to continue from multiple tasks.</span></span>

<span data-ttu-id="51719-196">Para más información, consulte [Encadenar tareas mediante tareas de continuación](chaining-tasks-by-using-continuation-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="51719-196">For more information, see [Chaining Tasks by Using Continuation Tasks](chaining-tasks-by-using-continuation-tasks.md).</span></span>

## <a name="creating-detached-child-tasks"></a><span data-ttu-id="51719-197">Crear tareas secundarias desasociadas</span><span class="sxs-lookup"><span data-stu-id="51719-197">Creating detached child tasks</span></span>

<span data-ttu-id="51719-198">Cuando el código de usuario que se está ejecutando en una tarea crea una nueva tarea y no especifica la opción <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent>, la nueva tarea no se sincroniza con la tarea principal de ninguna manera especial.</span><span class="sxs-lookup"><span data-stu-id="51719-198">When user code that is running in a task creates a new task and does not specify the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> option, the new task is not synchronized with the parent task in any special way.</span></span> <span data-ttu-id="51719-199">Este tipo de tarea no sincronizada se denomina *tarea anidada desasociada* o *tarea secundaria desasociada*.</span><span class="sxs-lookup"><span data-stu-id="51719-199">This type of non-synchronized task is called a *detached nested task* or *detached child task*.</span></span> <span data-ttu-id="51719-200">En el siguiente ejemplo se muestra una tarea que crea una tarea secundaria desasociada.</span><span class="sxs-lookup"><span data-stu-id="51719-200">The following example shows a task that creates one detached child task.</span></span>

[!code-csharp[TPL_TaskIntro#07](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/taskintro.cs#07)]
[!code-vb[TPL_TaskIntro#07](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/tpl_intro.vb#07)]

<span data-ttu-id="51719-201">Observe que la tarea primaria no espera a que la tarea secundaria desasociada se complete.</span><span class="sxs-lookup"><span data-stu-id="51719-201">Note that the parent task does not wait for the detached child task to finish.</span></span>

## <a name="creating-child-tasks"></a><span data-ttu-id="51719-202">Crear tareas secundarias</span><span class="sxs-lookup"><span data-stu-id="51719-202">Creating child tasks</span></span>

<span data-ttu-id="51719-203">Cuando el código de usuario que se está ejecutando en una tarea crea una tarea con la opción <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent>, la nueva tarea se conoce como una *tarea secundaria asociada* de la tarea principal.</span><span class="sxs-lookup"><span data-stu-id="51719-203">When user code that is running in a task creates a task with the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> option, the new task is known as an *attached child task* of the parent task.</span></span> <span data-ttu-id="51719-204">Puede usar la opción <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> para expresar el paralelismo de tareas estructurado, ya que la tarea primaria espera implícitamente a que todas las tareas secundarias asociadas finalicen.</span><span class="sxs-lookup"><span data-stu-id="51719-204">You can use the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent> option to express structured task parallelism, because the parent task implicitly waits for all attached child tasks to finish.</span></span> <span data-ttu-id="51719-205">En el ejemplo siguiente se muestra una tarea principal que crea diez tareas secundarias adjuntas.</span><span class="sxs-lookup"><span data-stu-id="51719-205">The following example shows a parent task that creates ten attached child tasks.</span></span> <span data-ttu-id="51719-206">Observe que aunque en el ejemplo se llame al método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> para esperar a que la tarea primaria finalice, no tiene que esperar explícitamente a que se completen las tareas secundarias asociadas.</span><span class="sxs-lookup"><span data-stu-id="51719-206">Note that although the example calls the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to wait for the parent task to finish, it does not have to explicitly wait for the attached child tasks to complete.</span></span>

[!code-csharp[TPL_TaskIntro#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/child1.cs#8)]
[!code-vb[TPL_TaskIntro#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/child1.vb#8)]

<span data-ttu-id="51719-207">Una tarea principal puede usar la opción <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> para evitar que otras tareas se asocien a la tarea primaria.</span><span class="sxs-lookup"><span data-stu-id="51719-207">A parent task can use the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option to prevent other tasks from attaching to the parent task.</span></span> <span data-ttu-id="51719-208">Para más información, consulte [Tareas secundarias asociadas y desasociadas](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="51719-208">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="waiting-for-tasks-to-finish"></a><span data-ttu-id="51719-209">Esperar hasta que las tareas finalicen</span><span class="sxs-lookup"><span data-stu-id="51719-209">Waiting for tasks to finish</span></span>

<span data-ttu-id="51719-210">Los tipos <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> y <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> proporcionan varias sobrecargas de los métodos <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> que permiten esperar a que finalice una tarea.</span><span class="sxs-lookup"><span data-stu-id="51719-210">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> types provide several overloads of the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> methods that enable you to wait for a task to finish.</span></span> <span data-ttu-id="51719-211">Además, las sobrecargas del método <xref:System.Threading.Tasks.Task.WaitAll%2A?displayProperty=nameWithType> estático y del método <xref:System.Threading.Tasks.Task.WaitAny%2A?displayProperty=nameWithType> permiten esperar a que finalicen alguna o todas las tareas de una matriz de tareas.</span><span class="sxs-lookup"><span data-stu-id="51719-211">In addition, overloads of the static <xref:System.Threading.Tasks.Task.WaitAll%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WaitAny%2A?displayProperty=nameWithType> methods let you wait for any or all of an array of tasks to finish.</span></span>

<span data-ttu-id="51719-212">Normalmente, una tarea se espera por una de estas razones:</span><span class="sxs-lookup"><span data-stu-id="51719-212">Typically, you would wait for a task for one of these reasons:</span></span>

- <span data-ttu-id="51719-213">El subproceso principal depende del resultado final que se calcula mediante una tarea.</span><span class="sxs-lookup"><span data-stu-id="51719-213">The main thread depends on the final result computed by a task.</span></span>

- <span data-ttu-id="51719-214">Hay que controlar las excepciones que pueden producirse en la tarea.</span><span class="sxs-lookup"><span data-stu-id="51719-214">You have to handle exceptions that might be thrown from the task.</span></span>

- <span data-ttu-id="51719-215">La aplicación puede finalizar antes de que todas las tareas hayan terminado de ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="51719-215">The application may terminate before all tasks have completed execution.</span></span> <span data-ttu-id="51719-216">Por ejemplo, las aplicaciones de consola finalizarán en cuanto se ejecute todo el código sincrónico en `Main` (el punto de entrada de la aplicación).</span><span class="sxs-lookup"><span data-stu-id="51719-216">For example, console applications will terminate as soon as all synchronous code in `Main` (the application entry point) has executed.</span></span>

<span data-ttu-id="51719-217">En el siguiente ejemplo se muestra el modelo básico donde el control de excepciones no está implicado.</span><span class="sxs-lookup"><span data-stu-id="51719-217">The following example shows the basic pattern that does not involve exception handling.</span></span>

[!code-csharp[TPL_TaskIntro#06](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_taskintro/cs/taskintro.cs#06)]
[!code-vb[TPL_TaskIntro#06](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_taskintro/vb/tpl_intro.vb#06)]

<span data-ttu-id="51719-218">Para un ejemplo que muestra el control de excepciones, consulte [Control de excepciones](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="51719-218">For an example that shows exception handling, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>

<span data-ttu-id="51719-219">Algunas sobrecargas permiten especificar un tiempo de espera, mientras que otras toman un objeto <xref:System.Threading.CancellationToken> adicional como parámetro de entrada, de modo que la espera puede cancelarse mediante programación o en respuesta a los datos proporcionados por el usuario.</span><span class="sxs-lookup"><span data-stu-id="51719-219">Some overloads let you specify a time-out, and others take an additional <xref:System.Threading.CancellationToken> as an input parameter, so that the wait itself can be canceled either programmatically or in response to user input.</span></span>

<span data-ttu-id="51719-220">Cuando se espera a una tarea, se espera implícitamente a todos los elementos secundarios de esa tarea que se crearon con la opción <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-220">When you wait for a task, you implicitly wait for all children of that task that were created by using the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option.</span></span> <span data-ttu-id="51719-221"><xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> devuelve un valor inmediatamente si la tarea ya se ha completado.</span><span class="sxs-lookup"><span data-stu-id="51719-221"><xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> returns immediately if the task has already completed.</span></span> <span data-ttu-id="51719-222">Un método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> producirá las tareas generadas por una tarea incluso si se llama a este método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> una vez completada la tarea.</span><span class="sxs-lookup"><span data-stu-id="51719-222">Any exceptions raised by a task will be thrown by a <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method, even if the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method was called after the task completed.</span></span>

## <a name="composing-tasks"></a><span data-ttu-id="51719-223">Componer tareas</span><span class="sxs-lookup"><span data-stu-id="51719-223">Composing tasks</span></span>

<span data-ttu-id="51719-224">Las clases <xref:System.Threading.Tasks.Task> y <xref:System.Threading.Tasks.Task%601> proporcionan varios métodos que pueden ayudar a componer varias tareas para implementar patrones comunes y para mejorar el uso de las características de lenguaje asincrónicas proporcionadas por C#, Visual Basic y F#.</span><span class="sxs-lookup"><span data-stu-id="51719-224">The <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> classes provide several methods that can help you compose multiple tasks to implement common patterns and to better use the asynchronous language features that are provided by C#, Visual Basic, and F#.</span></span> <span data-ttu-id="51719-225">En esta sección se describen los métodos <xref:System.Threading.Tasks.Task.WhenAll%2A>, <xref:System.Threading.Tasks.Task.WhenAny%2A>, <xref:System.Threading.Tasks.Task.Delay%2A> y <xref:System.Threading.Tasks.Task.FromResult%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-225">This section describes the <xref:System.Threading.Tasks.Task.WhenAll%2A>, <xref:System.Threading.Tasks.Task.WhenAny%2A>, <xref:System.Threading.Tasks.Task.Delay%2A>, and <xref:System.Threading.Tasks.Task.FromResult%2A> methods.</span></span>

### <a name="taskwhenall"></a><span data-ttu-id="51719-226">Task.WhenAll</span><span class="sxs-lookup"><span data-stu-id="51719-226">Task.WhenAll</span></span>

<span data-ttu-id="51719-227">El método <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> espera de forma asincrónica a que finalicen varios <xref:System.Threading.Tasks.Task> objetos <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-227">The <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method asynchronously waits for multiple <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to finish.</span></span> <span data-ttu-id="51719-228">Proporciona versiones sobrecargadas que permiten esperar a conjuntos no uniformes de tareas.</span><span class="sxs-lookup"><span data-stu-id="51719-228">It provides overloaded versions that enable you to wait for non-uniform sets of tasks.</span></span> <span data-ttu-id="51719-229">Por ejemplo, puede esperar a que varios objetos <xref:System.Threading.Tasks.Task> y <xref:System.Threading.Tasks.Task%601> se completen de una llamada al método.</span><span class="sxs-lookup"><span data-stu-id="51719-229">For example, you can wait for multiple <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects to complete from one method call.</span></span>

### <a name="taskwhenany"></a><span data-ttu-id="51719-230">Task.WhenAny</span><span class="sxs-lookup"><span data-stu-id="51719-230">Task.WhenAny</span></span>

<span data-ttu-id="51719-231">El método <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> espera de forma asincrónica a que finalice uno de varios <xref:System.Threading.Tasks.Task> objetos <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-231">The <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> method asynchronously waits for one of multiple <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to finish.</span></span> <span data-ttu-id="51719-232">Como en el método <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType>, este método proporciona versiones sobrecargadas que permiten esperar a conjuntos no uniformes de tareas.</span><span class="sxs-lookup"><span data-stu-id="51719-232">As in the <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method, this method provides overloaded versions that enable you to wait for non-uniform sets of tasks.</span></span> <span data-ttu-id="51719-233">El método <xref:System.Threading.Tasks.Task.WhenAny%2A> es especialmente útil en los siguientes escenarios.</span><span class="sxs-lookup"><span data-stu-id="51719-233">The <xref:System.Threading.Tasks.Task.WhenAny%2A> method is especially useful in the following scenarios.</span></span>

- <span data-ttu-id="51719-234">Operaciones redundantes.</span><span class="sxs-lookup"><span data-stu-id="51719-234">Redundant operations.</span></span> <span data-ttu-id="51719-235">Considere un algoritmo o una operación que pueda realizarse de muchas maneras.</span><span class="sxs-lookup"><span data-stu-id="51719-235">Consider an algorithm or operation that can be performed in many ways.</span></span> <span data-ttu-id="51719-236">Puede usar el método <xref:System.Threading.Tasks.Task.WhenAny%2A> para seleccionar la operación que finaliza primero y luego cancelar las operaciones restantes.</span><span class="sxs-lookup"><span data-stu-id="51719-236">You can use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to select the operation that finishes first and then cancel the remaining operations.</span></span>

- <span data-ttu-id="51719-237">Operaciones intercaladas.</span><span class="sxs-lookup"><span data-stu-id="51719-237">Interleaved operations.</span></span> <span data-ttu-id="51719-238">Puede iniciar varias operaciones, todas las cuales deben finalizar y utilizar el método <xref:System.Threading.Tasks.Task.WhenAny%2A> para procesar los resultados cuando finalice cada operación.</span><span class="sxs-lookup"><span data-stu-id="51719-238">You can start multiple operations that must all finish and use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to process results as each operation finishes.</span></span> <span data-ttu-id="51719-239">Finalizada una operación, puede iniciar una o más tareas adicionales.</span><span class="sxs-lookup"><span data-stu-id="51719-239">After one operation finishes, you can start one or more additional tasks.</span></span>

- <span data-ttu-id="51719-240">Operaciones limitadas.</span><span class="sxs-lookup"><span data-stu-id="51719-240">Throttled operations.</span></span> <span data-ttu-id="51719-241">Puede usar el método <xref:System.Threading.Tasks.Task.WhenAny%2A> para extender el escenario anterior limitando el número de operaciones simultáneas.</span><span class="sxs-lookup"><span data-stu-id="51719-241">You can use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to extend the previous scenario by limiting the number of concurrent operations.</span></span>

- <span data-ttu-id="51719-242">Operaciones que han expirado.</span><span class="sxs-lookup"><span data-stu-id="51719-242">Expired operations.</span></span> <span data-ttu-id="51719-243">Puede usar el método <xref:System.Threading.Tasks.Task.WhenAny%2A> para seleccionar entre una o más tareas y una tarea que termina después de un tiempo concreto, como una tarea devuelta por el método <xref:System.Threading.Tasks.Task.Delay%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-243">You can use the <xref:System.Threading.Tasks.Task.WhenAny%2A> method to select between one or more tasks and a task that finishes after a specific time, such as a task that is returned by the <xref:System.Threading.Tasks.Task.Delay%2A> method.</span></span> <span data-ttu-id="51719-244">El método <xref:System.Threading.Tasks.Task.Delay%2A> se describe en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="51719-244">The <xref:System.Threading.Tasks.Task.Delay%2A> method is described in the following section.</span></span>

### <a name="taskdelay"></a><span data-ttu-id="51719-245">Task.Delay</span><span class="sxs-lookup"><span data-stu-id="51719-245">Task.Delay</span></span>

<span data-ttu-id="51719-246">El método <xref:System.Threading.Tasks.Task.Delay%2A?displayProperty=nameWithType> produce un objeto <xref:System.Threading.Tasks.Task> que finaliza tras el tiempo especificado.</span><span class="sxs-lookup"><span data-stu-id="51719-246">The <xref:System.Threading.Tasks.Task.Delay%2A?displayProperty=nameWithType> method produces a <xref:System.Threading.Tasks.Task> object that finishes after the specified time.</span></span> <span data-ttu-id="51719-247">Puede usar este método para crear bucles que sondeen ocasionalmente en busca de datos, introduzcan finales de tiempo de espera, retrasen el control de los datos proporcionados por el usuario durante un tiempo predeterminado, etc.</span><span class="sxs-lookup"><span data-stu-id="51719-247">You can use this method to build loops that occasionally poll for data, introduce time-outs, delay the handling of user input for a predetermined time, and so on.</span></span>

### <a name="tasktfromresult"></a><span data-ttu-id="51719-248">Task(T).FromResult</span><span class="sxs-lookup"><span data-stu-id="51719-248">Task(T).FromResult</span></span>

<span data-ttu-id="51719-249">Mediante el método <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType>, puede crear un objeto <xref:System.Threading.Tasks.Task%601> que contenga un resultado previamente calculado.</span><span class="sxs-lookup"><span data-stu-id="51719-249">By using the <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType> method, you can create a <xref:System.Threading.Tasks.Task%601> object that holds a pre-computed result.</span></span> <span data-ttu-id="51719-250">Este método es útil cuando se realiza una operación asincrónica que devuelve un objeto <xref:System.Threading.Tasks.Task%601> y el resultado de ese objeto <xref:System.Threading.Tasks.Task%601> ya se ha calculado.</span><span class="sxs-lookup"><span data-stu-id="51719-250">This method is useful when you perform an asynchronous operation that returns a <xref:System.Threading.Tasks.Task%601> object, and the result of that <xref:System.Threading.Tasks.Task%601> object is already computed.</span></span> <span data-ttu-id="51719-251">Para obtener un ejemplo en el que se usa <xref:System.Threading.Tasks.Task.FromResult%2A> para recuperar los resultados de las operaciones de descarga asincrónica que se retienen en caché, vea [Procedimiento para crear tareas precalculadas](how-to-create-pre-computed-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="51719-251">For an example that uses <xref:System.Threading.Tasks.Task.FromResult%2A> to retrieve the results of asynchronous download operations that are held in a cache, see [How to: Create Pre-Computed Tasks](how-to-create-pre-computed-tasks.md).</span></span>

## <a name="handling-exceptions-in-tasks"></a><span data-ttu-id="51719-252">Controlar excepciones en tareas</span><span class="sxs-lookup"><span data-stu-id="51719-252">Handling exceptions in tasks</span></span>

<span data-ttu-id="51719-253">Cuando una tarea produce una o más excepciones, las excepciones se encapsulan en una excepción <xref:System.AggregateException>.</span><span class="sxs-lookup"><span data-stu-id="51719-253">When a task throws one or more exceptions, the exceptions are wrapped in an <xref:System.AggregateException> exception.</span></span> <span data-ttu-id="51719-254">Esa excepción se propaga de nuevo al subproceso que se combina con la tarea, que normalmente es el subproceso que está esperando a que la tarea termine o al subproceso que tiene acceso a la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-254">That exception is propagated back to the thread that joins with the task, which is typically the thread that is waiting for the task to finish or the thread that accesses the <xref:System.Threading.Tasks.Task%601.Result%2A> property.</span></span> <span data-ttu-id="51719-255">Este comportamiento sirve para aplicar la directiva de .NET Framework por la que, de manera predeterminada, todas las excepciones no controladas deben terminar el proceso.</span><span class="sxs-lookup"><span data-stu-id="51719-255">This behavior serves to enforce the .NET Framework policy that all unhandled exceptions by default should terminate the process.</span></span> <span data-ttu-id="51719-256">El código de llamada puede controlar las excepciones con cualquiera de los siguientes elementos del bloque `try`/`catch`:</span><span class="sxs-lookup"><span data-stu-id="51719-256">The calling code can handle the exceptions by using any of the following in a `try`/`catch` block:</span></span>

- <span data-ttu-id="51719-257">El método <xref:System.Threading.Tasks.Task.Wait%2A></span><span class="sxs-lookup"><span data-stu-id="51719-257">The <xref:System.Threading.Tasks.Task.Wait%2A> method</span></span>

- <span data-ttu-id="51719-258">El método <xref:System.Threading.Tasks.Task.WaitAll%2A></span><span class="sxs-lookup"><span data-stu-id="51719-258">The <xref:System.Threading.Tasks.Task.WaitAll%2A> method</span></span>

- <span data-ttu-id="51719-259">El método <xref:System.Threading.Tasks.Task.WaitAny%2A></span><span class="sxs-lookup"><span data-stu-id="51719-259">The <xref:System.Threading.Tasks.Task.WaitAny%2A> method</span></span>

- <span data-ttu-id="51719-260">La propiedad <xref:System.Threading.Tasks.Task%601.Result%2A></span><span class="sxs-lookup"><span data-stu-id="51719-260">The <xref:System.Threading.Tasks.Task%601.Result%2A> property</span></span>

<span data-ttu-id="51719-261">El subproceso de unión también puede controlar excepciones; para ello, obtiene acceso a la propiedad <xref:System.Threading.Tasks.Task.Exception%2A> antes de que la tarea se recolecte como elemento no utilizado.</span><span class="sxs-lookup"><span data-stu-id="51719-261">The joining thread can also handle exceptions by accessing the <xref:System.Threading.Tasks.Task.Exception%2A> property before the task is garbage-collected.</span></span> <span data-ttu-id="51719-262">Al obtener acceso a esta propiedad, impide que la excepción no controlada desencadene el comportamiento de propagación de la excepción que termina el proceso cuando el objeto ha finalizado.</span><span class="sxs-lookup"><span data-stu-id="51719-262">By accessing this property, you prevent the unhandled exception from triggering the exception propagation behavior that terminates the process when the object is finalized.</span></span>

<span data-ttu-id="51719-263">Para más información sobre las excepciones y las tareas, consulte [Control de excepciones](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="51719-263">For more information about exceptions and tasks, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>

## <a name="canceling-tasks"></a><span data-ttu-id="51719-264">Cancelar tareas</span><span class="sxs-lookup"><span data-stu-id="51719-264">Canceling tasks</span></span>

<span data-ttu-id="51719-265">La clase <xref:System.Threading.Tasks.Task> admite la cancelación cooperativa y está completamente integrada con las clases <xref:System.Threading.CancellationTokenSource?displayProperty=nameWithType> y <xref:System.Threading.CancellationToken?displayProperty=nameWithType>, que se presentaron en .NET Framework versión 4.</span><span class="sxs-lookup"><span data-stu-id="51719-265">The <xref:System.Threading.Tasks.Task> class supports cooperative cancellation and is fully integrated with the <xref:System.Threading.CancellationTokenSource?displayProperty=nameWithType> and <xref:System.Threading.CancellationToken?displayProperty=nameWithType> classes, which were introduced in the .NET Framework 4.</span></span> <span data-ttu-id="51719-266">Muchos de los constructores de la clase <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> toman un objeto <xref:System.Threading.CancellationToken> como parámetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="51719-266">Many of the constructors in the <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> class take a <xref:System.Threading.CancellationToken> object as an input parameter.</span></span> <span data-ttu-id="51719-267">Muchas de las sobrecargas de <xref:System.Threading.Tasks.TaskFactory.StartNew%2A> y <xref:System.Threading.Tasks.Task.Run%2A> incluyen también un parámetro <xref:System.Threading.CancellationToken>.</span><span class="sxs-lookup"><span data-stu-id="51719-267">Many of the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A> and <xref:System.Threading.Tasks.Task.Run%2A> overloads also include a <xref:System.Threading.CancellationToken> parameter.</span></span>

<span data-ttu-id="51719-268">Puede crear el token y emitir la solicitud de cancelación posteriormente usando la clase <xref:System.Threading.CancellationTokenSource>.</span><span class="sxs-lookup"><span data-stu-id="51719-268">You can create the token, and issue the cancellation request at some later time, by using the <xref:System.Threading.CancellationTokenSource> class.</span></span> <span data-ttu-id="51719-269">A continuación, debe pasar el token a <xref:System.Threading.Tasks.Task> como argumento y hacer referencia al mismo token también en el delegado de usuario, que se encarga de responder a una solicitud de cancelación.</span><span class="sxs-lookup"><span data-stu-id="51719-269">Pass the token to the <xref:System.Threading.Tasks.Task> as an argument, and also reference the same token in your user delegate, which does the work of responding to a cancellation request.</span></span>

<span data-ttu-id="51719-270">Para más información, vea [Cancelación de tareas](task-cancellation.md) y [Cómo: Cancelar una tarea y sus elementos secundarios](how-to-cancel-a-task-and-its-children.md).</span><span class="sxs-lookup"><span data-stu-id="51719-270">For more information, see [Task Cancellation](task-cancellation.md) and [How to: Cancel a Task and Its Children](how-to-cancel-a-task-and-its-children.md).</span></span>

## <a name="the-taskfactory-class"></a><span data-ttu-id="51719-271">Clase TaskFactory</span><span class="sxs-lookup"><span data-stu-id="51719-271">The TaskFactory class</span></span>

<span data-ttu-id="51719-272">La clase <xref:System.Threading.Tasks.TaskFactory> proporciona métodos estáticos que encapsulan algunos modelos comunes de creación e inicio de tareas y tareas de continuación.</span><span class="sxs-lookup"><span data-stu-id="51719-272">The <xref:System.Threading.Tasks.TaskFactory> class provides static methods that encapsulate some common patterns for creating and starting tasks and continuation tasks.</span></span>

- <span data-ttu-id="51719-273">El modelo más común es <xref:System.Threading.Tasks.TaskFactory.StartNew%2A>, que crea e inicia una tarea en una sola instrucción.</span><span class="sxs-lookup"><span data-stu-id="51719-273">The most common pattern is <xref:System.Threading.Tasks.TaskFactory.StartNew%2A>, which creates and starts a task in one statement.</span></span>

- <span data-ttu-id="51719-274">Cuando cree tareas de continuación a partir de varios antecedentes, use el método <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> o el método<xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> o sus equivalentes en la clase <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-274">When you create continuation tasks from multiple antecedents, use the <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> method or <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> method or their equivalents in the <xref:System.Threading.Tasks.Task%601> class.</span></span> <span data-ttu-id="51719-275">Para más información, consulte [Encadenar tareas mediante tareas de continuación](chaining-tasks-by-using-continuation-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="51719-275">For more information, see [Chaining Tasks by Using Continuation Tasks](chaining-tasks-by-using-continuation-tasks.md).</span></span>

- <span data-ttu-id="51719-276">Para encapsular los métodos `BeginX` y `EndX` del modelo de programación asincrónica en una instancia de <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>, use los métodos <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-276">To encapsulate Asynchronous Programming Model `BeginX` and `EndX` methods in a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> instance, use the <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A> methods.</span></span> <span data-ttu-id="51719-277">Para más información, consulte [TPL y la programación asincrónica tradicional de .NET Framework](tpl-and-traditional-async-programming.md).</span><span class="sxs-lookup"><span data-stu-id="51719-277">For more information, see [TPL and Traditional .NET Framework Asynchronous Programming](tpl-and-traditional-async-programming.md).</span></span>

<span data-ttu-id="51719-278">Al objeto <xref:System.Threading.Tasks.TaskFactory> predeterminado se puede tener acceso como propiedad estática de la clase <xref:System.Threading.Tasks.Task> o de la clase <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-278">The default <xref:System.Threading.Tasks.TaskFactory> can be accessed as a static property on the <xref:System.Threading.Tasks.Task> class or <xref:System.Threading.Tasks.Task%601> class.</span></span> <span data-ttu-id="51719-279">También pueden crearse directamente instancias de <xref:System.Threading.Tasks.TaskFactory> y especificar varias opciones entre las que se incluyan las opciones <xref:System.Threading.CancellationToken>, <xref:System.Threading.Tasks.TaskCreationOptions>, <xref:System.Threading.Tasks.TaskContinuationOptions> o <xref:System.Threading.Tasks.TaskScheduler>.</span><span class="sxs-lookup"><span data-stu-id="51719-279">You can also instantiate a <xref:System.Threading.Tasks.TaskFactory> directly and specify various options that include a <xref:System.Threading.CancellationToken>, a <xref:System.Threading.Tasks.TaskCreationOptions> option, a <xref:System.Threading.Tasks.TaskContinuationOptions> option, or a <xref:System.Threading.Tasks.TaskScheduler>.</span></span> <span data-ttu-id="51719-280">Cualquier opción que se especifique al crear el generador de tareas se aplicará a todas las tareas que este generador cree, a menos que <xref:System.Threading.Tasks.Task> se cree usando la enumeración <xref:System.Threading.Tasks.TaskCreationOptions>, en cuyo caso las opciones de la tarea reemplazarán a las del generador de tareas.</span><span class="sxs-lookup"><span data-stu-id="51719-280">Whatever options are specified when you create the task factory will be applied to all tasks that it creates, unless the <xref:System.Threading.Tasks.Task> is created by using the <xref:System.Threading.Tasks.TaskCreationOptions> enumeration, in which case the task's options override those of the task factory.</span></span>

## <a name="tasks-without-delegates"></a><span data-ttu-id="51719-281">Tareas sin delegados</span><span class="sxs-lookup"><span data-stu-id="51719-281">Tasks without delegates</span></span>

<span data-ttu-id="51719-282">En algunos casos, es posible que desee usar un objeto <xref:System.Threading.Tasks.Task> para encapsular alguna operación asincrónica ejecutada por un componente externo en lugar de su propio usuario delegado.</span><span class="sxs-lookup"><span data-stu-id="51719-282">In some cases, you may want to use a <xref:System.Threading.Tasks.Task> to encapsulate some asynchronous operation that is performed by an external component instead of your own user delegate.</span></span> <span data-ttu-id="51719-283">Si la operación se basa en el patrón Begin/End del modelo de programación asincrónica, puede usar los métodos <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-283">If the operation is based on the Asynchronous Programming Model Begin/End pattern, you can use the <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A> methods.</span></span> <span data-ttu-id="51719-284">Si no es este el caso, puede usar el objeto <xref:System.Threading.Tasks.TaskCompletionSource%601> para encapsular la operación en una tarea y, de este modo, aprovechar algunas de las ventajas de programación de <xref:System.Threading.Tasks.Task>, como por ejemplo, su compatibilidad con la propagación de excepciones y el uso de continuaciones.</span><span class="sxs-lookup"><span data-stu-id="51719-284">If that is not the case, you can use the <xref:System.Threading.Tasks.TaskCompletionSource%601> object to wrap the operation in a task and thereby gain some of the benefits of <xref:System.Threading.Tasks.Task> programmability, for example, support for exception propagation and continuations.</span></span> <span data-ttu-id="51719-285">Para obtener más información, vea <xref:System.Threading.Tasks.TaskCompletionSource%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-285">For more information, see <xref:System.Threading.Tasks.TaskCompletionSource%601>.</span></span>

## <a name="custom-schedulers"></a><span data-ttu-id="51719-286">Programadores personalizados</span><span class="sxs-lookup"><span data-stu-id="51719-286">Custom schedulers</span></span>

<span data-ttu-id="51719-287">La mayoría de los desarrolladores de aplicaciones o bibliotecas no prestan atención al procesador en el que se ejecuta la tarea, al modo en que la tarea sincroniza su trabajo con otras tareas o al modo en que se programa la tarea en el objeto <xref:System.Threading.ThreadPool?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-287">Most application or library developers do not care which processor the task runs on, how it synchronizes its work with other tasks, or how it is scheduled on the <xref:System.Threading.ThreadPool?displayProperty=nameWithType>.</span></span> <span data-ttu-id="51719-288">Solo necesitan que la ejecución en el equipo host sea lo más eficaz posible.</span><span class="sxs-lookup"><span data-stu-id="51719-288">They only require that it execute as efficiently as possible on the host computer.</span></span> <span data-ttu-id="51719-289">Si necesita tener un control más minucioso sobre los detalles de programación, la biblioteca TPL permite configurar algunos valores del programador de tareas predeterminado e incluso permite proporcionar un programador personalizado.</span><span class="sxs-lookup"><span data-stu-id="51719-289">If you require more fine-grained control over the scheduling details, the Task Parallel Library lets you configure some settings on the default task scheduler, and even lets you supply a custom scheduler.</span></span> <span data-ttu-id="51719-290">Para obtener más información, vea <xref:System.Threading.Tasks.TaskScheduler>.</span><span class="sxs-lookup"><span data-stu-id="51719-290">For more information, see <xref:System.Threading.Tasks.TaskScheduler>.</span></span>

## <a name="related-data-structures"></a><span data-ttu-id="51719-291">Estructuras de datos relacionados</span><span class="sxs-lookup"><span data-stu-id="51719-291">Related data structures</span></span>

<span data-ttu-id="51719-292">TPL tiene varios tipos públicos nuevos que resultan útiles tanto en escenarios en paralelo como en escenarios secuenciales.</span><span class="sxs-lookup"><span data-stu-id="51719-292">The TPL has several new public types that are useful in both parallel and sequential scenarios.</span></span> <span data-ttu-id="51719-293">Entre ellos, se incluyen diversas clases de colecciones multiproceso rápidas y escalables del espacio de nombres <xref:System.Collections.Concurrent?displayProperty=nameWithType> y varios tipos nuevos de sincronización, como <xref:System.Threading.Semaphore?displayProperty=nameWithType> y <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType>, que resultan más eficaces que sus predecesores en tipos concretos de cargas de trabajo.</span><span class="sxs-lookup"><span data-stu-id="51719-293">These include several thread-safe, fast and scalable collection classes in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace, and several new synchronization types, for example, <xref:System.Threading.Semaphore?displayProperty=nameWithType> and <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType>, which are more efficient than their predecessors for specific kinds of workloads.</span></span> <span data-ttu-id="51719-294">Otros tipos nuevos de .NET Framework versión 4, como <xref:System.Threading.Barrier?displayProperty=nameWithType> y <xref:System.Threading.SpinLock?displayProperty=nameWithType>, proporcionan una funcionalidad que no estaba disponible en versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="51719-294">Other new types in the .NET Framework 4, for example, <xref:System.Threading.Barrier?displayProperty=nameWithType> and <xref:System.Threading.SpinLock?displayProperty=nameWithType>, provide functionality that was not available in earlier releases.</span></span> <span data-ttu-id="51719-295">Para más información, consulte [Estructuras de datos para la programación paralela](data-structures-for-parallel-programming.md).</span><span class="sxs-lookup"><span data-stu-id="51719-295">For more information, see [Data Structures for Parallel Programming](data-structures-for-parallel-programming.md).</span></span>

## <a name="custom-task-types"></a><span data-ttu-id="51719-296">Tipos de tarea personalizados</span><span class="sxs-lookup"><span data-stu-id="51719-296">Custom task types</span></span>

<span data-ttu-id="51719-297">Se recomienda no heredar de <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> ni de <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="51719-297">We recommend that you do not inherit from <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>.</span></span> <span data-ttu-id="51719-298">En su lugar, se recomienda usar la propiedad <xref:System.Threading.Tasks.Task.AsyncState%2A> para asociar los datos adicionales o el estado a un objeto <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-298">Instead, we recommend that you use the <xref:System.Threading.Tasks.Task.AsyncState%2A> property to associate additional data or state with a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> object.</span></span> <span data-ttu-id="51719-299">También puede usar métodos de extensión para extender la funcionalidad de las clases <xref:System.Threading.Tasks.Task> y <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-299">You can also use extension methods to extend the functionality of the <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> classes.</span></span> <span data-ttu-id="51719-300">Para más información sobre los métodos de extensión, consulte [Métodos de extensión (C#)](../../csharp/programming-guide/classes-and-structs/extension-methods.md) y [Métodos de extensión (Visual Basic)](../../visual-basic/programming-guide/language-features/procedures/extension-methods.md).</span><span class="sxs-lookup"><span data-stu-id="51719-300">For more information about extension methods, see [Extension Methods](../../csharp/programming-guide/classes-and-structs/extension-methods.md) and [Extension Methods](../../visual-basic/programming-guide/language-features/procedures/extension-methods.md).</span></span>

<span data-ttu-id="51719-301">Si debe heredar de <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>, no puede usar <xref:System.Threading.Tasks.Task.Run%2A>, o las clases <xref:System.Threading.Tasks.TaskFactory?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskFactory%601?displayProperty=nameWithType> o <xref:System.Threading.Tasks.TaskCompletionSource%601?displayProperty=nameWithType>, para crear instancias del tipo de tarea personalizada porque estos mecanismos solo crean objetos <xref:System.Threading.Tasks.Task> y objetos <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-301">If you must inherit from <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, you cannot use <xref:System.Threading.Tasks.Task.Run%2A>, or the <xref:System.Threading.Tasks.TaskFactory?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskFactory%601?displayProperty=nameWithType>, or <xref:System.Threading.Tasks.TaskCompletionSource%601?displayProperty=nameWithType> classes to create instances of your custom task type because these mechanisms create only <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects.</span></span> <span data-ttu-id="51719-302">Además, no puede usar los mecanismos de continuación de tarea proporcionados por <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.TaskFactory> y <xref:System.Threading.Tasks.TaskFactory%601> para crear instancias del tipo de tarea personalizada porque también estos mecanismos crean solo objetos <xref:System.Threading.Tasks.Task> y <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="51719-302">In addition, you cannot use the task continuation mechanisms that are provided by <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.TaskFactory>, and  <xref:System.Threading.Tasks.TaskFactory%601> to create instances of your custom task type because these mechanisms also create only <xref:System.Threading.Tasks.Task> and  <xref:System.Threading.Tasks.Task%601> objects.</span></span>

## <a name="related-topics"></a><span data-ttu-id="51719-303">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="51719-303">Related topics</span></span>

|<span data-ttu-id="51719-304">Title</span><span class="sxs-lookup"><span data-stu-id="51719-304">Title</span></span>|<span data-ttu-id="51719-305">Descripción</span><span class="sxs-lookup"><span data-stu-id="51719-305">Description</span></span>|
|-|-|
|[<span data-ttu-id="51719-306">Encadenar tareas mediante tareas de continuación</span><span class="sxs-lookup"><span data-stu-id="51719-306">Chaining Tasks by Using Continuation Tasks</span></span>](chaining-tasks-by-using-continuation-tasks.md)|<span data-ttu-id="51719-307">Describe el funcionamiento de las continuaciones.</span><span class="sxs-lookup"><span data-stu-id="51719-307">Describes how continuations work.</span></span>|
|<span data-ttu-id="51719-308">[Attached and Detached Child Tasks](attached-and-detached-child-tasks.md) (Tareas secundarias asociadas y desasociadas)</span><span class="sxs-lookup"><span data-stu-id="51719-308">[Attached and Detached Child Tasks](attached-and-detached-child-tasks.md)</span></span>|<span data-ttu-id="51719-309">Describe la diferencia entre las tareas secundarias asociadas y desasociadas.</span><span class="sxs-lookup"><span data-stu-id="51719-309">Describes the difference between attached and detached child tasks.</span></span>|
|[<span data-ttu-id="51719-310">Cancelación de tareas</span><span class="sxs-lookup"><span data-stu-id="51719-310">Task Cancellation</span></span>](task-cancellation.md)|<span data-ttu-id="51719-311">Describe la compatibilidad con la cancelación que está integrada en el objeto <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="51719-311">Describes the cancellation support that is built into the <xref:System.Threading.Tasks.Task> object.</span></span>|
|[<span data-ttu-id="51719-312">Control de excepciones</span><span class="sxs-lookup"><span data-stu-id="51719-312">Exception Handling</span></span>](exception-handling-task-parallel-library.md)|<span data-ttu-id="51719-313">Describe cómo se controlan excepciones en subprocesos simultáneos.</span><span class="sxs-lookup"><span data-stu-id="51719-313">Describes how exceptions on concurrent threads are handled.</span></span>|
|[<span data-ttu-id="51719-314">Cómo: Usar Parallel.Invoke para ejecutar operaciones en paralelo</span><span class="sxs-lookup"><span data-stu-id="51719-314">How to: Use Parallel.Invoke to Execute Parallel Operations</span></span>](how-to-use-parallel-invoke-to-execute-parallel-operations.md)|<span data-ttu-id="51719-315">Describe cómo usar <xref:System.Threading.Tasks.Parallel.Invoke%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-315">Describes how to use <xref:System.Threading.Tasks.Parallel.Invoke%2A>.</span></span>|
|[<span data-ttu-id="51719-316">Cómo: Devolver un valor a partir de una tarea</span><span class="sxs-lookup"><span data-stu-id="51719-316">How to: Return a Value from a Task</span></span>](how-to-return-a-value-from-a-task.md)|<span data-ttu-id="51719-317">Describe cómo devolver valores de tareas.</span><span class="sxs-lookup"><span data-stu-id="51719-317">Describes how to return values from tasks.</span></span>|
|[<span data-ttu-id="51719-318">Cómo: Cancelar una tarea y sus elementos secundarios</span><span class="sxs-lookup"><span data-stu-id="51719-318">How to: Cancel a Task and Its Children</span></span>](how-to-cancel-a-task-and-its-children.md)|<span data-ttu-id="51719-319">Describe cómo cancelar tareas.</span><span class="sxs-lookup"><span data-stu-id="51719-319">Describes how to cancel tasks.</span></span>|
|[<span data-ttu-id="51719-320">Cómo: Crear tareas precalculadas</span><span class="sxs-lookup"><span data-stu-id="51719-320">How to: Create Pre-Computed Tasks</span></span>](how-to-create-pre-computed-tasks.md)|<span data-ttu-id="51719-321">Describe cómo utilizar el método <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType> para recuperar los resultados de las operaciones asincrónicas de descarga que se retienen en una memoria caché.</span><span class="sxs-lookup"><span data-stu-id="51719-321">Describes how to use the <xref:System.Threading.Tasks.Task.FromResult%2A?displayProperty=nameWithType> method to retrieve the results of asynchronous download operations that are held in a cache.</span></span>|
|[<span data-ttu-id="51719-322">Cómo: Recorrer un árbol binario con tareas en paralelo</span><span class="sxs-lookup"><span data-stu-id="51719-322">How to: Traverse a Binary Tree with Parallel Tasks</span></span>](how-to-traverse-a-binary-tree-with-parallel-tasks.md)|<span data-ttu-id="51719-323">Describe cómo utilizar tareas para atravesar un árbol binario.</span><span class="sxs-lookup"><span data-stu-id="51719-323">Describes how to use tasks to traverse a binary tree.</span></span>|
|[<span data-ttu-id="51719-324">Cómo: Desencapsular una tarea anidada</span><span class="sxs-lookup"><span data-stu-id="51719-324">How to: Unwrap a Nested Task</span></span>](how-to-unwrap-a-nested-task.md)|<span data-ttu-id="51719-325">Demuestra cómo utilizar el método de extensión <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A>.</span><span class="sxs-lookup"><span data-stu-id="51719-325">Demonstrates how to use the <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> extension method.</span></span>|
|[<span data-ttu-id="51719-326">Paralelismo de datos</span><span class="sxs-lookup"><span data-stu-id="51719-326">Data Parallelism</span></span>](data-parallelism-task-parallel-library.md)|<span data-ttu-id="51719-327">Describe cómo usar <xref:System.Threading.Tasks.Parallel.For%2A> y <xref:System.Threading.Tasks.Parallel.ForEach%2A> para crear bucles paralelos sobre los datos.</span><span class="sxs-lookup"><span data-stu-id="51719-327">Describes how to use <xref:System.Threading.Tasks.Parallel.For%2A> and <xref:System.Threading.Tasks.Parallel.ForEach%2A> to create parallel loops over data.</span></span>|
|[<span data-ttu-id="51719-328">Programación en paralelo</span><span class="sxs-lookup"><span data-stu-id="51719-328">Parallel Programming</span></span>](index.md)|<span data-ttu-id="51719-329">Nodo de nivel superior de la programación en paralelo de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="51719-329">Top level node for .NET Framework parallel programming.</span></span>|

## <a name="see-also"></a><span data-ttu-id="51719-330">Vea también</span><span class="sxs-lookup"><span data-stu-id="51719-330">See also</span></span>

- [<span data-ttu-id="51719-331">Programación en paralelo</span><span class="sxs-lookup"><span data-stu-id="51719-331">Parallel Programming</span></span>](index.md)
- [<span data-ttu-id="51719-332">Ejemplos de programación en paralelo con .NET Core y .NET Standard</span><span class="sxs-lookup"><span data-stu-id="51719-332">Samples for Parallel Programming with the .NET Core & .NET Standard</span></span>](/samples/browse/?products=dotnet-core%2Cdotnet-standard&term=parallel)
