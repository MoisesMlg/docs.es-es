---
title: 'Tutorial: Usar flujos de datos en aplicaciones de Windows Forms'
ms.date: 03/30/2017
helpviewer_keywords:
- TPL dataflow library, in Windows Forms
- Task Parallel Library, dataflows
- Windows Forms, and TPL
ms.assetid: 9c65cdf7-660c-409f-89ea-59d7ec8e127c
ms.openlocfilehash: c09259afdc5ede32791ba895ca012cdc2a0a1c18
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/18/2020
ms.locfileid: "94829952"
---
# <a name="walkthrough-using-dataflow-in-a-windows-forms-application"></a><span data-ttu-id="a9b1b-102">Tutorial: Usar flujos de datos en aplicaciones de Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a9b1b-102">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>
<span data-ttu-id="a9b1b-103">Este documento muestra cómo crear una red de bloques de flujo de datos que realizan el procesamiento de imágenes en una aplicación de Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-103">This document demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>  
  
 <span data-ttu-id="a9b1b-104">En este ejemplo se cargan archivos de imagen de la carpeta especificada, se crea una imagen compuesta y se muestra el resultado.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-104">This example loads image files from the specified folder, creates a composite image, and displays the result.</span></span> <span data-ttu-id="a9b1b-105">En el ejemplo se utiliza el modelo de flujo de datos para distribuir las imágenes por la red.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-105">The example uses the dataflow model to route images through the network.</span></span> <span data-ttu-id="a9b1b-106">En el modelo de flujo de datos, los componentes independientes de un programa se comunican entre sí mediante mensajes.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-106">In the dataflow model, independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="a9b1b-107">Cuando un componente recibe un mensaje, realiza alguna acción y pasa el resultado a otro componente.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-107">When a component receives a message, it performs some action and then passes the result to another component.</span></span> <span data-ttu-id="a9b1b-108">Compare esto con el modelo de flujo de control, en el que una aplicación utiliza estructuras de control, como por ejemplo, instrucciones condicionales, bucles, etc., para controlar el orden de las operaciones en un programa.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-108">Compare this with the control flow model, in which an application uses control structures, for example, conditional statements, loops, and so on, to control the order of operations in a program.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="a9b1b-109">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="a9b1b-109">Prerequisites</span></span>  
 <span data-ttu-id="a9b1b-110">Lea [Flujo de datos](dataflow-task-parallel-library.md) antes de empezar este tutorial.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-110">Read [Dataflow](dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="sections"></a><span data-ttu-id="a9b1b-111">Secciones</span><span class="sxs-lookup"><span data-stu-id="a9b1b-111">Sections</span></span>  
 <span data-ttu-id="a9b1b-112">Este tutorial contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="a9b1b-112">This walkthrough contains the following sections:</span></span>  
  
- [<span data-ttu-id="a9b1b-113">Crear una aplicación de Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a9b1b-113">Creating the Windows Forms Application</span></span>](#winforms)  
  
- [<span data-ttu-id="a9b1b-114">Crear la red del flujo de datos</span><span class="sxs-lookup"><span data-stu-id="a9b1b-114">Creating the Dataflow Network</span></span>](#network)  
  
- [<span data-ttu-id="a9b1b-115">Conectar la red del flujo de datos a la interfaz de usuario</span><span class="sxs-lookup"><span data-stu-id="a9b1b-115">Connecting the Dataflow Network to the User Interface</span></span>](#ui)  
  
- [<span data-ttu-id="a9b1b-116">Ejemplo completo</span><span class="sxs-lookup"><span data-stu-id="a9b1b-116">The Complete Example</span></span>](#complete)  
  
<a name="winforms"></a>
## <a name="creating-the-windows-forms-application"></a><span data-ttu-id="a9b1b-117">Crear una aplicación de Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a9b1b-117">Creating the Windows Forms Application</span></span>  
 <span data-ttu-id="a9b1b-118">En esta sección se describe cómo crear la aplicación básica de Windows Forms y agregar controles al formulario principal.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-118">This section describes how to create the basic Windows Forms application and add controls to the main form.</span></span>  
  
### <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="a9b1b-119">Para crear la aplicación de Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a9b1b-119">To Create the Windows Forms Application</span></span>  
  
1. <span data-ttu-id="a9b1b-120">En Visual Studio, cree un proyecto **Aplicación de Windows Forms** de Visual C# o Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-120">In Visual Studio, create a Visual C# or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="a9b1b-121">En este documento, el proyecto se denomina `CompositeImages`.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-121">In this document, the project is named `CompositeImages`.</span></span>  
  
2. <span data-ttu-id="a9b1b-122">En el diseñador de formularios del formulario principal, Form1.cs (Form1.vb para Visual Basic), agregue un control <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-122">On the form designer for the main form, Form1.cs (Form1.vb for Visual Basic), add a <xref:System.Windows.Forms.ToolStrip> control.</span></span>  
  
3. <span data-ttu-id="a9b1b-123">Agregue un control <xref:System.Windows.Forms.ToolStripButton> al control <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-123">Add a <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="a9b1b-124">Establezca la propiedad <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> en <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> y la propiedad <xref:System.Windows.Forms.ToolStripItem.Text%2A> en **Elegir carpeta**.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-124">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> and the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Choose Folder**.</span></span>  
  
4. <span data-ttu-id="a9b1b-125">Agregue un segundo control <xref:System.Windows.Forms.ToolStripButton> al control <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-125">Add a second <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="a9b1b-126">Establezca la propiedad <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> en <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, la propiedad <xref:System.Windows.Forms.ToolStripItem.Text%2A> en **Cancelar** y la propiedad <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> en `False`.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-126">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Cancel**, and the <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> property to `False`.</span></span>  
  
5. <span data-ttu-id="a9b1b-127">Agregue un objeto <xref:System.Windows.Forms.PictureBox> al formulario principal.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-127">Add a <xref:System.Windows.Forms.PictureBox> object to the main form.</span></span> <span data-ttu-id="a9b1b-128">Establezca la propiedad <xref:System.Windows.Forms.Control.Dock%2A> en <xref:System.Windows.Forms.DockStyle.Fill>.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-128">Set the <xref:System.Windows.Forms.Control.Dock%2A> property to <xref:System.Windows.Forms.DockStyle.Fill>.</span></span>  
  
<a name="network"></a>
## <a name="creating-the-dataflow-network"></a><span data-ttu-id="a9b1b-129">Crear la red del flujo de datos</span><span class="sxs-lookup"><span data-stu-id="a9b1b-129">Creating the Dataflow Network</span></span>  
 <span data-ttu-id="a9b1b-130">En esta sección se describe cómo crear la red del flujo de datos que lleva a cabo el procesamiento de imágenes.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-130">This section describes how to create the dataflow network that performs image processing.</span></span>  
  
### <a name="to-create-the-dataflow-network"></a><span data-ttu-id="a9b1b-131">Para crear la red del flujo de datos</span><span class="sxs-lookup"><span data-stu-id="a9b1b-131">To Create the Dataflow Network</span></span>  
  
1. <span data-ttu-id="a9b1b-132">Agregue a su proyecto una referencia a System.Threading.Tasks.Dataflow.dll.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-132">Add a reference to System.Threading.Tasks.Dataflow.dll to your project.</span></span>  
  
2. <span data-ttu-id="a9b1b-133">Asegúrese de que Form1.cs (Form1.vb para Visual Basic) contenga las siguientes instrucciones `using` (`Using` en Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="a9b1b-133">Ensure that Form1.cs (Form1.vb for Visual Basic) contains the following `using` (`Using` in Visual Basic) statements:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#1)]  
  
3. <span data-ttu-id="a9b1b-134">Agregue a la clase `Form1` los miembros de datos siguientes:</span><span class="sxs-lookup"><span data-stu-id="a9b1b-134">Add the following data members to the `Form1` class:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#2)]  
  
4. <span data-ttu-id="a9b1b-135">Agregue el método siguiente, `CreateImageProcessingNetwork`, a la clase `Form1`.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-135">Add the following method, `CreateImageProcessingNetwork`, to the `Form1` class.</span></span> <span data-ttu-id="a9b1b-136">Este método crea la red de procesamiento de imágenes.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-136">This method creates the image processing network.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#3)]  
  
5. <span data-ttu-id="a9b1b-137">Implemente el método `LoadBitmaps`.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-137">Implement the `LoadBitmaps` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#4)]  
  
6. <span data-ttu-id="a9b1b-138">Implemente el método `CreateCompositeBitmap`.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-138">Implement the `CreateCompositeBitmap` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#5)]  
  
    > [!NOTE]
    > <span data-ttu-id="a9b1b-139">La versión de C# del método `CreateCompositeBitmap` utiliza punteros para permitir un procesamiento eficaz de los objetos <xref:System.Drawing.Bitmap?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-139">The C# version of the `CreateCompositeBitmap` method uses pointers to enable efficient processing of the <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objects.</span></span> <span data-ttu-id="a9b1b-140">Por lo tanto, debe habilitar la opción **Permitir código no seguro** en el proyecto para utilizar la palabra clave [unsafe](../../csharp/language-reference/keywords/unsafe.md).</span><span class="sxs-lookup"><span data-stu-id="a9b1b-140">Therefore, you must enable the **Allow unsafe code** option in your project in order to use the [unsafe](../../csharp/language-reference/keywords/unsafe.md) keyword.</span></span> <span data-ttu-id="a9b1b-141">Para obtener más información sobre cómo habilitar el código no seguro en un proyecto de Visual C#, vea [Compilar (Página, Diseñador de proyectos) (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span><span class="sxs-lookup"><span data-stu-id="a9b1b-141">For more information about how to enable unsafe code in a Visual C# project, see [Build Page, Project Designer (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span></span>  
  
 <span data-ttu-id="a9b1b-142">En la tabla siguiente se describen los miembros de la red.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-142">The following table describes the members of the network.</span></span>  
  
|<span data-ttu-id="a9b1b-143">Member</span><span class="sxs-lookup"><span data-stu-id="a9b1b-143">Member</span></span>|<span data-ttu-id="a9b1b-144">Tipo</span><span class="sxs-lookup"><span data-stu-id="a9b1b-144">Type</span></span>|<span data-ttu-id="a9b1b-145">Description</span><span class="sxs-lookup"><span data-stu-id="a9b1b-145">Description</span></span>|  
|------------|----------|-----------------|  
|`loadBitmaps`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="a9b1b-146">Acepta una ruta de carpeta como entrada y genera una colección de objetos <xref:System.Drawing.Bitmap> como salida.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-146">Takes a folder path as input and produces a collection of <xref:System.Drawing.Bitmap> objects as output.</span></span>|  
|`createCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="a9b1b-147">Acepta una colección de objetos <xref:System.Drawing.Bitmap> como entrada y produce un mapa de bits compuesto como salida.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-147">Takes a collection of <xref:System.Drawing.Bitmap> objects as input and produces a composite bitmap as output.</span></span>|  
|`displayCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="a9b1b-148">Muestra el mapa de bits compuesto en el formulario.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-148">Displays the composite bitmap on the form.</span></span>|  
|`operationCancelled`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="a9b1b-149">Muestra una imagen para indicar que la operación se cancela y permite al usuario seleccionar otra carpeta.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-149">Displays an image to indicate that the operation is canceled and enables the user to select another folder.</span></span>|  
  
 <span data-ttu-id="a9b1b-150">Para conectar los bloques de flujo de datos para formar una red, este ejemplo usa el método <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A>.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-150">To connect the dataflow blocks to form a network, this example uses the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method.</span></span> <span data-ttu-id="a9b1b-151">El método <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> contiene una versión sobrecargada que adopta un objeto <xref:System.Predicate%601> que determina si el bloque de destino acepta o rechaza un mensaje.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-151">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method contains an overloaded version that takes a <xref:System.Predicate%601> object that determines whether the target block accepts or rejects a message.</span></span> <span data-ttu-id="a9b1b-152">Este mecanismo de filtrado permite que los bloques de mensajes reciban solo ciertos valores.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-152">This filtering mechanism enables message blocks to receive only certain values.</span></span> <span data-ttu-id="a9b1b-153">En este ejemplo, la red puede dividirse en ramas de una de dos maneras.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-153">In this example, the network can branch in one of two ways.</span></span> <span data-ttu-id="a9b1b-154">La rama principal carga las imágenes desde el disco, crea la imagen compuesta y la muestra en el formulario.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-154">The main branch loads the images from disk, creates the composite image, and displays that image on the form.</span></span> <span data-ttu-id="a9b1b-155">La rama alternativa cancela la operación actual.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-155">The alternate branch cancels the current operation.</span></span> <span data-ttu-id="a9b1b-156">Los objetos <xref:System.Predicate%601> permiten que los bloques de flujo de datos en la rama principal cambien a la rama alternativa al rechazar determinados mensajes.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-156">The <xref:System.Predicate%601> objects enable the dataflow blocks along the main branch to switch to the alternative branch by rejecting certain messages.</span></span> <span data-ttu-id="a9b1b-157">Por ejemplo, si el usuario cancela la operación, el bloque de flujo de datos `createCompositeBitmap` produce `null` (`Nothing` en Visual Basic) como salida.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-157">For example, if the user cancels the operation, the dataflow block `createCompositeBitmap` produces `null` (`Nothing` in Visual Basic) as its output.</span></span> <span data-ttu-id="a9b1b-158">El bloque de flujo de datos `displayCompositeBitmap` rechaza valores de entrada `null` y, por lo tanto, el mensaje se ofrece a `operationCancelled`.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-158">The dataflow block `displayCompositeBitmap` rejects `null` input values, and therefore, the message is offered to `operationCancelled`.</span></span> <span data-ttu-id="a9b1b-159">El bloque de flujo de datos `operationCancelled` acepta todos los mensajes y, por lo tanto, muestra una imagen para indicar que se ha cancelado la operación.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-159">The dataflow block `operationCancelled` accepts all messages and therefore, displays an image to indicate that the operation is canceled.</span></span>  
  
 <span data-ttu-id="a9b1b-160">En la ilustración siguiente se muestra la red de procesamiento de imágenes:</span><span class="sxs-lookup"><span data-stu-id="a9b1b-160">The following illustration shows the image processing network:</span></span>  
  
 ![Ilustración en la que se muestra la red de procesamiento de imágenes.](./media/walkthrough-using-dataflow-in-a-windows-forms-application/dataflow-winforms-image-processing.png)  
  
 <span data-ttu-id="a9b1b-162">Dado que los bloques de flujo de datos `displayCompositeBitmap` y `operationCancelled` actúan sobre la interfaz de usuario, es importante que esta acción se produzca en el subproceso de interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-162">Because the `displayCompositeBitmap` and `operationCancelled` dataflow blocks act on the user interface, it is important that these actions occur on the user-interface thread.</span></span> <span data-ttu-id="a9b1b-163">Para lograrlo, durante la construcción, cada uno de estos objetos proporciona un objeto <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> que tiene la propiedad <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> establecida como <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-163">To accomplish this, during construction, these objects each provide a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="a9b1b-164">El método <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> crea un objeto <xref:System.Threading.Tasks.TaskScheduler> que funciona en el contexto de sincronización actual.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-164">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="a9b1b-165">Como se llama al método `CreateImageProcessingNetwork` desde el controlador del botón **Elegir carpeta**, que se ejecuta en el subproceso de la interfaz de usuario, las acciones para los bloques de flujo de datos `displayCompositeBitmap` y `operationCancelled` también se ejecutan en el subproceso de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-165">Because the `CreateImageProcessingNetwork` method is called from the handler of the **Choose Folder** button, which runs on the user-interface thread, the actions for the `displayCompositeBitmap` and `operationCancelled` dataflow blocks also run on the user-interface thread.</span></span>  
  
 <span data-ttu-id="a9b1b-166">Este ejemplo usa un token de cancelación compartido en lugar de establecer la propiedad <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>, porque la propiedad <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> cancela permanentemente la ejecución del bloque de flujo de datos.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-166">This example uses a shared cancellation token instead of setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property because the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property permanently cancels dataflow block execution.</span></span> <span data-ttu-id="a9b1b-167">En este ejemplo, un token de cancelación permite reutilizar la misma red del flujo de datos varias veces, incluso cuando el usuario cancela una o varias operaciones.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-167">A cancellation token enables this example to reuse the same dataflow network multiple times, even when the user cancels one or more operations.</span></span> <span data-ttu-id="a9b1b-168">Para obtener un ejemplo que usa <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> para cancelar la ejecución de un bloque de flujo de datos de modo permanente, vea [Cómo: Cancelar un bloque de flujos de datos](how-to-cancel-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="a9b1b-168">For an example that uses <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> to permanently cancel the execution of a dataflow block, see [How to: Cancel a Dataflow Block](how-to-cancel-a-dataflow-block.md).</span></span>  
  
<a name="ui"></a>
## <a name="connecting-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="a9b1b-169">Conectar la red del flujo de datos a la interfaz de usuario</span><span class="sxs-lookup"><span data-stu-id="a9b1b-169">Connecting the Dataflow Network to the User Interface</span></span>  
 <span data-ttu-id="a9b1b-170">En esta sección se describe cómo conectar la red del flujo de datos a la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-170">This section describes how to connect the dataflow network to the user interface.</span></span> <span data-ttu-id="a9b1b-171">La creación de la imagen compuesta y la cancelación de la operación se inician desde los botones **Elegir carpeta** y **Cancelar**.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-171">The creation of the composite image and cancellation of the operation are initiated from the **Choose Folder** and **Cancel** buttons.</span></span> <span data-ttu-id="a9b1b-172">Cuando el usuario elige cualquiera de ellos, se inicia la acción correspondiente de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-172">When the user chooses either of these buttons, the appropriate action is initiated in an asynchronous manner.</span></span>  
  
### <a name="to-connect-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="a9b1b-173">Para conectar la red del flujo de datos a la interfaz de usuario</span><span class="sxs-lookup"><span data-stu-id="a9b1b-173">To Connect the Dataflow Network to the User Interface</span></span>  
  
1. <span data-ttu-id="a9b1b-174">En el diseñador de formularios del formulario principal, cree un controlador de eventos para el evento <xref:System.Windows.Forms.ToolStripItem.Click> del botón **Elegir carpeta**.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-174">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
2. <span data-ttu-id="a9b1b-175">Implemente el evento <xref:System.Windows.Forms.ToolStripItem.Click> del botón **Elegir carpeta**.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-175">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#6)]  
  
3. <span data-ttu-id="a9b1b-176">En el diseñador de formularios del formulario principal, cree un controlador de eventos para el evento <xref:System.Windows.Forms.ToolStripItem.Click> del botón **Cancelar**.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-176">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
4. <span data-ttu-id="a9b1b-177">Implemente el evento <xref:System.Windows.Forms.ToolStripItem.Click> del botón **Cancelar**.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-177">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#7)]  
  
<a name="complete"></a>
## <a name="the-complete-example"></a><span data-ttu-id="a9b1b-178">Ejemplo completo</span><span class="sxs-lookup"><span data-stu-id="a9b1b-178">The Complete Example</span></span>  
 <span data-ttu-id="a9b1b-179">En el ejemplo siguiente se muestra el código completo de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-179">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_CompositeImages#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#100)]  
  
 <span data-ttu-id="a9b1b-180">En la ilustración siguiente se muestra la salida típica de la carpeta \Sample Pictures\ común.</span><span class="sxs-lookup"><span data-stu-id="a9b1b-180">The following illustration shows typical output for the common \Sample Pictures\ folder.</span></span>  
  
 <span data-ttu-id="a9b1b-181">![Aplicación de Windows Forms](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span><span class="sxs-lookup"><span data-stu-id="a9b1b-181">![The Windows Forms Application](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span></span>  

## <a name="see-also"></a><span data-ttu-id="a9b1b-182">Vea también</span><span class="sxs-lookup"><span data-stu-id="a9b1b-182">See also</span></span>

- [<span data-ttu-id="a9b1b-183">Flujo de datos</span><span class="sxs-lookup"><span data-stu-id="a9b1b-183">Dataflow</span></span>](dataflow-task-parallel-library.md)
