---
title: Procedimientos recomendados para modelos de diseño de observador
ms.date: 03/30/2017
helpviewer_keywords:
- observer design pattern [.NET], best practices
- best practices [.NET], observer design pattern
ms.assetid: c834760f-ddd4-417f-abb7-a059679d5b8c
ms.openlocfilehash: 48a9bb49be20bbedbaa19d622aabfd18affe39bd
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/18/2020
ms.locfileid: "94828262"
---
# <a name="observer-design-pattern-best-practices"></a><span data-ttu-id="e2a8c-102">Procedimientos recomendados para modelos de diseño de observador</span><span class="sxs-lookup"><span data-stu-id="e2a8c-102">Observer Design Pattern Best Practices</span></span>

<span data-ttu-id="e2a8c-103">En .NET, el modelo de diseño de observador se implementa como un conjunto de interfaces.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-103">In .NET, the observer design pattern is implemented as a set of interfaces.</span></span> <span data-ttu-id="e2a8c-104">La interfaz <xref:System.IObservable%601?displayProperty=nameWithType> representa al proveedor de datos, que también es responsable de proporcionar una implementación <xref:System.IDisposable> que permite a los observadores cancelar la suscripción a las notificaciones.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-104">The <xref:System.IObservable%601?displayProperty=nameWithType> interface represents the data provider, which is also responsible for providing an <xref:System.IDisposable> implementation that lets observers unsubscribe from notifications.</span></span> <span data-ttu-id="e2a8c-105">La interfaz <xref:System.IObserver%601?displayProperty=nameWithType> representa al observador.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-105">The <xref:System.IObserver%601?displayProperty=nameWithType> interface represents the observer.</span></span> <span data-ttu-id="e2a8c-106">En este tema se describen los procedimientos recomendados que los desarrolladores deben seguir al implementar el patrón de diseño de observador con estas interfaces.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-106">This topic describes the best practices that developers should follow when implementing the observer design pattern using these interfaces.</span></span>  
  
## <a name="threading"></a><span data-ttu-id="e2a8c-107">Subprocesos</span><span class="sxs-lookup"><span data-stu-id="e2a8c-107">Threading</span></span>  
 <span data-ttu-id="e2a8c-108">Normalmente, para implementar el método <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType>, un proveedor agrega un observador determinado a una lista de suscriptores que se representa mediante un objeto de colección; por su parte, para implementar el método <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType>, el proveedor quita un observador determinado de la lista de suscriptores.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-108">Typically, a provider implements the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method by adding a particular observer to a subscriber list that is represented by some collection object, and it implements the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> method by removing a particular observer from the subscriber list.</span></span> <span data-ttu-id="e2a8c-109">Un observador puede llamar a estos métodos en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-109">An observer can call these methods at any time.</span></span> <span data-ttu-id="e2a8c-110">Además, dado que el contrato de proveedor/observador no especifica quién es el responsable de cancelar la suscripción después del método de devolución de llamada <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, el proveedor y el observador pueden intentar quitar el mismo miembro de la lista.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-110">In addition, because the provider/observer contract does not specify who is responsible for unsubscribing after the <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> callback method, the provider and observer may both try to remove the same member from the list.</span></span> <span data-ttu-id="e2a8c-111">Debido a esta posibilidad, ambos métodos <xref:System.IObservable%601.Subscribe%2A> y <xref:System.IDisposable.Dispose%2A> deben ser seguros para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-111">Because of this possibility, both the <xref:System.IObservable%601.Subscribe%2A> and <xref:System.IDisposable.Dispose%2A> methods should be thread-safe.</span></span> <span data-ttu-id="e2a8c-112">Normalmente, esto implica el uso de una [colección simultánea](../parallel-programming/data-structures-for-parallel-programming.md) o un bloqueo.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-112">Typically, this involves using a [concurrent collection](../parallel-programming/data-structures-for-parallel-programming.md) or a lock.</span></span> <span data-ttu-id="e2a8c-113">Las implementaciones que no son seguras para subprocesos deben documentar explícitamente que no lo son.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-113">Implementations that are not thread-safe should explicitly document that they are not.</span></span>  
  
 <span data-ttu-id="e2a8c-114">Las posibles garantías adicionales deben especificarse en un nivel por encima del contrato de proveedor/observador.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-114">Any additional guarantees have to be specified in a layer on top of the provider/observer contract.</span></span> <span data-ttu-id="e2a8c-115">Los implementadores deben dejar claro que imponen requisitos adicionales para evitar confusiones al usuario sobre el contrato de observador.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-115">Implementers should clearly call out when they impose additional requirements to avoid user confusion about the observer contract.</span></span>  
  
## <a name="handling-exceptions"></a><span data-ttu-id="e2a8c-116">Controlar las excepciones</span><span class="sxs-lookup"><span data-stu-id="e2a8c-116">Handling Exceptions</span></span>  
 <span data-ttu-id="e2a8c-117">Debido al acoplamiento flexible entre un proveedor de datos y un observador, las excepciones en el patrón de diseño de observador tienen un carácter informativo.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-117">Because of the loose coupling between a data provider and an observer, exceptions in the observer design pattern are intended to be informational.</span></span> <span data-ttu-id="e2a8c-118">Esto afecta a cómo los proveedores y observadores controlan las excepciones en el patrón de diseño de observador.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-118">This affects how providers and observers handle exceptions in the observer design pattern.</span></span>  
  
### <a name="the-provider----calling-the-onerror-method"></a><span data-ttu-id="e2a8c-119">El proveedor: llamada al método OnError</span><span class="sxs-lookup"><span data-stu-id="e2a8c-119">The Provider -- Calling the OnError Method</span></span>  
 <span data-ttu-id="e2a8c-120">El propósito del método <xref:System.IObserver%601.OnError%2A> es servir de mensaje informativo para el observador, de modo parecido al método <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-120">The <xref:System.IObserver%601.OnError%2A> method is intended as an informational message to observers, much like the <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="e2a8c-121">Sin embargo, el método <xref:System.IObserver%601.OnNext%2A> está diseñado para proporcionarle a un observador información actual o actualizada, mientras que el método <xref:System.IObserver%601.OnError%2A> está diseñado para indicar que el proveedor no puede proporcionar datos válidos.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-121">However, the <xref:System.IObserver%601.OnNext%2A> method is designed to provide an observer with current or updated data, whereas the <xref:System.IObserver%601.OnError%2A> method is designed to indicate that the provider is unable to provide valid data.</span></span>  
  
 <span data-ttu-id="e2a8c-122">El proveedor debe seguir estas recomendaciones a la hora de controlar las excepciones y llamar al método <xref:System.IObserver%601.OnError%2A>:</span><span class="sxs-lookup"><span data-stu-id="e2a8c-122">The provider should follow these best practices when handling exceptions and calling the <xref:System.IObserver%601.OnError%2A> method:</span></span>  
  
- <span data-ttu-id="e2a8c-123">El proveedor debe controlar sus propias excepciones si tiene requisitos específicos.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-123">The provider must handle its own exceptions if it has any specific requirements.</span></span>  
  
- <span data-ttu-id="e2a8c-124">El proveedor no debe esperar ni exigir que los observadores controlen las excepciones en ningún modo en particular.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-124">The provider should not expect or require that observers handle exceptions in any particular way.</span></span>  
  
- <span data-ttu-id="e2a8c-125">El proveedor debe llamar al método <xref:System.IObserver%601.OnError%2A> cuando controla una excepción que pone en peligro su capacidad para proporcionar actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-125">The provider should call the <xref:System.IObserver%601.OnError%2A> method when it handles an exception that compromises its ability to provide updates.</span></span> <span data-ttu-id="e2a8c-126">La información sobre este tipo de excepciones se puede pasar al observador.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-126">Information on such exceptions can be passed to the observer.</span></span> <span data-ttu-id="e2a8c-127">En otros casos, no es necesario informar a los observadores de una excepción.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-127">In other cases, there is no need to notify observers of an exception.</span></span>  
  
 <span data-ttu-id="e2a8c-128">Una vez que el proveedor llama al método <xref:System.IObserver%601.OnError%2A> o <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, no debe haber más notificaciones y el proveedor puede cancelar la suscripción de sus observadores.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-128">Once the provider calls the <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> method, there should be no further notifications, and the provider can unsubscribe its observers.</span></span> <span data-ttu-id="e2a8c-129">No obstante, también los observadores pueden cancelar ellos mismos su suscripción en cualquier momento, incluso antes y después de recibir una notificación <xref:System.IObserver%601.OnError%2A> o <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-129">However, the observers can also unsubscribe themselves at any time, including both before and after they receive an <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> notification.</span></span> <span data-ttu-id="e2a8c-130">El patrón de diseño de observador no indica si el proveedor o el observador son responsables de cancelar la suscripción; por lo tanto, es posible que ambos traten de cancelar la suscripción.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-130">The observer design pattern does not dictate whether the provider or the observer is responsible for unsubscribing; therefore, there is a possibility that both may attempt to unsubscribe.</span></span> <span data-ttu-id="e2a8c-131">Normalmente, cuando los observadores cancelan su suscripción, se quitan de una colección de los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-131">Typically, when observers unsubscribe, they are removed from a subscribers collection.</span></span> <span data-ttu-id="e2a8c-132">En una aplicación de un único subproceso, la implementación de <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> debe asegurarse de la validez de una referencia de objeto y de que el objeto es miembro de la colección de suscriptores antes de intentar quitarlo.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-132">In a single-threaded application, the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation should ensure that an object reference is valid and that the object is a member of the subscribers collection before attempting to remove it.</span></span> <span data-ttu-id="e2a8c-133">En una aplicación multiproceso, debe utilizarse un objeto de colección seguro para subprocesos, por ejemplo, un objeto <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-133">In a multithreaded application, a thread-safe collection object, such as a <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType> object, should be used.</span></span>  
  
### <a name="the-observer----implementing-the-onerror-method"></a><span data-ttu-id="e2a8c-134">El observador: implementación del método OnError</span><span class="sxs-lookup"><span data-stu-id="e2a8c-134">The Observer -- Implementing the OnError Method</span></span>  
 <span data-ttu-id="e2a8c-135">Cuando un observador recibe una notificación de error de un proveedor, debe considerar solo el valor informativo de la excepción sin que sea necesario realizar ninguna acción especial.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-135">When an observer receives an error notification from a provider, the observer should treat the exception as informational and should not be required to take any particular action.</span></span>  
  
 <span data-ttu-id="e2a8c-136">El observador debe seguir estas recomendaciones al responder a una llamada de método <xref:System.IObserver%601.OnError%2A> de un proveedor:</span><span class="sxs-lookup"><span data-stu-id="e2a8c-136">The observer should follow these best practices when responding to an <xref:System.IObserver%601.OnError%2A> method call from a provider:</span></span>  
  
- <span data-ttu-id="e2a8c-137">El observador no debe generar excepciones desde sus implementaciones de interfaz, como <xref:System.IObserver%601.OnNext%2A> o <xref:System.IObserver%601.OnError%2A>.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-137">The observer should not throw exceptions from its interface implementations, such as <xref:System.IObserver%601.OnNext%2A> or <xref:System.IObserver%601.OnError%2A>.</span></span> <span data-ttu-id="e2a8c-138">No obstante, si el observador genera excepciones, no debe esperar que se controlen.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-138">However, if the observer does throw exceptions, it should expect these exceptions to go unhandled.</span></span>  
  
- <span data-ttu-id="e2a8c-139">Para conservar la pila de llamadas, un observador que desee producir un objeto <xref:System.Exception> pasado a su método <xref:System.IObserver%601.OnError%2A>, debe encapsular la excepción antes generarla.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-139">To preserve the call stack, an observer that wishes to throw an <xref:System.Exception> object that was passed to its <xref:System.IObserver%601.OnError%2A> method should wrap the exception before throwing it.</span></span> <span data-ttu-id="e2a8c-140">Para este propósito, debe usarse un objeto de excepción estándar.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-140">A standard exception object should be used for this purpose.</span></span>  
  
## <a name="additional-best-practices"></a><span data-ttu-id="e2a8c-141">Recomendaciones adicionales</span><span class="sxs-lookup"><span data-stu-id="e2a8c-141">Additional Best Practices</span></span>  
 <span data-ttu-id="e2a8c-142">Intentar anular el registro en el método <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> puede producir una referencia nula.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-142">Attempting to unregister in the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method may result in a null reference.</span></span> <span data-ttu-id="e2a8c-143">Por lo tanto, se recomienda evitar esta práctica.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-143">Therefore, we recommend that you avoid this practice.</span></span>  
  
 <span data-ttu-id="e2a8c-144">Aunque es posible adjuntar un observador a varios proveedores, el patrón recomendado consiste en adjuntar una instancia de <xref:System.IObserver%601> a una única instancia de <xref:System.IObservable%601>.</span><span class="sxs-lookup"><span data-stu-id="e2a8c-144">Although it is possible to attach an observer to multiple providers, the recommended pattern is to attach an <xref:System.IObserver%601> instance to only one <xref:System.IObservable%601> instance.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e2a8c-145">Vea también</span><span class="sxs-lookup"><span data-stu-id="e2a8c-145">See also</span></span>

- [<span data-ttu-id="e2a8c-146">Modelo de diseño de observador</span><span class="sxs-lookup"><span data-stu-id="e2a8c-146">Observer Design Pattern</span></span>](observer-design-pattern.md)
- [<span data-ttu-id="e2a8c-147">Implementar un observador</span><span class="sxs-lookup"><span data-stu-id="e2a8c-147">How to: Implement an Observer</span></span>](how-to-implement-an-observer.md)
- [<span data-ttu-id="e2a8c-148">Implementar un proveedor</span><span class="sxs-lookup"><span data-stu-id="e2a8c-148">How to: Implement a Provider</span></span>](how-to-implement-a-provider.md)
