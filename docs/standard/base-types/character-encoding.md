---
title: Procedimiento para usar clases de codificación de caracteres en .NET
description: Aprenda a usar clases de codificación de caracteres en .NET.
ms.date: 12/22/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- encoding, understanding
- encoding, choosing
- encoding, fallback strategy
ms.assetid: bf6d9823-4c2d-48af-b280-919c5af66ae9
ms.openlocfilehash: 520316c0733d5c56b5ab77fbec7d4dd838af6338
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/18/2020
ms.locfileid: "94823295"
---
# <a name="how-to-use-character-encoding-classes-in-net"></a><span data-ttu-id="22acb-103">Procedimiento para usar clases de codificación de caracteres en .NET</span><span class="sxs-lookup"><span data-stu-id="22acb-103">How to use character encoding classes in .NET</span></span>

<span data-ttu-id="22acb-104">En este artículo se explica cómo usar las clases que proporciona .NET para codificar y descodificar texto mediante varios esquemas de codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-104">This article explains how to use the classes that .NET provides for encoding and decoding text by using various encoding schemes.</span></span> <span data-ttu-id="22acb-105">En las instrucciones se da por hecho que ha leído [Introducción a la codificación de caracteres en .NET](character-encoding-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="22acb-105">The instructions assume you have read [Introduction to character encoding in .NET](character-encoding-introduction.md).</span></span>

## <a name="encoders-and-decoders"></a><span data-ttu-id="22acb-106">Codificadores y descodificadores</span><span class="sxs-lookup"><span data-stu-id="22acb-106">Encoders and decoders</span></span>

<span data-ttu-id="22acb-107">.NET proporciona clases de codificación que codifican y descodifican texto mediante varios sistemas de codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-107">.NET provides encoding classes that encode and decode text by using various encoding systems.</span></span> <span data-ttu-id="22acb-108">Por ejemplo, la clase <xref:System.Text.UTF8Encoding> describe las reglas de codificación y descodificación de UTF-8.</span><span class="sxs-lookup"><span data-stu-id="22acb-108">For example, the <xref:System.Text.UTF8Encoding> class describes the rules for encoding to, and decoding from, UTF-8.</span></span> <span data-ttu-id="22acb-109">.NET usa la codificación UTF-16 (representada por la clase <xref:System.Text.UnicodeEncoding>) con las instancias de `string`.</span><span class="sxs-lookup"><span data-stu-id="22acb-109">.NET uses UTF-16 encoding (represented by the <xref:System.Text.UnicodeEncoding> class) for `string` instances.</span></span> <span data-ttu-id="22acb-110">Existen codificadores y descodificadores para otros esquemas de codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-110">Encoders and decoders are available for other encoding schemes.</span></span>

<span data-ttu-id="22acb-111">La codificación y la descodificación también pueden incluir validación.</span><span class="sxs-lookup"><span data-stu-id="22acb-111">Encoding and decoding can also include validation.</span></span> <span data-ttu-id="22acb-112">Por ejemplo, la clase <xref:System.Text.UnicodeEncoding> comprueba todas las instancias de `char` en el intervalo suplente para asegurarse de que están en pares suplentes válidos.</span><span class="sxs-lookup"><span data-stu-id="22acb-112">For example, the <xref:System.Text.UnicodeEncoding> class checks all `char` instances in the surrogate range to make sure they're in valid surrogate pairs.</span></span> <span data-ttu-id="22acb-113">Una estrategia de reserva determina cómo trata un codificador los caracteres no válidos o cómo trata un descodificador los bytes no válidos.</span><span class="sxs-lookup"><span data-stu-id="22acb-113">A fallback strategy determines how an encoder handles invalid characters or how a decoder handles invalid bytes.</span></span>

> [!WARNING]
> <span data-ttu-id="22acb-114">Las clases de codificación de .NET proporcionan una manera de almacenar y convertir datos de caracteres.</span><span class="sxs-lookup"><span data-stu-id="22acb-114">.NET encoding classes provide a way to store and convert character data.</span></span> <span data-ttu-id="22acb-115">No se deben usar para almacenar datos binarios en formato de cadena.</span><span class="sxs-lookup"><span data-stu-id="22acb-115">They should not be used to store binary data in string form.</span></span> <span data-ttu-id="22acb-116">Dependiendo de la codificación empleada, la conversión de datos binarios al formato de cadena con las clases de codificación puede presentar un comportamiento inesperado y mostrar datos inexactos o dañados.</span><span class="sxs-lookup"><span data-stu-id="22acb-116">Depending on the encoding used, converting binary data to string format with the encoding classes can introduce unexpected behavior and produce inaccurate or corrupted data.</span></span> <span data-ttu-id="22acb-117">Para convertir datos binarios en un formato de cadena, use el método <xref:System.Convert.ToBase64String%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-117">To convert binary data to a string form, use the <xref:System.Convert.ToBase64String%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="22acb-118">Todas las clases de codificación de caracteres de .NET heredan de la clase <xref:System.Text.Encoding?displayProperty=nameWithType>, que es una clase abstracta que define la funcionalidad común a todas las codificaciones de caracteres.</span><span class="sxs-lookup"><span data-stu-id="22acb-118">All character encoding classes in .NET inherit from the <xref:System.Text.Encoding?displayProperty=nameWithType> class, which is an abstract class that defines the functionality common to all character encodings.</span></span> <span data-ttu-id="22acb-119">Para acceder a los objetos individuales de codificación implementados en .NET, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="22acb-119">To access the individual encoding objects implemented in .NET, do the following:</span></span>

- <span data-ttu-id="22acb-120">Use las propiedades estáticas de la clase <xref:System.Text.Encoding>, que devuelven objetos que representan las codificaciones de caracteres estándar disponibles en .NET (ASCII, UTF-7, UTF-8, UTF-16 y UTF-32).</span><span class="sxs-lookup"><span data-stu-id="22acb-120">Use the static properties of the <xref:System.Text.Encoding> class, which return objects that represent the standard character encodings available in .NET (ASCII, UTF-7, UTF-8, UTF-16, and UTF-32).</span></span> <span data-ttu-id="22acb-121">Por ejemplo, la propiedad <xref:System.Text.Encoding.Unicode%2A?displayProperty=nameWithType> devuelve un objeto <xref:System.Text.UnicodeEncoding> :</span><span class="sxs-lookup"><span data-stu-id="22acb-121">For example, the <xref:System.Text.Encoding.Unicode%2A?displayProperty=nameWithType> property returns a <xref:System.Text.UnicodeEncoding> object.</span></span> <span data-ttu-id="22acb-122">Cada objeto usa la reserva de reemplazo para controlar las cadenas que no puede codificar y los bytes que no puede descodificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-122">Each object uses replacement fallback to handle strings that it cannot encode and bytes that it cannot decode.</span></span> <span data-ttu-id="22acb-123">Para más información, consulte [Reserva de reemplazo](character-encoding.md#Replacement).</span><span class="sxs-lookup"><span data-stu-id="22acb-123">For more information, see [Replacement fallback](character-encoding.md#Replacement).</span></span>

- <span data-ttu-id="22acb-124">Llame al constructor de clase de la codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-124">Call the encoding's class constructor.</span></span> <span data-ttu-id="22acb-125">Se pueden crear instancias de los objetos para las codificaciones ASCII, UTF-7, UTF-8, UTF-16 y UTF-32 de esta manera.</span><span class="sxs-lookup"><span data-stu-id="22acb-125">Objects for the ASCII, UTF-7, UTF-8, UTF-16, and UTF-32 encodings can be instantiated in this way.</span></span> <span data-ttu-id="22acb-126">De forma predeterminada, cada objeto usa la reserva de reemplazo para controlar las cadenas que no puede codificar y los bytes que no puede descodificar, pero puede especificar que se debe producir una excepción en su lugar.</span><span class="sxs-lookup"><span data-stu-id="22acb-126">By default, each object uses replacement fallback to handle strings that it cannot encode and bytes that it cannot decode, but you can specify that an exception should be thrown instead.</span></span> <span data-ttu-id="22acb-127">Para más información, consulte [Reserva de reemplazo](character-encoding.md#Replacement) y [Reserva de excepción](character-encoding.md#Exception).</span><span class="sxs-lookup"><span data-stu-id="22acb-127">For more information, see [Replacement fallback](character-encoding.md#Replacement) and [Exception fallback](character-encoding.md#Exception).</span></span>

- <span data-ttu-id="22acb-128">Llame al constructor <xref:System.Text.Encoding.%23ctor%28System.Int32%29> y pásele un entero que represente la codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-128">Call the <xref:System.Text.Encoding.%23ctor%28System.Int32%29> constructor and pass it an integer that represents the encoding.</span></span> <span data-ttu-id="22acb-129">Los objetos de codificación estándar usan la reserva de reemplazo, y los objetos de codificación para la página de códigos y el juego de caracteres de doble byte (DBCS) usan el retroceso de ajuste perfecto para controlar las cadenas que no pueden codificar y los bytes que no pueden descodificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-129">Standard encoding objects use replacement fallback, and code page and double-byte character set (DBCS) encoding objects use best-fit fallback to handle strings that they cannot encode and bytes that they cannot decode.</span></span> <span data-ttu-id="22acb-130">Para más información, consulte [Reserva con ajuste perfecto](character-encoding.md#BestFit).</span><span class="sxs-lookup"><span data-stu-id="22acb-130">For more information, see [Best-fit fallback](character-encoding.md#BestFit).</span></span>

- <span data-ttu-id="22acb-131">Llame al método <xref:System.Text.Encoding.GetEncoding%2A?displayProperty=nameWithType>, que devuelve cualquier estándar, página de códigos o codificación DBCS disponible en .NET.</span><span class="sxs-lookup"><span data-stu-id="22acb-131">Call the <xref:System.Text.Encoding.GetEncoding%2A?displayProperty=nameWithType> method, which returns any standard, code page, or DBCS encoding available in .NET.</span></span> <span data-ttu-id="22acb-132">Las sobrecargas permiten especificar un objeto de reserva para el codificador y para el descodificador.</span><span class="sxs-lookup"><span data-stu-id="22acb-132">Overloads let you specify a fallback object for both the encoder and the decoder.</span></span>

<span data-ttu-id="22acb-133">Se puede recuperar información sobre todas las codificaciones disponibles en .NET llamando al método <xref:System.Text.Encoding.GetEncodings%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="22acb-133">You can retrieve information about all the encodings available in .NET by calling the <xref:System.Text.Encoding.GetEncodings%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-134">.NET admite los esquemas de codificación de caracteres que se muestran en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="22acb-134">.NET supports the character encoding schemes listed in the following table.</span></span>

|<span data-ttu-id="22acb-135">Clase de codificación</span><span class="sxs-lookup"><span data-stu-id="22acb-135">Encoding class</span></span>|<span data-ttu-id="22acb-136">Descripción</span><span class="sxs-lookup"><span data-stu-id="22acb-136">Description</span></span>|
|--------------|-----------|
|[<span data-ttu-id="22acb-137">ASCII</span><span class="sxs-lookup"><span data-stu-id="22acb-137">ASCII</span></span>](xref:System.Text.ASCIIEncoding)|<span data-ttu-id="22acb-138">Codifica un intervalo limitado de caracteres usando los siete bits inferiores de un byte.</span><span class="sxs-lookup"><span data-stu-id="22acb-138">Encodes a limited range of characters by using the lower seven bits of a byte.</span></span> <span data-ttu-id="22acb-139">Como esta codificación solo admite valores de caracteres de U+0000 a U+007F, en la mayoría de los casos no resulta suficiente para aplicaciones de uso internacional.</span><span class="sxs-lookup"><span data-stu-id="22acb-139">Because this encoding only supports character values from U+0000 through U+007F, in most cases it is inadequate for internationalized applications.</span></span>|
|[<span data-ttu-id="22acb-140">UTF-7</span><span class="sxs-lookup"><span data-stu-id="22acb-140">UTF-7</span></span>](xref:System.Text.UTF7Encoding)|<span data-ttu-id="22acb-141">Representa los caracteres como secuencias de caracteres ASCII de 7 bits.</span><span class="sxs-lookup"><span data-stu-id="22acb-141">Represents characters as sequences of 7-bit ASCII characters.</span></span> <span data-ttu-id="22acb-142">Los caracteres Unicode no ASCII se representan con una secuencia de escape de caracteres ASCII.</span><span class="sxs-lookup"><span data-stu-id="22acb-142">Non-ASCII Unicode characters are represented by an escape sequence of ASCII characters.</span></span> <span data-ttu-id="22acb-143">UTF-7 admite protocolos como correo electrónico y grupos de noticias.</span><span class="sxs-lookup"><span data-stu-id="22acb-143">UTF-7 supports protocols such as email and newsgroup.</span></span> <span data-ttu-id="22acb-144">Sin embargo, la codificación UTF-7 no es particularmente segura ni sólida.</span><span class="sxs-lookup"><span data-stu-id="22acb-144">However, UTF-7 is not particularly secure or robust.</span></span> <span data-ttu-id="22acb-145">En algunos casos, cambiar un bit puede modificar radicalmente la interpretación de toda una cadena UTF-7.</span><span class="sxs-lookup"><span data-stu-id="22acb-145">In some cases, changing one bit can radically alter the interpretation of an entire UTF-7 string.</span></span> <span data-ttu-id="22acb-146">En otros casos, diferentes cadenas UTF-7 pueden codificar el mismo texto.</span><span class="sxs-lookup"><span data-stu-id="22acb-146">In other cases, different UTF-7 strings can encode the same text.</span></span> <span data-ttu-id="22acb-147">Para las secuencias que incluyen caracteres no ASCII, UTF-7 necesita más espacio que UTF-8, y la codificación y descodificación son más lentas.</span><span class="sxs-lookup"><span data-stu-id="22acb-147">For sequences that include non-ASCII characters, UTF-7 requires more space than UTF-8, and encoding/decoding is slower.</span></span> <span data-ttu-id="22acb-148">Por tanto, debe usar UTF-8 en lugar de UTF-7 si es posible.</span><span class="sxs-lookup"><span data-stu-id="22acb-148">Consequently, you should use UTF-8 instead of UTF-7 if possible.</span></span>|
|[<span data-ttu-id="22acb-149">UTF-8</span><span class="sxs-lookup"><span data-stu-id="22acb-149">UTF-8</span></span>](xref:System.Text.UTF8Encoding)|<span data-ttu-id="22acb-150">Representa cada punto de código Unicode como una secuencia de uno a cuatro bytes.</span><span class="sxs-lookup"><span data-stu-id="22acb-150">Represents each Unicode code point as a sequence of one to four bytes.</span></span> <span data-ttu-id="22acb-151">UTF-8 admite tamaños de datos de 8 bits y funciona bien con muchos sistemas operativos existentes.</span><span class="sxs-lookup"><span data-stu-id="22acb-151">UTF-8 supports 8-bit data sizes and works well with many existing operating systems.</span></span> <span data-ttu-id="22acb-152">Para el intervalo ASCII de caracteres, UTF-8 es idéntico a la codificación ASCII y permite un conjunto mayor de caracteres.</span><span class="sxs-lookup"><span data-stu-id="22acb-152">For the ASCII range of characters, UTF-8 is identical to ASCII encoding and allows a broader set of characters.</span></span> <span data-ttu-id="22acb-153">Sin embargo, para los scripts de chino-japonés-coreano (CJK), UTF-8 puede necesitar tres bytes para cada carácter y puede generar tamaños de datos mayores que UTF-16.</span><span class="sxs-lookup"><span data-stu-id="22acb-153">However, for Chinese-Japanese-Korean (CJK) scripts, UTF-8 can require three bytes for each character, and can cause larger data sizes than UTF-16.</span></span> <span data-ttu-id="22acb-154">Algunas veces, la cantidad de datos ASCII, como las etiquetas HTML, justifica el mayor tamaño del intervalo de CJK.</span><span class="sxs-lookup"><span data-stu-id="22acb-154">Sometimes the amount of ASCII data, such as HTML tags, justifies the increased size for the CJK range.</span></span>|
|[<span data-ttu-id="22acb-155">UTF-16</span><span class="sxs-lookup"><span data-stu-id="22acb-155">UTF-16</span></span>](xref:System.Text.UnicodeEncoding)|<span data-ttu-id="22acb-156">Representa cada punto de código Unicode como una secuencia de uno o dos enteros de 16 bits.</span><span class="sxs-lookup"><span data-stu-id="22acb-156">Represents each Unicode code point as a sequence of one or two 16-bit integers.</span></span> <span data-ttu-id="22acb-157">La mayoría de los caracteres Unicode comunes solo necesitan un punto de código UTF-16, aunque los caracteres Unicode suplementarios (U+10000 y posteriores) necesitan dos puntos de código UTF-16 suplentes.</span><span class="sxs-lookup"><span data-stu-id="22acb-157">Most common Unicode characters require only one UTF-16 code point, although Unicode supplementary characters (U+10000 and greater) require two UTF-16 surrogate code points.</span></span> <span data-ttu-id="22acb-158">Se admiten tanto el orden de bytes little-endian como el big-endian.</span><span class="sxs-lookup"><span data-stu-id="22acb-158">Both little-endian and big-endian byte orders are supported.</span></span> <span data-ttu-id="22acb-159">Common Language Runtime usa la codificación UTF-16 para representar valores de tipo <xref:System.Char> y <xref:System.String> , y el sistema operativo Windows la usa para representar valores de tipo `WCHAR` .</span><span class="sxs-lookup"><span data-stu-id="22acb-159">UTF-16 encoding is used by the common language runtime to represent <xref:System.Char> and <xref:System.String> values, and it is used by the Windows operating system to represent `WCHAR` values.</span></span>|
|[<span data-ttu-id="22acb-160">UTF-32</span><span class="sxs-lookup"><span data-stu-id="22acb-160">UTF-32</span></span>](xref:System.Text.UTF32Encoding)|<span data-ttu-id="22acb-161">Representa cada punto de código Unicode como un entero de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="22acb-161">Represents each Unicode code point as a 32-bit integer.</span></span> <span data-ttu-id="22acb-162">Se admiten tanto el orden de bytes little-endian como el big-endian.</span><span class="sxs-lookup"><span data-stu-id="22acb-162">Both little-endian and big-endian byte orders are supported.</span></span> <span data-ttu-id="22acb-163">La codificación UTF-32 se usa cuando las aplicaciones desean evitar el comportamiento de punto de código suplente de la codificación UTF-16 en sistemas operativos para los que el espacio codificado es muy importante.</span><span class="sxs-lookup"><span data-stu-id="22acb-163">UTF-32 encoding is used when applications want to avoid the surrogate code point behavior of UTF-16 encoding on operating systems for which encoded space is too important.</span></span> <span data-ttu-id="22acb-164">Los glifos únicos representados en una pantalla aún se pueden codificar con más de un carácter UTF-32.</span><span class="sxs-lookup"><span data-stu-id="22acb-164">Single glyphs rendered on a display can still be encoded with more than one UTF-32 character.</span></span>|
|<span data-ttu-id="22acb-165">Codificación ANSI/ISO</span><span class="sxs-lookup"><span data-stu-id="22acb-165">ANSI/ISO encoding</span></span>|<span data-ttu-id="22acb-166">Proporciona compatibilidad con diversas páginas de códigos.</span><span class="sxs-lookup"><span data-stu-id="22acb-166">Provides support for a variety of code pages.</span></span> <span data-ttu-id="22acb-167">En los sistemas operativos Windows, las páginas de códigos se usan para admitir un idioma o un grupo de idiomas concreto.</span><span class="sxs-lookup"><span data-stu-id="22acb-167">On Windows operating systems, code pages are used to support a specific language or group of languages.</span></span> <span data-ttu-id="22acb-168">Para obtener una tabla que muestra las páginas de códigos admitidas por .NET, vea la clase <xref:System.Text.Encoding>.</span><span class="sxs-lookup"><span data-stu-id="22acb-168">For a table that lists the code pages supported by .NET, see the <xref:System.Text.Encoding> class.</span></span> <span data-ttu-id="22acb-169">Puede recuperar un objeto de codificación para una página de códigos determinada llamando al método <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-169">You can retrieve an encoding object for a particular code page by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-170">Una página de códigos contiene 256 puntos de código y se basa en cero.</span><span class="sxs-lookup"><span data-stu-id="22acb-170">A code page contains 256 code points and is zero-based.</span></span> <span data-ttu-id="22acb-171">En la mayoría de las páginas de códigos, los puntos de código 0 a 127 representan el juego de caracteres ASCII y los puntos de código 128 a 255 difieren de forma significativa entre las páginas de códigos.</span><span class="sxs-lookup"><span data-stu-id="22acb-171">In most code pages, code points 0 through 127 represent the ASCII character set, and code points 128 through 255 differ significantly between code pages.</span></span> <span data-ttu-id="22acb-172">Por ejemplo, la página de códigos 1252 proporciona los caracteres para los sistemas de escritura latinos, incluidos el inglés, el alemán y el francés.</span><span class="sxs-lookup"><span data-stu-id="22acb-172">For example, code page 1252 provides the characters for Latin writing systems, including English, German, and French.</span></span> <span data-ttu-id="22acb-173">Los últimos 128 puntos de código de la página de códigos 1252 contienen los caracteres de acento.</span><span class="sxs-lookup"><span data-stu-id="22acb-173">The last 128 code points in code page 1252 contain the accent characters.</span></span> <span data-ttu-id="22acb-174">La página de códigos 1253 proporciona códigos de caracteres necesarios en el sistema de escritura griego.</span><span class="sxs-lookup"><span data-stu-id="22acb-174">Code page 1253 provides character codes that are required in the Greek writing system.</span></span> <span data-ttu-id="22acb-175">Los últimos 128 puntos de código de la página de códigos 1253 contienen los caracteres griegos.</span><span class="sxs-lookup"><span data-stu-id="22acb-175">The last 128 code points in code page 1253 contain the Greek characters.</span></span> <span data-ttu-id="22acb-176">Como resultado, una aplicación que se basa en páginas de códigos ANSI no puede almacenar griego y alemán en la misma secuencia de texto a menos que incluya un identificador que indique la página de códigos a la que se hace referencia.</span><span class="sxs-lookup"><span data-stu-id="22acb-176">As a result, an application that relies on ANSI code pages cannot store Greek and German in the same text stream unless it includes an identifier that indicates the referenced code page.</span></span>|
|<span data-ttu-id="22acb-177">Codificaciones de juegos de caracteres de doble byte (DBCS)</span><span class="sxs-lookup"><span data-stu-id="22acb-177">Double-byte character set (DBCS) encodings</span></span>|<span data-ttu-id="22acb-178">Admite idiomas que contienen más de 256 caracteres, como el chino, el japonés y el coreano.</span><span class="sxs-lookup"><span data-stu-id="22acb-178">Supports languages, such as Chinese, Japanese, and Korean, that contain more than 256 characters.</span></span> <span data-ttu-id="22acb-179">En un DBCS, un par de puntos de código (un byte doble) representa cada carácter.</span><span class="sxs-lookup"><span data-stu-id="22acb-179">In a DBCS, a pair of code points (a double byte) represents each character.</span></span> <span data-ttu-id="22acb-180">La propiedad <xref:System.Text.Encoding.IsSingleByte%2A?displayProperty=nameWithType> devuelve `false` para las codificaciones DBCS.</span><span class="sxs-lookup"><span data-stu-id="22acb-180">The <xref:System.Text.Encoding.IsSingleByte%2A?displayProperty=nameWithType> property returns `false` for DBCS encodings.</span></span> <span data-ttu-id="22acb-181">Puede recuperar un objeto de codificación para un DBCS determinado llamando al método <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-181">You can retrieve an encoding object for a particular DBCS by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-182">Cuando una aplicación controla datos DBCS, el primer byte de un carácter DBCS (el byte inicial) se procesa junto con el byte final que le sigue inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="22acb-182">When an application handles DBCS data, the first byte of a DBCS character (the lead byte) is processed in combination with the trail byte that immediately follows it.</span></span> <span data-ttu-id="22acb-183">Puesto que un único par de puntos de código de doble byte puede representar caracteres diferentes dependiendo de la página de códigos, este esquema aún no permite la combinación de dos idioma, como el japonés y el chino, en el mismo flujo de datos.</span><span class="sxs-lookup"><span data-stu-id="22acb-183">Because a single pair of double-byte code points can represent different characters depending on the code page, this scheme still does not allow for the combination of two languages, such as Japanese and Chinese, in the same data stream.</span></span>|

<span data-ttu-id="22acb-184">Estas codificaciones permiten trabajar con caracteres Unicode, así como con codificaciones que son las más usadas en aplicaciones heredadas.</span><span class="sxs-lookup"><span data-stu-id="22acb-184">These encodings enable you to work with Unicode characters as well as with encodings that are most commonly used in legacy applications.</span></span> <span data-ttu-id="22acb-185">Además, puede crear una codificación personalizada definiendo una clase que se deriva de <xref:System.Text.Encoding> e invalidar sus miembros.</span><span class="sxs-lookup"><span data-stu-id="22acb-185">In addition, you can create a custom encoding by defining a class that derives from <xref:System.Text.Encoding> and overriding its members.</span></span>

## <a name="net-core-encoding-support"></a><span data-ttu-id="22acb-186">Compatibilidad con la codificación de .NET Core</span><span class="sxs-lookup"><span data-stu-id="22acb-186">.NET Core encoding support</span></span>

<span data-ttu-id="22acb-187">De manera predeterminada, .NET Core no pone a disposición codificaciones de páginas de código que no sean la página de códigos 28591 y las codificaciones Unicode, como UTF-8 y UTF-16.</span><span class="sxs-lookup"><span data-stu-id="22acb-187">By default, .NET Core does not make available any code page encodings other than code page 28591 and the Unicode encodings, such as UTF-8 and UTF-16.</span></span> <span data-ttu-id="22acb-188">Sin embargo, puede agregar que las codificaciones de páginas de código que se encuentran en las aplicaciones estándar de Windows que tienen como destino .NET a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22acb-188">However, you can add the code page encodings found in standard Windows apps that target .NET to your app.</span></span> <span data-ttu-id="22acb-189">Para obtener más información, vea el tema <xref:System.Text.CodePagesEncodingProvider>.</span><span class="sxs-lookup"><span data-stu-id="22acb-189">For more information, see the <xref:System.Text.CodePagesEncodingProvider> topic.</span></span>

<a name="Selecting"></a>

## <a name="selecting-an-encoding-class"></a><span data-ttu-id="22acb-190">Seleccionar una clase de codificación</span><span class="sxs-lookup"><span data-stu-id="22acb-190">Selecting an Encoding Class</span></span>

<span data-ttu-id="22acb-191">Si tiene la oportunidad de elegir la codificación que se usará en la aplicación, debe usar una codificación Unicode, preferiblemente <xref:System.Text.UTF8Encoding> o <xref:System.Text.UnicodeEncoding>.</span><span class="sxs-lookup"><span data-stu-id="22acb-191">If you have the opportunity to choose the encoding to be used by your application, you should use a Unicode encoding, preferably either <xref:System.Text.UTF8Encoding> or <xref:System.Text.UnicodeEncoding>.</span></span> <span data-ttu-id="22acb-192">(.NET también admite una tercera codificación Unicode, <xref:System.Text.UTF32Encoding>).</span><span class="sxs-lookup"><span data-stu-id="22acb-192">(.NET also supports a third Unicode encoding, <xref:System.Text.UTF32Encoding>.)</span></span>

<span data-ttu-id="22acb-193">Si piensa usar una codificación ASCII (<xref:System.Text.ASCIIEncoding>), elija <xref:System.Text.UTF8Encoding> en su lugar.</span><span class="sxs-lookup"><span data-stu-id="22acb-193">If you are planning to use an ASCII encoding (<xref:System.Text.ASCIIEncoding>), choose <xref:System.Text.UTF8Encoding> instead.</span></span> <span data-ttu-id="22acb-194">Las dos codificaciones son idénticas para el juego de caracteres ASCII, pero <xref:System.Text.UTF8Encoding> presenta las ventajas siguientes:</span><span class="sxs-lookup"><span data-stu-id="22acb-194">The two encodings are identical for the ASCII character set, but <xref:System.Text.UTF8Encoding> has the following advantages:</span></span>

- <span data-ttu-id="22acb-195">Puede representar todos los caracteres Unicode, mientras que <xref:System.Text.ASCIIEncoding> solo admite los valores de caracteres Unicode entre U+0000 y U+007F.</span><span class="sxs-lookup"><span data-stu-id="22acb-195">It can represent every Unicode character, whereas <xref:System.Text.ASCIIEncoding> supports only the Unicode character values between U+0000 and U+007F.</span></span>

- <span data-ttu-id="22acb-196">Proporciona detección de errores y una mayor seguridad.</span><span class="sxs-lookup"><span data-stu-id="22acb-196">It provides error detection and better security.</span></span>

- <span data-ttu-id="22acb-197">Se ha mejorado en materia de velocidad y debe ser más rápida que cualquier otra codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-197">It has been tuned to be as fast as possible and should be faster than any other encoding.</span></span> <span data-ttu-id="22acb-198">Incluso cuando todo el contenido es ASCII, las operaciones realizadas con <xref:System.Text.UTF8Encoding> son más rápidas que las operaciones realizadas con <xref:System.Text.ASCIIEncoding>.</span><span class="sxs-lookup"><span data-stu-id="22acb-198">Even for content that is entirely ASCII, operations performed with <xref:System.Text.UTF8Encoding> are faster than operations performed with <xref:System.Text.ASCIIEncoding>.</span></span>

<span data-ttu-id="22acb-199">Debe considerar la posibilidad de usar <xref:System.Text.ASCIIEncoding> solo para las aplicaciones heredadas.</span><span class="sxs-lookup"><span data-stu-id="22acb-199">You should consider using <xref:System.Text.ASCIIEncoding> only for legacy applications.</span></span> <span data-ttu-id="22acb-200">Sin embargo, incluso para las aplicaciones heredadas, <xref:System.Text.UTF8Encoding> podría ser una opción mejor por las razones siguientes (suponiendo la configuración predeterminada):</span><span class="sxs-lookup"><span data-stu-id="22acb-200">However, even for legacy applications, <xref:System.Text.UTF8Encoding> might be a better choice for the following reasons (assuming default settings):</span></span>

- <span data-ttu-id="22acb-201">Si la aplicación tiene contenido que no es estrictamente ASCII y lo codifica con <xref:System.Text.ASCIIEncoding>, cada carácter no ASCII se codifica como un signo de interrogación (?).</span><span class="sxs-lookup"><span data-stu-id="22acb-201">If your application has content that is not strictly ASCII and encodes it with <xref:System.Text.ASCIIEncoding>, each non-ASCII character encodes as a question mark (?).</span></span> <span data-ttu-id="22acb-202">Si la aplicación descodifica después estos datos, la información se pierde.</span><span class="sxs-lookup"><span data-stu-id="22acb-202">If the application then decodes this data, the information is lost.</span></span>

- <span data-ttu-id="22acb-203">Si la aplicación tiene contenido que no es estrictamente ASCII y lo codifica con <xref:System.Text.UTF8Encoding>, el resultado parece ininteligible si se interpreta como ASCII.</span><span class="sxs-lookup"><span data-stu-id="22acb-203">If your application has content that is not strictly ASCII and encodes it with <xref:System.Text.UTF8Encoding>, the result seems unintelligible if interpreted as ASCII.</span></span> <span data-ttu-id="22acb-204">Sin embargo, si la aplicación usa un descodificador UTF-8 para descodificar estos datos, los datos realizan una acción de ida y vuelta correctamente.</span><span class="sxs-lookup"><span data-stu-id="22acb-204">However, if the application then uses a UTF-8 decoder to decode this data, the data performs a round trip successfully.</span></span>

<span data-ttu-id="22acb-205">En una aplicación web, los caracteres enviados al cliente como respuesta a una solicitud web deben reflejar la codificación empleada en el cliente.</span><span class="sxs-lookup"><span data-stu-id="22acb-205">In a web application, characters sent to the client in response to a web request should reflect the encoding used on the client.</span></span> <span data-ttu-id="22acb-206">En la mayoría de los casos, debe establecer la propiedad <xref:System.Web.HttpResponse.ContentEncoding%2A?displayProperty=nameWithType> en el valor devuelto por la propiedad <xref:System.Web.HttpRequest.ContentEncoding%2A?displayProperty=nameWithType> para mostrar el texto en la codificación que el usuario espera.</span><span class="sxs-lookup"><span data-stu-id="22acb-206">In most cases, you should set the <xref:System.Web.HttpResponse.ContentEncoding%2A?displayProperty=nameWithType> property to the value returned by the <xref:System.Web.HttpRequest.ContentEncoding%2A?displayProperty=nameWithType> property to display text in the encoding that the user expects.</span></span>

<a name="Using"></a>

## <a name="using-an-encoding-object"></a><span data-ttu-id="22acb-207">Usar un objeto de codificación</span><span class="sxs-lookup"><span data-stu-id="22acb-207">Using an Encoding Object</span></span>

<span data-ttu-id="22acb-208">Un codificador convierte una cadena de caracteres (normalmente, caracteres Unicode) en su equivalente numérico (bytes).</span><span class="sxs-lookup"><span data-stu-id="22acb-208">An encoder converts a string of characters (most commonly, Unicode characters) to its numeric (byte) equivalent.</span></span> <span data-ttu-id="22acb-209">Por ejemplo, podría usar un codificador ASCII para convertir caracteres Unicode en ASCII de forma que se puedan mostrar en la consola.</span><span class="sxs-lookup"><span data-stu-id="22acb-209">For example, you might use an ASCII encoder to convert Unicode characters to ASCII so that they can be displayed at the console.</span></span> <span data-ttu-id="22acb-210">Para realizar la conversión, se llama al método <xref:System.Text.Encoding.GetBytes%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-210">To perform the conversion, you call the <xref:System.Text.Encoding.GetBytes%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-211">Si desea determinar cuántos bytes son necesarios para almacenar los caracteres codificados antes de realizar la codificación, puede llamar al método <xref:System.Text.Encoding.GetByteCount%2A> .</span><span class="sxs-lookup"><span data-stu-id="22acb-211">If you want to determine how many bytes are needed to store the encoded characters before performing the encoding, you can call the <xref:System.Text.Encoding.GetByteCount%2A> method.</span></span>

<span data-ttu-id="22acb-212">En el ejemplo siguiente se usa una única matriz de bytes para codificar cadenas en dos operaciones independientes.</span><span class="sxs-lookup"><span data-stu-id="22acb-212">The following example uses a single byte array to encode strings in two separate operations.</span></span> <span data-ttu-id="22acb-213">Mantiene un índice que indica la posición inicial de la matriz de bytes para el siguiente conjunto de bytes codificados con ASCII.</span><span class="sxs-lookup"><span data-stu-id="22acb-213">It maintains an index that indicates the starting position in the byte array for the next set of ASCII-encoded bytes.</span></span> <span data-ttu-id="22acb-214">Llama al método <xref:System.Text.ASCIIEncoding.GetByteCount%28System.String%29?displayProperty=nameWithType> para asegurarse de que la matriz de bytes es suficiente para alojar la cadena codificada.</span><span class="sxs-lookup"><span data-stu-id="22acb-214">It calls the <xref:System.Text.ASCIIEncoding.GetByteCount%28System.String%29?displayProperty=nameWithType> method to ensure that the byte array is large enough to accommodate the encoded string.</span></span> <span data-ttu-id="22acb-215">A continuación, llama al método <xref:System.Text.ASCIIEncoding.GetBytes%28System.String%2CSystem.Int32%2CSystem.Int32%2CSystem.Byte%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> para codificar los caracteres de la cadena.</span><span class="sxs-lookup"><span data-stu-id="22acb-215">It then calls the <xref:System.Text.ASCIIEncoding.GetBytes%28System.String%2CSystem.Int32%2CSystem.Int32%2CSystem.Byte%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> method to encode the characters in the string.</span></span>

[!code-csharp[Conceptual.Encoding#8](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/getbytes1.cs#8)]
[!code-vb[Conceptual.Encoding#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/getbytes1.vb#8)]

<span data-ttu-id="22acb-216">Un descodificador convierte una matriz de bytes que refleja una codificación de caracteres determinada en un juego de caracteres, ya sea en una matriz de caracteres o en una cadena.</span><span class="sxs-lookup"><span data-stu-id="22acb-216">A decoder converts a byte array that reflects a particular character encoding into a set of characters, either in a character array or in a string.</span></span> <span data-ttu-id="22acb-217">Para descodificar una matriz de bytes en una matriz de caracteres, se llama al método <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-217">To decode a byte array into a character array, you call the <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-218">Para descodificar una matriz de bytes en una cadena, se llama al método <xref:System.Text.Encoding.GetString%2A> .</span><span class="sxs-lookup"><span data-stu-id="22acb-218">To decode a byte array into a string, you call the <xref:System.Text.Encoding.GetString%2A> method.</span></span> <span data-ttu-id="22acb-219">Si desea determinar cuántos caracteres son necesarios para almacenar los bytes descodificados antes de realizar la descodificación, puede llamar al método <xref:System.Text.Encoding.GetCharCount%2A> .</span><span class="sxs-lookup"><span data-stu-id="22acb-219">If you want to determine how many characters are needed to store the decoded bytes before performing the decoding, you can call the <xref:System.Text.Encoding.GetCharCount%2A> method.</span></span>

<span data-ttu-id="22acb-220">En el ejemplo siguiente se codifican tres cadenas y después se descodifican en una sola matriz de caracteres.</span><span class="sxs-lookup"><span data-stu-id="22acb-220">The following example encodes three strings and then decodes them into a single array of characters.</span></span> <span data-ttu-id="22acb-221">Se mantiene un índice que indica la posición inicial de la matriz de caracteres para el siguiente juego de caracteres descodificados.</span><span class="sxs-lookup"><span data-stu-id="22acb-221">It maintains an index that indicates the starting position in the character array for the next set of decoded characters.</span></span> <span data-ttu-id="22acb-222">Se llama al método <xref:System.Text.ASCIIEncoding.GetCharCount%2A> para asegurarse de que la matriz de caracteres es suficientemente grande para alojar todos los caracteres descodificados.</span><span class="sxs-lookup"><span data-stu-id="22acb-222">It calls the <xref:System.Text.ASCIIEncoding.GetCharCount%2A> method to ensure that the character array is large enough to accommodate all the decoded characters.</span></span> <span data-ttu-id="22acb-223">A continuación, se llama al método <xref:System.Text.ASCIIEncoding.GetChars%28System.Byte%5B%5D%2CSystem.Int32%2CSystem.Int32%2CSystem.Char%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> para descodificar la matriz de bytes.</span><span class="sxs-lookup"><span data-stu-id="22acb-223">It then calls the <xref:System.Text.ASCIIEncoding.GetChars%28System.Byte%5B%5D%2CSystem.Int32%2CSystem.Int32%2CSystem.Char%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> method to decode the byte array.</span></span>

[!code-csharp[Conceptual.Encoding#9](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/getchars1.cs#9)]
[!code-vb[Conceptual.Encoding#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/getchars1.vb#9)]

<span data-ttu-id="22acb-224">Los métodos de codificación y descodificación de una clase derivada de <xref:System.Text.Encoding> están diseñados para funcionar en un conjunto completo de datos; es decir, todos los datos que se va a codificar o descodificar se proporciona en una única llamada al método.</span><span class="sxs-lookup"><span data-stu-id="22acb-224">The encoding and decoding methods of a class derived from <xref:System.Text.Encoding> are designed to work on a complete set of data; that is, all the data to be encoded or decoded is supplied in a single method call.</span></span> <span data-ttu-id="22acb-225">Sin embargo, en algunos casos, los datos están disponibles en una secuencia y los datos que se va a codificar o descodificar pueden estar disponibles solo desde operaciones de lectura independientes.</span><span class="sxs-lookup"><span data-stu-id="22acb-225">However, in some cases, data is available in a stream, and the data to be encoded or decoded may be available only from separate read operations.</span></span> <span data-ttu-id="22acb-226">Para ello, la operación de codificación o descodificación debe recordar cualquier estado guardado de su invocación anterior.</span><span class="sxs-lookup"><span data-stu-id="22acb-226">This requires the encoding or decoding operation to remember any saved state from its previous invocation.</span></span> <span data-ttu-id="22acb-227">Los métodos de clases derivadas de <xref:System.Text.Encoder> y <xref:System.Text.Decoder> pueden controlar las operaciones de codificación y descodificación que abarcan varias llamadas a métodos.</span><span class="sxs-lookup"><span data-stu-id="22acb-227">Methods of classes derived from <xref:System.Text.Encoder> and <xref:System.Text.Decoder> are able to handle encoding and decoding operations that span multiple method calls.</span></span>

<span data-ttu-id="22acb-228">Hay disponible un objeto <xref:System.Text.Encoder> para una codificación determinada desde la propiedad <xref:System.Text.Encoding.GetEncoder%2A?displayProperty=nameWithType> de esa codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-228">An <xref:System.Text.Encoder> object for a particular encoding is available from that encoding's <xref:System.Text.Encoding.GetEncoder%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="22acb-229">Hay disponible un objeto <xref:System.Text.Decoder> para una codificación determinada desde la propiedad <xref:System.Text.Encoding.GetDecoder%2A?displayProperty=nameWithType> de esa codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-229">A <xref:System.Text.Decoder> object for a particular encoding is available from that encoding's <xref:System.Text.Encoding.GetDecoder%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="22acb-230">Para las operaciones de descodificación, tenga en cuenta que las clases derivadas de <xref:System.Text.Decoder> incluyen un método <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> , pero no tienen un método que se corresponda con <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="22acb-230">For decoding operations, note that classes derived from <xref:System.Text.Decoder> include a <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> method, but they do not have a method that corresponds to <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="22acb-231">En el ejemplo siguiente se muestra la diferencia entre el uso de los métodos <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> y <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> para descodificar una matriz de bytes Unicode.</span><span class="sxs-lookup"><span data-stu-id="22acb-231">The following example illustrates the difference between using the <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> and <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> methods for decoding a Unicode byte array.</span></span> <span data-ttu-id="22acb-232">En el ejemplo se codifica una cadena que contiene algunos caracteres Unicode en un archivo y, a continuación, se usan los dos métodos de descodificación para descodificarlos de diez bytes en diez bytes.</span><span class="sxs-lookup"><span data-stu-id="22acb-232">The example encodes a string that contains some Unicode characters to a file, and then uses the two decoding methods to decode them ten bytes at a time.</span></span> <span data-ttu-id="22acb-233">Puesto que hay un par suplente en los bytes décimo y undécimo, se descodifica en llamadas a métodos independientes.</span><span class="sxs-lookup"><span data-stu-id="22acb-233">Because a surrogate pair occurs in the tenth and eleventh bytes, it is decoded in separate method calls.</span></span> <span data-ttu-id="22acb-234">Como muestra el resultado, el método <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> no puede descodificar los bytes correctamente y, en su lugar, los reemplaza con U+FFFD (carácter de reemplazo).</span><span class="sxs-lookup"><span data-stu-id="22acb-234">As the output shows, the <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> method is not able to correctly decode the bytes and instead replaces them with U+FFFD (REPLACEMENT CHARACTER).</span></span> <span data-ttu-id="22acb-235">Por otra parte, el método <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> puede descodificar correctamente la matriz de bytes para obtener la cadena original.</span><span class="sxs-lookup"><span data-stu-id="22acb-235">On the other hand, the <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> method is able to successfully decode the byte array to get the original string.</span></span>

[!code-csharp[Conceptual.Encoding#10](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/stream1.cs#10)]
[!code-vb[Conceptual.Encoding#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/stream1.vb#10)]

<a name="FallbackStrategy"></a>

## <a name="choosing-a-fallback-strategy"></a><span data-ttu-id="22acb-236">Elegir una estrategia de reinterpretación</span><span class="sxs-lookup"><span data-stu-id="22acb-236">Choosing a Fallback Strategy</span></span>

<span data-ttu-id="22acb-237">Cuando un método intenta codificar o descodificar un carácter pero no existe ninguna asignación, debe implementar una estrategia de reserva que determine cómo se debe tratar la asignación incorrecta.</span><span class="sxs-lookup"><span data-stu-id="22acb-237">When a method tries to encode or decode a character but no mapping exists, it must implement a fallback strategy that determines how the failed mapping should be handled.</span></span> <span data-ttu-id="22acb-238">Hay tres tipos de estrategias de reserva:</span><span class="sxs-lookup"><span data-stu-id="22acb-238">There are three types of fallback strategies:</span></span>

- <span data-ttu-id="22acb-239">Best-Fit Fallback</span><span class="sxs-lookup"><span data-stu-id="22acb-239">Best-fit fallback</span></span>

- <span data-ttu-id="22acb-240">Replacement Fallback</span><span class="sxs-lookup"><span data-stu-id="22acb-240">Replacement fallback</span></span>

- <span data-ttu-id="22acb-241">Exception Fallback</span><span class="sxs-lookup"><span data-stu-id="22acb-241">Exception fallback</span></span>

> [!IMPORTANT]
> <span data-ttu-id="22acb-242">Los problemas más frecuentes en las operaciones de codificación se producen cuando un carácter Unicode no se puede asignar a una codificación determinada de la página de códigos.</span><span class="sxs-lookup"><span data-stu-id="22acb-242">The most common problems in encoding operations occur when a Unicode character cannot be mapped to a particular code page encoding.</span></span> <span data-ttu-id="22acb-243">Los problemas más comunes de las operaciones de descodificación se producen cuando las secuencias no válidas de bytes no se pueden traducir a caracteres Unicode válidos.</span><span class="sxs-lookup"><span data-stu-id="22acb-243">The most common problems in decoding operations occur when invalid byte sequences cannot be translated into valid Unicode characters.</span></span> <span data-ttu-id="22acb-244">Por estas razones, debe saber qué estrategia de reserva emplea un determinado objeto de codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-244">For these reasons, you should know which fallback strategy a particular encoding object uses.</span></span> <span data-ttu-id="22acb-245">Siempre que sea posible, debe especificar la estrategia de reserva usada por un objeto de codificación cuando se crea una instancia del objeto.</span><span class="sxs-lookup"><span data-stu-id="22acb-245">Whenever possible, you should specify the fallback strategy used by an encoding object when you instantiate the object.</span></span>

<a name="BestFit"></a>

### <a name="best-fit-fallback"></a><span data-ttu-id="22acb-246">Best-Fit Fallback</span><span class="sxs-lookup"><span data-stu-id="22acb-246">Best-Fit Fallback</span></span>

<span data-ttu-id="22acb-247">Cuando un carácter no tiene una coincidencia exacta en la codificación de destino, el codificador puede intentar asignarle a un carácter similar.</span><span class="sxs-lookup"><span data-stu-id="22acb-247">When a character does not have an exact match in the target encoding, the encoder can try to map it to a similar character.</span></span> <span data-ttu-id="22acb-248">(La reserva con ajuste perfecto es principalmente un problema de codificación en lugar de un problema de descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-248">(Best-fit fallback is mostly an encoding rather than a decoding issue.</span></span> <span data-ttu-id="22acb-249">Hay muy pocas páginas de códigos que contengan caracteres que no se puedan asignar correctamente a Unicode.) La reserva con ajuste perfecto es el valor predeterminado para las codificaciones de páginas de códigos y de juegos de caracteres de doble byte recuperadas por las sobrecargas de <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> y <xref:System.Text.Encoding.GetEncoding%28System.String%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="22acb-249">There are very few code pages that contain characters that cannot be successfully mapped to Unicode.) Best-fit fallback is the default for code page and double-byte character set encodings that are retrieved by the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> and <xref:System.Text.Encoding.GetEncoding%28System.String%29?displayProperty=nameWithType> overloads.</span></span>

> [!NOTE]
> <span data-ttu-id="22acb-250">En teoría, las clases de codificación Unicode proporcionadas en .NET (<xref:System.Text.UTF8Encoding>, <xref:System.Text.UnicodeEncoding> y <xref:System.Text.UTF32Encoding>) admiten cada carácter de todos los juegos de caracteres, por lo que se pueden usar para eliminar los problemas de reserva con ajuste perfecto.</span><span class="sxs-lookup"><span data-stu-id="22acb-250">In theory, the Unicode encoding classes provided in .NET (<xref:System.Text.UTF8Encoding>, <xref:System.Text.UnicodeEncoding>, and <xref:System.Text.UTF32Encoding>) support every character in every character set, so they can be used to eliminate best-fit fallback issues.</span></span>

<span data-ttu-id="22acb-251">Las estrategias de ajuste perfecto varían en páginas de códigos diferentes.</span><span class="sxs-lookup"><span data-stu-id="22acb-251">Best-fit strategies vary for different code pages.</span></span> <span data-ttu-id="22acb-252">Por ejemplo, para algunas páginas de códigos, los caracteres latinos de ancho completo se asignarán a caracteres latinos de ancho medio, que son más comunes.</span><span class="sxs-lookup"><span data-stu-id="22acb-252">For example, for some code pages, full-width Latin characters map to the more common half-width Latin characters.</span></span> <span data-ttu-id="22acb-253">Para otras páginas de códigos no se realiza esta asignación.</span><span class="sxs-lookup"><span data-stu-id="22acb-253">For other code pages, this mapping is not made.</span></span> <span data-ttu-id="22acb-254">Incluso con una estrategia de ajuste perfecto dinámica, algunos caracteres no tienen un ajuste imaginable en algunas codificaciones.</span><span class="sxs-lookup"><span data-stu-id="22acb-254">Even under an aggressive best-fit strategy, there is no imaginable fit for some characters in some encodings.</span></span> <span data-ttu-id="22acb-255">Por ejemplo, un ideograma chino no tiene ninguna asignación razonable a la página de códigos 1252.</span><span class="sxs-lookup"><span data-stu-id="22acb-255">For example, a Chinese ideograph has no reasonable mapping to code page 1252.</span></span> <span data-ttu-id="22acb-256">En este caso, se emplea una cadena de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="22acb-256">In this case, a replacement string is used.</span></span> <span data-ttu-id="22acb-257">De forma predeterminada, esta cadena es simplemente un carácter QUESTION MARK (U+003F).</span><span class="sxs-lookup"><span data-stu-id="22acb-257">By default, this string is just a single QUESTION MARK (U+003F).</span></span>

> [!NOTE]
> <span data-ttu-id="22acb-258">Las estrategias de ajuste perfecto no están documentadas de forma detallada.</span><span class="sxs-lookup"><span data-stu-id="22acb-258">Best-fit strategies are not documented in detail.</span></span> <span data-ttu-id="22acb-259">Sin embargo, varias páginas de códigos se documentan en el sitio web de [Unicode Consortium](https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/).</span><span class="sxs-lookup"><span data-stu-id="22acb-259">However, several code pages are documented at the [Unicode Consortium's](https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/) website.</span></span> <span data-ttu-id="22acb-260">Revise el archivo **Léame.txt** de esa carpeta para obtener una descripción de cómo interpretar los archivos de asignación.</span><span class="sxs-lookup"><span data-stu-id="22acb-260">Please review the **readme.txt** file in that folder for a description of how to interpret the mapping files.</span></span>

<span data-ttu-id="22acb-261">En el ejemplo siguiente se usa la página de códigos 1252 (la página de códigos de Windows para los idiomas de Europa occidental) para mostrar la asignación con ajuste perfecto y sus desventajas.</span><span class="sxs-lookup"><span data-stu-id="22acb-261">The following example uses code page 1252 (the Windows code page for Western European languages) to illustrate best-fit mapping and its drawbacks.</span></span> <span data-ttu-id="22acb-262">El método <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> se usa para recuperar un objeto de codificación para la página de códigos 1252.</span><span class="sxs-lookup"><span data-stu-id="22acb-262">The <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method is used to retrieve an encoding object for code page 1252.</span></span> <span data-ttu-id="22acb-263">De forma predeterminada, usa una asignación con ajuste perfecto para los caracteres Unicode que no admite.</span><span class="sxs-lookup"><span data-stu-id="22acb-263">By default, it uses a best-fit mapping for Unicode characters that it does not support.</span></span> <span data-ttu-id="22acb-264">En el ejemplo se crea una instancia de una cadena que contiene tres caracteres no ASCII, CIRCLED LATIN CAPITAL LETTER S (U+24C8), SUPERSCRIPT FIVE (U+2075) e INFINITY (U+221E), separados por espacios en blanco.</span><span class="sxs-lookup"><span data-stu-id="22acb-264">The example instantiates a string that contains three non-ASCII characters - CIRCLED LATIN CAPITAL LETTER S (U+24C8), SUPERSCRIPT FIVE (U+2075), and INFINITY (U+221E) - separated by spaces.</span></span> <span data-ttu-id="22acb-265">Como muestra el resultado del ejemplo, cuando se codifica la cadena, los tres caracteres originales que no son espacios en blanco se reemplazan con QUESTION MARK (U+003F), DIGIT FIVE (U+0035) y DIGIT EIGHT (U+0038).</span><span class="sxs-lookup"><span data-stu-id="22acb-265">As the output from the example shows, when the string is encoded, the three original non-space characters are replaced by QUESTION MARK (U+003F), DIGIT FIVE (U+0035), and DIGIT EIGHT (U+0038).</span></span> <span data-ttu-id="22acb-266">DIGIT EIGHT es un reemplazo especialmente deficiente para el carácter INFINITY no compatible y QUESTION MARK indica que no había ninguna asignación disponible para el carácter original.</span><span class="sxs-lookup"><span data-stu-id="22acb-266">DIGIT EIGHT is a particularly poor replacement for the unsupported INFINITY character, and QUESTION MARK indicates that no mapping was available for the original character.</span></span>

[!code-csharp[Conceptual.Encoding#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1.cs#1)]
[!code-vb[Conceptual.Encoding#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1.vb#1)]

<span data-ttu-id="22acb-267">La asignación con ajuste perfecto es el comportamiento predeterminado para un objeto <xref:System.Text.Encoding> que codifica los datos Unicode en datos de página de códigos, y hay aplicaciones heredadas que se basan en este comportamiento.</span><span class="sxs-lookup"><span data-stu-id="22acb-267">Best-fit mapping is the default behavior for an <xref:System.Text.Encoding> object that encodes Unicode data into code page data, and there are legacy applications that rely on this behavior.</span></span> <span data-ttu-id="22acb-268">Sin embargo, la mayoría de las aplicaciones nuevas deben evitarlo por razones de seguridad.</span><span class="sxs-lookup"><span data-stu-id="22acb-268">However, most new applications should avoid best-fit behavior for security reasons.</span></span> <span data-ttu-id="22acb-269">Por ejemplo, las aplicaciones no deben asignar nombres de dominio mediante una codificación con ajuste perfecto.</span><span class="sxs-lookup"><span data-stu-id="22acb-269">For example, applications should not put a domain name through a best-fit encoding.</span></span>

> [!NOTE]
> <span data-ttu-id="22acb-270">También puede implementar una asignación personalizada de reserva con ajuste perfecto para una codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-270">You can also implement a custom best-fit fallback mapping for an encoding.</span></span> <span data-ttu-id="22acb-271">Para más información, vea la sección [Implementing a Custom Fallback Strategy](character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="22acb-271">For more information, see the [Implementing a Custom Fallback Strategy](character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="22acb-272">Si la reserva con ajuste perfecto es el valor predeterminado para un objeto de codificación, puede elegir otra estrategia de reserva cuando se recupera un objeto <xref:System.Text.Encoding> llamando a la sobrecarga de <xref:System.Text.Encoding.GetEncoding%28System.Int32%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> o <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-272">If best-fit fallback is the default for an encoding object, you can choose another fallback strategy when you retrieve an <xref:System.Text.Encoding> object by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> or <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> overload.</span></span> <span data-ttu-id="22acb-273">La próxima sección incluye un ejemplo que reemplaza con un asterisco (\*) cada carácter que no se puede asignar a la página de códigos 1252.</span><span class="sxs-lookup"><span data-stu-id="22acb-273">The following section includes an example that replaces each character that cannot be mapped to code page 1252 with an asterisk (\*).</span></span>

[!code-csharp[Conceptual.Encoding#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1a.cs#3)]
[!code-vb[Conceptual.Encoding#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1a.vb#3)]

<a name="Replacement"></a>

### <a name="replacement-fallback"></a><span data-ttu-id="22acb-274">Replacement Fallback</span><span class="sxs-lookup"><span data-stu-id="22acb-274">Replacement Fallback</span></span>

<span data-ttu-id="22acb-275">Cuando un carácter no tiene una coincidencia exacta en el esquema de destino, pero no hay ningún carácter adecuado al que se pueda asignar, la aplicación puede especificar un carácter o una cadena de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="22acb-275">When a character does not have an exact match in the target scheme, but there is no appropriate character that it can be mapped to, the application can specify a replacement character or string.</span></span> <span data-ttu-id="22acb-276">Este es el comportamiento predeterminado del descodificador Unicode, que reemplaza cualquier secuencia de dos bytes que no pueda descodificar con REPLACEMENT_CHARACTER (U+FFFD).</span><span class="sxs-lookup"><span data-stu-id="22acb-276">This is the default behavior for the Unicode decoder, which replaces any two-byte sequence that it cannot decode with REPLACEMENT_CHARACTER (U+FFFD).</span></span> <span data-ttu-id="22acb-277">También es el comportamiento predeterminado de la clase <xref:System.Text.ASCIIEncoding> , que reemplaza cada carácter que no puede codificar o descodificar con un signo de interrogación.</span><span class="sxs-lookup"><span data-stu-id="22acb-277">It is also the default behavior of the <xref:System.Text.ASCIIEncoding> class, which replaces each character that it cannot encode or decode with a question mark.</span></span> <span data-ttu-id="22acb-278">En el ejemplo siguiente se muestra el reemplazo de caracteres para la cadena Unicode del ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="22acb-278">The following example illustrates character replacement for the Unicode string from the previous example.</span></span> <span data-ttu-id="22acb-279">Como muestra el resultado, cada carácter que no se puede descodificar en un valor de bytes ASCII se reemplaza con 0x3F, que es el código ASCII de un signo de interrogación.</span><span class="sxs-lookup"><span data-stu-id="22acb-279">As the output shows, each character that cannot be decoded into an ASCII byte value is replaced by 0x3F, which is the ASCII code for a question mark.</span></span>

[!code-csharp[Conceptual.Encoding#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/replacementascii.cs#2)]
[!code-vb[Conceptual.Encoding#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/replacementascii.vb#2)]

<span data-ttu-id="22acb-280">.NET incluye las clases <xref:System.Text.EncoderReplacementFallback> y <xref:System.Text.DecoderReplacementFallback>, que sustituyen una cadena de reemplazo si un carácter no se asigna exactamente en una operación de codificación o descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-280">.NET includes the <xref:System.Text.EncoderReplacementFallback> and <xref:System.Text.DecoderReplacementFallback> classes, which substitute a replacement string if a character does not map exactly in an encoding or decoding operation.</span></span> <span data-ttu-id="22acb-281">De forma predeterminada, esta cadena de reemplazo es un signo de interrogación, pero puede llamar a una sobrecarga del constructor de clase para elegir otra cadena diferente.</span><span class="sxs-lookup"><span data-stu-id="22acb-281">By default, this replacement string is a question mark, but you can call a class constructor overload to choose a different string.</span></span> <span data-ttu-id="22acb-282">Normalmente, la cadena de reemplazo es un carácter único, aunque esto no es un requisito.</span><span class="sxs-lookup"><span data-stu-id="22acb-282">Typically, the replacement string is a single character, although this is not a requirement.</span></span> <span data-ttu-id="22acb-283">En el ejemplo siguiente se cambia el comportamiento del codificador de la página de códigos 1252 creando una instancia de un objeto <xref:System.Text.EncoderReplacementFallback> que usa un asterisco (\*) como cadena de reemplazo.</span><span class="sxs-lookup"><span data-stu-id="22acb-283">The following example changes the behavior of the code page 1252 encoder by instantiating an <xref:System.Text.EncoderReplacementFallback> object that uses an asterisk (\*) as a replacement string.</span></span>

[!code-csharp[Conceptual.Encoding#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1a.cs#3)]
[!code-vb[Conceptual.Encoding#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1a.vb#3)]

> [!NOTE]
> <span data-ttu-id="22acb-284">También puede implementar una clase de reemplazo para una codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-284">You can also implement a replacement class for an encoding.</span></span> <span data-ttu-id="22acb-285">Para más información, vea la sección [Implementing a Custom Fallback Strategy](character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="22acb-285">For more information, see the [Implementing a Custom Fallback Strategy](character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="22acb-286">Además de QUESTION MARK (U+003F), el REPLACEMENT CHARACTER de Unicode (U+FFFD) se suele usar como cadena de reemplazo, especialmente al descodificar secuencias de bytes que no se puede traducir correctamente a caracteres Unicode.</span><span class="sxs-lookup"><span data-stu-id="22acb-286">In addition to QUESTION MARK (U+003F), the Unicode REPLACEMENT CHARACTER (U+FFFD) is commonly used as a replacement string, particularly when decoding byte sequences that cannot be successfully translated into Unicode characters.</span></span> <span data-ttu-id="22acb-287">Sin embargo, se puede elegir cualquier cadena de reemplazo y esta puede contener varios caracteres.</span><span class="sxs-lookup"><span data-stu-id="22acb-287">However, you are free to choose any replacement string, and it can contain multiple characters.</span></span>

<a name="Exception"></a>

### <a name="exception-fallback"></a><span data-ttu-id="22acb-288">Exception Fallback</span><span class="sxs-lookup"><span data-stu-id="22acb-288">Exception Fallback</span></span>

<span data-ttu-id="22acb-289">En lugar de proporcionar una reserva con ajuste perfecto o una cadena de reemplazo, un codificador puede producir <xref:System.Text.EncoderFallbackException> si no puede codificar un juego de caracteres y un descodificador puede producir <xref:System.Text.DecoderFallbackException> si no puede descodificar una matriz de bytes.</span><span class="sxs-lookup"><span data-stu-id="22acb-289">Instead of providing a best-fit fallback or a replacement string, an encoder can throw an <xref:System.Text.EncoderFallbackException> if it is unable to encode a set of characters, and a decoder can throw a <xref:System.Text.DecoderFallbackException> if it is unable to decode a byte array.</span></span> <span data-ttu-id="22acb-290">Para producir una excepción en operaciones de codificación y descodificación, se proporciona un objeto <xref:System.Text.EncoderExceptionFallback> y un objeto <xref:System.Text.DecoderExceptionFallback> , respectivamente, al método <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-290">To throw an exception in encoding and decoding operations, you supply an <xref:System.Text.EncoderExceptionFallback> object and a <xref:System.Text.DecoderExceptionFallback> object, respectively, to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-291">En el ejemplo siguiente se muestra la reserva de excepción con la clase <xref:System.Text.ASCIIEncoding> .</span><span class="sxs-lookup"><span data-stu-id="22acb-291">The following example illustrates exception fallback with the <xref:System.Text.ASCIIEncoding> class.</span></span>

[!code-csharp[Conceptual.Encoding#4](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/exceptionascii.cs#4)]
[!code-vb[Conceptual.Encoding#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/exceptionascii.vb#4)]

> [!NOTE]
> <span data-ttu-id="22acb-292">También puede implementar un controlador de excepciones personalizado para una operación de codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-292">You can also implement a custom exception handler for an encoding operation.</span></span> <span data-ttu-id="22acb-293">Para más información, vea la sección [Implementing a Custom Fallback Strategy](character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="22acb-293">For more information, see the [Implementing a Custom Fallback Strategy](character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="22acb-294">Los objetos <xref:System.Text.EncoderFallbackException> y <xref:System.Text.DecoderFallbackException> proporcionan la siguiente información acerca de la condición que provocó la excepción:</span><span class="sxs-lookup"><span data-stu-id="22acb-294">The <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> objects provide the following information about the condition that caused the exception:</span></span>

- <span data-ttu-id="22acb-295">El objeto <xref:System.Text.EncoderFallbackException> incluye un método <xref:System.Text.EncoderFallbackException.IsUnknownSurrogate%2A> , que indica si el carácter o los caracteres que no se pueden codificar representan un par suplente desconocido (en este caso, el método devuelve `true`) o un único carácter desconocido (en este caso, el método devuelve `false`).</span><span class="sxs-lookup"><span data-stu-id="22acb-295">The <xref:System.Text.EncoderFallbackException> object includes an <xref:System.Text.EncoderFallbackException.IsUnknownSurrogate%2A> method, which indicates whether the character or characters that cannot be encoded represent an unknown surrogate pair (in which case, the method returns `true`) or an unknown single character (in which case, the method returns `false`).</span></span> <span data-ttu-id="22acb-296">Los caracteres del par suplente están disponibles a partir de las propiedades <xref:System.Text.EncoderFallbackException.CharUnknownHigh%2A?displayProperty=nameWithType> y <xref:System.Text.EncoderFallbackException.CharUnknownLow%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-296">The characters in the surrogate pair are available from the <xref:System.Text.EncoderFallbackException.CharUnknownHigh%2A?displayProperty=nameWithType> and <xref:System.Text.EncoderFallbackException.CharUnknownLow%2A?displayProperty=nameWithType> properties.</span></span> <span data-ttu-id="22acb-297">El carácter único desconocido está disponible en la propiedad <xref:System.Text.EncoderFallbackException.CharUnknown%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-297">The unknown single character is available from the <xref:System.Text.EncoderFallbackException.CharUnknown%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="22acb-298">La propiedad <xref:System.Text.EncoderFallbackException.Index%2A?displayProperty=nameWithType> indica la posición de la cadena en la que se encontró el primer carácter que no se pudo codificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-298">The <xref:System.Text.EncoderFallbackException.Index%2A?displayProperty=nameWithType> property indicates the position in the string at which the first character that could not be encoded was found.</span></span>

- <span data-ttu-id="22acb-299">El objeto <xref:System.Text.DecoderFallbackException> incluye una propiedad <xref:System.Text.DecoderFallbackException.BytesUnknown%2A> que devuelve una matriz de bytes que no se pueden descodificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-299">The <xref:System.Text.DecoderFallbackException> object includes a <xref:System.Text.DecoderFallbackException.BytesUnknown%2A> property that returns an array of bytes that cannot be decoded.</span></span> <span data-ttu-id="22acb-300">La propiedad <xref:System.Text.DecoderFallbackException.Index%2A?displayProperty=nameWithType> indica la posición inicial de los bytes desconocidos.</span><span class="sxs-lookup"><span data-stu-id="22acb-300">The <xref:System.Text.DecoderFallbackException.Index%2A?displayProperty=nameWithType> property indicates the starting position of the unknown bytes.</span></span>

<span data-ttu-id="22acb-301">Aunque los objetos <xref:System.Text.EncoderFallbackException> y <xref:System.Text.DecoderFallbackException> proporcionan información suficiente de diagnóstico sobre la excepción, no proporcionan acceso al búfer de codificación o descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-301">Although the <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> objects provide adequate diagnostic information about the exception, they do not provide access to the encoding or decoding buffer.</span></span> <span data-ttu-id="22acb-302">Por tanto, no permiten reemplazar o corregir datos no válidos dentro del método de codificación o descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-302">Therefore, they do not allow invalid data to be replaced or corrected within the encoding or decoding method.</span></span>

<a name="Custom"></a>

## <a name="implementing-a-custom-fallback-strategy"></a><span data-ttu-id="22acb-303">Implementing a Custom Fallback Strategy</span><span class="sxs-lookup"><span data-stu-id="22acb-303">Implementing a Custom Fallback Strategy</span></span>

<span data-ttu-id="22acb-304">Además de la asignación con ajuste perfecto implementada internamente por las páginas de códigos, .NET incluye las siguientes clases para implementar una estrategia de reserva:</span><span class="sxs-lookup"><span data-stu-id="22acb-304">In addition to the best-fit mapping that is implemented internally by code pages, .NET includes the following classes for implementing a fallback strategy:</span></span>

- <span data-ttu-id="22acb-305">Use <xref:System.Text.EncoderReplacementFallback> y <xref:System.Text.EncoderReplacementFallbackBuffer> para reemplazar caracteres en operaciones de codificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-305">Use <xref:System.Text.EncoderReplacementFallback> and <xref:System.Text.EncoderReplacementFallbackBuffer> to replace characters in encoding operations.</span></span>

- <span data-ttu-id="22acb-306">Use <xref:System.Text.DecoderReplacementFallback> y <xref:System.Text.DecoderReplacementFallbackBuffer> para reemplazar caracteres en operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-306">Use <xref:System.Text.DecoderReplacementFallback> and <xref:System.Text.DecoderReplacementFallbackBuffer> to replace characters in decoding operations.</span></span>

- <span data-ttu-id="22acb-307">Use <xref:System.Text.EncoderExceptionFallback> y <xref:System.Text.EncoderExceptionFallbackBuffer> para producir <xref:System.Text.EncoderFallbackException> cuando un carácter no se puede codificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-307">Use <xref:System.Text.EncoderExceptionFallback> and <xref:System.Text.EncoderExceptionFallbackBuffer> to throw an <xref:System.Text.EncoderFallbackException> when a character cannot be encoded.</span></span>

- <span data-ttu-id="22acb-308">Use <xref:System.Text.DecoderExceptionFallback> y <xref:System.Text.DecoderExceptionFallbackBuffer> para producir <xref:System.Text.DecoderFallbackException> cuando un carácter no se puede descodificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-308">Use <xref:System.Text.DecoderExceptionFallback> and <xref:System.Text.DecoderExceptionFallbackBuffer> to throw a <xref:System.Text.DecoderFallbackException> when a character cannot be decoded.</span></span>

<span data-ttu-id="22acb-309">Además, puede implementar una solución personalizada que use reserva con ajuste perfecto, reserva de reemplazo o reserva de excepción siguiendo estos pasos:</span><span class="sxs-lookup"><span data-stu-id="22acb-309">In addition, you can implement a custom solution that uses best-fit fallback, replacement fallback, or exception fallback, by following these steps:</span></span>

1. <span data-ttu-id="22acb-310">Derive una clase de <xref:System.Text.EncoderFallback> para las operaciones de codificación y de <xref:System.Text.DecoderFallback> para las operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-310">Derive a class from <xref:System.Text.EncoderFallback> for encoding operations, and from <xref:System.Text.DecoderFallback> for decoding operations.</span></span>

2. <span data-ttu-id="22acb-311">Derive una clase de <xref:System.Text.EncoderFallbackBuffer> para las operaciones de codificación y de <xref:System.Text.DecoderFallbackBuffer> para las operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-311">Derive a class from <xref:System.Text.EncoderFallbackBuffer> for encoding operations, and from <xref:System.Text.DecoderFallbackBuffer> for decoding operations.</span></span>

3. <span data-ttu-id="22acb-312">Para la reserva de excepción, si las clases <xref:System.Text.EncoderFallbackException> y <xref:System.Text.DecoderFallbackException> predefinidas no satisfacen sus necesidades, derive una clase de un objeto de excepción como <xref:System.Exception> o <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="22acb-312">For exception fallback, if the predefined <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> classes do not meet your needs, derive a class from an exception object such as <xref:System.Exception> or <xref:System.ArgumentException>.</span></span>

### <a name="deriving-from-encoderfallback-or-decoderfallback"></a><span data-ttu-id="22acb-313">Derivar de EncoderFallback o DecoderFallback</span><span class="sxs-lookup"><span data-stu-id="22acb-313">Deriving from EncoderFallback or DecoderFallback</span></span>

<span data-ttu-id="22acb-314">Para implementar una solución de reserva personalizada, debe crear una clase que herede de <xref:System.Text.EncoderFallback> para las operaciones de codificación y de <xref:System.Text.DecoderFallback> para las operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-314">To implement a custom fallback solution, you must create a class that inherits from <xref:System.Text.EncoderFallback> for encoding operations, and from <xref:System.Text.DecoderFallback> for decoding operations.</span></span> <span data-ttu-id="22acb-315">Las instancias de estas clases se pasan al método <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> y actúan como intermediario entre la clase de codificación y la implementación de reserva.</span><span class="sxs-lookup"><span data-stu-id="22acb-315">Instances of these classes are passed to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method and serve as the intermediary between the encoding class and the fallback implementation.</span></span>

<span data-ttu-id="22acb-316">Cuando se crea una solución de reserva personalizada para un codificador o un descodificador, debe implementar los miembros siguientes:</span><span class="sxs-lookup"><span data-stu-id="22acb-316">When you create a custom fallback solution for an encoder or decoder, you must implement the following members:</span></span>

- <span data-ttu-id="22acb-317">La propiedad <xref:System.Text.EncoderFallback.MaxCharCount%2A?displayProperty=nameWithType> o <xref:System.Text.DecoderFallback.MaxCharCount%2A?displayProperty=nameWithType> , que devuelve el número máximo de caracteres posible que el reemplazo con mejor ajuste o la reserva de excepción pueda devolver para reemplazar un único carácter.</span><span class="sxs-lookup"><span data-stu-id="22acb-317">The <xref:System.Text.EncoderFallback.MaxCharCount%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallback.MaxCharCount%2A?displayProperty=nameWithType> property, which returns the maximum possible number of characters that the best-fit, replacement, or exception fallback can return to replace a single character.</span></span> <span data-ttu-id="22acb-318">En el caso de la reserva de excepción personalizada, su valor es cero.</span><span class="sxs-lookup"><span data-stu-id="22acb-318">For a custom exception fallback, its value is zero.</span></span>

- <span data-ttu-id="22acb-319">El método <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> o <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> , que devuelve una implementación personalizada de <xref:System.Text.EncoderFallbackBuffer> o <xref:System.Text.DecoderFallbackBuffer> .</span><span class="sxs-lookup"><span data-stu-id="22acb-319">The <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method, which returns your custom <xref:System.Text.EncoderFallbackBuffer> or <xref:System.Text.DecoderFallbackBuffer> implementation.</span></span> <span data-ttu-id="22acb-320">El codificador llama al método cuando encuentra el primer carácter que no puede codificar correctamente o lo llama el decodificador cuando encuentra el primer byte que no puede descodificar correctamente.</span><span class="sxs-lookup"><span data-stu-id="22acb-320">The method is called by the encoder when it encounters the first character that it is unable to successfully encode, or by the decoder when it encounters the first byte that it is unable to successfully decode.</span></span>

### <a name="deriving-from-encoderfallbackbuffer-or-decoderfallbackbuffer"></a><span data-ttu-id="22acb-321">Derivar de EncoderFallbackBuffer o DecoderFallbackBuffer</span><span class="sxs-lookup"><span data-stu-id="22acb-321">Deriving from EncoderFallbackBuffer or DecoderFallbackBuffer</span></span>

<span data-ttu-id="22acb-322">Para implementar una solución de reserva personalizada, debe crear también una clase que herede de <xref:System.Text.EncoderFallbackBuffer> para las operaciones de codificación y de <xref:System.Text.DecoderFallbackBuffer> para las operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="22acb-322">To implement a custom fallback solution, you must also create a class that inherits from <xref:System.Text.EncoderFallbackBuffer> for encoding operations, and from <xref:System.Text.DecoderFallbackBuffer> for decoding operations.</span></span> <span data-ttu-id="22acb-323">El método <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A> de las clases <xref:System.Text.EncoderFallback> y <xref:System.Text.DecoderFallback> devuelve instancias de estas clases.</span><span class="sxs-lookup"><span data-stu-id="22acb-323">Instances of these classes are returned by the <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A> method  of the <xref:System.Text.EncoderFallback> and <xref:System.Text.DecoderFallback> classes.</span></span> <span data-ttu-id="22acb-324">El codificador llama al método <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> cuando encuentra el primer carácter que no puede codificar y el descodificador llama al método <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> cuando encuentra uno o más bytes que no puede descodificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-324">The <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method is called by the encoder when it encounters the first character that it is not able to encode, and the <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method is called by the decoder when it encounters one or more bytes that it is not able to decode.</span></span> <span data-ttu-id="22acb-325">Las clases <xref:System.Text.EncoderFallbackBuffer> y <xref:System.Text.DecoderFallbackBuffer> proporcionan la implementación de reserva.</span><span class="sxs-lookup"><span data-stu-id="22acb-325">The <xref:System.Text.EncoderFallbackBuffer> and <xref:System.Text.DecoderFallbackBuffer> classes provide the fallback implementation.</span></span> <span data-ttu-id="22acb-326">Cada instancia representa un búfer que contiene los caracteres de reserva que reemplazarán el carácter que no se puede codificar o la secuencia de bytes que no se puede descodificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-326">Each instance represents a buffer that contains the fallback characters that will replace the character that cannot be encoded or the byte sequence that cannot be decoded.</span></span>

<span data-ttu-id="22acb-327">Cuando se crea una solución de reserva personalizada para un codificador o un descodificador, debe implementar los miembros siguientes:</span><span class="sxs-lookup"><span data-stu-id="22acb-327">When you create a custom fallback solution for an encoder or decoder, you must implement the following members:</span></span>

- <span data-ttu-id="22acb-328">El método <xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> o <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-328">The <xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-329">El codificador llama a<xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> para proporcionar el búfer de reserva con información sobre el carácter que no puede codificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-329"><xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> is called by the encoder to provide the fallback buffer with information about the character that it cannot encode.</span></span> <span data-ttu-id="22acb-330">Puesto que el carácter que se va a codificar puede ser un par suplente, este método está sobrecargado.</span><span class="sxs-lookup"><span data-stu-id="22acb-330">Because the character to be encoded may be a surrogate pair, this method is overloaded.</span></span> <span data-ttu-id="22acb-331">Se pasa a una sobrecarga el carácter que se va a codificar y su índice en la cadena.</span><span class="sxs-lookup"><span data-stu-id="22acb-331">One overload is passed the character to be encoded and its index in the string.</span></span> <span data-ttu-id="22acb-332">A la segunda sobrecarga se le pasa el suplente máximo y mínimo junto con su índice en la cadena.</span><span class="sxs-lookup"><span data-stu-id="22acb-332">The second overload is passed the high and low surrogate along with its index in the string.</span></span> <span data-ttu-id="22acb-333">El descodificador llama al método <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> para proporcionar el búfer de reserva con información sobre los bytes que no puede descodificar.</span><span class="sxs-lookup"><span data-stu-id="22acb-333">The <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> method is called by the decoder to provide the fallback buffer with information about the bytes that it cannot decode.</span></span> <span data-ttu-id="22acb-334">Se pasa a este método una matriz de bytes que no puede descodificar, junto con el índice del primer byte.</span><span class="sxs-lookup"><span data-stu-id="22acb-334">This method is passed an array of bytes that it cannot decode, along with the index of the first byte.</span></span> <span data-ttu-id="22acb-335">El método de reserva debe devolver `true` si el búfer de reserva puede proporcionar un carácter o caracteres de mejor ajuste o de reemplazo; de lo contrario, debe devolver `false`.</span><span class="sxs-lookup"><span data-stu-id="22acb-335">The fallback method should return `true` if the fallback buffer can supply a best-fit or replacement character or characters; otherwise, it should return `false`.</span></span> <span data-ttu-id="22acb-336">En el caso de una reserva de excepción, el método de reserva debe producir una excepción.</span><span class="sxs-lookup"><span data-stu-id="22acb-336">For an exception fallback, the fallback method should throw an exception.</span></span>

- <span data-ttu-id="22acb-337">El método <xref:System.Text.EncoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> o <xref:System.Text.DecoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> , al que llama repetidamente el codificador o el descodificador para obtener el siguiente carácter del búfer de reserva.</span><span class="sxs-lookup"><span data-stu-id="22acb-337">The <xref:System.Text.EncoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> method, which is called repeatedly by the encoder or decoder to get the next character from the fallback buffer.</span></span> <span data-ttu-id="22acb-338">Cuando se han devuelto todos los caracteres de reserva, el método debe devolver U+0000.</span><span class="sxs-lookup"><span data-stu-id="22acb-338">When all fallback characters have been returned, the method should return U+0000.</span></span>

- <span data-ttu-id="22acb-339">La propiedad <xref:System.Text.EncoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> o <xref:System.Text.DecoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> , que devuelve el número de caracteres que permanecen en el búfer de reserva.</span><span class="sxs-lookup"><span data-stu-id="22acb-339">The <xref:System.Text.EncoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> property, which returns the number of characters remaining in the fallback buffer.</span></span>

- <span data-ttu-id="22acb-340">El método <xref:System.Text.EncoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> o <xref:System.Text.DecoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> , que mueve la posición actual en el búfer de reserva al carácter anterior.</span><span class="sxs-lookup"><span data-stu-id="22acb-340">The <xref:System.Text.EncoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> method, which moves the current position in the fallback buffer to the previous character.</span></span>

- <span data-ttu-id="22acb-341">El método <xref:System.Text.EncoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> o <xref:System.Text.DecoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> , que se reinicializa el búfer de reserva.</span><span class="sxs-lookup"><span data-stu-id="22acb-341">The <xref:System.Text.EncoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> method, which reinitializes the fallback buffer.</span></span>

<span data-ttu-id="22acb-342">Si la implementación de reserva es una reserva con ajuste perfecto o una reserva de reemplazo, las clases derivadas de <xref:System.Text.EncoderFallbackBuffer> y <xref:System.Text.DecoderFallbackBuffer> también mantienen dos campos de instancia privados: el número exacto de caracteres del búfer y el índice del carácter siguiente del búfer que se va a devolver.</span><span class="sxs-lookup"><span data-stu-id="22acb-342">If the fallback implementation is a best-fit fallback or a replacement fallback, the classes derived from <xref:System.Text.EncoderFallbackBuffer> and <xref:System.Text.DecoderFallbackBuffer> also maintain two private instance fields: the exact number of characters in the buffer; and the index of the next character in the buffer to return.</span></span>

### <a name="an-encoderfallback-example"></a><span data-ttu-id="22acb-343">Ejemplo de EncoderFallback</span><span class="sxs-lookup"><span data-stu-id="22acb-343">An EncoderFallback Example</span></span>

<span data-ttu-id="22acb-344">En un ejemplo anterior se usaba la reserva de reemplazo para reemplazar caracteres Unicode que no correspondían a caracteres ASCII con un asterisco (\*).</span><span class="sxs-lookup"><span data-stu-id="22acb-344">An earlier example used replacement fallback to replace Unicode characters that did not correspond to ASCII characters with an asterisk (\*).</span></span> <span data-ttu-id="22acb-345">En el ejemplo siguiente se usa una implementación personalizada de reserva con ajuste perfecto en su lugar para proporcionar una mejor asignación de caracteres no ASCII.</span><span class="sxs-lookup"><span data-stu-id="22acb-345">The following example uses a custom best-fit fallback implementation instead to provide a better mapping of non-ASCII characters.</span></span>

<span data-ttu-id="22acb-346">En el código siguiente se define una clase denominada `CustomMapper` que se deriva de <xref:System.Text.EncoderFallback> para controlar la asignación con ajuste perfecto de caracteres no ASCII.</span><span class="sxs-lookup"><span data-stu-id="22acb-346">The following code defines a class named `CustomMapper` that is derived from <xref:System.Text.EncoderFallback> to handle the best-fit mapping of non-ASCII characters.</span></span> <span data-ttu-id="22acb-347">Su método `CreateFallbackBuffer` devuelve un objeto `CustomMapperFallbackBuffer` , que proporciona la implementación de <xref:System.Text.EncoderFallbackBuffer> .</span><span class="sxs-lookup"><span data-stu-id="22acb-347">Its `CreateFallbackBuffer` method returns a `CustomMapperFallbackBuffer` object, which provides the <xref:System.Text.EncoderFallbackBuffer> implementation.</span></span> <span data-ttu-id="22acb-348">La clase `CustomMapper` usa un objeto <xref:System.Collections.Generic.Dictionary%602> para almacenar las asignaciones de caracteres Unicode no compatibles (el valor de clave) y sus caracteres de 8 bits correspondientes (que se almacenan en dos bytes consecutivos en un entero de 64 bits).</span><span class="sxs-lookup"><span data-stu-id="22acb-348">The `CustomMapper` class uses a <xref:System.Collections.Generic.Dictionary%602> object to store the mappings of unsupported Unicode characters (the key value) and their corresponding 8-bit characters (which are stored in two consecutive bytes in a 64-bit integer).</span></span> <span data-ttu-id="22acb-349">Para que esta asignación esté disponible para el búfer de reserva, la instancia de `CustomMapper` se pasa como un parámetro al constructor de clase `CustomMapperFallbackBuffer` .</span><span class="sxs-lookup"><span data-stu-id="22acb-349">To make this mapping available to the fallback buffer, the `CustomMapper` instance is passed as a parameter to the `CustomMapperFallbackBuffer` class constructor.</span></span> <span data-ttu-id="22acb-350">Puesto que la asignación más larga es la cadena "INF" por el carácter Unicode U+221E, la propiedad `MaxCharCount` devuelve 3.</span><span class="sxs-lookup"><span data-stu-id="22acb-350">Because the longest mapping is the string "INF" for the Unicode character U+221E, the `MaxCharCount` property returns 3.</span></span>

[!code-csharp[Conceptual.Encoding#5](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#5)]
[!code-vb[Conceptual.Encoding#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#5)]

<span data-ttu-id="22acb-351">En el código siguiente se define la clase `CustomMapperFallbackBuffer` , que se deriva de <xref:System.Text.EncoderFallbackBuffer>.</span><span class="sxs-lookup"><span data-stu-id="22acb-351">The following code defines the `CustomMapperFallbackBuffer` class, which is derived from <xref:System.Text.EncoderFallbackBuffer>.</span></span> <span data-ttu-id="22acb-352">El diccionario que contiene las asignaciones con ajuste perfecto y que se define en la instancia de `CustomMapper` está disponible desde su constructor de clase.</span><span class="sxs-lookup"><span data-stu-id="22acb-352">The dictionary that contains best-fit mappings and that is defined in the `CustomMapper` instance is available from its class constructor.</span></span> <span data-ttu-id="22acb-353">Su método `Fallback` devuelve `true` si cualquiera de los caracteres Unicode que el codificador ASCII no puede codificar se definen en el diccionario de asignación; de lo contrario, devuelve `false`.</span><span class="sxs-lookup"><span data-stu-id="22acb-353">Its `Fallback` method returns `true` if any of the Unicode characters that the ASCII encoder cannot encode are defined in the mapping dictionary; otherwise, it returns `false`.</span></span> <span data-ttu-id="22acb-354">Para cada reserva, la variable `count` privada indica el número de caracteres que quedan por devolver y la variable `index` privada indica la posición en el búfer de cadena, `charsToReturn`, del siguiente carácter que se va a devolver.</span><span class="sxs-lookup"><span data-stu-id="22acb-354">For each fallback, the private `count` variable indicates the number of characters that remain to be returned, and the private `index` variable indicates the position in the string buffer, `charsToReturn`, of the next character to return.</span></span>

[!code-csharp[Conceptual.Encoding#6](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#6)]
[!code-vb[Conceptual.Encoding#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#6)]

<span data-ttu-id="22acb-355">En el código siguiente se crean instancias del objeto `CustomMapper` y se pasa una instancia del mismo al método <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="22acb-355">The following code then instantiates the `CustomMapper` object and passes an instance of it to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="22acb-356">El resultado indica que la implementación de reserva con ajuste perfecto controla correctamente los tres caracteres no ASCII de la cadena original.</span><span class="sxs-lookup"><span data-stu-id="22acb-356">The output indicates that the best-fit fallback implementation successfully handles the three non-ASCII characters in the original string.</span></span>

[!code-csharp[Conceptual.Encoding#7](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#7)]
[!code-vb[Conceptual.Encoding#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#7)]

## <a name="see-also"></a><span data-ttu-id="22acb-357">Vea también</span><span class="sxs-lookup"><span data-stu-id="22acb-357">See also</span></span>

- [<span data-ttu-id="22acb-358">Introducción a la codificación de caracteres en .NET</span><span class="sxs-lookup"><span data-stu-id="22acb-358">Introduction to character encoding in .NET</span></span>](character-encoding-introduction.md)
- <xref:System.Text.Encoder>
- <xref:System.Text.Decoder>
- <xref:System.Text.DecoderFallback>
- <xref:System.Text.Encoding>
- <xref:System.Text.EncoderFallback>
- [<span data-ttu-id="22acb-359">Globalización y localización</span><span class="sxs-lookup"><span data-stu-id="22acb-359">Globalization and Localization</span></span>](../globalization-localization/index.md)
