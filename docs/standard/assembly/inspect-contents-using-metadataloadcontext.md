---
title: Procedimiento Inspección del contenido de un ensamblado con MetadataLoadContext
description: Aprenda a usar MetadataLoadContext, que es una API que le permite cargar ensamblados .NET con fines de inspección.
author: MSDN-WhiteKnight
ms.date: 03/10/2020
ms.openlocfilehash: 7205230986aa852813a651d2fcb7c5ef88ab18fe
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/18/2020
ms.locfileid: "94831356"
---
# <a name="how-to-inspect-assembly-contents-using-metadataloadcontext"></a><span data-ttu-id="b18a5-103">Procedimiento Inspección del contenido de un ensamblado con MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="b18a5-103">How to: Inspect assembly contents using MetadataLoadContext</span></span>

<span data-ttu-id="b18a5-104">De forma predeterminada, la API de reflexión de .NET permite a los desarrolladores inspeccionar el contenido de los ensamblados cargados en el contexto de ejecución principal.</span><span class="sxs-lookup"><span data-stu-id="b18a5-104">The reflection API in .NET by default enables developers to inspect the contents of assemblies loaded into the main execution context.</span></span> <span data-ttu-id="b18a5-105">Sin embargo, a veces no es posible cargar un ensamblado en el contexto de ejecución, por ejemplo, porque se compiló para otra arquitectura de procesador o plataforma, o es un [ensamblado de referencia](reference-assemblies.md).</span><span class="sxs-lookup"><span data-stu-id="b18a5-105">However, sometimes it isn't possible to load an assembly into the execution context, for example, because it was compiled for another platform or processor architecture, or it's a [reference assembly](reference-assemblies.md).</span></span> <span data-ttu-id="b18a5-106">La API de <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> permite cargar e inspeccionar dichos ensamblados.</span><span class="sxs-lookup"><span data-stu-id="b18a5-106">The <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> API allows you to load and inspect such assemblies.</span></span> <span data-ttu-id="b18a5-107">Los ensamblados cargados en <xref:System.Reflection.MetadataLoadContext> se tratan únicamente como metadatos, es decir, se pueden examinar los tipos del ensamblado, pero no se puede ejecutar ningún código que contenga.</span><span class="sxs-lookup"><span data-stu-id="b18a5-107">Assemblies loaded into the <xref:System.Reflection.MetadataLoadContext> are treated only as metadata, that is, you can examine types in the assembly, but you can't execute any code contained in it.</span></span> <span data-ttu-id="b18a5-108">A diferencia del contexto de ejecución principal, <xref:System.Reflection.MetadataLoadContext> no carga automáticamente las dependencias del directorio actual, sino que usa la lógica de enlace personalizada proporcionada por la clase <xref:System.Reflection.MetadataAssemblyResolver> que se le ha pasado.</span><span class="sxs-lookup"><span data-stu-id="b18a5-108">Unlike the main execution context, the <xref:System.Reflection.MetadataLoadContext> doesn't automatically load dependencies from the current directory; instead it uses the custom binding logic provided by the <xref:System.Reflection.MetadataAssemblyResolver> passed to it.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b18a5-109">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="b18a5-109">Prerequisites</span></span>

<span data-ttu-id="b18a5-110">Para usar <xref:System.Reflection.MetadataLoadContext>, instale el paquete NuGet [System.Reflection.MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext).</span><span class="sxs-lookup"><span data-stu-id="b18a5-110">To use <xref:System.Reflection.MetadataLoadContext>, install the [System.Reflection.MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) NuGet package.</span></span> <span data-ttu-id="b18a5-111">Se admite en cualquier plataforma de destino compatible con .NET Standard 2.0, por ejemplo, .NET Core 2.0 o .NET Framework 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="b18a5-111">It is supported on any .NET Standard 2.0-compliant target framework, for example, .NET Core 2.0 or .NET Framework 4.6.1.</span></span>

## <a name="create-metadataassemblyresolver-for-metadataloadcontext"></a><span data-ttu-id="b18a5-112">Creación de MetadataAssemblyResolver para MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="b18a5-112">Create MetadataAssemblyResolver for MetadataLoadContext</span></span>

<span data-ttu-id="b18a5-113">Para crear la clase <xref:System.Reflection.MetadataLoadContext> es necesario proporcionar la instancia de la clase <xref:System.Reflection.MetadataAssemblyResolver>.</span><span class="sxs-lookup"><span data-stu-id="b18a5-113">Creating the <xref:System.Reflection.MetadataLoadContext> requires providing the instance of the <xref:System.Reflection.MetadataAssemblyResolver>.</span></span> <span data-ttu-id="b18a5-114">La manera más sencilla de proporcionar una es usar la clase <xref:System.Reflection.PathAssemblyResolver>, que resuelve los ensamblados de la colección especificada de cadenas de ruta de acceso de ensamblado.</span><span class="sxs-lookup"><span data-stu-id="b18a5-114">The simplest way to provide one is to use the <xref:System.Reflection.PathAssemblyResolver>, which resolves assemblies from the given collection of assembly path strings.</span></span> <span data-ttu-id="b18a5-115">Esta colección, además de los ensamblados que quiere inspeccionar directamente, también debe incluir todas las dependencias necesarias.</span><span class="sxs-lookup"><span data-stu-id="b18a5-115">This collection, besides assemblies you want to inspect directly, should also include all needed dependencies.</span></span> <span data-ttu-id="b18a5-116">Por ejemplo, para leer el atributo personalizado que se encuentra en un ensamblado externo, debe incluir ese ensamblado o se producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="b18a5-116">For example, to read the custom attribute located in an external assembly, you should include that assembly or an exception will be thrown.</span></span> <span data-ttu-id="b18a5-117">En la mayoría de los casos, debe incluir al menos el *ensamblado principal*, es decir, el ensamblado que contiene tipos de sistema integrados, como <xref:System.Object?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b18a5-117">In most cases, you should include at least the *core assembly*, that is, the assembly containing built-in system types, such as <xref:System.Object?displayProperty=nameWithType>.</span></span> <span data-ttu-id="b18a5-118">En el código siguiente se muestra cómo crear la clase <xref:System.Reflection.PathAssemblyResolver> mediante la colección que consta del ensamblado inspeccionado y el ensamblado principal del entorno de ejecución actual:</span><span class="sxs-lookup"><span data-stu-id="b18a5-118">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and the current runtime's core assembly:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CoreAssembly)]

<span data-ttu-id="b18a5-119">Si necesita tener acceso a todos los tipos de BCL, puede incluir todos los ensamblados en tiempo de ejecución de la colección.</span><span class="sxs-lookup"><span data-stu-id="b18a5-119">If you need access to all BCL types, you can include all runtime assemblies in the collection.</span></span> <span data-ttu-id="b18a5-120">En el código siguiente se muestra cómo crear la clase <xref:System.Reflection.PathAssemblyResolver> mediante la colección que consta del ensamblado inspeccionado y todos los ensamblados del entorno de ejecución actual:</span><span class="sxs-lookup"><span data-stu-id="b18a5-120">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and all assemblies of the current runtime:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#RuntimeAssemblies)]

## <a name="create-metadataloadcontext"></a><span data-ttu-id="b18a5-121">Creación de MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="b18a5-121">Create MetadataLoadContext</span></span>

<span data-ttu-id="b18a5-122">Para crear la clase <xref:System.Reflection.MetadataLoadContext>, invoque su constructor <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>, y pase la clase <xref:System.Reflection.MetadataAssemblyResolver> creada previamente como primer parámetro y el nombre del ensamblado principal como segundo parámetro.</span><span class="sxs-lookup"><span data-stu-id="b18a5-122">To create the <xref:System.Reflection.MetadataLoadContext>, invoke its constructor <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>, passing the previously created <xref:System.Reflection.MetadataAssemblyResolver> as the first parameter and the core assembly name as the second parameter.</span></span> <span data-ttu-id="b18a5-123">Puede omitir el nombre del ensamblado principal, en cuyo caso el constructor intentará usar nombres predeterminados: "mscorlib", "System.Runtime" o "netstandard".</span><span class="sxs-lookup"><span data-stu-id="b18a5-123">You can omit the core assembly name, in which case the constructor will attempt to use default names: "mscorlib", "System.Runtime", or "netstandard".</span></span>

<span data-ttu-id="b18a5-124">Después de crear el contexto, puede cargar los ensamblados en él mediante métodos como <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="b18a5-124">After you've created the context, you can load assemblies into it using methods such as <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>.</span></span> <span data-ttu-id="b18a5-125">Puede usar todas las API de reflexión en los ensamblados cargados, excepto las que tienen que ver con la ejecución de código.</span><span class="sxs-lookup"><span data-stu-id="b18a5-125">You can use all reflection APIs on loaded assemblies except ones that involve code execution.</span></span> <span data-ttu-id="b18a5-126">El método <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> supone la ejecución de constructores, así que use el método <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> en su lugar cuando necesite examinar los atributos personalizados de la clase <xref:System.Reflection.MetadataLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="b18a5-126">The <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> method does involve the execution of constructors, so use the <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> method instead when you need to examine custom attributes in the <xref:System.Reflection.MetadataLoadContext>.</span></span>

<span data-ttu-id="b18a5-127">En el siguiente ejemplo de código se crea la clase <xref:System.Reflection.MetadataLoadContext>, se carga en ella el ensamblado y se generan los atributos del ensamblado en la consola:</span><span class="sxs-lookup"><span data-stu-id="b18a5-127">The following code sample creates <xref:System.Reflection.MetadataLoadContext>, loads the assembly into it, and outputs assembly attributes into the console:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CreateContext)]

## <a name="example"></a><span data-ttu-id="b18a5-128">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="b18a5-128">Example</span></span>

<span data-ttu-id="b18a5-129">Para obtener un ejemplo de código completo, vea el [ejemplo Inspección del contenido de un ensamblado mediante MetadataLoadContext](/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span><span class="sxs-lookup"><span data-stu-id="b18a5-129">For a complete code example, see the [Inspect assembly contents using MetadataLoadContext sample](/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span></span>
