---
title: Procedimientos recomendados para implementar el modelo asincrónico basado en eventos
ms.date: 03/30/2017
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET], asynchronous
- AsyncOperationManager class
- threading [.NET], asynchronous features
- AsyncOperation class
- AsyncCompletedEventArgs class
ms.assetid: 4acd2094-4f46-4eff-9190-92d0d9ff47db
ms.openlocfilehash: 6c2df4c2877f9191bd2b8190869c359a74de8e8f
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/18/2020
ms.locfileid: "94830498"
---
# <a name="best-practices-for-implementing-the-event-based-asynchronous-pattern"></a><span data-ttu-id="b810f-102">Procedimientos recomendados para implementar el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="b810f-102">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>

<span data-ttu-id="b810f-103">El modelo asincrónico basado en eventos proporciona un método eficaz de exponer el comportamiento asincrónico en clases, con una semántica de delegados y eventos ya conocida.</span><span class="sxs-lookup"><span data-stu-id="b810f-103">The Event-based Asynchronous Pattern provides you with an effective way to expose asynchronous behavior in classes, with familiar event and delegate semantics.</span></span> <span data-ttu-id="b810f-104">Para implementar el modelo asincrónico basado en eventos, es necesario cumplir algunos requisitos de comportamiento específicos.</span><span class="sxs-lookup"><span data-stu-id="b810f-104">To implement Event-based Asynchronous Pattern, you need to follow some specific behavioral requirements.</span></span> <span data-ttu-id="b810f-105">En las secciones siguientes se describen los requisitos y las instrucciones que se deben tener en cuenta a la hora de implementar una clase que responda a este modelo.</span><span class="sxs-lookup"><span data-stu-id="b810f-105">The following sections describe requirements and guidelines you should consider when you implement a class that follows the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="b810f-106">Para información general, consulte [Implementación del patrón asincrónico basado en eventos](implementing-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="b810f-106">For an overview, see [Implementing the Event-based Asynchronous Pattern](implementing-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="required-behavioral-guarantees"></a><span data-ttu-id="b810f-107">Garantías de comportamiento necesarias</span><span class="sxs-lookup"><span data-stu-id="b810f-107">Required Behavioral Guarantees</span></span>

 <span data-ttu-id="b810f-108">Si implementa el modelo asincrónico basado en eventos, debe ofrecer una serie de garantías que aseguren un comportamiento apropiado de su clase en el que puedan confiar sus clientes.</span><span class="sxs-lookup"><span data-stu-id="b810f-108">If you implement the Event-based Asynchronous Pattern, you must provide a number of guarantees to ensure that your class will behave properly and clients of your class can rely on such behavior.</span></span>  
  
### <a name="completion"></a><span data-ttu-id="b810f-109">Finalización</span><span class="sxs-lookup"><span data-stu-id="b810f-109">Completion</span></span>

 <span data-ttu-id="b810f-110">Invoque siempre al controlador de eventos <em>NombreDeMétodo</em>**Completed** cuando se produzca un error, una cancelación o una finalización correcta.</span><span class="sxs-lookup"><span data-stu-id="b810f-110">Always invoke the <em>MethodName</em>**Completed** event handler when you have successful completion, an error, or a cancellation.</span></span> <span data-ttu-id="b810f-111">Las aplicaciones jamás deben encontrarse en una situación en la que permanezcan inactivas sin que se produzca una finalización.</span><span class="sxs-lookup"><span data-stu-id="b810f-111">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span> <span data-ttu-id="b810f-112">Una excepción a esta regla es que la misma operación asincrónica esté diseñada para no finalizar nunca.</span><span class="sxs-lookup"><span data-stu-id="b810f-112">One exception to this rule is if the asynchronous operation itself is designed so that it never completes.</span></span>  
  
### <a name="completed-event-and-eventargs"></a><span data-ttu-id="b810f-113">Evento Completed y EventArgs</span><span class="sxs-lookup"><span data-stu-id="b810f-113">Completed Event and EventArgs</span></span>

<span data-ttu-id="b810f-114">En cada método <em>NombreDeMétodo</em>**Async**, aplique los requisitos de diseño siguientes:</span><span class="sxs-lookup"><span data-stu-id="b810f-114">For each separate <em>MethodName</em>**Async** method, apply the following design requirements:</span></span>  
  
- <span data-ttu-id="b810f-115">Defina un evento <em>NombreDeMétodo</em>**Completed** en la misma clase que el método.</span><span class="sxs-lookup"><span data-stu-id="b810f-115">Define a <em>MethodName</em>**Completed** event on the same class as the method.</span></span>  
  
- <span data-ttu-id="b810f-116">Defina una clase <xref:System.EventArgs> y un delegado adjunto para el evento <em>NombreDeMétodo</em>**Completed** que deriva de la clase <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="b810f-116">Define an <xref:System.EventArgs> class and accompanying delegate for the <em>MethodName</em>**Completed** event that derives from the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span> <span data-ttu-id="b810f-117">El nombre de clase predeterminado debe presentar el formato <em>MethodName</em>**CompletedEventArgs**.</span><span class="sxs-lookup"><span data-stu-id="b810f-117">The default class name should be of the form <em>MethodName</em>**CompletedEventArgs**.</span></span>  
  
- <span data-ttu-id="b810f-118">Asegúrese de que la clase <xref:System.EventArgs> sea específica de los valores devueltos del método <em>MethodName</em>.</span><span class="sxs-lookup"><span data-stu-id="b810f-118">Ensure that the <xref:System.EventArgs> class is specific to the return values of the <em>MethodName</em> method.</span></span> <span data-ttu-id="b810f-119">Cuando use la clase <xref:System.EventArgs>, nunca les pida a los desarrolladores que conviertan el resultado.</span><span class="sxs-lookup"><span data-stu-id="b810f-119">When you use the <xref:System.EventArgs> class, you should never require developers to cast the result.</span></span>  
  
     <span data-ttu-id="b810f-120">En el ejemplo de código siguiente se muestra una implementación correcta e incorrecta, respectivamente, de este requisito de diseño.</span><span class="sxs-lookup"><span data-stu-id="b810f-120">The following code example shows good and bad implementation of this design requirement respectively.</span></span>  
  
```csharp  
// Good design  
private void Form1_MethodNameCompleted(object sender, xxxCompletedEventArgs e)
{
    DemoType result = e.Result;  
}  
  
// Bad design  
private void Form1_MethodNameCompleted(object sender, MethodNameCompletedEventArgs e)
{
    DemoType result = (DemoType)(e.Result);  
}  
```  
  
- <span data-ttu-id="b810f-121">No defina una clase <xref:System.EventArgs> para métodos que devuelvan `void`.</span><span class="sxs-lookup"><span data-stu-id="b810f-121">Do not define an <xref:System.EventArgs> class for returning methods that return `void`.</span></span> <span data-ttu-id="b810f-122">En su lugar, use una instancia de la clase <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="b810f-122">Instead, use an instance of the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span>  
  
- <span data-ttu-id="b810f-123">Asegúrese de que siempre genera el evento <em>MethodName</em>**Completed**.</span><span class="sxs-lookup"><span data-stu-id="b810f-123">Ensure that you always raise the <em>MethodName</em>**Completed** event.</span></span> <span data-ttu-id="b810f-124">Este evento debe generarse cuando se produce una finalización correcta, un error o una cancelación.</span><span class="sxs-lookup"><span data-stu-id="b810f-124">This event should be raised on successful completion, on an error, or on cancellation.</span></span> <span data-ttu-id="b810f-125">Las aplicaciones jamás deben encontrarse en una situación en la que permanezcan inactivas sin que se produzca una finalización.</span><span class="sxs-lookup"><span data-stu-id="b810f-125">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span>  
  
- <span data-ttu-id="b810f-126">Asegúrese de que captura todas las excepciones que se producen en la operación asincrónica y de que asigna la excepción capturada a la propiedad <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="b810f-126">Ensure that you catch any exceptions that occur in the asynchronous operation and assign the caught exception to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="b810f-127">Si se produjo un error al finalizar la tarea, los resultados no deben ser accesibles.</span><span class="sxs-lookup"><span data-stu-id="b810f-127">If there was an error completing the task, the results should not be accessible.</span></span> <span data-ttu-id="b810f-128">Si la propiedad <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> no es `null`, asegúrese de que el acceso a cualquier propiedad de la estructura <xref:System.EventArgs> genera una excepción.</span><span class="sxs-lookup"><span data-stu-id="b810f-128">When the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property is not `null`, ensure that accessing any property in the <xref:System.EventArgs> structure raises an exception.</span></span> <span data-ttu-id="b810f-129">Use el método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> para realizar esta verificación.</span><span class="sxs-lookup"><span data-stu-id="b810f-129">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method to perform this verification.</span></span>  
  
- <span data-ttu-id="b810f-130">Cree un modelo de error para los agotamientos del tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="b810f-130">Model a time out as an error.</span></span> <span data-ttu-id="b810f-131">Cuando se agote el tiempo de espera, genere el evento <em>MethodName</em>**Completed** y asigne <xref:System.TimeoutException> a la propiedad <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="b810f-131">When a time out occurs, raise the <em>MethodName</em>**Completed** event and assign a <xref:System.TimeoutException> to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="b810f-132">Si su clase admite varias invocaciones simultáneas, asegúrese de que el evento <em>MethodName</em>**Completed** contiene el objeto `userSuppliedState` apropiado.</span><span class="sxs-lookup"><span data-stu-id="b810f-132">If your class supports multiple concurrent invocations, ensure that the <em>MethodName</em>**Completed** event contains the appropriate `userSuppliedState` object.</span></span>  
  
- <span data-ttu-id="b810f-133">Asegúrese de que el evento <em>MethodName</em>**Completed** se genera en el subproceso apropiado y en el momento adecuado del ciclo de vida de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b810f-133">Ensure that the <em>MethodName</em>**Completed** event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="b810f-134">Para obtener más información, vea la sección Subprocesos y contextos.</span><span class="sxs-lookup"><span data-stu-id="b810f-134">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="simultaneously-executing-operations"></a><span data-ttu-id="b810f-135">Ejecución simultánea de operaciones</span><span class="sxs-lookup"><span data-stu-id="b810f-135">Simultaneously Executing Operations</span></span>  
  
- <span data-ttu-id="b810f-136">Si su clase admite varias invocaciones simultáneas, habilite al desarrollador para que realice un seguimiento por separado de cada invocación; para ello, defina la sobrecarga <em>MethodName</em>**Async** que toma un parámetro de estado con valor de objeto o identificador de tarea, denominado `userSuppliedState`.</span><span class="sxs-lookup"><span data-stu-id="b810f-136">If your class supports multiple concurrent invocations, enable the developer to track each invocation separately by defining the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, called `userSuppliedState`.</span></span> <span data-ttu-id="b810f-137">Este parámetro siempre debe ser el último de la signatura del método <em>MethodName</em>**Async**.</span><span class="sxs-lookup"><span data-stu-id="b810f-137">This parameter should always be the last parameter in the <em>MethodName</em>**Async** method's signature.</span></span>  
  
- <span data-ttu-id="b810f-138">Si su clase define la sobrecarga <em>MethodName</em>**Async** que toma un parámetro de estado con valor de objeto o identificador de tarea, asegúrese de realizar un seguimiento de la duración de la operación con ese identificador de tarea y de devolverlo al controlador de finalización.</span><span class="sxs-lookup"><span data-stu-id="b810f-138">If your class defines the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, be sure to track the lifetime of the operation with that task ID, and be sure to provide it back into the completion handler.</span></span> <span data-ttu-id="b810f-139">Hay clases del asistente que le servirán de ayuda.</span><span class="sxs-lookup"><span data-stu-id="b810f-139">There are helper classes available to assist.</span></span> <span data-ttu-id="b810f-140">Para más información sobre la administración de simultaneidad, vea [Tutorial: Implementación de un componente que admita el modelo asincrónico basado en eventos](component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="b810f-140">For more information on concurrency management, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
- <span data-ttu-id="b810f-141">Si su clase define el método <em>MethodName</em>**Async** sin el parámetro de estado y no admite varias invocaciones simultáneas, asegúrese de que cualquier intento de invocar <em>MethodName</em>**Async** antes de que la invocación previa a <em>MethodName</em>**Async** se haya completado genere <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="b810f-141">If your class defines the <em>MethodName</em>**Async** method without the state parameter, and it does not support multiple concurrent invocations, ensure that any attempt to invoke <em>MethodName</em>**Async** before the prior <em>MethodName</em>**Async** invocation has completed raises an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="b810f-142">Por lo general, no genere una excepción si se invoca varias veces al método <em>MethodName</em>**Async** sin el parámetro `userSuppliedState` de modo que haya varias operaciones pendientes.</span><span class="sxs-lookup"><span data-stu-id="b810f-142">In general, do not raise an exception if the <em>MethodName</em>**Async** method without the `userSuppliedState` parameter is invoked multiple times so that there are multiple outstanding operations.</span></span> <span data-ttu-id="b810f-143">Puede generar una excepción si la clase no puede controlar esa situación de forma explícita, pero piense que los desarrolladores pueden gestionar varias devoluciones de llamadas indistinguibles.</span><span class="sxs-lookup"><span data-stu-id="b810f-143">You can raise an exception when your class explicitly cannot handle that situation, but assume that developers can handle these multiple indistinguishable callbacks</span></span>  
  
### <a name="accessing-results"></a><span data-ttu-id="b810f-144">Acceso a resultados</span><span class="sxs-lookup"><span data-stu-id="b810f-144">Accessing Results</span></span>  
  
- <span data-ttu-id="b810f-145">Si se produjo un error durante la ejecución de la operación asincrónica, los resultados no pueden ser accesibles.</span><span class="sxs-lookup"><span data-stu-id="b810f-145">If there was an error during execution of the asynchronous operation, the results should not be accessible.</span></span> <span data-ttu-id="b810f-146">Asegúrese de que el acceso a cualquier propiedad de <xref:System.ComponentModel.AsyncCompletedEventArgs> cuando <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> no es `null` genera la excepción a la que hace referencia <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="b810f-146">Ensure that accessing any property in the <xref:System.ComponentModel.AsyncCompletedEventArgs> when <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> is not `null` raises the exception referenced by <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span></span> <span data-ttu-id="b810f-147">La clase <xref:System.ComponentModel.AsyncCompletedEventArgs> proporciona el método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> para este fin.</span><span class="sxs-lookup"><span data-stu-id="b810f-147">The <xref:System.ComponentModel.AsyncCompletedEventArgs> class provides the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method for this purpose.</span></span>  
  
- <span data-ttu-id="b810f-148">Asegúrese de que cualquier intento de acceder al resultado genere una <xref:System.InvalidOperationException> en la que se declare que la operación se canceló.</span><span class="sxs-lookup"><span data-stu-id="b810f-148">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="b810f-149">Use el método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> para realizar esta verificación.</span><span class="sxs-lookup"><span data-stu-id="b810f-149">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
### <a name="progress-reporting"></a><span data-ttu-id="b810f-150">Informe de progreso</span><span class="sxs-lookup"><span data-stu-id="b810f-150">Progress Reporting</span></span>  
  
- <span data-ttu-id="b810f-151">Si es posible, admita informes de progreso.</span><span class="sxs-lookup"><span data-stu-id="b810f-151">Support progress reporting, if possible.</span></span> <span data-ttu-id="b810f-152">Esto permite a los desarrolladores ofrecer una mejor experiencia a los usuarios de la aplicación cuando utilicen su clase.</span><span class="sxs-lookup"><span data-stu-id="b810f-152">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="b810f-153">Si implementa un evento **ProgressChanged** o <em>MethodName</em>**ProgressChanged**, asegúrese de que no se han generado esos eventos para una operación asincrónica concreta después de que se haya generado el evento <em>MethodName</em>**Completed** de esa operación.</span><span class="sxs-lookup"><span data-stu-id="b810f-153">If you implement a **ProgressChanged** or <em>MethodName</em>**ProgressChanged** event, ensure that there are no such events raised for a particular asynchronous operation after that operation's <em>MethodName</em>**Completed** event has been raised.</span></span>  
  
- <span data-ttu-id="b810f-154">Si se rellena la clase <xref:System.ComponentModel.ProgressChangedEventArgs> estándar, asegúrese de que <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> siempre se pueda interpretar como un porcentaje.</span><span class="sxs-lookup"><span data-stu-id="b810f-154">If the standard <xref:System.ComponentModel.ProgressChangedEventArgs> is being populated, ensure that the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> can always be interpreted as a percentage.</span></span> <span data-ttu-id="b810f-155">No es necesario que el porcentaje sea exacto, pero debe representarse uno.</span><span class="sxs-lookup"><span data-stu-id="b810f-155">The percentage does not need to be accurate, but it should represent a percentage.</span></span> <span data-ttu-id="b810f-156">Si su métrica de informes de progreso debe ser distinta a un porcentaje, derive una clase a partir de la clase <xref:System.ComponentModel.ProgressChangedEventArgs> y deje <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> en 0.</span><span class="sxs-lookup"><span data-stu-id="b810f-156">If your progress reporting metric must be something other than a percentage, derive a class from the <xref:System.ComponentModel.ProgressChangedEventArgs> class and leave <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> at 0.</span></span> <span data-ttu-id="b810f-157">Evite usar una métrica de informes que no sea un porcentaje.</span><span class="sxs-lookup"><span data-stu-id="b810f-157">Avoid using a reporting metric other than a percentage.</span></span>  
  
- <span data-ttu-id="b810f-158">Asegúrese de que el evento `ProgressChanged` se genera en el subproceso apropiado y en el momento adecuado del ciclo de vida de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b810f-158">Ensure that the `ProgressChanged` event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="b810f-159">Para obtener más información, vea la sección Subprocesos y contextos.</span><span class="sxs-lookup"><span data-stu-id="b810f-159">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="isbusy-implementation"></a><span data-ttu-id="b810f-160">Implementación de IsBusy</span><span class="sxs-lookup"><span data-stu-id="b810f-160">IsBusy Implementation</span></span>  
  
- <span data-ttu-id="b810f-161">No exponga una propiedad `IsBusy` si su clase admite varias invocaciones simultáneas.</span><span class="sxs-lookup"><span data-stu-id="b810f-161">Do not expose an `IsBusy` property if your class supports multiple concurrent invocations.</span></span> <span data-ttu-id="b810f-162">Por ejemplo, los proxy del servicio XML Web no exponen una propiedad `IsBusy` porque admiten varias invocaciones simultáneas de métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="b810f-162">For example, XML Web service proxies do not expose an `IsBusy` property because they support multiple concurrent invocations of asynchronous methods.</span></span>  
  
- <span data-ttu-id="b810f-163">La propiedad `IsBusy` debe devolver `true` después de que se haya llamado al método <em>MethodName</em>**Async** y antes de que se haya generado el evento <em>MethodName</em>**Completed**.</span><span class="sxs-lookup"><span data-stu-id="b810f-163">The `IsBusy` property should return `true` after the <em>MethodName</em>**Async** method has been called and before the <em>MethodName</em>**Completed** event has been raised.</span></span> <span data-ttu-id="b810f-164">De lo contrario, debe devolver `false`.</span><span class="sxs-lookup"><span data-stu-id="b810f-164">Otherwise it should return `false`.</span></span> <span data-ttu-id="b810f-165">Los componentes <xref:System.ComponentModel.BackgroundWorker> y <xref:System.Net.WebClient> son ejemplos de clases que exponen una propiedad `IsBusy`.</span><span class="sxs-lookup"><span data-stu-id="b810f-165">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.Net.WebClient> components are examples of classes that expose an `IsBusy` property.</span></span>  
  
### <a name="cancellation"></a><span data-ttu-id="b810f-166">Cancelación</span><span class="sxs-lookup"><span data-stu-id="b810f-166">Cancellation</span></span>  
  
- <span data-ttu-id="b810f-167">Si es posible, admita cancelación.</span><span class="sxs-lookup"><span data-stu-id="b810f-167">Support cancellation, if possible.</span></span> <span data-ttu-id="b810f-168">Esto permite a los desarrolladores ofrecer una mejor experiencia a los usuarios de la aplicación cuando utilicen su clase.</span><span class="sxs-lookup"><span data-stu-id="b810f-168">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="b810f-169">En caso de cancelación, establezca la marca <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> en el objeto <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="b810f-169">In the case of cancellation, set the <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> flag in the <xref:System.ComponentModel.AsyncCompletedEventArgs> object.</span></span>  
  
- <span data-ttu-id="b810f-170">Asegúrese de que cualquier intento de acceder al resultado genere una <xref:System.InvalidOperationException> en la que se declare que la operación se canceló.</span><span class="sxs-lookup"><span data-stu-id="b810f-170">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="b810f-171">Use el método <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> para realizar esta verificación.</span><span class="sxs-lookup"><span data-stu-id="b810f-171">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
- <span data-ttu-id="b810f-172">Asegúrese de que las llamadas a un método de cancelación siempre se devuelvan correctamente y nunca generen una excepción.</span><span class="sxs-lookup"><span data-stu-id="b810f-172">Ensure that calls to a cancellation method always return successfully, and never raise an exception.</span></span> <span data-ttu-id="b810f-173">Por lo general, los clientes no son informados de si una operación es realmente cancelable en un momento determinado, ni tampoco de si una cancelación emitida previamente se ha realizado de forma correcta.</span><span class="sxs-lookup"><span data-stu-id="b810f-173">In general, a client is not notified as to whether an operation is truly cancelable at any given time, and is not notified as to whether a previously issued cancellation has succeeded.</span></span> <span data-ttu-id="b810f-174">No obstante, la aplicación siempre recibirá notificación cuando la cancelación tenga éxito, ya que la aplicación participa en el estado de finalización.</span><span class="sxs-lookup"><span data-stu-id="b810f-174">However, the application will always be given notification when a cancellation succeeded, because the application takes part in the completion status.</span></span>  
  
- <span data-ttu-id="b810f-175">Genere el evento <em>MethodName</em>**Completed** cuando la operación se cancele.</span><span class="sxs-lookup"><span data-stu-id="b810f-175">Raise the <em>MethodName</em>**Completed** event when the operation is canceled.</span></span>  
  
### <a name="errors-and-exceptions"></a><span data-ttu-id="b810f-176">Errores y excepciones</span><span class="sxs-lookup"><span data-stu-id="b810f-176">Errors and Exceptions</span></span>  
  
- <span data-ttu-id="b810f-177">Capture todas las excepciones que se produzcan en la operación asincrónica y establezca el valor de la propiedad <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> en esa excepción.</span><span class="sxs-lookup"><span data-stu-id="b810f-177">Catch any exceptions that occur in the asynchronous operation and set the value of the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> property to that exception.</span></span>  
  
### <a name="threading-and-contexts"></a><span data-ttu-id="b810f-178">Subprocesos y contextos</span><span class="sxs-lookup"><span data-stu-id="b810f-178">Threading and Contexts</span></span>

 <span data-ttu-id="b810f-179">Para que la clase funcione correctamente, es vital que los controladores de eventos del cliente se invoquen en el subproceso o contexto apropiados para el modelo de aplicación concreto, incluidas aplicaciones de ASP.NET y de Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="b810f-179">For correct operation of your class, it is critical that the client's event handlers are invoked on the proper thread or context for the given application model, including ASP.NET and Windows Forms applications.</span></span> <span data-ttu-id="b810f-180">Para garantizar que su clase asincrónica se comporta correctamente en cualquier modelo de aplicación, se proporcionan dos importantes clases del asistente: <xref:System.ComponentModel.AsyncOperation> y <xref:System.ComponentModel.AsyncOperationManager>.</span><span class="sxs-lookup"><span data-stu-id="b810f-180">Two important helper classes are provided to ensure that your asynchronous class behaves correctly under any application model: <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager>.</span></span>  
  
 <span data-ttu-id="b810f-181"><xref:System.ComponentModel.AsyncOperationManager> proporciona un método, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, que devuelve una <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="b810f-181"><xref:System.ComponentModel.AsyncOperationManager> provides one method, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, which returns an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="b810f-182">El método <em>MethodName</em>**Async** llama a <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> y su clase usa la clase <xref:System.ComponentModel.AsyncOperation> devuelta para realizar un seguimiento de la duración de la tarea asincrónica.</span><span class="sxs-lookup"><span data-stu-id="b810f-182">Your <em>MethodName</em>**Async** method calls <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> and your class uses the returned <xref:System.ComponentModel.AsyncOperation> to track the lifetime of the asynchronous task.</span></span>  
  
 <span data-ttu-id="b810f-183">Para informar al cliente del progreso, los resultados incrementales y la finalización, llame a los métodos <xref:System.ComponentModel.AsyncOperation.Post%2A> y <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> en <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="b810f-183">To report progress, incremental results, and completion to the client, call the <xref:System.ComponentModel.AsyncOperation.Post%2A> and <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> methods on the <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="b810f-184"><xref:System.ComponentModel.AsyncOperation> es responsable de calcular las referencias de llamadas a los controladores de eventos del cliente para el subproceso o contexto apropiado.</span><span class="sxs-lookup"><span data-stu-id="b810f-184"><xref:System.ComponentModel.AsyncOperation> is responsible for marshaling calls to the client's event handlers to the proper thread or context.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b810f-185">Puede sortear estas reglas si desea contravenir la directiva del modelo de aplicación, pero al mismo tiempo seguir beneficiándose de las otras ventajas de usar el modelo asincrónico basado en eventos.</span><span class="sxs-lookup"><span data-stu-id="b810f-185">You can circumvent these rules if you explicitly want to go against the policy of the application model, but still benefit from the other advantages of using the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="b810f-186">Por ejemplo, es posible que desee que una clase que opera en Windows Forms sea de subproceso libre.</span><span class="sxs-lookup"><span data-stu-id="b810f-186">For example, you may want a class operating in Windows Forms to be free threaded.</span></span> <span data-ttu-id="b810f-187">Puede crear una clase de subproceso libre si los desarrolladores entienden las restricciones implícitas.</span><span class="sxs-lookup"><span data-stu-id="b810f-187">You can create a free threaded class, as long as developers understand the implied restrictions.</span></span> <span data-ttu-id="b810f-188">Las aplicaciones de consola no sincronizan la ejecución de llamadas <xref:System.ComponentModel.AsyncOperation.Post%2A>.</span><span class="sxs-lookup"><span data-stu-id="b810f-188">Console applications do not synchronize the execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls.</span></span> <span data-ttu-id="b810f-189">Esto puede provocar que se generen eventos `ProgressChanged` fuera de lugar.</span><span class="sxs-lookup"><span data-stu-id="b810f-189">This can cause `ProgressChanged` events to be raised out of order.</span></span> <span data-ttu-id="b810f-190">Si desea serializar la ejecución de llamadas <xref:System.ComponentModel.AsyncOperation.Post%2A>, implemente e instale una clase <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b810f-190">If you wish to have serialized execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls, implement and install a <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType> class.</span></span>  
  
 <span data-ttu-id="b810f-191">Para más información sobre el uso de <xref:System.ComponentModel.AsyncOperation> y <xref:System.ComponentModel.AsyncOperationManager> para habilitar las operaciones asincrónicas, vea [Tutorial: Implementación de un componente que admita el modelo asincrónico basado en eventos](component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="b810f-191">For more information about using <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager> to enable your asynchronous operations, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="guidelines"></a><span data-ttu-id="b810f-192">Instrucciones</span><span class="sxs-lookup"><span data-stu-id="b810f-192">Guidelines</span></span>  
  
- <span data-ttu-id="b810f-193">Lo ideal es que las invocaciones de métodos sean independiente entre sí.</span><span class="sxs-lookup"><span data-stu-id="b810f-193">Ideally, each method invocation should be independent of others.</span></span> <span data-ttu-id="b810f-194">Debe evitarse el acoplamiento de invocaciones con recursos compartidos.</span><span class="sxs-lookup"><span data-stu-id="b810f-194">You should avoid coupling invocations with shared resources.</span></span> <span data-ttu-id="b810f-195">Si los recursos se van a compartir entre invocaciones, es necesario proporcionar un mecanismo de sincronización adecuado en la implementación.</span><span class="sxs-lookup"><span data-stu-id="b810f-195">If resources are to be shared among invocations, you will need to provide a proper synchronization mechanism in your implementation.</span></span>  
  
- <span data-ttu-id="b810f-196">No se recomienda usar diseños que exijan al cliente implementar sincronización.</span><span class="sxs-lookup"><span data-stu-id="b810f-196">Designs that require the client to implement synchronization are discouraged.</span></span> <span data-ttu-id="b810f-197">Por ejemplo, si tiene un método asincrónico que recibe un objeto estático global como parámetro y se producen varias invocaciones simultáneas de ese método, se podrían dañar los datos o producir interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="b810f-197">For example, you could have an asynchronous method that receives a global static object as a parameter; multiple concurrent invocations of such a method could result in data corruption or deadlocks.</span></span>  
  
- <span data-ttu-id="b810f-198">Si implementa un método con la sobrecarga de varias invocaciones (`userState` en la signatura), su clase necesitará administrar una colección de estados de usuario o identificadores de tarea, así como sus correspondientes operaciones pendientes.</span><span class="sxs-lookup"><span data-stu-id="b810f-198">If you implement a method with the multiple-invocation overload (`userState` in the signature), your class will need to manage a collection of user states, or task IDs, and their corresponding pending operations.</span></span> <span data-ttu-id="b810f-199">Esta colección debe protegerse con regiones `lock`, ya que las diversas invocaciones agregan y quitan objetos `userState` de la colección.</span><span class="sxs-lookup"><span data-stu-id="b810f-199">This collection should be protected with `lock` regions, because the various invocations add and remove `userState` objects in the collection.</span></span>  
  
- <span data-ttu-id="b810f-200">Considere la opción de volver a usar clases `CompletedEventArgs` donde sea posible y apropiado.</span><span class="sxs-lookup"><span data-stu-id="b810f-200">Consider reusing `CompletedEventArgs` classes where feasible and appropriate.</span></span> <span data-ttu-id="b810f-201">En este caso, la nomenclatura no es coherente con el nombre de método, ya que un delegado dado y el tipo <xref:System.EventArgs> no están asociados a un único método.</span><span class="sxs-lookup"><span data-stu-id="b810f-201">In this case, the naming is not consistent with the method name, because a given delegate and <xref:System.EventArgs> type are not tied to a single method.</span></span> <span data-ttu-id="b810f-202">Sin embargo, jamás se puede forzar a los desarrolladores a que conviertan el valor recuperado de una propiedad en la clase <xref:System.EventArgs>.</span><span class="sxs-lookup"><span data-stu-id="b810f-202">However, forcing developers to cast the value retrieved from a property on the <xref:System.EventArgs> is never acceptable.</span></span>  
  
- <span data-ttu-id="b810f-203">Si va a crear una clase que deriva de <xref:System.ComponentModel.Component>, no implemente ni instale su propia clase <xref:System.Threading.SynchronizationContext>.</span><span class="sxs-lookup"><span data-stu-id="b810f-203">If you are authoring a class that derives from <xref:System.ComponentModel.Component>, do not implement and install your own <xref:System.Threading.SynchronizationContext> class.</span></span> <span data-ttu-id="b810f-204">Los modelos de aplicación, y no los componentes, controlan el <xref:System.Threading.SynchronizationContext> utilizado.</span><span class="sxs-lookup"><span data-stu-id="b810f-204">Application models, not components, control the <xref:System.Threading.SynchronizationContext> that is used.</span></span>  
  
- <span data-ttu-id="b810f-205">Si usa multithreading de cualquier tipo, corre el riesgo de que se produzcan errores graves y complejos.</span><span class="sxs-lookup"><span data-stu-id="b810f-205">When you use multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="b810f-206">Antes de implementar cualquier solución que utilice el subprocesamiento múltiple, consulte [Procedimientos recomendados para el subprocesamiento administrado](../threading/managed-threading-best-practices.md).</span><span class="sxs-lookup"><span data-stu-id="b810f-206">Before implementing any solution that uses multithreading, see [Managed Threading Best Practices](../threading/managed-threading-best-practices.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b810f-207">Vea también</span><span class="sxs-lookup"><span data-stu-id="b810f-207">See also</span></span>

- <xref:System.ComponentModel.AsyncOperation>
- <xref:System.ComponentModel.AsyncOperationManager>
- <xref:System.ComponentModel.AsyncCompletedEventArgs>
- <xref:System.ComponentModel.ProgressChangedEventArgs>
- <xref:System.ComponentModel.BackgroundWorker>
- [<span data-ttu-id="b810f-208">Implementación del modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="b810f-208">Implementing the Event-based Asynchronous Pattern</span></span>](implementing-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="b810f-209">Modelo asincrónico basado en eventos (EAP)</span><span class="sxs-lookup"><span data-stu-id="b810f-209">Event-based Asynchronous Pattern (EAP)</span></span>](event-based-asynchronous-pattern-eap.md)
- [<span data-ttu-id="b810f-210">Decisión de cuándo implementar el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="b810f-210">Deciding When to Implement the Event-based Asynchronous Pattern</span></span>](deciding-when-to-implement-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="b810f-211">Procedimientos recomendados para implementar el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="b810f-211">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>](best-practices-for-implementing-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="b810f-212">Uso de componentes que admitan el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="b810f-212">How to: Use Components That Support the Event-based Asynchronous Pattern</span></span>](how-to-use-components-that-support-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="b810f-213">Implementar un componente que admita el modelo asincrónico basado en eventos</span><span class="sxs-lookup"><span data-stu-id="b810f-213">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](component-that-supports-the-event-based-asynchronous-pattern.md)
