---
title: Selección y validación de certificados
description: Obtenga información sobre las distintas formas ofrecidas por las clases System.Net para seleccionar y validar certificados de conexión SSL/TLS.
ms.date: 03/30/2017
ms.assetid: c933aca2-4cd0-4ff1-9df9-267143f25a6f
ms.openlocfilehash: a85b6947c20f7dbced1fb6ad6e79f3134ce1f57b
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96287519"
---
# <a name="certificate-selection-and-validation"></a><span data-ttu-id="c747c-103">Selección y validación de certificados</span><span class="sxs-lookup"><span data-stu-id="c747c-103">Certificate Selection and Validation</span></span>

<span data-ttu-id="c747c-104">Las clases <xref:System.Net> admiten varios métodos para seleccionar y validar <xref:System.Security.Cryptography.X509Certificates> para conexiones de Capa de sockets seguros (SSL).</span><span class="sxs-lookup"><span data-stu-id="c747c-104">The <xref:System.Net> classes support several ways to select and validate <xref:System.Security.Cryptography.X509Certificates> for Secure Socket Layer (SSL) connections.</span></span> <span data-ttu-id="c747c-105">Un cliente puede seleccionar uno o varios certificados para autenticarse en un servidor.</span><span class="sxs-lookup"><span data-stu-id="c747c-105">A client can select one or more certificates to authenticate itself to a server.</span></span> <span data-ttu-id="c747c-106">Un servidor puede requerir que un certificado de cliente tenga uno o más atributos específicos para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="c747c-106">A server can require that a client certificate have one or more specific attributes for authentication.</span></span>  
  
## <a name="definition"></a><span data-ttu-id="c747c-107">Definición</span><span class="sxs-lookup"><span data-stu-id="c747c-107">Definition</span></span>  

 <span data-ttu-id="c747c-108">Un certificado es un flujo de bytes ASCII que contiene una clave pública, atributos (por ejemplo, el número de versión, el número de serie y la fecha de expiración) y una firma digital de una entidad de certificación.</span><span class="sxs-lookup"><span data-stu-id="c747c-108">A certificate is an ASCII byte stream that contains a public key, attributes (such as version number, serial number, and expiration date) and a digital signature from a Certificate Authority.</span></span> <span data-ttu-id="c747c-109">Los certificados se usan para establecer una conexión cifrada o para autenticar un cliente en un servidor.</span><span class="sxs-lookup"><span data-stu-id="c747c-109">Certificates are used to establish an encrypted connection or to authenticate a client to a server.</span></span>  
  
## <a name="client-certificate-selection-and-validation"></a><span data-ttu-id="c747c-110">Selección y validación de certificados de cliente</span><span class="sxs-lookup"><span data-stu-id="c747c-110">Client Certificate Selection and Validation</span></span>  

 <span data-ttu-id="c747c-111">Un cliente puede seleccionar uno o varios certificados para una conexión SSL concreta.</span><span class="sxs-lookup"><span data-stu-id="c747c-111">A client can select one or more certificates for a specific SSL connection.</span></span> <span data-ttu-id="c747c-112">Los certificados de cliente se pueden asociar con la conexión SSL a un servidor web o un servidor de correo SMTP.</span><span class="sxs-lookup"><span data-stu-id="c747c-112">Client certificates can be associated with the SSL connection to a web server or an SMTP mail server.</span></span> <span data-ttu-id="c747c-113">Un cliente agrega certificados a una colección de objetos de la clase <xref:System.Security.Cryptography.X509Certificates.X509Certificate> o <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span><span class="sxs-lookup"><span data-stu-id="c747c-113">A client adds certificates to a collection of <xref:System.Security.Cryptography.X509Certificates.X509Certificate> or <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class objects.</span></span> <span data-ttu-id="c747c-114">Si se usa el correo electrónico como ejemplo, la colección de certificados es una instancia de un elemento <xref:System.Security.Cryptography.X509Certificates.X509CertificateCollection>) asociado a la propiedad <xref:System.Net.Mail.SmtpClient.ClientCertificates%2A> de la clase <xref:System.Net.Mail.SmtpClient>.</span><span class="sxs-lookup"><span data-stu-id="c747c-114">Using email as an example, the certificate collection is an instance of a <xref:System.Security.Cryptography.X509Certificates.X509CertificateCollection>) associated with the <xref:System.Net.Mail.SmtpClient.ClientCertificates%2A> property of the <xref:System.Net.Mail.SmtpClient> class.</span></span> <span data-ttu-id="c747c-115">La clase <xref:System.Net.HttpWebRequest> tiene una propiedad <xref:System.Net.HttpWebRequest.ClientCertificates%2A> similar.</span><span class="sxs-lookup"><span data-stu-id="c747c-115">The <xref:System.Net.HttpWebRequest> class has a similar <xref:System.Net.HttpWebRequest.ClientCertificates%2A> property.</span></span>  
  
 <span data-ttu-id="c747c-116">La diferencia principal entre la clase <xref:System.Security.Cryptography.X509Certificates.X509Certificate> y <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> es que la clave privada debe residir en el almacén de certificados de la clase <xref:System.Security.Cryptography.X509Certificates.X509Certificate>.</span><span class="sxs-lookup"><span data-stu-id="c747c-116">The primary difference between the <xref:System.Security.Cryptography.X509Certificates.X509Certificate> and the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class is that the private key must reside in the certificate store for the <xref:System.Security.Cryptography.X509Certificates.X509Certificate> class.</span></span>  
  
 <span data-ttu-id="c747c-117">Aunque se agreguen certificados a una colección y se asocien a una conexión SSL concreta, no se enviará ningún certificado al servidor a menos que este lo solicite.</span><span class="sxs-lookup"><span data-stu-id="c747c-117">Even if certificates are added to a collection and associated with a specific SSL connection, no certificates will be sent to the server unless the server requests them.</span></span> <span data-ttu-id="c747c-118">Si se establecen varios certificados de cliente en una conexión, se usará el mejor según un algoritmo que considera la coincidencia entre la lista de emisores de certificados proporcionados por el servidor y el nombre del emisor del certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="c747c-118">If multiple client certificates are set on a connection, the best one will be used based on an algorithm that considers the match between the list of certificate issuers provided by the server and the client certificate issuer name.</span></span>  
  
 <span data-ttu-id="c747c-119">La clase <xref:System.Net.Security.SslStream> proporciona aún más control sobre el protocolo de enlace SSL.</span><span class="sxs-lookup"><span data-stu-id="c747c-119">The <xref:System.Net.Security.SslStream> class provides even more control over the SSL handshake.</span></span> <span data-ttu-id="c747c-120">Un cliente puede especificar un delegado para elegir qué certificado de cliente va a usar.</span><span class="sxs-lookup"><span data-stu-id="c747c-120">A client can specify a delegate to pick which client certificate to use.</span></span>  
  
 <span data-ttu-id="c747c-121">Un servidor remoto puede comprobar que un certificado de cliente es válido, actual y está firmado por la entidad de certificación adecuada.</span><span class="sxs-lookup"><span data-stu-id="c747c-121">A remote server can verify that a client certificate is valid, current, and signed by the appropriate Certificate Authority.</span></span> <span data-ttu-id="c747c-122">Se puede agregar un delegado a <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback%2A> para exigir la validación del certificado.</span><span class="sxs-lookup"><span data-stu-id="c747c-122">A delegate can be added to the <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback%2A> to enforce certificate validation.</span></span>  
  
## <a name="client-certificate-selection"></a><span data-ttu-id="c747c-123">Selección de certificado de cliente</span><span class="sxs-lookup"><span data-stu-id="c747c-123">Client Certificate Selection</span></span>  

 <span data-ttu-id="c747c-124">.NET Framework selecciona el certificado de cliente que va a presentar al servidor de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="c747c-124">The .NET Framework selects the client certificate to present to the server in the following manner:</span></span>  
  
1. <span data-ttu-id="c747c-125">Si se ha presentado un certificado de cliente anteriormente al servidor, el certificado se almacena en caché cuando se presenta por primera vez y se vuelve a usar para las solicitudes de certificado de cliente posteriores.</span><span class="sxs-lookup"><span data-stu-id="c747c-125">If a client certificate was presented previously to the server, the certificate is cached when first presented and is reused for subsequent client certificate requests.</span></span>  
  
2. <span data-ttu-id="c747c-126">Si hay un delegado, use siempre el resultado del delegado como certificado de cliente para seleccionar.</span><span class="sxs-lookup"><span data-stu-id="c747c-126">If a delegate is present, always use the result from the delegate as the client certificate to select.</span></span> <span data-ttu-id="c747c-127">Intente usar un certificado almacenado en caché siempre que sea posible, pero no use credenciales anónimas almacenadas en caché si el delegado ha devuelto null y la colección de certificados no está vacía.</span><span class="sxs-lookup"><span data-stu-id="c747c-127">Try to use a cached certificate when possible, but do not use cached anonymous credentials if the delegate has returned null and the certificate collection is not empty.</span></span>  
  
3. <span data-ttu-id="c747c-128">Si este es el primer desafío de un certificado de cliente, el marco de trabajo enumera los certificados de los objetos de la clase <xref:System.Security.Cryptography.X509Certificates.X509Certificate> o <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> asociados a la conexión y busca una coincidencia entre la lista de emisores de certificados proporcionados por el servidor y el nombre del emisor del certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="c747c-128">If this is the first challenge for a client certificate, the Framework enumerates the certificates in <xref:System.Security.Cryptography.X509Certificates.X509Certificate> or the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class objects associated with the connection, looking for a match between the list of certificate issuers provided by the server and the client certificate issuer name.</span></span> <span data-ttu-id="c747c-129">El primer certificado que coincida se envía al servidor.</span><span class="sxs-lookup"><span data-stu-id="c747c-129">The first certificate that matches is sent to the server.</span></span> <span data-ttu-id="c747c-130">Si ningún certificado coincide o la colección de certificados está vacía, se envía una credencial anónima al servidor.</span><span class="sxs-lookup"><span data-stu-id="c747c-130">If no certificate matches or the certificate collection is empty, then an anonymous credential is sent to the server.</span></span>  
  
## <a name="tools-for-certificate-configuration"></a><span data-ttu-id="c747c-131">Herramientas para la configuración de certificados</span><span class="sxs-lookup"><span data-stu-id="c747c-131">Tools for Certificate Configuration</span></span>  

 <span data-ttu-id="c747c-132">Hay varias herramientas disponibles para la configuración de certificados de cliente y servidor.</span><span class="sxs-lookup"><span data-stu-id="c747c-132">A number of tools are available for client and server certificate configuration.</span></span>  
  
 <span data-ttu-id="c747c-133">La herramienta *Winhttpcertcfg.exe* puede usarse para configurar certificados de cliente.</span><span class="sxs-lookup"><span data-stu-id="c747c-133">The *Winhttpcertcfg.exe* tool can be used to configure client certificates.</span></span> <span data-ttu-id="c747c-134">La herramienta *Winhttpcertcfg.exe* es una de las herramientas del Kit de recursos de Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="c747c-134">The *Winhttpcertcfg.exe* tool is provided as one of the tools with the Windows Server 2003 Resource Kit.</span></span> <span data-ttu-id="c747c-135">Esta herramienta también está disponible como descarga como parte de las herramientas del Kit de recursos de Windows Server 2003 en [www.microsoft.com](https://www.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="c747c-135">This tool is also available as a download as part of the Windows Server 2003 Resource Kit Tools at [www.microsoft.com](https://www.microsoft.com).</span></span>  
  
<span data-ttu-id="c747c-136">La herramienta *HttpCfg.exe* se puede usar para configurar certificados de servidor para la clase <xref:System.Net.HttpListener>.</span><span class="sxs-lookup"><span data-stu-id="c747c-136">The *HttpCfg.exe* tool can be used to configure server certificates for the <xref:System.Net.HttpListener> class.</span></span> <span data-ttu-id="c747c-137">La herramienta *HttpCfg.exe* es una de las herramientas de soporte de Windows Server 2003 y Windows XP Service Pack 2.</span><span class="sxs-lookup"><span data-stu-id="c747c-137">The *HttpCfg.exe* tool is provided as one of the support tools for Windows Server 2003 and Windows XP Service Pack 2.</span></span> <span data-ttu-id="c747c-138">*HttpCfg.exe* y las demás herramientas de soporte no se instalan de forma predeterminada ni en Windows Server 2003 ni en Windows XP.</span><span class="sxs-lookup"><span data-stu-id="c747c-138">*HttpCfg.exe* and the other support tools are not installed by default on either Windows Server 2003 or Windows XP.</span></span> <span data-ttu-id="c747c-139">En Windows Server 2003,</span><span class="sxs-lookup"><span data-stu-id="c747c-139">On Windows Server 2003.</span></span> <span data-ttu-id="c747c-140">las herramientas de soporte se instalan por separado desde la carpeta y el archivo siguientes del CD-ROM de Windows Server 2003:</span><span class="sxs-lookup"><span data-stu-id="c747c-140">the support tools are installed separately from the following folder and file on the Windows Server 2003 CD-ROM:</span></span>  
  
 <span data-ttu-id="c747c-141">\Support\Tools\Suptools.msi</span><span class="sxs-lookup"><span data-stu-id="c747c-141">\Support\Tools\Suptools.msi</span></span>  
  
 <span data-ttu-id="c747c-142">Para su uso con Windows XP Service Pack 2, las herramientas de soporte de Windows XP están disponibles como descarga en [www.microsoft.com](https://www.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="c747c-142">For use with Windows XP Service Pack 2, the Windows XP Support Tools are available as a download from [www.microsoft.com](https://www.microsoft.com).</span></span>  
  
 <span data-ttu-id="c747c-143">El código fuente para una versión de la herramienta *HttpCfg.exe* también se proporciona como ejemplo con el SDK de Windows Server.</span><span class="sxs-lookup"><span data-stu-id="c747c-143">The source code to a version of the *HttpCfg.exe* tool is also provided as a sample with the Windows Server SDK.</span></span> <span data-ttu-id="c747c-144">El código fuente para el ejemplo *HttpCfg.exe* se instala de forma predeterminada con los ejemplos de redes como parte de Windows SDK en la siguiente carpeta:</span><span class="sxs-lookup"><span data-stu-id="c747c-144">The source code to the *HttpCfg.exe* sample is installed by default with the networking samples as part of the Windows SDK under the following folder:</span></span>  
  
 <span data-ttu-id="c747c-145">*C:\Archivos de programa\Microsoft SDKs\Windows\v1.0\Samples\NetDS\http\serviceconfig*</span><span class="sxs-lookup"><span data-stu-id="c747c-145">*C:\Program Files\Microsoft SDKs\Windows\v1.0\Samples\NetDS\http\serviceconfig*</span></span>  
  
 <span data-ttu-id="c747c-146">Además de estas herramientas, las clases <xref:System.Security.Cryptography.X509Certificates.X509Certificate> y <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> proporcionan métodos para cargar un certificado desde el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="c747c-146">In addition to these tools, the <xref:System.Security.Cryptography.X509Certificates.X509Certificate> and <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> classes provides methods for loading a certificate from the file system.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c747c-147">Vea también</span><span class="sxs-lookup"><span data-stu-id="c747c-147">See also</span></span>

- [<span data-ttu-id="c747c-148">Seguridad en la programación para redes</span><span class="sxs-lookup"><span data-stu-id="c747c-148">Security in Network Programming</span></span>](security-in-network-programming.md)
- [<span data-ttu-id="c747c-149">Programación para redes en .NET Framework</span><span class="sxs-lookup"><span data-stu-id="c747c-149">Network Programming in the .NET Framework</span></span>](index.md)
