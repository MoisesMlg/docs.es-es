---
title: NAT Traversal mediante IPv6 y Teredo
ms.date: 03/30/2017
ms.assetid: 568cd245-3300-49ef-a995-d81bf845d961
ms.openlocfilehash: a6448ddf117e1f454338869820751ae5d9e0070e
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96258626"
---
# <a name="nat-traversal-using-ipv6-and-teredo"></a><span data-ttu-id="7b683-102">NAT Traversal mediante IPv6 y Teredo</span><span class="sxs-lookup"><span data-stu-id="7b683-102">NAT Traversal using IPv6 and Teredo</span></span>

<span data-ttu-id="7b683-103">Se han realizado mejoras que proporcionan compatibilidad con la traducción de direcciones de red (NAT) transversal.</span><span class="sxs-lookup"><span data-stu-id="7b683-103">Enhancements were made that provide support for Network Address Translation (NAT) traversal.</span></span> <span data-ttu-id="7b683-104">Estos cambios están diseñados para su uso con IPv6 y Teredo, pero también son aplicables a otras tecnologías de túnel IP.</span><span class="sxs-lookup"><span data-stu-id="7b683-104">These changes are designed for use with IPv6 and Teredo, but they are also applicable to other IP tunneling technologies.</span></span> <span data-ttu-id="7b683-105">Estas mejoras afectan a las clases del espacio de nombres <xref:System.Net> y de otros espacios de nombres relacionados.</span><span class="sxs-lookup"><span data-stu-id="7b683-105">These enhancements affect classes in the <xref:System.Net> and related namespaces.</span></span>  
  
 <span data-ttu-id="7b683-106">Estos cambios pueden afectar a las aplicaciones cliente y servidor que tienen previsto usar tecnologías de túnel IP.</span><span class="sxs-lookup"><span data-stu-id="7b683-106">These changes can affect client and server applications that plan to use IP tunneling technologies.</span></span>  
  
 <span data-ttu-id="7b683-107">Los cambios para admitir NAT transversal{1}{2}solo están disponibles para las aplicaciones que usan .NET Framework versión 4.</span><span class="sxs-lookup"><span data-stu-id="7b683-107">The changes to support NAT traversal are available only for applications using .NET Framework version 4.</span></span> <span data-ttu-id="7b683-108">Estas características no están disponibles en versiones anteriores de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="7b683-108">These features are not available on earlier versions of the .NET Framework.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="7b683-109">Información general</span><span class="sxs-lookup"><span data-stu-id="7b683-109">Overview</span></span>  

 <span data-ttu-id="7b683-110">El protocolo de Internet versión 4 (IPv4) definía una dirección IPv4 con una longitud de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="7b683-110">The Internet Protocol version 4 (IPv4) defined an IPv4 address as 32 bits long.</span></span> <span data-ttu-id="7b683-111">Como resultado, IPv4 admite aproximadamente 4 mil millones de direcciones IP únicas (2^32).</span><span class="sxs-lookup"><span data-stu-id="7b683-111">As a result, IPv4 supports approximately 4 billion unique IP addresses (2^32).</span></span> <span data-ttu-id="7b683-112">Con el aumento del número de equipos y dispositivos de red en Internet en la década de 1990, los límites del espacio de direcciones IPv4 se hacían cada vez más evidentes.</span><span class="sxs-lookup"><span data-stu-id="7b683-112">As the number of computers and network devices on the Internet expanded in the 1990s, the limits of the IPv4 address space became apparent.</span></span>  
  
 <span data-ttu-id="7b683-113">Una de las diversas técnicas usadas para ampliar la vigencia de IPv4 consistía en implementar NAT de modo que permitiese que una sola dirección IP pública representase un gran número de direcciones IP privadas (intranet privada).</span><span class="sxs-lookup"><span data-stu-id="7b683-113">One of several techniques used to extend the lifetime of IPv4 has been to deploy NAT to allow a single unique public IP address to represent a large number of private IP addresses (private Intranet).</span></span> <span data-ttu-id="7b683-114">Las direcciones IP privadas tras el dispositivo NAT comparten la única dirección IPv4 pública.</span><span class="sxs-lookup"><span data-stu-id="7b683-114">The private IP addresses behind the NAT device share the single public IPv4 address.</span></span> <span data-ttu-id="7b683-115">El dispositivo NAT puede ser un dispositivo de hardware dedicado (un económico punto de acceso inalámbrico y enrutador, por ejemplo) o un equipo que ejecuta un servicio para proporcionar NAT.</span><span class="sxs-lookup"><span data-stu-id="7b683-115">The NAT device may be a dedicated hardware device (an inexpensive Wireless Access Point and router, for example) or a computer running a service to provide NAT.</span></span> <span data-ttu-id="7b683-116">Un dispositivo o servicio para esta dirección IP pública traduce los paquetes de red IP entre la red de Internet pública y la intranet privada.</span><span class="sxs-lookup"><span data-stu-id="7b683-116">A device or service for this public IP address translates IP network packets between the public Internet and the private Intranet.</span></span>  
  
 <span data-ttu-id="7b683-117">Este esquema es apropiado para las aplicaciones cliente que se ejecutan en la intranet privada y que envían solicitudes a otras direcciones IP (normalmente servidores) en Internet.</span><span class="sxs-lookup"><span data-stu-id="7b683-117">This scheme works well for client applications running on the private Intranet that send requests to other IP addresses (usually servers) on the Internet.</span></span> <span data-ttu-id="7b683-118">El dispositivo o servidor NAT puede mantener una asignación de las solicitudes de los clientes, de modo que cuando se devuelve una respuesta sabe adónde enviarla.</span><span class="sxs-lookup"><span data-stu-id="7b683-118">The NAT device or server can keep a mapping of client requests so when a response is returned it knows where to send the response.</span></span> <span data-ttu-id="7b683-119">Pero este esquema plantea problemas a las aplicaciones que se ejecutan en la intranet privada tras el dispositivo NAT que va a proporcionar servicios, realizar escuchas de paquetes y responder.</span><span class="sxs-lookup"><span data-stu-id="7b683-119">But this scheme poses problems for applications running in the private Intranet behind the NAT device that want to provide services, listen for packets, and respond.</span></span> <span data-ttu-id="7b683-120">Esto sucede sobre todo en las aplicaciones punto a punto.</span><span class="sxs-lookup"><span data-stu-id="7b683-120">This is particularly the case for peer-to-peer applications.</span></span>  
  
 <span data-ttu-id="7b683-121">El protocolo IPv6 definía una dirección IPv4 con una longitud de 128 bits.</span><span class="sxs-lookup"><span data-stu-id="7b683-121">The IPv6 protocol defined an IPv4 address as 128 bits long.</span></span> <span data-ttu-id="7b683-122">Como resultado, IPv6 admite un gran espacio de direcciones IP de 3,2 x 10^38 direcciones únicas (2^128).</span><span class="sxs-lookup"><span data-stu-id="7b683-122">As a result, IPv6 supports very a large IP address space of 3.2 x 10^38 unique addresses (2^128).</span></span> <span data-ttu-id="7b683-123">Con un espacio de direcciones de este tamaño, es posible que todos los dispositivos conectados a Internet obtengan una dirección única.</span><span class="sxs-lookup"><span data-stu-id="7b683-123">With an address space of this size, it is possible for every device connected to the Internet to be given a unique address.</span></span> <span data-ttu-id="7b683-124">A pesar de ello, existe una serie de problemas.</span><span class="sxs-lookup"><span data-stu-id="7b683-124">But there are problems.</span></span> <span data-ttu-id="7b683-125">En gran parte del mundo se sigue usando solo IPv4.</span><span class="sxs-lookup"><span data-stu-id="7b683-125">Much of the world is still using only IPv4.</span></span> <span data-ttu-id="7b683-126">En concreto, muchos de los enrutadores y puntos de acceso inalámbrico usados por los hogares, las organizaciones y las pequeñas empresas no admiten IPv6.</span><span class="sxs-lookup"><span data-stu-id="7b683-126">In particular, many of the existing routers and wireless access points used by small companies, organizations, and households do not support IPv6.</span></span> <span data-ttu-id="7b683-127">Además, algunos de los proveedores de servicios de Internet que atienden a estos clientes no admiten IPv6 o no han configurado la compatibilidad con IPv6.</span><span class="sxs-lookup"><span data-stu-id="7b683-127">Also some Internet service providers that serve these customers either do not support or have not configured support for IPv6.</span></span>  
  
 <span data-ttu-id="7b683-128">Se han desarrollado varias tecnologías de transición de IPv6 para tunelizar las direcciones IPv6 en un paquete IPv4.</span><span class="sxs-lookup"><span data-stu-id="7b683-128">Several IPv6 transition technologies have been developed to tunnel IPv6 addresses in an IPv4 packet.</span></span> <span data-ttu-id="7b683-129">Estas tecnologías incluyen 6to4, ISATAP y túneles Teredo, que proporcionan la asignación de direcciones y la tunelización automática de host a host para el tráfico IPv6 de unidifusión cuando los hosts IPv6 deben atravesar redes IP4 para llegar a otras redes IPv6.</span><span class="sxs-lookup"><span data-stu-id="7b683-129">These technologies include 6to4, ISATAP, and Teredo tunnels that provide address assignment and host-to-host automatic tunneling for unicast IPv6 traffic when IPv6 hosts must traverse IP4 networks to reach other IPv6 networks.</span></span> <span data-ttu-id="7b683-130">Los paquetes IPv6 se envían mediante túneles como paquetes IPv4.</span><span class="sxs-lookup"><span data-stu-id="7b683-130">IPv6 packets are sent tunneled as IPv4 packets.</span></span> <span data-ttu-id="7b683-131">Se están usando varias técnicas de tunelización que permiten NAT transversal{1}{2}para direcciones IPv6 a través de un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="7b683-131">Several tunneling techniques are being used that allow NAT traversal for IPv6 addresses through a NAT device.</span></span>  
  
 <span data-ttu-id="7b683-132">Teredo es una de las tecnologías de transición IPv6 que ofrece conectividad IPv6 en redes IPv4.</span><span class="sxs-lookup"><span data-stu-id="7b683-132">Teredo is one of the IPv6 transition technologies which brings IPv6 connectivity to IPv4 networks.</span></span> <span data-ttu-id="7b683-133">Las especificaciones de Teredo están documentadas en RFC 4380, publicado por Internet Engineering Task Force (IETF).</span><span class="sxs-lookup"><span data-stu-id="7b683-133">Teredo is documented in RFC 4380 published by the Internet Engineering Task Force (IETF).</span></span> <span data-ttu-id="7b683-134">Windows XP SP2 y versiones posteriores proporcionan compatibilidad con un adaptador Teredo virtual que puede proporcionar una dirección IPv6 pública en el intervalo 2001:0::/32.</span><span class="sxs-lookup"><span data-stu-id="7b683-134">Windows XP SP2 and later provide support for a virtual Teredo adapter which can provide a public IPv6 address in the range 2001:0::/32.</span></span> <span data-ttu-id="7b683-135">Esta dirección IPv6 puede usarse para escuchar las conexiones entrantes procedentes de Internet y puede proporcionarse a los clientes habilitados para IPv6 que quieren conectar con el servicio de escucha.</span><span class="sxs-lookup"><span data-stu-id="7b683-135">This IPv6 address can be used to listen for incoming connections from the Internet and can be provided to IPv6 enabled clients that wish to connect to the listening service.</span></span> <span data-ttu-id="7b683-136">Esto hace que una aplicación no tenga que preocuparse por cómo dirigirse a un equipo tras un dispositivo NAT, dado que la aplicación solo se puede conectar a él mediante su dirección Teredo IPv6.</span><span class="sxs-lookup"><span data-stu-id="7b683-136">This frees an application from worrying about how to address a computer behind a NAT device, since the application can just connect to it using its IPv6 Teredo address.</span></span>  
  
## <a name="enhancements-to-support-nat-traversal-and-teredo"></a><span data-ttu-id="7b683-137">Mejoras para admitir NAT transversal{1}{2}y Teredo</span><span class="sxs-lookup"><span data-stu-id="7b683-137">Enhancements to Support NAT Traversal and Teredo</span></span>  

 <span data-ttu-id="7b683-138">Se han agregado mejoras a los espacios de nombres <xref:System.Net>, <xref:System.Net.NetworkInformation> y <xref:System.Net.Sockets> para admitir NAT transversal{4}{5}mediante IPv6 y Teredo.</span><span class="sxs-lookup"><span data-stu-id="7b683-138">Enhancements are added to the <xref:System.Net>, <xref:System.Net.NetworkInformation>, and <xref:System.Net.Sockets> namespaces for supporting NAT traversal using IPv6 and Teredo.</span></span>  
  
 <span data-ttu-id="7b683-139">Se han agregado varios métodos a la clase <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> para obtener la lista de direcciones IP de unidifusión en el host.</span><span class="sxs-lookup"><span data-stu-id="7b683-139">Several methods are added to the <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> class to get the list of unicast IP addresses on the host.</span></span> <span data-ttu-id="7b683-140">El método <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> inicia una solicitud asincrónica para recuperar la tabla de direcciones IP de unidifusión estables del equipo local.</span><span class="sxs-lookup"><span data-stu-id="7b683-140">The <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="7b683-141">El método <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> finaliza una solicitud asincrónica pendiente para recuperar la tabla de direcciones IP de unidifusión estables del equipo local.</span><span class="sxs-lookup"><span data-stu-id="7b683-141">The <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="7b683-142">El método <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> es una solicitud sincrónica para recuperar la tabla de direcciones IP de unidifusión estables del equipo local, que espera hasta que la tabla de direcciones se estabilice, si es necesario.</span><span class="sxs-lookup"><span data-stu-id="7b683-142">The <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary.</span></span>  
  
 <span data-ttu-id="7b683-143">Se puede usar la propiedad <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> para determinar si una <xref:System.Net.IPAddress> es una dirección Teredo IPv6.</span><span class="sxs-lookup"><span data-stu-id="7b683-143">The <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> property can be used to determine if an <xref:System.Net.IPAddress> is an IPv6 Teredo address.</span></span>  
  
 <span data-ttu-id="7b683-144">El uso de estos nuevos métodos de clase <xref:System.Net.NetworkInformation.IPGlobalProperties> en combinación con la propiedad <xref:System.Net.IPAddress.IsIPv6Teredo%2A> permite que una aplicación encuentre fácilmente la dirección Teredo.</span><span class="sxs-lookup"><span data-stu-id="7b683-144">Using these new <xref:System.Net.NetworkInformation.IPGlobalProperties> class methods in combination with the <xref:System.Net.IPAddress.IsIPv6Teredo%2A> property allows an application to easily find the Teredo address.</span></span> <span data-ttu-id="7b683-145">Normalmente, una aplicación solo necesita conocer la dirección Teredo local si está comunicando esta información a aplicaciones remotas.</span><span class="sxs-lookup"><span data-stu-id="7b683-145">An application normally only needs to know the local Teredo address if it is communicating this information to remote applications.</span></span> <span data-ttu-id="7b683-146">Por ejemplo, una aplicación punto a punto puede enviar todas sus direcciones IPv6 a un servidor de contactos que, posteriormente, puede reenviarlas a otros servidores para habilitar la comunicación directa.</span><span class="sxs-lookup"><span data-stu-id="7b683-146">For example, a peer-to-peer application might send all of its IPv6 addresses to a matchmaking server which can then forward them to others peers to enable direct communication.</span></span>  
  
 <span data-ttu-id="7b683-147">Por lo general, una aplicación debe establecer su servicio de escucha para que escuche en <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType>, en lugar de en la dirección Teredo local.</span><span class="sxs-lookup"><span data-stu-id="7b683-147">An application should normally set its listening service to listen on <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> rather than on the local Teredo address.</span></span> <span data-ttu-id="7b683-148">Así pues, si un elemento del mismo nivel o cliente remoto tiene una ruta IPv6 directa al host del servicio de escucha, puede conectarse directamente mediante IPv6 sin tener que usar Teredo para tunelizar paquetes.</span><span class="sxs-lookup"><span data-stu-id="7b683-148">So if a remote client or peer has a direct IPv6 route to the host of the listening service, the client or peer can connect directly using IPv6 and not have to use Teredo to tunnel packets.</span></span>  
  
 <span data-ttu-id="7b683-149">Para las aplicaciones TCP, la clase <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> tiene un método <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> para permitir NAT transversal.</span><span class="sxs-lookup"><span data-stu-id="7b683-149">For TCP applications, the <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> method to enable NAT traversal.</span></span> <span data-ttu-id="7b683-150">Para las aplicaciones UDP, la clase <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> tiene un método <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> para permitir NAT transversal.</span><span class="sxs-lookup"><span data-stu-id="7b683-150">For UDP applications, the <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> method to enable NAT traversal.</span></span>  
  
 <span data-ttu-id="7b683-151">Para las aplicaciones que usan <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> y clases relacionadas, se pueden usar los métodos <xref:System.Net.Sockets.Socket.GetSocketOption%2A> y <xref:System.Net.Sockets.Socket.SetSocketOption%2A> con la opción de socket <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> para consultar, habilitar o deshabilitar NAT transversal.</span><span class="sxs-lookup"><span data-stu-id="7b683-151">For applications that use the <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> and related classes, the <xref:System.Net.Sockets.Socket.GetSocketOption%2A> and <xref:System.Net.Sockets.Socket.SetSocketOption%2A> methods can be used with the <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> socket option to query, enable, or disable NAT traversal.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7b683-152">Vea también</span><span class="sxs-lookup"><span data-stu-id="7b683-152">See also</span></span>

- <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.IPProtectionLevel?displayProperty=nameWithType>
- <xref:System.Net.Sockets.Socket.SetIPProtectionLevel%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A?displayProperty=nameWithType>
