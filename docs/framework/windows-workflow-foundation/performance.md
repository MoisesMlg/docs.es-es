---
title: Rendimiento de Windows Workflow Foundation
description: En este artículo se explican las características de rendimiento de la revisión principal de Windows Workflow Foundation, que forma parte de .NET Framework 4.
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: f77ebaeb0b59dea1a75594c7425b960e3fe839cb
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96246555"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="c7ff3-103">Rendimiento de Windows Workflow Foundation</span><span class="sxs-lookup"><span data-stu-id="c7ff3-103">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="c7ff3-104">.NET Framework 4 incluye una revisión importante del Windows Workflow Foundation (WF) con grandes inversiones en rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-104">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="c7ff3-105">Esta nueva revisión presenta cambios importantes en el diseño de las versiones anteriores de [!INCLUDE[wf1](../../../includes/wf1-md.md)] que se incluían como parte de .NET Framework 3,0 y .NET Framework 3,5.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-105">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="c7ff3-106">Se ha rediseñado en lo que respecta al núcleo del modelo de programación, el runtime y las herramientas para mejorar significativamente el rendimiento y la facilidad de uso.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-106">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="c7ff3-107">En este tema se muestran las características de rendimiento más importantes de estas revisiones y se comparan con las de la versión anterior.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-107">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="c7ff3-108">El rendimiento de cada componente de flujo de trabajo se ha aumentado por órdenes de magnitud entre WF3 y WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-108">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="c7ff3-109">Esto deja el intervalo entre los servicios de Windows Communication Foundation codificados a mano (WCF) y los servicios de flujo de trabajo de WCF para que sean bastante pequeños.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-109">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="c7ff3-110">La latencia del flujo de trabajo se ha reducido significativamente en WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-110">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="c7ff3-111">El rendimiento de persistencia ha aumentado en un factor comprendido entre 2,5 y 3,0.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-111">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="c7ff3-112">Se ha reducido notablemente la sobrecarga del seguimiento de estado por medio del seguimiento de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-112">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="c7ff3-113">Estas son razones de peso para migrar a WF4, o adoptarlo, en las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-113">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="c7ff3-114">Terminología</span><span class="sxs-lookup"><span data-stu-id="c7ff3-114">Terminology</span></span>

 <span data-ttu-id="c7ff3-115">La versión de [!INCLUDE[wf1](../../../includes/wf1-md.md)] introducida en .NET Framework 4 se denominará WF4 en el resto de este tema.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-115">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)] <span data-ttu-id="c7ff3-116">se presentó en .NET Framework 3,0 y tenía algunas revisiones poco importantes a través de .NET Framework 3,5 SP1.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-116">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="c7ff3-117">La versión .NET Framework 3,5 de Workflow Foundation se denominará WF3 en el resto de este tema.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-117">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="c7ff3-118">WF3 se incluye en .NET Framework 4 en paralelo con WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-118">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="c7ff3-119">Para obtener más información sobre cómo migrar artefactos de WF3 a WF4, vea la [Guía de migración de Windows Workflow Foundation 4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-119">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="c7ff3-120">Windows Communication Foundation (WCF) es el modelo de programación Unificado de Microsoft para la creación de aplicaciones orientadas a servicios.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-120">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="c7ff3-121">Se presentó por primera vez como parte de .NET Framework 3,0 junto con WF3 y ahora es uno de los componentes clave de la .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-121">It was first introduced as part of .NET Framework 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="c7ff3-122">Windows Server AppFabric es un conjunto de tecnologías integradas que permiten compilar, escalar y administrar más fácilmente aplicaciones web y aplicaciones compuestas que se ejecutan en IIS.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-122">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="c7ff3-123">Proporciona herramientas para supervisar y administrar servicios y flujos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-123">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="c7ff3-124">Para obtener más información, consulte [Windows Server AppFabric 1,0](/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-124">For more information, see [Windows Server AppFabric 1.0](/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="c7ff3-125">Objetivos</span><span class="sxs-lookup"><span data-stu-id="c7ff3-125">Goals</span></span>

 <span data-ttu-id="c7ff3-126">El objetivo de este tema es mostrar las características de rendimiento de WF4 con datos medidos para diferentes escenarios.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-126">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="c7ff3-127">También se proporcionan en él comparaciones detalladas entre WF4 y WF3, y asimismo se muestran las grandes mejoras realizadas en esta nueva revisión.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-127">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="c7ff3-128">Los escenarios y los datos presentados en este artículo cuantifican el costo subyacente de distintos aspectos de WF4 y WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-128">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="c7ff3-129">Estos datos son útiles para entender las características de rendimiento de WF4 y pueden ser útiles para planear migraciones de WF3 a WF4 o utilizar WF4 en el desarrollo de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-129">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="c7ff3-130">Sin embargo, se debe ser cauto al considerar las conclusiones extraídas de los datos presentados en este artículo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-130">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="c7ff3-131">El rendimiento de una aplicación de flujo de trabajo compuesta depende en gran medida de cómo se implementa el flujo de trabajo y cómo se integran los distintos componentes.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-131">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="c7ff3-132">Se debe medir cada aplicación para determinar las características de rendimiento de la misma.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-132">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="c7ff3-133">Información general sobre las mejoras de rendimiento de WF4</span><span class="sxs-lookup"><span data-stu-id="c7ff3-133">Overview of WF4 Performance Enhancements</span></span>

 <span data-ttu-id="c7ff3-134">WF4 se ha diseñado e implementado cuidadosamente con un alto grado de rendimiento y escalabilidad que se describe en las siguientes secciones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-134">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="c7ff3-135">Runtime de WF</span><span class="sxs-lookup"><span data-stu-id="c7ff3-135">WF Runtime</span></span>

 <span data-ttu-id="c7ff3-136">El núcleo del runtime de [!INCLUDE[wf1](../../../includes/wf1-md.md)] lo constituye un programador asincrónico que controla la ejecución de las actividades en un flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-136">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="c7ff3-137">Proporciona un entorno de ejecución predecible y de gran rendimiento para las actividades.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-137">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="c7ff3-138">El entorno tiene un contrato bien definido en materia de ejecución, continuación, realización, cancelación y control de excepciones, así como un modelo de subprocesos predecible.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-138">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="c7ff3-139">En comparación con WF3, el runtime de WF4 tiene un programador más eficaz.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-139">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="c7ff3-140">Aprovecha el mismo grupo de subprocesos de e/s que se usa para WCF, que es muy eficaz en la ejecución de elementos de trabajo por lotes.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-140">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="c7ff3-141">La cola del programador interno de elemento de trabajo se ha optimizado para la mayoría de los patrones de uso comunes.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-141">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="c7ff3-142">El tiempo de ejecución de WF4 también administra los Estados de ejecución de una manera muy ligera con una lógica mínima de sincronización y control de eventos, mientras que WF3 depende de un registro de eventos y una invocación de gran peso para realizar una sincronización compleja de las transiciones de estado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-142">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="c7ff3-143">Almacenamiento y flujo de datos</span><span class="sxs-lookup"><span data-stu-id="c7ff3-143">Data Storage and Flow</span></span>

 <span data-ttu-id="c7ff3-144">En WF3, los datos asociados a una actividad se modelan mediante propiedades de dependencia implementadas por el tipo <xref:System.Windows.DependencyProperty>.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-144">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="c7ff3-145">El patrón de propiedad de dependencia se presentó en Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-145">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="c7ff3-146">En general, este patrón es muy flexible para admitir un enlace de datos fácil y otras características de interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-146">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="c7ff3-147">Sin embargo, el patrón requiere que las propiedades se definan como campos estáticos en la definición de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-147">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="c7ff3-148">El establecimiento o la obtención de los valores de propiedad por parte del runtime de [!INCLUDE[wf1](../../../includes/wf1-md.md)] suponen una lógica de búsqueda compleja.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-148">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="c7ff3-149">WF4 utiliza una lógica clara de ámbito de datos para mejorar sustancialmente la forma de tratar los datos en un flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-149">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="c7ff3-150">Separa los datos almacenados en una actividad de los datos que fluyen por los límites de la actividad utilizando dos conceptos diferentes: variables y argumentos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-150">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="c7ff3-151">Mediante el uso de un ámbito jerárquico claro para las variables y los argumentos "in/out/InOut", la complejidad del uso de los datos de las actividades se reduce drásticamente y la duración de los datos también se limita automáticamente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-151">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="c7ff3-152">Las actividades tienen una signatura bien definida descrita por sus argumentos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-152">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="c7ff3-153">Mediante la simple inspección de una actividad, se puede determinar qué datos espera recibir y qué datos generará como consecuencia de su ejecución.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-153">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="c7ff3-154">En WF3, las actividades se inicializaban cuando se creaba un flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-154">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="c7ff3-155">En WF4, las actividades se inicializan solo cuando se ejecutan las actividades correspondientes.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-155">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="c7ff3-156">Esto permite un ciclo de vida más simple de la actividad sin realizar operaciones de inicializar/anular inicialización cuando se crea una nueva instancia de flujo de trabajo, consiguiéndose de este modo una mayor eficacia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-156">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="c7ff3-157">Flujo de control</span><span class="sxs-lookup"><span data-stu-id="c7ff3-157">Control Flow</span></span>

 <span data-ttu-id="c7ff3-158">Como en cualquier lenguaje de programación, [!INCLUDE[wf1](../../../includes/wf1-md.md)] proporciona compatibilidad con los flujos de control para las definiciones de flujo de trabajo introduciendo un conjunto de actividades de flujo de control para la creación de secuencias, bucles, bifurcaciones y otros patrones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-158">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="c7ff3-159">En WF3, cuando se necesita volver a ejecutar la misma actividad, se crea un nuevo elemento <xref:System.Workflow.ComponentModel.ActivityExecutionContext> y la actividad se clona mediante una lógica de serialización y deserialización compleja basada en <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-159">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="c7ff3-160">Normalmente, el rendimiento de los flujos de control reiterativos es mucho más lento que la ejecución de una secuencia de actividades.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-160">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="c7ff3-161">WF4 trata este aspecto de forma bastante diferente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-161">WF4 handles this quite differently.</span></span> <span data-ttu-id="c7ff3-162">Toma la plantilla de actividad, crea un nuevo objeto ActivityInstance y lo agrega a la cola del programador.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-162">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="c7ff3-163">Este proceso completo solo implica la creación explícita de objetos y es muy ligero.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-163">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="c7ff3-164">Programación asincrónica</span><span class="sxs-lookup"><span data-stu-id="c7ff3-164">Asynchronous Programming</span></span>

 <span data-ttu-id="c7ff3-165">Las aplicaciones tienen normalmente mejores niveles de rendimiento y escalabilidad con la programación asincrónica de operaciones de bloqueo de ejecución prolongada, como las operaciones de computación distribuidas o de E/S.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-165">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="c7ff3-166">WF4 proporciona compatibilidad asincrónica a través de los tipos de actividad base <xref:System.Activities.AsyncCodeActivity> y <xref:System.Activities.AsyncCodeActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-166">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="c7ff3-167">El runtime entiende las actividades asincrónicas de forma nativa y, por lo tanto, puede colocar automáticamente la instancia en una zona sin persistencia mientras el trabajo asincrónico está pendiente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-167">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="c7ff3-168">Las actividades personalizadas pueden derivar de estos tipos para realizar el trabajo asincrónico sin retener el subproceso de programador de flujo de trabajo ni bloquear las actividades que puedan ejecutarse en paralelo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-168">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="c7ff3-169">Mensajería</span><span class="sxs-lookup"><span data-stu-id="c7ff3-169">Messaging</span></span>

 <span data-ttu-id="c7ff3-170">Inicialmente, WF3 tenía compatibilidad de mensajería muy limitada a través de invocaciones de eventos externos o servicios Web.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-170">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="c7ff3-171">En .NET Framework 3,5, los flujos de trabajo podrían implementarse como clientes WCF o exponerse como servicios WCF a través <xref:System.Workflow.Activities.SendActivity> de y <xref:System.Workflow.Activities.ReceiveActivity> .</span><span class="sxs-lookup"><span data-stu-id="c7ff3-171">In .NET Framework 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="c7ff3-172">En WF4, el concepto de programación de mensajería basada en el flujo de trabajo se ha reforzado aún más a través de la estrecha integración de la lógica de mensajería de WCF en WF.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-172">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="c7ff3-173">La canalización de procesamiento de mensajes unificada proporcionada en WCF en .NET 4 ayuda a WF4 Services a tener un rendimiento y una escalabilidad significativamente mejores que WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-173">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="c7ff3-174">WF4 también proporciona una compatibilidad de programación de mensajería más avanzada que puede modelar patrones de intercambio de mensajes (MEP) complejos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-174">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="c7ff3-175">Los desarrolladores pueden utilizar contratos de servicio con tipos para conseguir una programación fácil o contratos de servicio sin tipos para lograr un rendimiento mejor sin pagar costos de serialización.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-175">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="c7ff3-176">La compatibilidad de almacenamiento en caché de canales del lado cliente mediante la clase <xref:System.ServiceModel.Activities.SendMessageChannelCache> en WF4 ayuda a los desarrolladores a compilar aplicaciones rápidas con el mínimo esfuerzo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-176">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="c7ff3-177">Para obtener más información, consulte [cambiar los niveles de uso compartido de caché para las actividades de envío](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-177">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="c7ff3-178">Programación declarativa</span><span class="sxs-lookup"><span data-stu-id="c7ff3-178">Declarative Programming</span></span>

 <span data-ttu-id="c7ff3-179">WF4 proporciona un marco de programación declarativa limpio y simple para modelar los procesos y servicios de negocios.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-179">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="c7ff3-180">El modelo de programación admite la composición totalmente declarativa de actividades, sin código lateral, simplificando enormemente la creación del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-180">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="c7ff3-181">En .NET Framework 4, el marco de programación declarativo basado en XAML se ha unificado en el System.Xaml.dll de ensamblado único para admitir WPF y WF.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-181">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="c7ff3-182">En WF4, XAML proporciona una experiencia realmente declarativa y permite que la definición completa del flujo de trabajo se defina en marcado XML, haciendo referencia a actividades y tipos generados mediante el uso de .NET.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-182">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="c7ff3-183">Esto resultaba difícil de hacer en WF3 con formato XOML sin la participación de lógica personalizada de código subyacente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-183">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="c7ff3-184">La nueva pila XAML en .NET 4 tiene un rendimiento mucho mejor en la serialización/deserialización de artefactos de flujo de trabajo y hace que la programación declarativa sea más atractiva y sólida.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-184">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="c7ff3-185">Diseñador de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="c7ff3-185">Workflow Designer</span></span>

 <span data-ttu-id="c7ff3-186">La compatibilidad de la programación totalmente declarativa con WF4 impone explícitamente requisitos más exigentes para el rendimiento en tiempo de diseño de grandes flujos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-186">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="c7ff3-187">El diseñador de flujos de trabajo en WF4 tiene mejor escalabilidad para grandes flujos de trabajo que el de WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-187">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="c7ff3-188">Con la compatibilidad de virtualización de interfaz de usuario, el diseñador puede cargar fácilmente un flujo de trabajo grande de 1000 actividades en unos segundos, mientras que es muy difícil cargar un flujo de trabajo de unos pocos cientos de actividades con el diseñador de WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-188">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="c7ff3-189">Comparaciones de rendimiento en el nivel de componente</span><span class="sxs-lookup"><span data-stu-id="c7ff3-189">Component-level Performance Comparisons</span></span>

 <span data-ttu-id="c7ff3-190">Esta sección contiene datos sobre comparaciones directas entre actividades individuales en flujos de trabajo de WF3 y WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-190">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="c7ff3-191">Áreas clave como la persistencia tienen un impacto más profundo en el rendimiento que los componentes de actividades individuales.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-191">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="c7ff3-192">Las mejoras de rendimiento en componentes individuales de WF4 son importantes porque los componentes son ahora bastante rápidos en comparación con la lógica de orquestación codificada manualmente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-192">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="c7ff3-193">Un ejemplo de esto se trata en la sección siguiente: "escenario de composición de servicio".</span><span class="sxs-lookup"><span data-stu-id="c7ff3-193">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c7ff3-194">Configuración del entorno</span><span class="sxs-lookup"><span data-stu-id="c7ff3-194">Environment Setup</span></span>

 ![Configuración del entorno para la medición del rendimiento del flujo de trabajo](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="c7ff3-196">Las ilustración anterior muestra la configuración de una máquina utilizada para la medición del rendimiento en el nivel de componente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-196">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="c7ff3-197">Un solo servidor y cinco clientes conectados a través de una interfaz de red Ethernet de 1 Gbps.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-197">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="c7ff3-198">Para las mediciones fáciles, el servidor se configura para utilizar un núcleo único de un servidor de procesador dual y núcleo cuádruple basado en x86 que ejecuta Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-198">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="c7ff3-199">La utilización de la CPU del sistema se mantiene en casi el 100%.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-199">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="c7ff3-200">Detalles de las pruebas</span><span class="sxs-lookup"><span data-stu-id="c7ff3-200">Test Details</span></span>

 <span data-ttu-id="c7ff3-201"><xref:System.Workflow.Activities.CodeActivity> de WF3 es probablemente la actividad más simple que se puede utilizar en un flujo de trabajo de WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-201">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="c7ff3-202">La actividad llama a un método en el código subyacente en que el programador de flujos de trabajo puede colocar el código personalizado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-202">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="c7ff3-203">En WF4, no hay ningún equivalente directo a <xref:System.Workflow.Activities.CodeActivity> de WF3 que proporcione la misma funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-203">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="c7ff3-204">Observe que hay una clase base <xref:System.Activities.CodeActivity> en WF4 que no está relacionada con <xref:System.Workflow.Activities.CodeActivity> de WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-204">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="c7ff3-205">Se recomienda encarecidamente a los autores de flujos de trabajo que creen actividades personalizadas y compilen flujos de trabajo de solo XAML.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-205">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="c7ff3-206">En las pruebas siguientes, se utiliza una actividad denominada `Comment` en lugar de un elemento <xref:System.Workflow.Activities.CodeActivity> vacío en flujos de trabajo de WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-206">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="c7ff3-207">El código de la actividad `Comment` es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-207">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="c7ff3-208">Flujo de trabajo vacío</span><span class="sxs-lookup"><span data-stu-id="c7ff3-208">Empty Workflow</span></span>

 <span data-ttu-id="c7ff3-209">Esta prueba utiliza un flujo de trabajo de secuencia sin actividades secundarias.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-209">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="c7ff3-210">Actividad única</span><span class="sxs-lookup"><span data-stu-id="c7ff3-210">Single Activity</span></span>

 <span data-ttu-id="c7ff3-211">El flujo de trabajo es un flujo de trabajo de secuencia que contiene una actividad secundaria.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-211">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="c7ff3-212">La actividad es un elemento <xref:System.Workflow.Activities.CodeActivity> sin código en el caso de WF3 y una actividad `Comment` en el caso de WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-212">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="c7ff3-213">While con 1000 iteraciones</span><span class="sxs-lookup"><span data-stu-id="c7ff3-213">While with 1000 Iterations</span></span>

 <span data-ttu-id="c7ff3-214">El flujo de trabajo de la secuencia contiene una actividad <xref:System.Activities.Statements.While> con una actividad secundaria en el bucle que no realiza ningún trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-214">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="c7ff3-215">Replicador comparado con ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="c7ff3-215">Replicator compared to ParallelForEach</span></span>

 <span data-ttu-id="c7ff3-216"><xref:System.Workflow.Activities.ReplicatorActivity> en WF3 tiene modos de ejecución paralela y secuencial.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-216"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="c7ff3-217">En modo secuencial, el rendimiento de la actividad es similar a <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-217">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="c7ff3-218"><xref:System.Workflow.Activities.ReplicatorActivity> es muy útil para la ejecución paralela.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-218">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="c7ff3-219">El equivalente de WF4 es la actividad <xref:System.Activities.Statements.ParallelForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-219">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="c7ff3-220">En el siguiente diagrama se muestran los flujos de trabajo utilizados para esta prueba.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-220">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="c7ff3-221">El flujo de trabajo de WF3 está en el lado izquierdo y el flujo de trabajo de WF4 está en el derecho.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-221">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![ReplicatorActivity de WF3 y ParallelForEach de WF4](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="c7ff3-223">Flujo de trabajo secuencial con cinco actividades</span><span class="sxs-lookup"><span data-stu-id="c7ff3-223">Sequential Workflow with Five Activities</span></span>

 <span data-ttu-id="c7ff3-224">Esta prueba sirve para mostrar el efecto de la ejecución de varias actividades en secuencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-224">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="c7ff3-225">Hay cinco actividades en la secuencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-225">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="c7ff3-226">Ámbito de transacción</span><span class="sxs-lookup"><span data-stu-id="c7ff3-226">Transaction Scope</span></span>

 <span data-ttu-id="c7ff3-227">La prueba de ámbito de transacción difiere ligeramente de las demás pruebas en que una nueva instancia de flujo de trabajo no se crea para cada iteración.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-227">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="c7ff3-228">En su lugar, el flujo de trabajo se estructura con un bucle While que contiene una actividad <xref:System.Activities.Statements.TransactionScope> que contiene a su vez una sola actividad que no realiza trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-228">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="c7ff3-229">Cada ejecución de un lote de 50 iteraciones mediante el bucle While se cuenta como una operación única.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-229">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="c7ff3-230">Compensación</span><span class="sxs-lookup"><span data-stu-id="c7ff3-230">Compensation</span></span>

 <span data-ttu-id="c7ff3-231">El flujo de trabajo de WF3 tiene una actividad compensable única denominada `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-231">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="c7ff3-232">La actividad simplemente implementa la interfaz <xref:System.Workflow.ComponentModel.ICompensatableActivity>:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-232">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="c7ff3-233">El controlador de errores tiene como destino la `WorkScope` actividad.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-233">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="c7ff3-234">El flujo de trabajo de WF4 es igualmente simplista.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-234">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="c7ff3-235">Una actividad <xref:System.Activities.Statements.CompensableActivity> tiene un cuerpo y un controlador de compensación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-235">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="c7ff3-236">Una compensación explícita es el elemento siguiente en la secuencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-236">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="c7ff3-237">La actividad de cuerpo y la actividad de controlador de compensación son implementaciones vacías:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-237">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="c7ff3-238">En el diagrama siguiente se muestra el flujo de trabajo de compensación básica.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-238">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="c7ff3-239">El flujo de trabajo de WF3 está en el lado izquierdo y el flujo de trabajo de WF4 está en el derecho.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-239">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Flujos de trabajo de compensación básica de WF3 y WF4](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="c7ff3-241">Resultados de pruebas de rendimiento</span><span class="sxs-lookup"><span data-stu-id="c7ff3-241">Performance Test Results</span></span>

 ![Tabla que muestra los datos de resultados de pruebas de rendimiento](./media/performance/performance-test-data.gif)

 ![Gráfico de columnas que compara los datos de prueba de rendimiento de WF3 y WF4](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="c7ff3-244">Todas las pruebas se miden en flujos de trabajo por segundo con la excepción de la prueba de ámbito de transacción.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-244">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="c7ff3-245">Como se puede ver más arriba, el rendimiento del runtime de [!INCLUDE[wf1](../../../includes/wf1-md.md)] ha mejorado globalmente, sobre todo en áreas que requieren varias ejecuciones de la misma actividad como el bucle While.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-245">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="c7ff3-246">Escenario de composición de servicio</span><span class="sxs-lookup"><span data-stu-id="c7ff3-246">Service Composition Scenario</span></span>

 <span data-ttu-id="c7ff3-247">Como se muestra en la sección anterior, "comparaciones de rendimiento en el nivel de componente", ha habido una reducción significativa en la sobrecarga entre WF3 y WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-247">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="c7ff3-248">Los servicios de flujo de trabajo de WCF ahora pueden coincidir casi con el rendimiento de los servicios WCF codificados manualmente, pero siguen teniendo todas las ventajas del [!INCLUDE[wf1](../../../includes/wf1-md.md)] tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-248">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="c7ff3-249">En este escenario de prueba se compara un servicio WCF con un servicio de flujo de trabajo WCF en WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-249">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="c7ff3-250">Servicio de tienda en línea</span><span class="sxs-lookup"><span data-stu-id="c7ff3-250">Online Store Service</span></span>

 <span data-ttu-id="c7ff3-251">Uno de los puntos fuertes de Windows Workflow Foundation es la capacidad de crear procesos mediante varios servicios.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-251">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="c7ff3-252">En este ejemplo, hay un servicio de tienda en línea que orquesta dos llamadas de servicio para realizar un pedido.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-252">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="c7ff3-253">El primer paso es validar el pedido utilizando un servicio de validación de pedidos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-253">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="c7ff3-254">El segundo paso es rellenar el pedido utilizando un servicio de almacén.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-254">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="c7ff3-255">Los dos servicios back-end, el servicio de validación de pedidos y el servicio de almacén, siguen siendo los mismos en ambas pruebas.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-255">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="c7ff3-256">La parte que cambia es el servicio de tienda en línea que realiza la orquestación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-256">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="c7ff3-257">En un caso, el servicio se codifica de forma manual como un servicio WCF.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-257">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="c7ff3-258">En el otro caso, el servicio se escribe como un servicio de flujo de trabajo WCF en WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-258">For the other case, the service is written as a WCF workflow service in WF4.</span></span> <span data-ttu-id="c7ff3-259">Las características específicas de [!INCLUDE[wf1](../../../includes/wf1-md.md)], como el seguimiento y la persistencia, se desactivan para esta prueba.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-259">[!INCLUDE[wf1](../../../includes/wf1-md.md)]-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="c7ff3-260">Entorno</span><span class="sxs-lookup"><span data-stu-id="c7ff3-260">Environment</span></span>

![Configuración del entorno para la medición del rendimiento](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="c7ff3-262">Las solicitudes del cliente se realizan al servicio de tienda en línea a través de HTTP desde varios equipos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-262">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="c7ff3-263">Un equipo único hospeda los tres servicios.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-263">A single computer hosts all three services.</span></span>  <span data-ttu-id="c7ff3-264">La capa de transporte entre el servicio de tienda en línea y los servicios back-end es TCP o HTTP.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-264">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="c7ff3-265">La medición de operaciones por segundo se basa en el número de llamadas a `PurchaseOrder` completadas realizadas al servicio de tienda en línea.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-265">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="c7ff3-266">La agrupación de canales es una nueva característica disponible en WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-266">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="c7ff3-267">En la parte WCF de esta agrupación de canales de prueba no se proporciona de forma integrada, por lo que se utilizó una implementación codificada a mano de una técnica de agrupación simple en el servicio de tienda en línea.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-267">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="c7ff3-268">Rendimiento</span><span class="sxs-lookup"><span data-stu-id="c7ff3-268">Performance</span></span>

![Gráfico de columnas que muestra el rendimiento del servicio de tienda en línea](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="c7ff3-270">La conexión de los servicios TCP back-end sin agrupación de canales hace que el servicio de [!INCLUDE[wf1](../../../includes/wf1-md.md)] tenga un impacto del 17,2% en el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-270">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="c7ff3-271">Con la agrupación de canales, la reducción es de aproximadamente el 23,8%.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-271">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="c7ff3-272">Para HTTP, el impacto es mucho menor: el 4,3% sin agrupación y el 8,1% con agrupación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-272">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="c7ff3-273">También es importante tener en cuenta que la agrupación de canales proporciona muy pocas ventajas cuando se utiliza HTTP.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-273">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="c7ff3-274">Aunque existe una sobrecarga del tiempo de ejecución de WF4 en comparación con un servicio WCF codificado de forma manual en esta prueba, se podría considerar un escenario en el peor de los casos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-274">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="c7ff3-275">Los dos servicios back-end de esta prueba realizan muy poco trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-275">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="c7ff3-276">En un escenario real de extremo a extremo, estos servicios realizarían operaciones más costosas, como llamadas de base de datos, con lo que el impacto en el rendimiento de la capa de transporte sería menos importante.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-276">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="c7ff3-277">Esto, más las ventajas de las características disponibles en WF4, hace de Workflow Foundation una opción viable para crear servicios de orquestación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-277">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="c7ff3-278">Consideraciones clave de rendimiento</span><span class="sxs-lookup"><span data-stu-id="c7ff3-278">Key Performance Considerations</span></span>

 <span data-ttu-id="c7ff3-279">Las áreas de características de esta sección, con la excepción de la interoperabilidad, han cambiado radicalmente entre WF3 y WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-279">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="c7ff3-280">Esto afecta al diseño de las aplicaciones de flujo de trabajo, así como al rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-280">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="c7ff3-281">Latencia de activación de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="c7ff3-281">Workflow Activation Latency</span></span>

 <span data-ttu-id="c7ff3-282">En una aplicación de servicio de flujo de trabajo WCF, la latencia para iniciar un nuevo flujo de trabajo o cargar un flujo de trabajo existente es importante, ya que se puede bloquear.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-282">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="c7ff3-283">Este caso de prueba mide un host XOML de WF3 en comparación con un host XAMLX de WF4 en un escenario típico.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-283">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="c7ff3-284">Configuración del entorno</span><span class="sxs-lookup"><span data-stu-id="c7ff3-284">Environment Setup</span></span>

 ![Configuración del entorno para pruebas de latencia y rendimiento](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="c7ff3-286">Configuración de prueba</span><span class="sxs-lookup"><span data-stu-id="c7ff3-286">Test Setup</span></span>

 <span data-ttu-id="c7ff3-287">En el escenario, un equipo cliente se pone en contacto con un servicio de flujo de trabajo WCF mediante la correlación basada en contexto.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-287">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="c7ff3-288">La correlación basada en contexto requiere un enlace de contexto especial y utiliza un encabezado de contexto o una cookie para relacionar los mensajes con la instancia de flujo de trabajo correcta.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-288">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="c7ff3-289">Tiene una mejora de rendimiento ya que el identificador de la correlación se encuentra en el encabezado del mensaje, por lo que no es necesario el análisis del cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-289">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="c7ff3-290">El servicio creará un nuevo flujo de trabajo con la solicitud y enviará una respuesta inmediata para que la medición de la latencia no incluya el tiempo empleado en la ejecución del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-290">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="c7ff3-291">El flujo de trabajo de WF3 es XOML con un código subyacente y el flujo de trabajo de WF4 es totalmente XAML.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-291">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="c7ff3-292">El flujo de trabajo de WF4 tiene el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-292">The WF4 workflow looks like this:</span></span>

 ![Flujo de trabajo del ámbito de correlación WF4](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="c7ff3-294">La actividad <xref:System.ServiceModel.Activities.Receive> crea la instancia del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-294">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="c7ff3-295">Un valor pasado al mensaje recibido se refleja en el mensaje de respuesta.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-295">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="c7ff3-296">Una secuencia que sigue a la respuesta contiene el resto del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-296">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="c7ff3-297">En el caso anterior, solo se muestra una actividad Comment.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-297">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="c7ff3-298">El número de actividades Comment se cambia para simular la complejidad del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-298">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="c7ff3-299">Una actividad de comentario es equivalente a una <xref:System.Workflow.Activities.CodeActivity> de WF3 que no realiza ningún trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-299">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="c7ff3-300">Para obtener más información sobre la actividad comment, vea la sección "comparación de rendimiento de nivel de componente", anteriormente en este artículo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-300">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="c7ff3-301">Resultados de pruebas</span><span class="sxs-lookup"><span data-stu-id="c7ff3-301">Test Results</span></span>

 <span data-ttu-id="c7ff3-302">Latencia pasiva y activa para los servicios de flujo de trabajo WCF:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-302">Cold and warm latency for WCF workflow services:</span></span>

 ![Gráfico de columnas que muestra una latencia fría y activa para los servicios de flujo de trabajo WCF mediante WF3 y WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="c7ff3-304">En el gráfico anterior, en frío se refiere al caso en el que no hay ningún <xref:System.ServiceModel.WorkflowServiceHost> para el flujo de trabajo determinado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-304">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="c7ff3-305">En otras palabras, la latencia en frío se produce cuando el flujo de trabajo se utiliza por primera vez y el XOML o el XAML deben compilarse.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-305">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="c7ff3-306">La latencia en caliente es el tiempo necesario para crear una nueva instancia de flujo de trabajo cuando el tipo de flujo de trabajo ya se ha compilado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-306">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="c7ff3-307">La complejidad del flujo de trabajo apenas si sufre diferencias en el caso de WF4, pero tiene una progresión lineal en el caso de WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-307">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="c7ff3-308">Rendimiento de la correlación</span><span class="sxs-lookup"><span data-stu-id="c7ff3-308">Correlation Throughput</span></span>

 <span data-ttu-id="c7ff3-309">WF4 introduce una nueva característica de correlación basada en contenido.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-309">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="c7ff3-310">WF3 proporcionaba solamente correlación basada en contexto.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-310">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="c7ff3-311">La correlación basada en contexto solo se puede realizar en enlaces de canal WCF concretos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-311">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="c7ff3-312">El identificador del flujo de trabajo se inserta en el encabezado del mensaje cuando se utilizan estos enlaces.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-312">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="c7ff3-313">El tiempo de ejecución de WF3 solo puede identificar un flujo de trabajo por su identificador.  Con la correlación basada en contenido, el autor del flujo de trabajo puede crear una clave de correlación fuera de una parte relevante de datos, como un número de cuenta o un identificador de cliente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-313">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="c7ff3-314">En la correlación basada en contexto hay un incremento de rendimiento ya que la clave de correlación se encuentra en el encabezado del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-314">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="c7ff3-315">La clave se puede leer desde el mensaje sin que sea necesaria la deserialización/copia del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-315">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="c7ff3-316">En la correlación basada en contenido, la clave de correlación se almacena en el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-316">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="c7ff3-317">Se utiliza una expresión XPath para buscar la clave.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-317">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="c7ff3-318">El costo de este procesamiento adicional depende del tamaño del mensaje, la profundidad de la clave en el cuerpo y el número de claves.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-318">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="c7ff3-319">Esta prueba compara la correlación basada en contexto con la correlación basada en contenido y también muestra el descenso del rendimiento cuando se utilizan varias claves.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-319">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="c7ff3-320">Configuración del entorno</span><span class="sxs-lookup"><span data-stu-id="c7ff3-320">Environment Setup</span></span>

![Configuración del entorno para la prueba de rendimiento del flujo de trabajo](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="c7ff3-322">Configuración de prueba</span><span class="sxs-lookup"><span data-stu-id="c7ff3-322">Test Setup</span></span>

<span data-ttu-id="c7ff3-323">![Prueba de flujo de trabajo del rendimiento de la correlación](./media/performance/correlation-throughput-workflow.gif "Configuración de la prueba de flujo de trabajo de rendimiento de correlación")</span><span class="sxs-lookup"><span data-stu-id="c7ff3-323">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="c7ff3-324">El flujo de trabajo anterior es el mismo que se usa en la sección de [persistencia](#persistence) .</span><span class="sxs-lookup"><span data-stu-id="c7ff3-324">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="c7ff3-325">En el caso de las pruebas de correlación sin persistencia, no hay ningún proveedor de persistencia instalado en el tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-325">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="c7ff3-326">La correlación se produce en dos lugares: CreateOrder y CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-326">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="c7ff3-327">Resultados de pruebas</span><span class="sxs-lookup"><span data-stu-id="c7ff3-327">Test Results</span></span>

<span data-ttu-id="c7ff3-328">![Rendimiento de la correlación](./media/performance/correlation-throughput-graph.gif "Gráfico de rendimiento de correlación")</span><span class="sxs-lookup"><span data-stu-id="c7ff3-328">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="c7ff3-329">Este gráfico muestra una disminución del rendimiento cuando aumenta el número de claves utilizadas en la correlación basada en contenido.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-329">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="c7ff3-330">La similitud de las curvas entre TCP y HTTP indica la sobrecarga asociada a estos protocolos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-330">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="c7ff3-331">Correlación con persistencia</span><span class="sxs-lookup"><span data-stu-id="c7ff3-331">Correlation with Persistence</span></span>

 <span data-ttu-id="c7ff3-332">Con un flujo de trabajo conservado, la presión de CPU debida a la correlación basada en contexto pasa del runtime de flujo de trabajo a la base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-332">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="c7ff3-333">Los procedimientos almacenados en el proveedor de persistencia de SQL realizan el trabajo de hacer coincidir las claves para buscar el flujo de trabajo adecuado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-333">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Gráfico de líneas que muestra los resultados de correlación y persistencia](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="c7ff3-335">La correlación basada en contexto es todavía más rápida que la correlación basada en contenido.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-335">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="c7ff3-336">Sin embargo, la diferencia es menos pronunciada, ya que la persistencia tiene un impacto mayor en el rendimiento que la correlación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-336">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="c7ff3-337">Rendimiento de un flujo de trabajo complejo</span><span class="sxs-lookup"><span data-stu-id="c7ff3-337">Complex Workflow Throughput</span></span>

 <span data-ttu-id="c7ff3-338">La complejidad de un flujo de trabajo no se mide solamente por el número de actividades.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-338">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="c7ff3-339">Las actividades compuestas pueden contener muchas actividades secundarias y esas actividades secundarias también pueden ser actividades compuestas.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-339">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="c7ff3-340">Según aumenta el número de niveles de anidamiento, también aumenta el número de actividades que pueden estar actualmente en estado de ejecución y el número de variables que pueden estar en este estado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-340">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="c7ff3-341">Esta prueba compara el rendimiento entre WF3 y WF4 cuando se ejecutan flujos de trabajo complejos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-341">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="c7ff3-342">Configuración de prueba</span><span class="sxs-lookup"><span data-stu-id="c7ff3-342">Test Setup</span></span>

 <span data-ttu-id="c7ff3-343">Estas pruebas se ejecutaron en un equipo de 4 vías con procesador Intel Xeon X5355, de 2,66 GHz y 4 GB de RAM que ejecuta Windows Server 2008 basado en x64.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-343">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="c7ff3-344">El código de prueba se ejecuta en un proceso único con un subproceso por núcleo para alcanzar el 100% de utilización de la CPU.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-344">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="c7ff3-345">Los flujos de trabajo generados para esta prueba tienen dos variables principales: la profundidad y el número de actividades en cada secuencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-345">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="c7ff3-346">Cada nivel de profundidad incluye una actividad paralela, un bucle While, decisiones, asignaciones y secuencias.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-346">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="c7ff3-347">En el diseñador de WF4 que se muestra más abajo, se representa el diagrama de flujo de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-347">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="c7ff3-348">Cada actividad de diagrama de flujo es similar al diagrama de flujo principal.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-348">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="c7ff3-349">Puede ser útil pensar en un fractal al representar este flujo de trabajo, donde la profundidad se limita a los parámetros de la prueba.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-349">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="c7ff3-350">El número de actividades en una prueba dada viene determinado por la profundidad y el número de actividades por secuencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-350">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="c7ff3-351">La siguiente ecuación calcula el número de actividades en la prueba de WF4:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-351">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Ecuación para calcular el número de actividades](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="c7ff3-353">El número de actividades en la prueba de WF3 se puede calcular con una ecuación algo diferente debido a una secuencia adicional:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-353">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Ecuación para calcular el número de actividades de WF3](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="c7ff3-355">Donde d es la profundidad y a es el número de actividades por secuencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-355">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="c7ff3-356">La lógica que subyace a estas ecuaciones es que la primera constante, multiplicada por a, es el número de secuencias y la segunda constante es el número estático de actividades en el nivel actual.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-356">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="c7ff3-357">Hay tres actividades secundarias de diagrama de flujo en cada diagrama de flujo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-357">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="c7ff3-358">En el nivel de profundidad inferior estos diagramas de flujo están vacíos, pero en los demás niveles hay copias del diagrama de flujo principal.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-358">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="c7ff3-359">El número de actividades en la definición de flujo de trabajo de cada variación de prueba se indica en la siguiente tabla:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-359">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Una tabla que muestra el número de actividades usadas en cada prueba](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="c7ff3-361">El número de actividades en la definición de flujo de trabajo aumenta claramente con cada nivel de profundidad.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-361">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="c7ff3-362">Pero solo una ruta por punto de decisión se ejecuta en una instancia de flujo de trabajo dada, por lo que solo se ejecuta un pequeño subconjunto de las actividades reales.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-362">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Diagrama de flujo del flujo de trabajo complejo de rendimiento](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="c7ff3-364">Se creó un flujo de trabajo equivalente para WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-364">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="c7ff3-365">El diseñador de WF3 muestra el flujo de trabajo completo en el área de diseño en lugar de anidarlo; por consiguiente, es demasiado extenso para mostrarlo en este tema.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-365">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="c7ff3-366">A continuación se muestra un fragmento de código del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-366">A snippet of the workflow is shown below.</span></span>

 ![Fragmento de diagrama del flujo de trabajo WF3](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="c7ff3-368">Para ejercer el anidamiento en un caso extremo, otro flujo de trabajo que forma parte de esta prueba utiliza 100 secuencias anidadas.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-368">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="c7ff3-369">En la secuencia más interna hay una actividad `Comment` o <xref:System.Workflow.Activities.CodeActivity> única.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-369">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Diagrama de flujo de una secuencia anidada](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="c7ff3-371">El seguimiento y la persistencia no se utilizan como parte de esta prueba.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-371">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="c7ff3-372">Resultados de pruebas</span><span class="sxs-lookup"><span data-stu-id="c7ff3-372">Test Results</span></span>

 ![Gráfico de columnas que muestra los resultados de rendimiento de rendimiento](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="c7ff3-374">Incluso con flujos de trabajo complejos con gran profundidad y un alto número de actividades, los resultados del rendimiento son coherentes con otras cifras mostradas anteriormente en este artículo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-374">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="c7ff3-375">El rendimiento de WF4 es más rápido en órdenes de magnitud y tiene que compararse en una escala logarítmica.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-375">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="c7ff3-376">Memoria</span><span class="sxs-lookup"><span data-stu-id="c7ff3-376">Memory</span></span>

 <span data-ttu-id="c7ff3-377">La sobrecarga de la memoria de Windows Workflow Foundation se mide en dos áreas clave: la complejidad del flujo de trabajo y el número de definiciones de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-377">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="c7ff3-378">Las mediciones de memoria se tomaron en una estación de trabajo de 64 bits con Windows 7.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-378">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="c7ff3-379">Hay muchas maneras de obtener la medición del tamaño del espacio de trabajo, como supervisar los contadores de rendimiento, sondear el entorno. WorkingSet o usar una herramienta como VMMap disponible en [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-379">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="c7ff3-380">Se utilizó una combinación de métodos para obtener y comprobar los resultados de cada prueba.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-380">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="c7ff3-381">Prueba de complejidad de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="c7ff3-381">Workflow Complexity Test</span></span>

 <span data-ttu-id="c7ff3-382">La prueba de complejidad de flujo de trabajo mide la diferencia del espacio de trabajo basándose en la complejidad del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-382">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="c7ff3-383">Además de los flujos de trabajo complejos utilizados en la sección anterior, las nuevas variaciones se agregan para cubrir dos casos básicos: un flujo de trabajo de una sola actividad y una secuencia con 1000 actividades.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-383">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="c7ff3-384">Para estas pruebas, los flujos de trabajo se inicializan y ejecutan hasta su finalización en un bucle serie único durante un período de un minuto.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-384">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="c7ff3-385">Cada variación de prueba se ejecuta tres veces y los datos registrados son la media de estas tres ejecuciones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-385">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="c7ff3-386">Las dos nuevas pruebas básicas tienen flujos de trabajo parecidos a los que se muestran a continuación:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-386">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Flujo de trabajo complejo para WF3 y WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="c7ff3-388">En el flujo de trabajo de WF3 mostrado más arriba, se utilizan actividades <xref:System.Workflow.Activities.CodeActivity> vacías.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-388">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="c7ff3-389">El flujo de trabajo de WF4 anterior utiliza actividades `Comment`.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-389">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="c7ff3-390">La actividad `Comment` se describió en la sección Comparaciones de rendimiento en el nivel de componente, anteriormente en este artículo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-390">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Gráfico de columnas que muestra el uso de memoria de flujo de trabajo complejo para flujos de trabajo de WF3 y WF4](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="c7ff3-392">Una de las tendencias claras que se observan en este gráfico es que el anidamiento tiene un impacto relativamente mínimo en el uso de memoria tanto en WF3 como en WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-392">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="c7ff3-393">El impacto en la memoria más significativo procede del número de actividades en un flujo de trabajo determinado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-393">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="c7ff3-394">Dados los datos de las variaciones de la secuencia 1000, la secuencia 5 de profundidad compleja 5 y la secuencia 1 de profundidad  compleja 7, es evidente que, a partir de la cifra de mil actividades, el aumento del uso de memoria se hace más apreciable.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-394">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="c7ff3-395">En el caso extremo (secuencia 1 de profundidad 7) donde hay 29.000 actividades aproximadamente, WF4 utiliza casi un 79% menos de memoria que WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-395">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="c7ff3-396">Prueba de varias definiciones de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="c7ff3-396">Multiple Workflow Definitions Test</span></span>

 <span data-ttu-id="c7ff3-397">La medición de memoria por cada definición de flujo de trabajo se divide en dos pruebas diferentes debido a las opciones disponibles para hospedar flujos de trabajo en WF3 y WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-397">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="c7ff3-398">La ejecución de estas pruebas se diferencia de la ejecución de la prueba de complejidad de flujo de trabajo en que se crean instancias de un flujo de trabajo determinado y se ejecutan solo una vez por definición.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-398">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="c7ff3-399">Esto se debe a que la definición de flujo de trabajo y su host permanecen en memoria durante la vigencia de AppDomain.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-399">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="c7ff3-400">La memoria utilizada en la ejecución de una instancia de flujo de trabajo determinada se debe limpiar durante la recolección de elementos no utilizados.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-400">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="c7ff3-401">La guía de migración de WF4 contiene información más detallada acerca de las opciones de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-401">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="c7ff3-402">Para obtener más información, vea [Guía de migración de WF: hospedaje de flujo de trabajo](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-402">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="c7ff3-403">La creación de muchas definiciones de flujo de trabajo para una prueba de definición de flujo de trabajo se puede realizar de varias maneras.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-403">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="c7ff3-404">Por ejemplo, se puede utilizar generación de código para crear un conjunto de 1000 flujos de trabajo idénticos excepto en el nombre y guardar cada uno de ellos en archivos independientes.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-404">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="c7ff3-405">Se adoptó este enfoque para la prueba hospedada en consola.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-405">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="c7ff3-406">En WF3, se utilizó la clase <xref:System.Workflow.Runtime.WorkflowRuntime> para ejecutar las definiciones de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-406">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="c7ff3-407">WF4 puede usar <xref:System.Activities.WorkflowApplication> para crear una única instancia de flujo de trabajo o usar directamente <xref:System.Activities.WorkflowInvoker> para ejecutar la actividad como si fuera una llamada al método.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-407">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="c7ff3-408"><xref:System.Activities.WorkflowApplication> es un host de una única instancia de flujo de trabajo y tiene una paridad de características más cercana a <xref:System.Workflow.Runtime.WorkflowRuntime> de modo que se usa en esta prueba.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-408"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="c7ff3-409">Cuando se hospedan flujos de trabajo en IIS, es posible utilizar <xref:System.Web.Hosting.VirtualPathProvider> para crear un nuevo <xref:System.ServiceModel.WorkflowServiceHost> en lugar de generar todos los archivos XAMLX o XOML.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-409">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="c7ff3-410"><xref:System.Web.Hosting.VirtualPathProvider>Controla la solicitud entrante y responde con un "archivo virtual" que se puede cargar desde una base de datos o, en este caso, generar sobre la marcha.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-410">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="c7ff3-411">Por consiguiente, no es necesario crear 1000 archivos físicos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-411">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="c7ff3-412">Las definiciones de flujo de trabajo utilizadas en la prueba de consola fueron flujos de trabajo secuenciales simples con una sola actividad.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-412">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="c7ff3-413">Esta actividad única fue una actividad <xref:System.Workflow.Activities.CodeActivity> vacía en el caso de WF3 y una actividad `Comment` en el caso de WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-413">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="c7ff3-414">El caso hospedado en IIS utilizó flujos de trabajo que empiezan en la recepción de un mensaje y finalizan en el envío de una respuesta:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-414">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="c7ff3-415">La siguiente imagen muestra un flujo de trabajo de WF3 con ReceiveActivity y un flujo de trabajo de WF4 con patrón de solicitud/respuesta:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-415">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Servicios de flujo de trabajo de WF3 y WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="c7ff3-417">En la tabla siguiente se muestra la diferencia en el espacio de trabajo entre una única definición de flujo de trabajo y definiciones 1001:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-417">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="c7ff3-418">Opciones de hospedaje</span><span class="sxs-lookup"><span data-stu-id="c7ff3-418">Hosting Options</span></span>|<span data-ttu-id="c7ff3-419">Incremento de espacio de trabajo de WF3</span><span class="sxs-lookup"><span data-stu-id="c7ff3-419">WF3 Working Set Delta</span></span>|<span data-ttu-id="c7ff3-420">Incremento de espacio de trabajo de WF4</span><span class="sxs-lookup"><span data-stu-id="c7ff3-420">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="c7ff3-421">Flujos de trabajo hospedados en aplicación de consola</span><span class="sxs-lookup"><span data-stu-id="c7ff3-421">Console Application Hosted Workflows</span></span>|<span data-ttu-id="c7ff3-422">18 MB</span><span class="sxs-lookup"><span data-stu-id="c7ff3-422">18 MB</span></span>|<span data-ttu-id="c7ff3-423">9 MB</span><span class="sxs-lookup"><span data-stu-id="c7ff3-423">9 MB</span></span>|
|<span data-ttu-id="c7ff3-424">Servicios de flujo de trabajo hospedados en IIS</span><span class="sxs-lookup"><span data-stu-id="c7ff3-424">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="c7ff3-425">446 MB</span><span class="sxs-lookup"><span data-stu-id="c7ff3-425">446 MB</span></span>|<span data-ttu-id="c7ff3-426">364 MB</span><span class="sxs-lookup"><span data-stu-id="c7ff3-426">364 MB</span></span>|

 <span data-ttu-id="c7ff3-427">El hospedaje de definiciones de flujo de trabajo en IIS consume mucha más memoria debido a <xref:System.ServiceModel.WorkflowServiceHost> , artefactos de servicio de WCF detallados y la lógica de procesamiento de mensajes asociada al host.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-427">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="c7ff3-428">Para el hospedaje en consola en WF3 los flujos de trabajo se implementaron en código, en lugar de XOML.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-428">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="c7ff3-429">En WF4, la opción predeterminada es usar XAML.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-429">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="c7ff3-430">El XAML se almacena como un recurso incrustado en el ensamblado y se compila en tiempo de ejecución para proporcionar la implementación del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-430">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="c7ff3-431">Hay alguna sobrecarga asociada a este proceso.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-431">There is some overhead associated with this process.</span></span>  <span data-ttu-id="c7ff3-432">Para realizar una comparación objetiva entre WF3 y WF4, se utilizaron flujos de trabajo codificados en lugar de XAML.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-432">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="c7ff3-433">A continuación se muestra un ejemplo de uno de los flujos de trabajo de WF4:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-433">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="c7ff3-434">Hay otros muchos factores que pueden afectar al consumo de memoria.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-434">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="c7ff3-435">Sigue siendo aplicable el mismo consejo para todos los programas administrados.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-435">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="c7ff3-436">En entornos hospedados en IIS, el objeto <xref:System.ServiceModel.WorkflowServiceHost> creado para una definición de flujo de trabajo permanece en memoria hasta que se recicla el grupo de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-436">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="c7ff3-437">Debe tenerse en cuenta este aspecto al escribir extensiones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-437">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="c7ff3-438">Además, es mejor evitar las variables "globales" (variables cuyo ámbito es el flujo de trabajo completo) y limitar el ámbito de las variables siempre que sea posible.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-438">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="c7ff3-439">Servicios de runtime de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="c7ff3-439">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="c7ff3-440">Persistencia</span><span class="sxs-lookup"><span data-stu-id="c7ff3-440">Persistence</span></span>

 <span data-ttu-id="c7ff3-441">WF3 y WF4 se proporcionan con un proveedor de persistencia de SQL.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-441">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="c7ff3-442">El proveedor de persistencia de SQL de WF3 es una implementación simple que serializa la instancia de flujo de trabajo y la almacena en un blob.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-442">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="c7ff3-443">Por esta razón, el rendimiento de este proveedor depende en gran medida del tamaño de la instancia de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-443">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="c7ff3-444">En WF3, el tamaño de las instancias podía aumentar por muchas razones, como se ha analizado anteriormente en este documento.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-444">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="c7ff3-445">Muchos clientes prefieren no utilizar el proveedor de persistencia de SQL predeterminado porque el almacenamiento de una instancia serializada en una base de datos no proporciona visibilidad en el estado del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-445">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="c7ff3-446">Para encontrar un flujo de trabajo determinado sin conocer su identificador, se tendría que deserializar cada instancia persistente y examinar el contenido.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-446">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="c7ff3-447">Muchos desarrolladores prefieren escribir sus propios proveedores de persistencia para superar este obstáculo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-447">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="c7ff3-448">El proveedor de persistencia de SQL de WF4 ha intentado solucionar algunas de estas cuestiones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-448">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="c7ff3-449">Las tablas de persistencia exponen cierto tipo de información como los marcadores activos y las propiedades que se pueden convertir.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-449">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="c7ff3-450">La nueva característica de correlación basada en contenido en WF4 no se comportaría correctamente utilizando el enfoque de persistencia de SQL de WF3, que ha impulsado algún cambio en la organización de la instancia de flujo de trabajo persistente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-450">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="c7ff3-451">Esto hace que el trabajo del proveedor de persistencia sea más complejo y provoca un esfuerzo adicional en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-451">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c7ff3-452">Configuración del entorno</span><span class="sxs-lookup"><span data-stu-id="c7ff3-452">Environment Setup</span></span>

![Configuración del entorno para la prueba de rendimiento del flujo de trabajo](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="c7ff3-454">Configuración de prueba</span><span class="sxs-lookup"><span data-stu-id="c7ff3-454">Test Setup</span></span>

 <span data-ttu-id="c7ff3-455">Incluso con un conjunto de características mejorado y un control de simultaneidad superior, el proveedor de persistencia de SQL en WF4 es más rápido que el proveedor en WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-455">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="c7ff3-456">Para ilustrar esta afirmación, a continuación se comparan dos flujos de trabajo que realizan fundamentalmente las mismas operaciones en WF3 y WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-456">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Flujo de trabajo de persistencia en WF3 a la izquierda y WF4 a la derecha](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="c7ff3-458">Los dos flujos de trabajo los crea un mensaje recibido.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-458">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="c7ff3-459">Después de enviar una respuesta inicial, el flujo de trabajo se conserva.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-459">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="c7ff3-460">En el caso de WF3, se utiliza una actividad <xref:System.Workflow.ComponentModel.TransactionScopeActivity> vacía para iniciar la persistencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-460">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="c7ff3-461">Lo mismo se puede lograr en WF3 marcando una actividad como "conservar al cerrar".</span><span class="sxs-lookup"><span data-stu-id="c7ff3-461">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="c7ff3-462">Un segundo mensaje correlacionado completa el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-462">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="c7ff3-463">Los flujos de trabajo se conservan pero no se descargan.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-463">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="c7ff3-464">Resultados de pruebas</span><span class="sxs-lookup"><span data-stu-id="c7ff3-464">Test Results</span></span>

 ![Gráfico de columnas que muestra la persistencia de rendimiento](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="c7ff3-466">Cuando el transporte entre el cliente y el nivel intermedio es HTTP, la persistencia en WF4 mejora 2,6 veces más.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-466">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="c7ff3-467">El transporte TCP aumenta ese valor hasta 3 veces más.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-467">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="c7ff3-468">En todos los casos, la utilización de la CPU en el nivel intermedio es del 98% o un valor superior.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-468">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="c7ff3-469">La razón de que el rendimiento de WF4 sea mayor se debe a que el runtime de flujo de trabajo es más rápido.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-469">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="c7ff3-470">El tamaño de la instancia serializada es bajo en ambos casos y no es un elemento de gran contribución en esta situación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-470">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="c7ff3-471">Los flujos de trabajo de WF4 y WF3 en esta prueba utilizan una actividad para indicar explícitamente cuándo debe producirse la persistencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-471">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="c7ff3-472">Esto tiene la ventaja de que el flujo de trabajo se conserva sin descargarlo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-472">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="c7ff3-473">En WF3, también es posible la persistencia utilizando la característica <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>, pero en este caso se descarga la instancia de flujo de trabajo de la memoria.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-473">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="c7ff3-474">Si un desarrollador que utiliza WF3 desea asegurarse de que un flujo de trabajo se conserva en determinados puntos, tiene que modificar la definición de flujo de trabajo o pagar el costo de descargar y volver a cargar la instancia de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-474">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="c7ff3-475">Una nueva característica de WF4 hace posible la persistencia sin descargar: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-475">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="c7ff3-476">Esta característica permite que la instancia de flujo de trabajo se conserve en estado inactivo, pero permanezca en memoria hasta que se satisfaga el umbral de <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> o se reanude la ejecución.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-476">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="c7ff3-477">Observe que el proveedor de persistencia de SQL de WF4 realiza más trabajo en el nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-477">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="c7ff3-478">La base de datos SQL puede convertirse en un cuello de botella, por lo que es importante supervisar el uso de CPU y disco en ella.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-478">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="c7ff3-479">Asegúrese de incluir los siguientes contadores de rendimiento de la base de datos SQL al realizar la prueba de rendimiento de las aplicaciones de flujo de trabajo:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-479">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="c7ff3-480">\\% De tiempo de lectura de disco de DiscoFísico</span><span class="sxs-lookup"><span data-stu-id="c7ff3-480">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="c7ff3-481">\\% De tiempo de disco</span><span class="sxs-lookup"><span data-stu-id="c7ff3-481">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="c7ff3-482">\\% De tiempo de escritura de disco de DiscoFísico</span><span class="sxs-lookup"><span data-stu-id="c7ff3-482">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="c7ff3-483">\\Longitud media de la cola de disco físico</span><span class="sxs-lookup"><span data-stu-id="c7ff3-483">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="c7ff3-484">Disco físico\Media de longitud de cola de lectura de disco</span><span class="sxs-lookup"><span data-stu-id="c7ff3-484">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="c7ff3-485">Disco físico\Media de longitud de cola de escritura de disco</span><span class="sxs-lookup"><span data-stu-id="c7ff3-485">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="c7ff3-486">Disco físico\Longitud de cola de disco actual</span><span class="sxs-lookup"><span data-stu-id="c7ff3-486">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="c7ff3-487">% De tiempo de procesador de información de procesador \\</span><span class="sxs-lookup"><span data-stu-id="c7ff3-487">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="c7ff3-488">Bloqueos temporales de SQL\Media de tiempo de espera de bloqueo temporal (ms)</span><span class="sxs-lookup"><span data-stu-id="c7ff3-488">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="c7ff3-489">Bloqueos temporales de SQL\Esperas de bloqueo temporal por segundo</span><span class="sxs-lookup"><span data-stu-id="c7ff3-489">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="c7ff3-490">Seguimiento</span><span class="sxs-lookup"><span data-stu-id="c7ff3-490">Tracking</span></span>

 <span data-ttu-id="c7ff3-491">El seguimiento de flujo de trabajo se puede utilizar para realizar el seguimiento del progreso de un flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-491">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="c7ff3-492">La información incluida en los eventos de seguimiento la determina un perfil de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-492">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="c7ff3-493">Cuanto más complejo sea el perfil de seguimiento, más costoso será el seguimiento.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-493">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="c7ff3-494">WF3 se proporcionó con un servicio de seguimiento basado en SQL.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-494">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="c7ff3-495">Este servicio podía funcionar en modo por lotes y en modo sin lotes.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-495">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="c7ff3-496">En el modo sin lotes, los eventos de seguimiento se escriben directamente en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-496">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="c7ff3-497">En modo por lotes, los eventos de seguimiento se recopilan en el mismo lote como estado de instancia de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-497">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="c7ff3-498">El modo por lotes tiene el máximo rendimiento para la gama más amplia de diseños de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-498">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="c7ff3-499">Sin embargo, el procesamiento por lotes puede tener un impacto negativo en el rendimiento si el flujo de trabajo ejecuta muchas actividades sin persistencia y se realiza un seguimiento de esas actividades.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-499">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="c7ff3-500">Esto sucedería normalmente en los bucles y la mejor manera de evitar este escenario es diseñar bucles grandes para que contengan un punto de persistencia.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-500">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="c7ff3-501">La introducción de un punto de persistencia en un bucle también puede afectar negativamente al rendimiento, por lo que es importante medir los costos de cada uno y lograr un equilibrio.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-501">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="c7ff3-502">WF4 no se proporciona con un servicio de seguimiento de SQL.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-502">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="c7ff3-503">La grabación de información de seguimiento en una base de datos SQL se puede administrar mejor desde un servidor de aplicaciones en lugar de integrarse en el .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-503">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="c7ff3-504">Por lo tanto, el seguimiento de SQL lo controla ahora AppFabric.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-504">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="c7ff3-505">El proveedor de seguimiento para uso inmediato en WF4 está basado en el Seguimiento de eventos para Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-505">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="c7ff3-506">ETW es un sistema de eventos de baja latencia en el nivel de kernel integrado en Windows.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-506">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="c7ff3-507">Utiliza un modelo de proveedor/consumidor que permite que solo exista sanción en el seguimiento de eventos cuando haya realmente un consumidor.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-507">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="c7ff3-508">Además de los eventos de kernel como procesador, disco, memoria y uso de red, muchas aplicaciones también se benefician de las ventajas de ETW.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-508">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="c7ff3-509">Los eventos ETW son más eficaces que los contadores de rendimiento porque los eventos se pueden personalizar para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-509">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="c7ff3-510">Un evento puede contener texto, como un identificador de flujo de trabajo o un mensaje informativo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-510">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="c7ff3-511">Además, los eventos se categorizan con máscaras de bits, por lo que la utilización de un determinado subconjunto de eventos tendrá un impacto menor en el rendimiento que la captura de todos los eventos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-511">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="c7ff3-512">Estas son algunas de las ventajas del enfoque de utilizar ETW en lugar de SQL para el seguimiento:</span><span class="sxs-lookup"><span data-stu-id="c7ff3-512">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="c7ff3-513">La recopilación de eventos de seguimiento se puede separar a otro proceso.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-513">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="c7ff3-514">Esto proporciona mayor flexibilidad en la forma de grabar los eventos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-514">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="c7ff3-515">Los eventos de seguimiento de ETW se combinan fácilmente con los eventos ETW de WCF u otros proveedores de ETW, como un SQL Server o un proveedor de kernel.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-515">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="c7ff3-516">Los autores de flujos de trabajo no necesitan modificar un flujo de trabajo para trabajar mejor con una implementación de seguimiento en particular, como el modo por lotes del servicio de seguimiento de SQL de WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-516">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="c7ff3-517">Un administrador puede activar o desactivar el seguimiento sin reciclar el proceso de host.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-517">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="c7ff3-518">Las ventajas en cuanto a rendimiento para el seguimiento ETW plantean una desventaja.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-518">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="c7ff3-519">Los eventos ETW se pueden perder si el sistema está sometido a una intensa presión de recursos.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-519">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="c7ff3-520">El procesamiento de eventos no puede bloquear la ejecución normal de programas y, por consiguiente, no se garantiza que todos los eventos ETW se difundan a sus suscriptores.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-520">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="c7ff3-521">Esto hace que el seguimiento ETW sea apropiado para la supervisión de estado pero no para el proceso de auditoría.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-521">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="c7ff3-522">WF4 no tiene un proveedor de seguimiento de SQL, pero AppFabric sí lo tiene.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-522">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="c7ff3-523">El enfoque de seguimiento de SQL de AppFabric es la suscripción a eventos ETW con un servicio de Windows que procesa por lotes los eventos y los escribe en una tabla SQL diseñada para inserciones rápidas.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-523">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="c7ff3-524">Un trabajo independiente descarga los datos de esta tabla y los reforma en tablas de informes que se pueden ver en el panel de AppFabric.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-524">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="c7ff3-525">Esto significa que un lote de eventos de seguimiento se controla con independencia del flujo de trabajo del que procede y, por consiguiente, no tiene que esperar un punto de persistencia antes de su grabación.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-525">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="c7ff3-526">Los eventos ETW se pueden grabar con herramientas como logman o xperf.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-526">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="c7ff3-527">El archivo ETL compacto puede verse con una herramienta como xperfview o convertirse a un formato más legible, como XML, con tracerpt.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-527">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="c7ff3-528">En WF3, la única opción para obtener los eventos de seguimiento sin una base de datos SQL es crear un servicio de seguimiento personalizado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-528">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="c7ff3-529">Para obtener más información sobre ETW, vea [servicios WCF y seguimiento de eventos para Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) y [seguimiento de eventos: aplicaciones Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-529">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="c7ff3-530">La habilitación del seguimiento de flujo de trabajo influirá en el rendimiento de diversas maneras.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-530">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="c7ff3-531">El banco de pruebas que figura más abajo utiliza la herramienta logman para usar los eventos de seguimiento de ETW y grabarlos en un archivo ETL.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-531">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="c7ff3-532">El costo del seguimiento de SQL en AppFabric no pertenece al ámbito de este artículo.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-532">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="c7ff3-533">El perfil de seguimiento básico, que también se utiliza en AppFabric, se muestra en este banco de pruebas.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-533">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="c7ff3-534">También se incluye el costo de realizar solamente el seguimiento de los eventos de supervisión de estado.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-534">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="c7ff3-535">Estos eventos son útiles para la solución de problemas y la determinación del rendimiento medio del sistema.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-535">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c7ff3-536">Configuración del entorno</span><span class="sxs-lookup"><span data-stu-id="c7ff3-536">Environment Setup</span></span>

 ![Configuración del entorno para la prueba de rendimiento del flujo de trabajo](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="c7ff3-538">Resultados de pruebas</span><span class="sxs-lookup"><span data-stu-id="c7ff3-538">Test Results</span></span>

 ![Gráfico de columnas que muestra los costos de seguimiento de flujo de trabajo](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="c7ff3-540">La supervisión de estado tiene un impacto en el rendimiento de un 3%, aproximadamente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-540">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="c7ff3-541">El costo del perfil básico se sitúa en torno al 8%.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-541">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="c7ff3-542">Interop</span><span class="sxs-lookup"><span data-stu-id="c7ff3-542">Interop</span></span>

 <span data-ttu-id="c7ff3-543">WF4 es prácticamente una nueva escritura completa de [!INCLUDE[wf1](../../../includes/wf1-md.md)] y, por consiguiente, los flujos de trabajo y actividades de WF3 no son directamente compatibles con WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-543">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="c7ff3-544">Muchos clientes que adoptaron Windows Workflow Foundation temprano tendrán definiciones de flujo de trabajo internas o de terceros y actividades personalizadas para WF3.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-544">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="c7ff3-545">Una forma de facilitar la transición a WF4 es utilizar la actividad Interop, que puede ejecutar actividades de WF3 desde un flujo de trabajo de WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-545">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="c7ff3-546">Se recomienda que la actividad <xref:System.Activities.Statements.Interop> solo se use cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-546">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="c7ff3-547">Para obtener más información sobre cómo migrar a WF4, consulte la [Guía de migración de WF4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="c7ff3-547">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c7ff3-548">Configuración del entorno</span><span class="sxs-lookup"><span data-stu-id="c7ff3-548">Environment Setup</span></span>

 ![Configuración del entorno para la prueba de rendimiento del flujo de trabajo](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="c7ff3-550">Resultados de pruebas</span><span class="sxs-lookup"><span data-stu-id="c7ff3-550">Test Results</span></span>

<span data-ttu-id="c7ff3-551">En la tabla siguiente se muestran los resultados de la ejecución de un flujo de trabajo que contiene cinco actividades en una secuencia en varias configuraciones.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-551">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="c7ff3-552">Prueba</span><span class="sxs-lookup"><span data-stu-id="c7ff3-552">Test</span></span>|<span data-ttu-id="c7ff3-553">Rendimiento (flujos de trabajo/segundo)</span><span class="sxs-lookup"><span data-stu-id="c7ff3-553">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="c7ff3-554">Secuencia de WF3 en runtime de WF3</span><span class="sxs-lookup"><span data-stu-id="c7ff3-554">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="c7ff3-555">1,576</span><span class="sxs-lookup"><span data-stu-id="c7ff3-555">1,576</span></span>|
|<span data-ttu-id="c7ff3-556">Secuencia de WF3 en runtime de WF4 utilizando Interop</span><span class="sxs-lookup"><span data-stu-id="c7ff3-556">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="c7ff3-557">2,745</span><span class="sxs-lookup"><span data-stu-id="c7ff3-557">2,745</span></span>|
|<span data-ttu-id="c7ff3-558">Secuencia de WF4</span><span class="sxs-lookup"><span data-stu-id="c7ff3-558">WF4 Sequence</span></span>|<span data-ttu-id="c7ff3-559">153,582</span><span class="sxs-lookup"><span data-stu-id="c7ff3-559">153,582</span></span>|

 <span data-ttu-id="c7ff3-560">Se observa un aumento notable de rendimiento cuando se utiliza Interop en WF3 directamente.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-560">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="c7ff3-561">Sin embargo, cuando se compara con las actividades de WF4, el aumento es insignificante.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-561">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="c7ff3-562">Resumen</span><span class="sxs-lookup"><span data-stu-id="c7ff3-562">Summary</span></span>

 <span data-ttu-id="c7ff3-563">Las inversiones relevantes en rendimiento para WF4 han dado buenos resultados en muchas áreas cruciales.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-563">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="c7ff3-564">El rendimiento de cada componente de flujo de trabajo es, en algunos casos, cien veces mayor en cuanto a rapidez en WF4 si se compara con WF3; la causa es un runtime [!INCLUDE[wf1](../../../includes/wf1-md.md)] más ligero.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-564">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="c7ff3-565">Las cifras de latencia también son significativamente mejores.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-565">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="c7ff3-566">Esto significa que la penalización de rendimiento por el uso de en [!INCLUDE[wf1](../../../includes/wf1-md.md)] oposición a los servicios de orquestación WCF de codificación manual es muy pequeña teniendo en cuenta las ventajas adicionales de usar [!INCLUDE[wf1](../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="c7ff3-566">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="c7ff3-567">El rendimiento de persistencia ha aumentado en un factor comprendido entre 2,5 y 3,0.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-567">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="c7ff3-568">La sobrecarga de la supervisión de estado por medio del seguimiento de flujo de trabajo es ahora muy pequeña.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-568">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="c7ff3-569">Hay disponible un conjunto completo de guías de migración para quienes están considerando la posibilidad de cambiar de WF3 a WF4.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-569">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="c7ff3-570">Todo esto hace que WF4 sea una opción atractiva para escribir aplicaciones complejas.</span><span class="sxs-lookup"><span data-stu-id="c7ff3-570">All of this should make WF4 an attractive option for writing complex applications.</span></span>
