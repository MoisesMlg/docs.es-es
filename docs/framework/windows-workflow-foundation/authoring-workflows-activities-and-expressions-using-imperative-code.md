---
title: Crear flujos de trabajo, actividades y expresiones mediante código imperativo
description: Una definición de flujo de trabajo de Workflow Foundation es un árbol de objetos de actividad configurados. Use código para crear definiciones de flujo de trabajo, actividades y expresiones.
ms.date: 03/30/2017
ms.assetid: cefc9cfc-2882-4eb9-8c94-7a6da957f2b2
ms.openlocfilehash: 5355f2090317a0bce3fec0f46550b202bd0af095
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289131"
---
# <a name="authoring-workflows-activities-and-expressions-using-imperative-code"></a><span data-ttu-id="7919e-104">Crear flujos de trabajo, actividades y expresiones mediante código imperativo</span><span class="sxs-lookup"><span data-stu-id="7919e-104">Authoring Workflows, Activities, and Expressions Using Imperative Code</span></span>

<span data-ttu-id="7919e-105">Una definición de flujo de trabajo es un árbol de objetos de actividad configurados.</span><span class="sxs-lookup"><span data-stu-id="7919e-105">A workflow definition is a tree of configured activity objects.</span></span> <span data-ttu-id="7919e-106">Este árbol de actividades se puede definir de muchas maneras, incluido XAML editado a mano o el uso del Diseñador de flujo de trabajo para generar XAML.</span><span class="sxs-lookup"><span data-stu-id="7919e-106">This tree of activities can be defined many ways, including by hand-editing XAML or by using the Workflow Designer to produce XAML.</span></span> <span data-ttu-id="7919e-107">El uso de XAML, sin embargo, no es un requisito.</span><span class="sxs-lookup"><span data-stu-id="7919e-107">Use of XAML, however, is not a requirement.</span></span> <span data-ttu-id="7919e-108">También se pueden crear definiciones de flujo de trabajo mediante programación.</span><span class="sxs-lookup"><span data-stu-id="7919e-108">Workflow definitions can also be created programmatically.</span></span> <span data-ttu-id="7919e-109">Este tema proporciona información general sobre cómo crear definiciones de flujo de trabajo, actividades y expresiones mediante código.</span><span class="sxs-lookup"><span data-stu-id="7919e-109">This topic provides an overview of creating workflow definitions, activities, and expressions by using code.</span></span> <span data-ttu-id="7919e-110">Para obtener ejemplos de cómo trabajar con flujos de trabajo de XAML mediante código, vea [serializar flujos de trabajo y actividades a y desde XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-110">For examples of working with XAML workflows using code, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
## <a name="creating-workflow-definitions"></a><span data-ttu-id="7919e-111">Crear definiciones de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="7919e-111">Creating Workflow Definitions</span></span>  

 <span data-ttu-id="7919e-112">Se puede crear una definición de flujo de trabajo creando instancias de un tipo de actividad y configurando las propiedades del objeto de la actividad.</span><span class="sxs-lookup"><span data-stu-id="7919e-112">A workflow definition can be created by instantiating an instance of an activity type and configuring the activity object’s properties.</span></span> <span data-ttu-id="7919e-113">En el caso de actividades que no contengan actividades secundarias, puede llevarse a cabo con algunas líneas de código.</span><span class="sxs-lookup"><span data-stu-id="7919e-113">For activities that do not contain child activities, this can be accomplished using a few lines of code.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#47](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#47)]  
  
> [!NOTE]
> <span data-ttu-id="7919e-114">En los ejemplos de este tema se usa <xref:System.Activities.WorkflowInvoker> para ejecutar los flujos de trabajo de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="7919e-114">The examples in this topic use <xref:System.Activities.WorkflowInvoker> to run the sample workflows.</span></span> <span data-ttu-id="7919e-115">Para obtener más información sobre cómo invocar flujos de trabajo, pasar argumentos y las distintas opciones de hospedaje que están disponibles, vea [uso de WorkflowInvoker y WorkflowApplication](using-workflowinvoker-and-workflowapplication.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-115">For more information about invoking workflows, passing arguments, and the different hosting choices that are available, see [Using WorkflowInvoker and WorkflowApplication](using-workflowinvoker-and-workflowapplication.md).</span></span>  
  
 <span data-ttu-id="7919e-116">En este ejemplo se crea un flujo de trabajo que consta de una única actividad <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="7919e-116">In this example, a workflow that consists of a single <xref:System.Activities.Statements.WriteLine> activity is created.</span></span> <span data-ttu-id="7919e-117">Se establece el argumento <xref:System.Activities.Statements.WriteLine> de la actividad <xref:System.Activities.Statements.WriteLine.Text%2A> y se invoca el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-117">The <xref:System.Activities.Statements.WriteLine> activity’s <xref:System.Activities.Statements.WriteLine.Text%2A> argument is set, and the workflow is invoked.</span></span> <span data-ttu-id="7919e-118">Si una actividad contiene actividades secundarias, el método de construcción es similar.</span><span class="sxs-lookup"><span data-stu-id="7919e-118">If an activity contains child activities, the method of construction is similar.</span></span> <span data-ttu-id="7919e-119">En el siguiente ejemplo se usa una actividad <xref:System.Activities.Statements.Sequence> que contiene dos actividades <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="7919e-119">The following example uses a <xref:System.Activities.Statements.Sequence> activity that contains two <xref:System.Activities.Statements.WriteLine> activities.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#48](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#48)]  
  
### <a name="using-object-initializers"></a><span data-ttu-id="7919e-120">Usar inicializadores de objeto</span><span class="sxs-lookup"><span data-stu-id="7919e-120">Using Object Initializers</span></span>  

 <span data-ttu-id="7919e-121">Los ejemplos de este tema usan la sintaxis de inicialización del objeto.</span><span class="sxs-lookup"><span data-stu-id="7919e-121">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="7919e-122">Esta sintaxis puede ser una forma útil de crear definiciones de flujo de trabajo en el código porque proporciona una vista jerárquica de las actividades en el flujo de trabajo y muestra la relación entre las actividades.</span><span class="sxs-lookup"><span data-stu-id="7919e-122">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="7919e-123">No hay ningún requisito para usar la sintaxis de inicialización de objeto al crear los flujos de trabajo mediante programación.</span><span class="sxs-lookup"><span data-stu-id="7919e-123">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="7919e-124">El ejemplo siguiente es equivalente en su funcionamiento al ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="7919e-124">The following example is functionally equivalent to the previous example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#49](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#49)]  
  
 <span data-ttu-id="7919e-125">Para obtener más información sobre los inicializadores de objeto, vea [Cómo: inicializar objetos sin llamar a un constructor (Guía de programación de C#)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) y [Cómo: declarar un objeto usando un inicializador de objeto](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-125">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) and [How to: Declare an Object by Using an Object Initializer](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span></span>  
  
### <a name="working-with-variables-literal-values-and-expressions"></a><span data-ttu-id="7919e-126">Trabajar con variables, valores literales y expresiones</span><span class="sxs-lookup"><span data-stu-id="7919e-126">Working with Variables, Literal Values, and Expressions</span></span>  

 <span data-ttu-id="7919e-127">Al crear una definición de flujo de trabajo mediante código, tenga en cuenta qué código se ejecuta como parte de la creación de la definición de flujo de trabajo y qué código se ejecuta como parte de la ejecución de una instancia de ese flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-127">When creating a workflow definition using code, be aware of what code executes as part of the creation of the workflow definition and what code executes as part of the execution of an instance of that workflow.</span></span> <span data-ttu-id="7919e-128">Por ejemplo, el siguiente flujo de trabajo está pensado para generar un número aleatorio y escribirlo en la consola.</span><span class="sxs-lookup"><span data-stu-id="7919e-128">For example, the following workflow is intended to generate a random number and write it to the console.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#50](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#50)]  
  
 <span data-ttu-id="7919e-129">Cuando se ejecuta este código de definición de flujo de trabajo, se realiza la llamada a `Random.Next` y el resultado se almacena en la definición de flujo de trabajo como un valor literal.</span><span class="sxs-lookup"><span data-stu-id="7919e-129">When this workflow definition code is executed, the call to `Random.Next` is made and the result is stored in the workflow definition as a literal value.</span></span> <span data-ttu-id="7919e-130">Se pueden invocar muchas instancias de este flujo de trabajo y todas mostrarían el mismo número.</span><span class="sxs-lookup"><span data-stu-id="7919e-130">Many instances of this workflow can be invoked, and all would display the same number.</span></span> <span data-ttu-id="7919e-131">Para que la generación de números aleatorios se produzcan durante la ejecución del flujo de trabajo, se debe usar una expresión que se evalúa con caja ejecución del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-131">To have the random number generation occur during workflow execution, an expression must be used that is evaluated each time the workflow runs.</span></span> <span data-ttu-id="7919e-132">En el ejemplo siguiente, se usa una expresión de Visual Basic con <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span><span class="sxs-lookup"><span data-stu-id="7919e-132">In the following example, a Visual Basic expression is used with a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="7919e-133">La expresión del ejemplo anterior también se puede implementar mediante <xref:Microsoft.CSharp.Activities.CSharpValue%601> y una expresión de C#.</span><span class="sxs-lookup"><span data-stu-id="7919e-133">The expression in the previous example could also be implemented using a <xref:Microsoft.CSharp.Activities.CSharpValue%601> and a C# expression.</span></span>  
  
```csharp  
new Assign<int>  
{  
    To = n,  
    Value = new CSharpValue<int>("new Random().Next(1, 101)")  
}  
```  
  
 <span data-ttu-id="7919e-134">Es necesario compilar las expresiones de C# antes de que se invoque el flujo de trabajo que las contiene.</span><span class="sxs-lookup"><span data-stu-id="7919e-134">C# expressions must be compiled before the workflow containing them is invoked.</span></span> <span data-ttu-id="7919e-135">Si las expresiones de C# no se compilan, <xref:System.NotSupportedException> se produce una excepción cuando se invoca el flujo de trabajo con un mensaje similar al siguiente: ``Expression Activity type 'CSharpValue`1' requires compilation in order to run.  Please ensure that the workflow has been compiled.`` en la mayoría de los escenarios que implican flujos de trabajo creados en Visual Studio, las expresiones de c# se compilan automáticamente, pero en algunos escenarios, como los flujos de trabajo de código, las expresiones de c# deben compilarse manualmente.</span><span class="sxs-lookup"><span data-stu-id="7919e-135">If the C# expressions are not compiled, a <xref:System.NotSupportedException> is thrown when the workflow is invoked with a message similar to the following: ``Expression Activity type 'CSharpValue`1' requires compilation in order to run.  Please ensure that the workflow has been compiled.`` In most scenarios involving workflows created in Visual Studio the C# expressions are compiled automatically, but in some scenarios, such as code workflows, the C# expressions must be manually compiled.</span></span> <span data-ttu-id="7919e-136">Para obtener un ejemplo de cómo compilar expresiones de C#, consulte la sección [uso de expresiones de c# en flujos de trabajo de código](csharp-expressions.md#CodeWorkflows) del tema expresiones de [c#](csharp-expressions.md) .</span><span class="sxs-lookup"><span data-stu-id="7919e-136">For an example of how to compile C# expressions, see the [Using C# expressions in code workflows](csharp-expressions.md#CodeWorkflows) section of the [C# Expressions](csharp-expressions.md) topic.</span></span>  
  
 <span data-ttu-id="7919e-137"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> representa una expresión en la sintaxis de Visual Basic que se puede usar como valor r en una expresión y <xref:Microsoft.CSharp.Activities.CSharpValue%601> representa una expresión en la sintaxis de C# que se puede usar como valor r en una expresión.</span><span class="sxs-lookup"><span data-stu-id="7919e-137">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> represents an expression in Visual Basic syntax that can be used as an r-value in an expression, and a <xref:Microsoft.CSharp.Activities.CSharpValue%601> represents an expression in C# syntax that can be used as an r-value in an expression.</span></span> <span data-ttu-id="7919e-138">Se evalúan estas expresiones cada vez que se ejecuta la actividad que contienen.</span><span class="sxs-lookup"><span data-stu-id="7919e-138">These expressions are evaluated each time the containing activity is executed.</span></span> <span data-ttu-id="7919e-139">El resultado de la expresión se asigna a la variable de flujo de trabajo `n`. La actividad siguiente usa estos resultados en el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-139">The result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="7919e-140">Para tener acceso al valor de la variable de flujo de trabajo `n` en el tiempo de ejecución, se necesita <xref:System.Activities.ActivityContext>.</span><span class="sxs-lookup"><span data-stu-id="7919e-140">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="7919e-141">Se puede tener acceso a esto con la siguiente expresión lambda.</span><span class="sxs-lookup"><span data-stu-id="7919e-141">This can be accessed by using the following lambda expression.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7919e-142">Observe que ambos códigos son ejemplos que usan C# como lenguaje de programación, pero uno emplea <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> y el otro <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span><span class="sxs-lookup"><span data-stu-id="7919e-142">Note that both of these code are examples are using C# as the programming language, but one uses a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and one uses a <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span></span> <span data-ttu-id="7919e-143"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> y <xref:Microsoft.CSharp.Activities.CSharpValue%601> se pueden usar en los proyectos de Visual Basic y C#.</span><span class="sxs-lookup"><span data-stu-id="7919e-143"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and <xref:Microsoft.CSharp.Activities.CSharpValue%601> can be used in both Visual Basic and C# projects.</span></span> <span data-ttu-id="7919e-144">De forma predeterminada, las expresiones creadas en el diseñador de flujo de trabajo coinciden con el lenguaje del proyecto de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="7919e-144">By default, expressions created in the workflow designer match the language of the hosting project.</span></span> <span data-ttu-id="7919e-145">Al crear flujos de trabajo en código, el lenguaje deseado está a discreción del autor del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-145">When creating workflows in code, the desired language is at the discretion of the workflow author.</span></span>  
  
 <span data-ttu-id="7919e-146">En estos ejemplos, el resultado de la expresión se asigna a la variable de flujo de trabajo `n`. La actividad siguiente usa estos resultados en el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-146">In these examples the result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="7919e-147">Para tener acceso al valor de la variable de flujo de trabajo `n` en el tiempo de ejecución, se necesita <xref:System.Activities.ActivityContext>.</span><span class="sxs-lookup"><span data-stu-id="7919e-147">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="7919e-148">Se puede tener acceso a esto con la siguiente expresión lambda.</span><span class="sxs-lookup"><span data-stu-id="7919e-148">This can be accessed by using the following lambda expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#52](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#52)]  
  
 <span data-ttu-id="7919e-149">Para obtener más información sobre las expresiones lambda, vea [expresiones lambda (referencia de C#)](../../csharp/language-reference/operators/lambda-expressions.md) o [expresiones lambda (Visual Basic)](../../visual-basic/programming-guide/language-features/procedures/lambda-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-149">For more information about lambda expressions, see [Lambda Expressions (C# reference)](../../csharp/language-reference/operators/lambda-expressions.md) or [Lambda Expressions (Visual Basic)](../../visual-basic/programming-guide/language-features/procedures/lambda-expressions.md).</span></span>  
  
 <span data-ttu-id="7919e-150">Las expresiones lambda no son serializables para el formato XAML.</span><span class="sxs-lookup"><span data-stu-id="7919e-150">Lambda expressions are not serializable to XAML format.</span></span> <span data-ttu-id="7919e-151">Si se intenta serializar un flujo de trabajo con expresiones lambda, se produce <xref:System.Activities.Expressions.LambdaSerializationException> con el mensaje siguiente: “Este flujo de trabajo contiene expresiones lambda especificadas en código.</span><span class="sxs-lookup"><span data-stu-id="7919e-151">If an attempt to serialize a workflow with lambda expressions is made, a <xref:System.Activities.Expressions.LambdaSerializationException> is thrown with the following message: "This workflow contains lambda expressions specified in code.</span></span> <span data-ttu-id="7919e-152">Estas expresiones no se pueden serializar mediante XAML.</span><span class="sxs-lookup"><span data-stu-id="7919e-152">These expressions are not XAML serializable.</span></span> <span data-ttu-id="7919e-153">Para que el flujo de trabajo se pueda serializar mediante XAML, use VisualBasicValue/VisualBasicReference o ExpressionServices.Convert(lambda).</span><span class="sxs-lookup"><span data-stu-id="7919e-153">In order to make your workflow XAML-serializable, either use VisualBasicValue/VisualBasicReference or ExpressionServices.Convert(lambda).</span></span> <span data-ttu-id="7919e-154">Esto convertirá las expresiones lambda en actividades de expresión”.</span><span class="sxs-lookup"><span data-stu-id="7919e-154">This will convert your lambda expressions into expression activities."</span></span> <span data-ttu-id="7919e-155">Para que esta expresión sea compatible con XAML, use <xref:System.Activities.Expressions.ExpressionServices> y <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, tal y como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="7919e-155">To make this expression compatible with XAML, use <xref:System.Activities.Expressions.ExpressionServices> and <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, as shown in the following example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#53](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#53)]  
  
 <span data-ttu-id="7919e-156">También se puede utilizar <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span><span class="sxs-lookup"><span data-stu-id="7919e-156">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> could also be used.</span></span> <span data-ttu-id="7919e-157">Observe que no se necesita ninguna expresión lambda al usar una expresión de Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="7919e-157">Note that no lambda expression is required when using a Visual Basic expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#54](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#54)]  
  
 <span data-ttu-id="7919e-158">En tiempo de ejecución, las expresiones de Visual Basic se compilan en expresiones LINQ.</span><span class="sxs-lookup"><span data-stu-id="7919e-158">At run time, Visual Basic expressions are compiled into LINQ expressions.</span></span> <span data-ttu-id="7919e-159">Ambos ejemplos anteriores son serializables en XAML, pero si el XAML serializado está diseñado para que se vea y edite en el diseñador de flujo de trabajo, use <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> para las expresiones.</span><span class="sxs-lookup"><span data-stu-id="7919e-159">Both of the previous examples are serializable to XAML, but if the serialized XAML is intended to be viewed and edited in the workflow designer, use <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> for your expressions.</span></span> <span data-ttu-id="7919e-160">Los flujos de trabajo serializados que usan `ExpressionServices.Convert` se pueden abrir en el diseñador, pero el valor de la expresión estará en blanco.</span><span class="sxs-lookup"><span data-stu-id="7919e-160">Serialized workflows that use `ExpressionServices.Convert` can be opened in the designer, but the value of the expression will be blank.</span></span> <span data-ttu-id="7919e-161">Para obtener más información sobre cómo serializar flujos de trabajo en XAML, vea [serializar flujos de trabajo y actividades a y desde XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-161">For more information about serializing workflows to XAML, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
#### <a name="literal-expressions-and-reference-types"></a><span data-ttu-id="7919e-162">Expresiones literales y tipos de referencia</span><span class="sxs-lookup"><span data-stu-id="7919e-162">Literal Expressions and Reference Types</span></span>  

 <span data-ttu-id="7919e-163">Las expresiones literales se representan en flujos de trabajo mediante la actividad <xref:System.Activities.Expressions.Literal%601>.</span><span class="sxs-lookup"><span data-stu-id="7919e-163">Literal expressions are represented in workflows by the <xref:System.Activities.Expressions.Literal%601> activity.</span></span> <span data-ttu-id="7919e-164">Las siguientes actividades <xref:System.Activities.Statements.WriteLine> tienen una funcionalidad equivalente.</span><span class="sxs-lookup"><span data-stu-id="7919e-164">The following <xref:System.Activities.Statements.WriteLine> activities are functionally equivalent.</span></span>  
  
```csharp  
new WriteLine  
{  
    Text = "Hello World."  
},  
new WriteLine  
{  
    Text = new Literal<string>("Hello World.")  
}  
```  
  
 <span data-ttu-id="7919e-165">No se puede inicializar una expresión literal con cualquier tipo de referencia excepto <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="7919e-165">It is invalid to initialize a literal expression with any reference type except <xref:System.String>.</span></span> <span data-ttu-id="7919e-166">En el ejemplo siguiente, la propiedad <xref:System.Activities.Statements.Assign> de una actividad <xref:System.Activities.Statements.Assign.Value%2A> se inicializa con una expresión literal mediante `List<string>`.</span><span class="sxs-lookup"><span data-stu-id="7919e-166">In the following example, an <xref:System.Activities.Statements.Assign> activity's <xref:System.Activities.Statements.Assign.Value%2A> property is initialized with a literal expression using a `List<string>`.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new List<string>())  
},  
```  
  
 <span data-ttu-id="7919e-167">Cuando el flujo de trabajo que contiene esta actividad se valida, se devuelve el error de validación siguiente: "El literal solo admite tipos de valor y el tipo inmutable System.String.</span><span class="sxs-lookup"><span data-stu-id="7919e-167">When the workflow containing this activity is validated, the following validation error is returned: "Literal only supports value types and the immutable type System.String.</span></span> <span data-ttu-id="7919e-168">El tipo System.Collections.Generic.List\`1[System.String] no se puede usar como literal”.</span><span class="sxs-lookup"><span data-stu-id="7919e-168">The type System.Collections.Generic.List\`1[System.String] cannot be used as a literal."</span></span> <span data-ttu-id="7919e-169">Si se invoca el flujo de trabajo, se produce <xref:System.Activities.InvalidWorkflowException> que contiene el texto del error de validación.</span><span class="sxs-lookup"><span data-stu-id="7919e-169">If the workflow is invoked, an <xref:System.Activities.InvalidWorkflowException> is thrown that contains the text of the validation error.</span></span> <span data-ttu-id="7919e-170">Esto es un error de validación porque al crear una expresión literal con un tipo de referencia no se crea una nueva instancia del tipo de referencia para cada instancia del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-170">This is a validation error because creating a literal expression with a reference type does not create a new instance of the reference type for each instance of the workflow.</span></span> <span data-ttu-id="7919e-171">Para solucionarlo, reemplace la expresión literal con una que cree y devuelva una nueva instancia de tipo de referencia.</span><span class="sxs-lookup"><span data-stu-id="7919e-171">To resolve this, replace the literal expression with one that creates and returns a new instance of the reference type.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new VisualBasicValue<List<string>>("New List(Of String)"))  
},  
```  
  
 <span data-ttu-id="7919e-172">Para obtener más información sobre las expresiones, vea [expresiones](expressions.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-172">For more information about expressions, see [Expressions](expressions.md).</span></span>  
  
#### <a name="invoking-methods-on-objects-using-expressions-and-the-invokemethod-activity"></a><span data-ttu-id="7919e-173">Invocar métodos en objetos mediante expresiones y la actividad InvokeMethod</span><span class="sxs-lookup"><span data-stu-id="7919e-173">Invoking Methods on Objects using Expressions and the InvokeMethod Activity</span></span>  

 <span data-ttu-id="7919e-174">La actividad <xref:System.Activities.Expressions.InvokeMethod%601> se puede usar para invocar métodos estáticos y de instancia de clases de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="7919e-174">The <xref:System.Activities.Expressions.InvokeMethod%601> activity can be used to invoke static and instance methods of classes in the .NET Framework.</span></span> <span data-ttu-id="7919e-175">En un ejemplo anterior de este tema, se generaba un número aleatorio mediante la clase <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="7919e-175">In a previous example in this topic, a random number was generated using the <xref:System.Random> class.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="7919e-176">La actividad <xref:System.Activities.Expressions.InvokeMethod%601> podría haberse usado también para llamar al método <xref:System.Random.Next%2A> de la clase <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="7919e-176">The <xref:System.Activities.Expressions.InvokeMethod%601> activity could also have been used to call the <xref:System.Random.Next%2A> method of the <xref:System.Random> class.</span></span>  
  
```csharp  
new InvokeMethod<int>  
{  
    TargetObject = new InArgument<Random>(new VisualBasicValue<Random>("New Random()")),  
    MethodName = "Next",  
    Parameters =
    {  
        new InArgument<int>(1),  
        new InArgument<int>(101)  
    },  
    Result = n  
}  
```  
  
 <span data-ttu-id="7919e-177">Debido a que <xref:System.Random.Next%2A> no es un método estático, se proporciona una instancia de la clase <xref:System.Random> para la propiedad de <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="7919e-177">Since <xref:System.Random.Next%2A> is not a static method, an instance of the <xref:System.Random> class is supplied for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A> property.</span></span> <span data-ttu-id="7919e-178">En este ejemplo se crea una nueva instancia mediante una expresión de Visual Basic, pero también podría haberse creado previamente y almacenado en una variable de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-178">In this example a new instance is created using a Visual Basic expression, but it could also have been created previously and stored in a workflow variable.</span></span> <span data-ttu-id="7919e-179">En este ejemplo, sería más fácil usar la actividad <xref:System.Activities.Statements.Assign%601> en lugar de la actividad <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="7919e-179">In this example, it would be simpler to use the <xref:System.Activities.Statements.Assign%601> activity instead of the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="7919e-180">Si la llamada al método invocada en última instancia por las actividades <xref:System.Activities.Statements.Assign%601> o <xref:System.Activities.Expressions.InvokeMethod%601> es larga, <xref:System.Activities.Expressions.InvokeMethod%601> tiene una ventaja porque tiene una propiedad <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A>.</span><span class="sxs-lookup"><span data-stu-id="7919e-180">If the method call ultimately invoked by either the <xref:System.Activities.Statements.Assign%601> or <xref:System.Activities.Expressions.InvokeMethod%601> activities is long running, <xref:System.Activities.Expressions.InvokeMethod%601> has an advantage since it has a <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> property.</span></span> <span data-ttu-id="7919e-181">Cuando esta propiedad se establece en `true`, el método invocado se ejecutará de forma asincrónica con respecto al flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7919e-181">When this property is set to `true`, the invoked method will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="7919e-182">Si hay actividades en paralelo, no se bloquearán mientras el método se esté ejecutando de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="7919e-182">If other activities are in parallel, they will not be blocked while the method is asynchronously executing.</span></span> <span data-ttu-id="7919e-183">Además, si el método que se va a invocar no tiene ningún valor devuelto, <xref:System.Activities.Expressions.InvokeMethod%601> es la manera adecuada de invocar el método.</span><span class="sxs-lookup"><span data-stu-id="7919e-183">Also, if the method to be invoked has no return value, then <xref:System.Activities.Expressions.InvokeMethod%601> is the appropriate way to invoke the method.</span></span>  
  
## <a name="arguments-and-dynamic-activities"></a><span data-ttu-id="7919e-184">Argumentos y actividades dinámicas</span><span class="sxs-lookup"><span data-stu-id="7919e-184">Arguments and Dynamic Activities</span></span>  

 <span data-ttu-id="7919e-185">Una definición de flujo de trabajo se crea en código ensamblando las actividades en un árbol de actividad y configurando propiedades y argumentos.</span><span class="sxs-lookup"><span data-stu-id="7919e-185">A workflow definition is created in code by assembling activities into an activity tree and configuring any properties and arguments.</span></span> <span data-ttu-id="7919e-186">Se pueden enlazar los argumentos existentes, aunque los nuevos no pueden agregarse a las actividades.</span><span class="sxs-lookup"><span data-stu-id="7919e-186">Existing arguments can be bound, but new arguments cannot be added to activities.</span></span> <span data-ttu-id="7919e-187">Esto incluye argumentos de flujo de trabajo pasados a la actividad raíz.</span><span class="sxs-lookup"><span data-stu-id="7919e-187">This includes workflow arguments passed to the root activity.</span></span> <span data-ttu-id="7919e-188">En código imperativo, los argumentos de flujo de trabajo se especifican como propiedades en un nuevo tipo CLR. En XAML se declaran usando `x:Class` y `x:Member`.</span><span class="sxs-lookup"><span data-stu-id="7919e-188">In imperative code, workflow arguments are specified as properties on a new CLR type, and in XAML they are declared by using `x:Class` and `x:Member`.</span></span> <span data-ttu-id="7919e-189">Dado que no se ha creado ningún nuevo tipo de CLR cuando una definición de flujo de trabajo se crea como un árbol de objetos en memoria, no se pueden agregar argumentos.</span><span class="sxs-lookup"><span data-stu-id="7919e-189">Because there is no new CLR type created when a workflow definition is created as a tree of in-memory objects, arguments cannot be added.</span></span> <span data-ttu-id="7919e-190">Sin embargo, los argumentos se pueden agregar a <xref:System.Activities.DynamicActivity>.</span><span class="sxs-lookup"><span data-stu-id="7919e-190">However, arguments can be added to a <xref:System.Activities.DynamicActivity>.</span></span> <span data-ttu-id="7919e-191">En este ejemplo, se crea un <xref:System.Activities.DynamicActivity%601> que toma dos argumentos enteros y los agrega juntos y devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="7919e-191">In this example, a <xref:System.Activities.DynamicActivity%601> is created that takes two integer arguments, adds them together, and returns the result.</span></span> <span data-ttu-id="7919e-192"><xref:System.Activities.DynamicActivityProperty> se crea para cada argumento y el resultado de la operación se asigna al argumento <xref:System.Activities.Activity%601.Result%2A> de <xref:System.Activities.DynamicActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="7919e-192">A <xref:System.Activities.DynamicActivityProperty> is created for each argument, and the result of the operation is assigned to the <xref:System.Activities.Activity%601.Result%2A> argument of the <xref:System.Activities.DynamicActivity%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#55](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#55)]  
  
 <span data-ttu-id="7919e-193">Para obtener más información sobre las actividades dinámicas, vea [crear una actividad en tiempo de ejecución](creating-an-activity-at-runtime-with-dynamicactivity.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-193">For more information about dynamic activities, see [Creating an Activity at Runtime](creating-an-activity-at-runtime-with-dynamicactivity.md).</span></span>  
  
## <a name="compiled-activities"></a><span data-ttu-id="7919e-194">Actividades compiladas</span><span class="sxs-lookup"><span data-stu-id="7919e-194">Compiled Activities</span></span>  

 <span data-ttu-id="7919e-195">Las actividades dinámicas son una manera de definir una actividad que contiene argumentos mediante código, pero las actividades también se pueden crear en código y compilar en tipos.</span><span class="sxs-lookup"><span data-stu-id="7919e-195">Dynamic activities are one way to define an activity that contains arguments using code, but activities can also be created in code and compiled into types.</span></span> <span data-ttu-id="7919e-196">Se pueden crear actividades simples que derivan de <xref:System.Activities.CodeActivity> y actividades asincrónicas que derivan de <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="7919e-196">Simple activities can be created that derive from <xref:System.Activities.CodeActivity>, and asynchronous activities that derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="7919e-197">Estas actividades pueden tener argumentos, valores devueltos y definir la lógica mediante código imperativo.</span><span class="sxs-lookup"><span data-stu-id="7919e-197">These activities can have arguments, return values, and define their logic using imperative code.</span></span> <span data-ttu-id="7919e-198">Para obtener ejemplos de cómo crear estos tipos de actividades, vea [clase base CodeActivity](workflow-activity-authoring-using-the-codeactivity-class.md) y [crear actividades asincrónicas](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="7919e-198">For examples of creating these types of activities, see [CodeActivity Base Class](workflow-activity-authoring-using-the-codeactivity-class.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>  
  
 <span data-ttu-id="7919e-199">Las actividades que derivan de <xref:System.Activities.NativeActivity> pueden definir su lógica mediante código imperativo y también pueden contener actividades secundarias que definen la lógica.</span><span class="sxs-lookup"><span data-stu-id="7919e-199">Activities that derive from <xref:System.Activities.NativeActivity> can define their logic using imperative code and they can also contain child activities that define the logic.</span></span> <span data-ttu-id="7919e-200">También tienen acceso completo a las características del runtime como crear marcadores.</span><span class="sxs-lookup"><span data-stu-id="7919e-200">They also have full access to the features of the runtime such as creating bookmarks.</span></span> <span data-ttu-id="7919e-201">Para obtener ejemplos de cómo crear una <xref:System.Activities.NativeActivity> actividad basada en, vea [clase base NativeActivity](nativeactivity-base-class.md), [Cómo: crear una actividad](how-to-create-an-activity.md)y el ejemplo de [composición personalizada mediante la actividad nativa](./samples/custom-composite-using-native-activity.md) .</span><span class="sxs-lookup"><span data-stu-id="7919e-201">For examples of creating a <xref:System.Activities.NativeActivity>-based activity, see [NativeActivity Base Class](nativeactivity-base-class.md), [How to: Create an Activity](how-to-create-an-activity.md), and the [Custom Composite using Native Activity](./samples/custom-composite-using-native-activity.md) sample.</span></span>  
  
 <span data-ttu-id="7919e-202">Las actividades que derivan de <xref:System.Activities.Activity> definen la lógica únicamente con el uso de actividades secundarias.</span><span class="sxs-lookup"><span data-stu-id="7919e-202">Activities that derive from <xref:System.Activities.Activity> define their logic solely through the use of child activities.</span></span> <span data-ttu-id="7919e-203">Estas actividades se crean normalmente mediante el diseñador de flujo de trabajo, pero también pueden definirse mediante código.</span><span class="sxs-lookup"><span data-stu-id="7919e-203">These activities are typically created by using the workflow designer, but can also be defined by using code.</span></span> <span data-ttu-id="7919e-204">En el siguiente ejemplo, se define una actividad `Square` que deriva de `Activity<int>`.</span><span class="sxs-lookup"><span data-stu-id="7919e-204">In the following example, a `Square` activity is defined that derives from `Activity<int>`.</span></span> <span data-ttu-id="7919e-205">La actividad `Square` tiene un único <xref:System.Activities.InArgument%601> denominado `Value` y define su lógica especificando una actividad <xref:System.Activities.Statements.Sequence> mediante la propiedad <xref:System.Activities.Activity.Implementation%2A>.</span><span class="sxs-lookup"><span data-stu-id="7919e-205">The `Square` activity has a single <xref:System.Activities.InArgument%601> named `Value`, and defines its logic by specifying a <xref:System.Activities.Statements.Sequence> activity using the <xref:System.Activities.Activity.Implementation%2A> property.</span></span> <span data-ttu-id="7919e-206">La actividad <xref:System.Activities.Statements.Sequence> contiene una actividad <xref:System.Activities.Statements.WriteLine> y una actividad <xref:System.Activities.Statements.Assign%601>.</span><span class="sxs-lookup"><span data-stu-id="7919e-206">The <xref:System.Activities.Statements.Sequence> activity contains a <xref:System.Activities.Statements.WriteLine> activity and an <xref:System.Activities.Statements.Assign%601> activity.</span></span> <span data-ttu-id="7919e-207">Juntas, estas tres actividades implementan la lógica de la actividad `Square`.</span><span class="sxs-lookup"><span data-stu-id="7919e-207">Together, these three activities implement the logic of the `Square` activity.</span></span>  
  
```csharp  
class Square : Activity<int>  
{  
    [RequiredArgument]  
    public InArgument<int> Value { get; set; }  
  
    public Square()  
    {  
        this.Implementation = () => new Sequence  
        {  
            Activities =  
            {  
                new WriteLine  
                {  
                    Text = new InArgument<string>((env) => "Squaring the value: " + this.Value.Get(env))  
                },  
                new Assign<int>  
                {  
                    To = new OutArgument<int>((env) => this.Result.Get(env)),  
                    Value = new InArgument<int>((env) => this.Value.Get(env) * this.Value.Get(env))  
                }  
            }  
        };  
    }  
}  
```  
  
 <span data-ttu-id="7919e-208">En el siguiente ejemplo se invoca una definición de flujo de trabajo formada por una sola actividad `Square` mediante <xref:System.Activities.WorkflowInvoker>.</span><span class="sxs-lookup"><span data-stu-id="7919e-208">In the following example, a workflow definition consisting of a single `Square` activity is invoked using <xref:System.Activities.WorkflowInvoker>.</span></span>  
  
```csharp  
Dictionary<string, object> inputs = new Dictionary<string, object> {{ "Value", 5}};  
int result = WorkflowInvoker.Invoke(new Square(), inputs);  
Console.WriteLine("Result: {0}", result);  
```  
  
 <span data-ttu-id="7919e-209">Cuando se invoca el flujo de trabajo, en la consola se muestra el siguiente resultado:</span><span class="sxs-lookup"><span data-stu-id="7919e-209">When the workflow is invoked, the following output is displayed to the console:</span></span>  
  
 <span data-ttu-id="7919e-210">**Calculando raíz cuadrada del valor: 5**</span><span class="sxs-lookup"><span data-stu-id="7919e-210">**Squaring the value: 5**</span></span>  
<span data-ttu-id="7919e-211">**Resultado: 25**</span><span class="sxs-lookup"><span data-stu-id="7919e-211">**Result: 25**</span></span>
