---
title: loaderLock (MDA)
description: Revise el Asistente para la depuración administrada (MDA) de loaderLock en .NET, que detecta los intentos de ejecutar código administrado en un subproceso que contiene el bloqueo del cargador del sistema operativo Windows.
ms.date: 03/30/2017
helpviewer_keywords:
- deadlocks [.NET Framework]
- LoaderLock MDA
- MDAs (managed debugging assistants), loader locks
- managed debugging assistants (MDAs), loader locks
- operating system loader locks
- loader locks
- locks, threads
ms.assetid: 8c10fa02-1b9c-4be5-ab03-451d943ac1ee
ms.openlocfilehash: 0e8946a3482798f0a20d6304c7d42d2a5832ae61
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96240568"
---
# <a name="loaderlock-mda"></a><span data-ttu-id="1b5a1-103">loaderLock (MDA)</span><span class="sxs-lookup"><span data-stu-id="1b5a1-103">loaderLock MDA</span></span>

<span data-ttu-id="1b5a1-104">El Asistente para la depuración administrada (MDA) `loaderLock` detecta los intentos de ejecutar código administrado en un subproceso que contiene el bloqueo del cargador del sistema operativo Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-104">The `loaderLock` managed debugging assistant (MDA) detects attempts to execute managed code on a thread that holds the Microsoft Windows operating system loader lock.</span></span>  <span data-ttu-id="1b5a1-105">Cualquier ejecución de este tipo no es válida porque puede causar interbloqueos y el uso de archivos DLL antes de que se hayan inicializado por el cargador del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-105">Any such execution is illegal because it can lead to deadlocks and to use of DLLs before they have been initialized by the operating system's loader.</span></span>  
  
## <a name="symptoms"></a><span data-ttu-id="1b5a1-106">Síntomas</span><span class="sxs-lookup"><span data-stu-id="1b5a1-106">Symptoms</span></span>  

 <span data-ttu-id="1b5a1-107">El error más común cuando se ejecuta código dentro de un bloqueo del cargador del sistema operativo es que los subprocesos produzcan un interbloqueo al intentar llamar a otras funciones de Win32 que también requieren el bloqueo del cargador.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-107">The most common failure when executing code inside the operating system's loader lock is that threads will deadlock when attempting to call other Win32 functions that also require the loader lock.</span></span>  <span data-ttu-id="1b5a1-108">Ejemplos de esas funciones son `LoadLibrary`, `GetProcAddress`, `FreeLibrary` y `GetModuleHandle`.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-108">Examples of such functions are `LoadLibrary`, `GetProcAddress`, `FreeLibrary`, and `GetModuleHandle`.</span></span>  <span data-ttu-id="1b5a1-109">Es posible que la aplicación no llame directamente a estas funciones; Common Language Runtime (CLR) podría llamar a estas funciones como resultado de una llamada de nivel superior como <xref:System.Reflection.Assembly.Load%2A> o la primera llamada a un método de invocación de plataforma.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-109">The application might not directly call these functions; the common language runtime (CLR) might call these functions as the result of a higher level call like <xref:System.Reflection.Assembly.Load%2A> or the first call to a platform invoke method.</span></span>  
  
 <span data-ttu-id="1b5a1-110">También pueden producirse interbloqueos si un subproceso está esperando a que se inicie o finalice otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-110">Deadlocks can also occur if a thread is waiting for another thread to start or finish.</span></span>  <span data-ttu-id="1b5a1-111">Cuando un subproceso se inicia o termina de ejecutarse, debe adquirir el bloqueo del cargador del sistema operativo para entregar eventos a los archivos DLL afectados.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-111">When a thread starts or finishes executing, it must acquire the operating system's loader lock to deliver events to affected DLLs.</span></span>  
  
 <span data-ttu-id="1b5a1-112">Por último, hay casos donde las llamadas a archivos DLL pueden producirse antes de que el cargador del sistema operativo haya inicializado correctamente esos archivos DLL.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-112">Finally, there are cases where calls into DLLs can occur before those DLLs have been properly initialized by the operating system's loader.</span></span>  <span data-ttu-id="1b5a1-113">A diferencia de los errores de interbloqueo, que se pueden diagnosticar examinando las pilas de todos los subprocesos implicados en el interbloqueo, es muy difícil diagnosticar el uso de archivos DLL no inicializados sin usar este MDA.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-113">Unlike the deadlock failures, which can be diagnosed by examining the stacks of all the threads involved in the deadlock, it is very difficult to diagnose the use of uninitialized DLLs without using this MDA.</span></span>  
  
## <a name="cause"></a><span data-ttu-id="1b5a1-114">Causa</span><span class="sxs-lookup"><span data-stu-id="1b5a1-114">Cause</span></span>  

 <span data-ttu-id="1b5a1-115">Los ensamblados de C++ administrados y no administrados mixtos compilados para las versiones 1.0 o 1.1 de .NET Framework suelen intentar ejecutar código administrado dentro del bloqueo del cargador a menos que se hayan tomado precauciones especiales, por ejemplo, vinculándolos con **/NOENTRY**.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-115">Mixed managed/unmanaged C++ assemblies built for .NET Framework versions 1.0 or 1.1 generally attempt to execute managed code inside the loader lock unless special care has been taken, for example, linking with **/NOENTRY**.</span></span>
  
 <span data-ttu-id="1b5a1-116">Los ensamblados de C++ administrados y no administrados mixtos compilados para versión 2.0 de .NET Framework son menos susceptibles a estos problemas, y tienen el mismo riesgo reducido que las aplicaciones que usan archivos DLL no administrados que infringen las reglas del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-116">Mixed managed/unmanaged C++ assemblies built for .NET Framework version 2.0 are less susceptible to these problems, having the same reduced risk as applications using unmanaged DLLs that violate the operating system's rules.</span></span>  <span data-ttu-id="1b5a1-117">Por ejemplo, si el punto de entrada `DllMain` de un archivo DLL no administrado llama a `CoCreateInstance` para obtener un objeto administrado que se haya expuesto a COM, el resultado es un intento de ejecutar código administrado dentro del bloqueo del cargador.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-117">For example, if an unmanaged DLL's `DllMain` entry point calls `CoCreateInstance` to obtain a managed object that has been exposed to COM, the result is an attempt to execute managed code inside the loader lock.</span></span> <span data-ttu-id="1b5a1-118">Para más información sobre problemas de bloqueo del cargador en la versión 2.0 y posteriores de .NET Framework, vea [Inicialización de ensamblados mixtos](/cpp/dotnet/initialization-of-mixed-assemblies).</span><span class="sxs-lookup"><span data-stu-id="1b5a1-118">For more information about loader lock issues in the .NET Framework version 2.0 and later, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span>  
  
## <a name="resolution"></a><span data-ttu-id="1b5a1-119">Solución</span><span class="sxs-lookup"><span data-stu-id="1b5a1-119">Resolution</span></span>  

 <span data-ttu-id="1b5a1-120">En Visual C++ .NET 2002 y Visual C++ .NET 2003, los archivos DLL compilados con la opción del compilador `/clr` podían interbloquearse de forma no determinante al cargarse; esto se denominó el problema de carga de archivos DLL mixtos o bloqueo del cargador.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-120">In Visual C++ .NET 2002 and Visual C++ .NET 2003, DLLs compiled with the `/clr` compiler option could non-deterministically deadlock when loaded; this issue was called the mixed DLL loading or loader lock issue.</span></span> <span data-ttu-id="1b5a1-121">En Visual C++ 2005 y versiones posteriores se ha quitado prácticamente toda la falta de determinación del proceso de carga de archivos DLL mixtos.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-121">In Visual C++ 2005 and later, almost all non-determinism has been removed from the mixed DLL loading process.</span></span> <span data-ttu-id="1b5a1-122">En cambio, todavía hay algunos casos en los que podría producirse el bloqueo del cargador (de manera determinante).</span><span class="sxs-lookup"><span data-stu-id="1b5a1-122">However, there are a few remaining scenarios for which loader lock can (deterministically) occur.</span></span> <span data-ttu-id="1b5a1-123">Para obtener información detallada de las causas y soluciones para el resto de los problemas de bloqueo del cargador, vea [Inicialización de ensamblados mixtos](/cpp/dotnet/initialization-of-mixed-assemblies).</span><span class="sxs-lookup"><span data-stu-id="1b5a1-123">For a detailed account of the causes and resolutions for the remaining loader lock issues, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span> <span data-ttu-id="1b5a1-124">Si en ese tema no se identifica el problema de bloqueo del cargador, tendrá que examinar la pila del subproceso para determinar por qué se está produciendo el bloqueo del cargador y cómo corregir el problema.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-124">If that topic does not identify your loader lock problem, you have to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span> <span data-ttu-id="1b5a1-125">Examine el seguimiento de la pila para el subproceso que ha activado este MDA.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-125">Look at the stack trace for the thread that has activated this MDA.</span></span>  <span data-ttu-id="1b5a1-126">El subproceso está intentando llamar de forma no autorizada al código administrado mientras mantiene el bloqueo del cargador del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-126">The thread is attempting to illegally call into managed code while holding the operating system's loader lock.</span></span>  <span data-ttu-id="1b5a1-127">Probablemente verá un punto de entrada `DllMain` o equivalente del archivo DLL en la pila.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-127">You will probably see a DLL's `DllMain` or equivalent entry point on the stack.</span></span>  <span data-ttu-id="1b5a1-128">Las reglas del sistema operativo sobre lo que se permite hacer desde dentro de este tipo de punto de entrada son bastante limitadas.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-128">The operating system's rules for what you can legally do from inside such an entry point are quite limited.</span></span>  <span data-ttu-id="1b5a1-129">Estas reglas excluyen cualquier ejecución administrada.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-129">These rules preclude any managed execution.</span></span>  
  
## <a name="effect-on-the-runtime"></a><span data-ttu-id="1b5a1-130">Efecto en el Runtime</span><span class="sxs-lookup"><span data-stu-id="1b5a1-130">Effect on the Runtime</span></span>  

 <span data-ttu-id="1b5a1-131">Por lo general, varios subprocesos dentro del proceso producirán el interbloqueo.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-131">Typically, several threads inside the process will deadlock.</span></span>  <span data-ttu-id="1b5a1-132">Es probable que uno de esos subprocesos sea el responsable de realizar una recolección de elementos no utilizados, por lo que este interbloqueo puede tener una repercusión importante en todo el proceso.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-132">One of those threads is likely to be a thread responsible for performing a garbage collection, so this deadlock can have a major impact on the entire process.</span></span>  <span data-ttu-id="1b5a1-133">Además, impedirá cualquier operación adicional que requiera un bloqueo del cargador del sistema operativo, como cargar y descargar ensamblados o archivos DLL, e iniciar o detener subprocesos.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-133">Furthermore, it will prevent any additional operations that require the operating system's loader lock, like loading and unloading assemblies or DLLs and starting or stopping threads.</span></span>  
  
 <span data-ttu-id="1b5a1-134">En algunos casos poco frecuentes, también es posible que se desencadenen infracciones de acceso o problemas similares en los archivos DLL que se llaman antes de que se hayan inicializado.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-134">In some unusual cases, it is also possible for access violations or similar problems to be triggered in DLLs which are called before they have been initialized.</span></span>  
  
## <a name="output"></a><span data-ttu-id="1b5a1-135">Resultados</span><span class="sxs-lookup"><span data-stu-id="1b5a1-135">Output</span></span>  

 <span data-ttu-id="1b5a1-136">Este MDA informa de que se está intentado una ejecución administrada no válida.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-136">This MDA reports that an illegal managed execution is being attempted.</span></span>  <span data-ttu-id="1b5a1-137">Tendrá que examinar la pila del subproceso para determinar por qué se está produciendo el bloqueo del cargador y cómo corregir el problema.</span><span class="sxs-lookup"><span data-stu-id="1b5a1-137">You need to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span>  
  
## <a name="configuration"></a><span data-ttu-id="1b5a1-138">Configuración</span><span class="sxs-lookup"><span data-stu-id="1b5a1-138">Configuration</span></span>  
  
```xml  
<mdaConfig>  
  <assistants>  
    <loaderLock/>  
  </assistants>  
</mdaConfig>  
```  
  
## <a name="see-also"></a><span data-ttu-id="1b5a1-139">Vea también</span><span class="sxs-lookup"><span data-stu-id="1b5a1-139">See also</span></span>

- [<span data-ttu-id="1b5a1-140">Diagnóstico de errores con asistentes de depuraciones administradas</span><span class="sxs-lookup"><span data-stu-id="1b5a1-140">Diagnosing Errors with Managed Debugging Assistants</span></span>](diagnosing-errors-with-managed-debugging-assistants.md)
