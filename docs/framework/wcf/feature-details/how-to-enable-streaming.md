---
title: Procedimiento para habilitar el streaming
description: Obtenga información sobre cómo habilitar mensajes transmitidos en WCF en lugar de las transferencias almacenadas en búfer predeterminadas, que se deben recibir por completo antes de que se procesen.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: 7f77c406e1cfd4def116a1abe24aa92be74c6abe
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96237747"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="670fd-103">Procedimiento para habilitar el streaming</span><span class="sxs-lookup"><span data-stu-id="670fd-103">How to: Enable Streaming</span></span>

<span data-ttu-id="670fd-104">Windows Communication Foundation (WCF) puede enviar mensajes mediante transferencias almacenadas en búfer o por secuencias.</span><span class="sxs-lookup"><span data-stu-id="670fd-104">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="670fd-105">En el modo de transferencia almacenado en búfer (predeterminado), se debe entregar completamente un mensaje antes de que un receptor pueda leerlo.</span><span class="sxs-lookup"><span data-stu-id="670fd-105">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="670fd-106">En modo de transferencia de transmisión por secuencias, el receptor puede empezar a procesar el mensaje antes de se entregue completamente.</span><span class="sxs-lookup"><span data-stu-id="670fd-106">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="670fd-107">El modo de transmisión por secuencias es útil cuando la información que se pasa es larga y puede procesarse en serie.</span><span class="sxs-lookup"><span data-stu-id="670fd-107">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="670fd-108">El modo de transmisión por secuencias también es útil cuando el mensaje es demasiado grande para que se almacene en búfer completamente.</span><span class="sxs-lookup"><span data-stu-id="670fd-108">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="670fd-109">Para habilitar la transmisión por secuencias, defina apropiadamente `OperationContract` y habilite la transmisión por secuencias en el nivel de transporte.</span><span class="sxs-lookup"><span data-stu-id="670fd-109">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="670fd-110">Transmisión de datos por secuencias</span><span class="sxs-lookup"><span data-stu-id="670fd-110">To stream data</span></span>  
  
1. <span data-ttu-id="670fd-111">Para transmitir datos por secuencias, `OperationContract` del servicio debe satisfacer dos requisitos:</span><span class="sxs-lookup"><span data-stu-id="670fd-111">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1. <span data-ttu-id="670fd-112">El parámetro que contiene los datos que se van a transmitir debe ser el único parámetro del método.</span><span class="sxs-lookup"><span data-stu-id="670fd-112">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="670fd-113">Por ejemplo, si el mensaje de entrada es el que se va a transmitir por secuencia, la operación debe tener exactamente un parámetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="670fd-113">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="670fd-114">De igual forma, si el mensaje de salida se va a transmitir por secuencia, la operación debe tener exactamente un parámetro de salida o un valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="670fd-114">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2. <span data-ttu-id="670fd-115">Al menos uno de los tipos del parámetro y el valor devuelto debería ser <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>o <xref:System.Xml.Serialization.IXmlSerializable>.</span><span class="sxs-lookup"><span data-stu-id="670fd-115">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="670fd-116">A continuación se muestra un ejemplo de los datos.</span><span class="sxs-lookup"><span data-stu-id="670fd-116">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="670fd-117">La operación `GetStream` recibe algunos datos de entrada en búfer como `string`, que también se almacena en búfer y devuelve `Stream`, que se transmite por secuencias.</span><span class="sxs-lookup"><span data-stu-id="670fd-117">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="670fd-118">A la inversa, `UploadStream` admite una `Stream` (transmitida por secuencias) y devuelve un `bool` (almacenado en búfer).</span><span class="sxs-lookup"><span data-stu-id="670fd-118">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="670fd-119">`EchoStream` toma y devuelve `Stream` y es un ejemplo de una operación cuyos mensajes de entrada y salida se transmiten por secuencias.</span><span class="sxs-lookup"><span data-stu-id="670fd-119">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="670fd-120">Finalmente, `GetReversedStream` no toma ninguna entrada y devuelve un `Stream` (transmitido por secuencia).</span><span class="sxs-lookup"><span data-stu-id="670fd-120">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2. <span data-ttu-id="670fd-121">La transmisión por secuencias debe habilitarse en el enlace.</span><span class="sxs-lookup"><span data-stu-id="670fd-121">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="670fd-122">Defina una propiedad `TransferMode`, que puede adoptar uno de los siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="670fd-122">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1. <span data-ttu-id="670fd-123">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="670fd-123">`Buffered`,</span></span>  
  
    2. <span data-ttu-id="670fd-124">`Streamed`, que habilita la comunicación mediante transmisión por secuencias en ambas direcciones.</span><span class="sxs-lookup"><span data-stu-id="670fd-124">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3. <span data-ttu-id="670fd-125">`StreamedRequest`, que solo habilita la solicitud de transmisión.</span><span class="sxs-lookup"><span data-stu-id="670fd-125">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4. <span data-ttu-id="670fd-126">`StreamedResponse`, que solo habilita la transmisión por secuencias de la respuesta.</span><span class="sxs-lookup"><span data-stu-id="670fd-126">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="670fd-127">`BasicHttpBinding` expone la propiedad `TransferMode` en el enlace, tal y como hace, `NetTcpBinding` y `NetNamedPipeBinding`.</span><span class="sxs-lookup"><span data-stu-id="670fd-127">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="670fd-128">La propiedad `TransferMode` se puede establecer también en el elemento de enlace del transporte y utilizarse en un enlace personalizado.</span><span class="sxs-lookup"><span data-stu-id="670fd-128">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="670fd-129">Los siguientes ejemplos muestran cómo establecer `TransferMode` mediante código y cambiando el archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="670fd-129">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="670fd-130">Ambos ejemplos también establecen la propiedad `maxReceivedMessageSize` en 64 MB, que coloca un límite en el tamaño máximo permitido de mensajes que se reciben.</span><span class="sxs-lookup"><span data-stu-id="670fd-130">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="670fd-131">El `maxReceivedMessageSize` predeterminado es de 64 KB, que normalmente es demasiado pequeño para los escenarios de transmisión por secuencias.</span><span class="sxs-lookup"><span data-stu-id="670fd-131">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="670fd-132">Establezca este valor de cuota que depende, según corresponda, del tamaño máximo de mensajes que su aplicación espera recibir.</span><span class="sxs-lookup"><span data-stu-id="670fd-132">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="670fd-133">También tenga en cuenta que `maxBufferSize` controla el tamaño máximo que se almacena en búfer y lo establece de manera apropiada.</span><span class="sxs-lookup"><span data-stu-id="670fd-133">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1. <span data-ttu-id="670fd-134">El siguiente fragmento de código de configuración del ejemplo muestra cómo establecer la propiedad `TransferMode` en la transmisión por secuencias en `basicHttpBinding` y un enlace HTTP personalizado.</span><span class="sxs-lookup"><span data-stu-id="670fd-134">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]
  
    2. <span data-ttu-id="670fd-135">El siguiente fragmento de código muestra cómo establecer la propiedad `TransferMode` para la transmisión por secuencias en `basicHttpBinding` y un enlace HTTP personalizado.</span><span class="sxs-lookup"><span data-stu-id="670fd-135">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3. <span data-ttu-id="670fd-136">El siguiente fragmento de código muestra cómo establecer la propiedad `TransferMode` para la transmisión por secuencias en un enlace HTTP personalizado.</span><span class="sxs-lookup"><span data-stu-id="670fd-136">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3. <span data-ttu-id="670fd-137">Las operaciones `GetStream`, `UploadStream` y `EchoStream` tratan con el envío de datos directamente desde un archivo o guardando los datos recibidos directamente en un archivo.</span><span class="sxs-lookup"><span data-stu-id="670fd-137">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="670fd-138">El siguiente código se aplica a `GetStream`.</span><span class="sxs-lookup"><span data-stu-id="670fd-138">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="670fd-139">Escritura de una secuencia personalizada</span><span class="sxs-lookup"><span data-stu-id="670fd-139">Writing a custom stream</span></span>  
  
1. <span data-ttu-id="670fd-140">Para hacer un procesamiento especial en cada fragmento de un flujo de datos mientras se envía o recibe, derive una clase de flujo personalizada de <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="670fd-140">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="670fd-141">Como un ejemplo de una secuencia personalizada, el siguiente código contiene un método `GetReversedStream` y una clase `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="670fd-141">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="670fd-142">`GetReversedStream` crea y devuelve una nueva instancia de `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="670fd-142">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="670fd-143">El procesamiento real se produce cuando el sistema lee desde el objeto `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="670fd-143">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="670fd-144">El método `ReverseStream.Read` lee un fragmento de bytes del archivo subyacente, los invierte y después devuelve los bytes invertidos.</span><span class="sxs-lookup"><span data-stu-id="670fd-144">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="670fd-145">Este método no invierte el contenido del archivo completo, sino un fragmento de bytes cada vez.</span><span class="sxs-lookup"><span data-stu-id="670fd-145">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="670fd-146">Este ejemplo muestra cómo puede realizar el procesamiento de la secuencia cuando el contenido se lee o escribe desde la secuencia.</span><span class="sxs-lookup"><span data-stu-id="670fd-146">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="670fd-147">Vea también</span><span class="sxs-lookup"><span data-stu-id="670fd-147">See also</span></span>

- [<span data-ttu-id="670fd-148">Datos de gran tamaño y secuencias</span><span class="sxs-lookup"><span data-stu-id="670fd-148">Large Data and Streaming</span></span>](large-data-and-streaming.md)
- [<span data-ttu-id="670fd-149">Stream</span><span class="sxs-lookup"><span data-stu-id="670fd-149">Stream</span></span>](../samples/stream.md)
