---
title: Extensibilidad de host de servicio de flujo de trabajo
ms.date: 03/30/2017
ms.assetid: c0e8f7bb-cb13-49ec-852f-b85d7c23972f
ms.openlocfilehash: 67a7830c564cabafb9441e86eb0d87164d854ee5
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96258457"
---
# <a name="workflow-service-host-extensibility"></a><span data-ttu-id="b758d-102">Extensibilidad de host de servicio de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="b758d-102">Workflow Service Host Extensibility</span></span>

[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] <span data-ttu-id="b758d-103">proporciona la clase <xref:System.ServiceModel.Activities.WorkflowServiceHost> para hospedar servicios de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b758d-103">provides the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class for hosting workflow services.</span></span> <span data-ttu-id="b758d-104">Esta clase se usa cuando auto-hospeda un servicio de flujo de trabajo en una aplicación administrada o en un servicio Windows.</span><span class="sxs-lookup"><span data-stu-id="b758d-104">This class is used when you are self-hosting a workflow service in a managed application or a Windows service.</span></span> <span data-ttu-id="b758d-105">Esta clase también se usa al hospedar un servicio de flujo de trabajo con Internet Information Services (IIS) o el Servicio de activación de procesos de Windows (WAS).</span><span class="sxs-lookup"><span data-stu-id="b758d-105">This class is also used when hosting a workflow service with Internet Information Services (IIS) or Windows Process Activation Service (WAS).</span></span> <span data-ttu-id="b758d-106">La clase <xref:System.ServiceModel.Activities.WorkflowServiceHost> proporciona puntos de extensión que le permiten agregar extensiones personalizadas, cambiar el comportamiento inactivo y hospedar flujos de trabajo no pertenecientes al servicio (flujos de trabajo que no usan actividades de mensajería).</span><span class="sxs-lookup"><span data-stu-id="b758d-106">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> class provides extension points that allow you to add custom extensions, change the idle behavior, and host non-service workflows (workflows that do not use messaging activities).</span></span>  
  
## <a name="workflow-service-host-extensions"></a><span data-ttu-id="b758d-107">Extensiones del host de servicio de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="b758d-107">Workflow Service Host Extensions</span></span>  

 <span data-ttu-id="b758d-108"><xref:System.ServiceModel.Activities.WorkflowServiceHost> contiene una propiedad <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> de tipo <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> que ofrece métodos para agregar extensiones a <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="b758d-108">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> contains a <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> property of type <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> that provides methods to add extensions to the <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="b758d-109">Use el método <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> para agregar una extensión para cada instancia de servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b758d-109">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service instance.</span></span> <span data-ttu-id="b758d-110">Se llama al delegado especificado para crear una nueva extensión cuando una instancia de servicio de flujo de trabajo se crea o se carga de un almacén de persistencia.</span><span class="sxs-lookup"><span data-stu-id="b758d-110">The delegate specified is called to create a new extension when a workflow service instance is created or loaded from a persistence store.</span></span> <span data-ttu-id="b758d-111">Use el método <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> para agregar una extensión para cada host de servicio de flujo de trabajo; se comparte una instancia de la extensión para todas las instancias de servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b758d-111">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service host, one instance of the extension is shared for all workflow service instances.</span></span>  
  
## <a name="react-to-unhandled-exceptions"></a><span data-ttu-id="b758d-112">Reaccionar ante excepciones no controladas</span><span class="sxs-lookup"><span data-stu-id="b758d-112">React to Unhandled Exceptions</span></span>  

 <span data-ttu-id="b758d-113"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> permite especificar la acción que debe emprenderse cuando se produce una excepción no controlada dentro de un servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b758d-113">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> enables you to specify the action to take if an unhandled exception occurs within a workflow service.</span></span> <span data-ttu-id="b758d-114">La propiedad <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> especifica uno de los valores <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction>:</span><span class="sxs-lookup"><span data-stu-id="b758d-114">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> property specifies one of the <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> values:</span></span>  
  
- <span data-ttu-id="b758d-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon>. Anula la instancia de servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b758d-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> – Aborts the workflow service instance.</span></span>  
  
- <span data-ttu-id="b758d-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend>. Deshace hasta el último estado guardado y suspende la instancia de servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b758d-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> – Rolls back to the last persisted state and suspends the workflow service instance.</span></span> <span data-ttu-id="b758d-117">Esto solo ocurre si ya se ha guardado el flujo de trabajo por lo menos una vez.</span><span class="sxs-lookup"><span data-stu-id="b758d-117">This only occurs if the workflow has already been persisted at least once.</span></span> <span data-ttu-id="b758d-118">Si no es así, se anula la instancia de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b758d-118">If not the workflow instance is aborted.</span></span>  
  
- <span data-ttu-id="b758d-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel>. Cancela la instancia.</span><span class="sxs-lookup"><span data-stu-id="b758d-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> – Cancels the instance.</span></span>  
  
- <span data-ttu-id="b758d-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate>. Termina la instancia.</span><span class="sxs-lookup"><span data-stu-id="b758d-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> – Terminates the instance.</span></span>  
  
 <span data-ttu-id="b758d-121">Este comportamiento se puede configurar en código, tal y como se muestra en el siguiente ejemplo.</span><span class="sxs-lookup"><span data-stu-id="b758d-121">This behavior can be configured in code as shown in the following example.</span></span>  
  
```csharp  
host.Description.Behaviors.Add(new WorkflowUnhandledExceptionBehavior { Action = WorkflowUnhandledExceptionAction.Abandon });  
```  
  
 <span data-ttu-id="b758d-122">También se puede configurar en un archivo de configuración, tal y como se muestra en el siguiente ejemplo.</span><span class="sxs-lookup"><span data-stu-id="b758d-122">It can also be configured in a configuration file as shown in the following example.</span></span>  
  
```xml
<behaviors>  
      <serviceBehaviors>  
        <behavior>  
          <serviceMetadata httpGetEnabled="True"/>  
          <serviceDebug includeExceptionDetailInFaults="False" />  
          <workflowUnhandledExceptionBehavior action="Abandon" />
        </behavior>  
      </serviceBehaviors>  
</behaviors>
```  
  
## <a name="hosting-non-service-workflows"></a><span data-ttu-id="b758d-123">Hospedar flujos de trabajo no pertenecientes al servicio</span><span class="sxs-lookup"><span data-stu-id="b758d-123">Hosting Non-Service Workflows</span></span>  

 <span data-ttu-id="b758d-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> se puede utilizar para hospedar flujos de trabajo no pertenecientes al servicio, o flujos de trabajo que no comienzan con una actividad <xref:System.ServiceModel.Activities.Receive> o que no usan las actividades de mensajería.</span><span class="sxs-lookup"><span data-stu-id="b758d-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> can be used to host non-service workflows, or workflows that either do not begin with a <xref:System.ServiceModel.Activities.Receive> activity or workflows that do not use the messaging activities.</span></span> <span data-ttu-id="b758d-125">Los servicios de flujo de trabajo suelen comenzar por una actividad <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="b758d-125">Workflow services normally begin with a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="b758d-126">Cuando <xref:System.ServiceModel.Activities.WorkflowServiceHost> recibe un mensaje para un servicio de flujo de trabajo, se crea una nueva instancia de servicio de flujo de trabajo si aún no se está ejecutando (o no se ha guardado).</span><span class="sxs-lookup"><span data-stu-id="b758d-126">When the <xref:System.ServiceModel.Activities.WorkflowServiceHost> receives a message for a workflow service, if it is not already running (or persisted) a new workflow service instance is created.</span></span> <span data-ttu-id="b758d-127">Si un flujo de trabajo no comienza con una actividad Receive, no se puede iniciar enviando un mensaje porque no hay ninguna actividad para recibir el mensaje.</span><span class="sxs-lookup"><span data-stu-id="b758d-127">If a workflow does not begin with a Receive activity, it cannot be started by sending a message because there is no activity to receive the message.</span></span> <span data-ttu-id="b758d-128">Para hospedar un flujo de trabajo no perteneciente al servicio, derive una clase de <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> e invalide <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> y <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span><span class="sxs-lookup"><span data-stu-id="b758d-128">To host a non-service workflow, derive a class from <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> and override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, and <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span></span> <span data-ttu-id="b758d-129">Invalide <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> si desea proporcionar un identificador de instancia preferido.</span><span class="sxs-lookup"><span data-stu-id="b758d-129">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> if you want to provide a preferred instance ID.</span></span> <span data-ttu-id="b758d-130">Invalide <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> para crear un contexto de creación de flujo de trabajo personalizado o rellene una instancia de la clase <xref:System.ServiceModel.Activities.WorkflowCreationContext> existente.</span><span class="sxs-lookup"><span data-stu-id="b758d-130">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> to create a custom workflow creation context or populate an instance of the existing <xref:System.ServiceModel.Activities.WorkflowCreationContext>.</span></span> <span data-ttu-id="b758d-131">Invalide <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> para extraer manualmente el marcador del mensaje entrante.</span><span class="sxs-lookup"><span data-stu-id="b758d-131">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> to manually extract the bookmark from the incoming message.</span></span> <span data-ttu-id="b758d-132">Si invalida este método, debe invocar el método <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> en su cuerpo igual que al responder al mensaje enviado al WorkflowHostingEndpoint.</span><span class="sxs-lookup"><span data-stu-id="b758d-132">If you override this method, you must invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> in its body so as to respond to the message sent to the WorkflowHostingEndpoint.</span></span> <span data-ttu-id="b758d-133">Si no lo hace, puede que a la larga se supere un límite <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A>.</span><span class="sxs-lookup"><span data-stu-id="b758d-133">If you do not do so, a <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limit may be eventually exceeded.</span></span> <span data-ttu-id="b758d-134">En contratos bidireccionales, es posible que pueda detectar que no se puede invocar al método <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> debido a que el cliente no puede recibir una respuesta.</span><span class="sxs-lookup"><span data-stu-id="b758d-134">In two-way contracts, you may be able to detect your   failure to invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> because of the client’s failure to receive a response.</span></span> <span data-ttu-id="b758d-135">En los contratos unidireccionales, puede que no reconozca el error que se produce cuando no se puede llamar al método <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> hasta que sea demasiado tarde, después de que se supere el límite de la propiedad <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A>.</span><span class="sxs-lookup"><span data-stu-id="b758d-135">In one-way contracts, you may not recognize the mistake of failing to call <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> until it’s too late, after the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> throttle limit is exceeded.</span></span> <span data-ttu-id="b758d-136">Para obtener más información, vea el [marcador WorkflowHostingEndpoint resume](../../windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)para crear una nueva instancia de un flujo de trabajo que no sea de servicio, declare un contrato de servicio que defina una operación que cree una nueva instancia.</span><span class="sxs-lookup"><span data-stu-id="b758d-136">For more information, please see the [WorkflowHostingEndpoint Resume Bookmark](../../windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)To create a new instance of a non-service workflow, declare a service contract that defines an operation that creates a new instance.</span></span> <span data-ttu-id="b758d-137">La operación de creación debe tomar un IDictionary \<string, object> para pasar cualquier parámetro de flujo de trabajo necesario.</span><span class="sxs-lookup"><span data-stu-id="b758d-137">The creation operation should take an IDictionary\<string, object> to pass any required workflow parameters.</span></span> <span data-ttu-id="b758d-138">Este contrato está implícitamente implementado por la case derivada de <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>.</span><span class="sxs-lookup"><span data-stu-id="b758d-138">This contract is implicitly implemented by the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class.</span></span> <span data-ttu-id="b758d-139">Al hospedar el flujo de trabajo, agregue una instancia de la clase derivada de <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> al host llamando a <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> y llame a <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span><span class="sxs-lookup"><span data-stu-id="b758d-139">When hosting the workflow, add an instance of the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class to the host by calling <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> and call <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span></span> <span data-ttu-id="b758d-140">Para crear una instancia del flujo de trabajo, cree una clase <xref:System.ServiceModel.ChannelFactory%601> de su tipo de contrato de servicios y llame e <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span><span class="sxs-lookup"><span data-stu-id="b758d-140">To create an instance of the workflow, create a <xref:System.ServiceModel.ChannelFactory%601> of your service contract type and call <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span></span> <span data-ttu-id="b758d-141">A continuación, puede llamar a la operación de creación definida en el contrato de servicios.</span><span class="sxs-lookup"><span data-stu-id="b758d-141">You can then call the create operation defined in your service contract.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b758d-142">Vea también</span><span class="sxs-lookup"><span data-stu-id="b758d-142">See also</span></span>

- [<span data-ttu-id="b758d-143">Servicios de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="b758d-143">Workflow Services</span></span>](workflow-services.md)
- [<span data-ttu-id="b758d-144">Actividades de mensajería</span><span class="sxs-lookup"><span data-stu-id="b758d-144">Messaging Activities</span></span>](messaging-activities.md)
