---
title: Uso de la clase de mensajes
description: Obtenga información sobre la clase de mensaje, que es fundamental para WCF. Solo necesita programar con la clase Message directamente en algunos escenarios avanzados.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d1d62bfb-2aa3-4170-b6f8-c93d3afdbbed
ms.openlocfilehash: fd19256b571727883dd877f0094f180ec47c6d63
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289391"
---
# <a name="using-the-message-class"></a><span data-ttu-id="eab93-104">Uso de la clase de mensajes</span><span class="sxs-lookup"><span data-stu-id="eab93-104">Using the Message Class</span></span>

<span data-ttu-id="eab93-105">La <xref:System.ServiceModel.Channels.Message> clase es fundamental para Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="eab93-105">The <xref:System.ServiceModel.Channels.Message> class is fundamental to Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="eab93-106">Toda la comunicación entre clientes y servicios, en última instancia, produce como resultado instancias <xref:System.ServiceModel.Channels.Message> que se envían y reciben.</span><span class="sxs-lookup"><span data-stu-id="eab93-106">All communication between clients and services ultimately results in <xref:System.ServiceModel.Channels.Message> instances being sent and received.</span></span>  
  
 <span data-ttu-id="eab93-107">Normalmente no interactuaría directamente con la clase <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="eab93-107">You would not usually interact with the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="eab93-108">En su lugar, se usan construcciones de modelo de servicio de WCF, como contratos de datos, contratos de mensajes y contratos de operaciones, para describir los mensajes entrantes y salientes.</span><span class="sxs-lookup"><span data-stu-id="eab93-108">Instead, WCF service model constructs, such as data contracts, message contracts, and operation contracts, are used to describe incoming and outgoing messages.</span></span> <span data-ttu-id="eab93-109">Sin embargo, en algunos escenarios avanzados puede programar utilizando directamente la clase <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="eab93-109">However, in some advanced scenarios you can program using the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="eab93-110">Por ejemplo, es posible que desee usar la clase <xref:System.ServiceModel.Channels.Message>:</span><span class="sxs-lookup"><span data-stu-id="eab93-110">For example, you might want to use the <xref:System.ServiceModel.Channels.Message> class:</span></span>  
  
- <span data-ttu-id="eab93-111">Cuando se necesita una forma alternativa de crear el contenido de los mensajes salientes (por ejemplo, crear un mensaje directamente a partir de un archivo en disco) en lugar de serializar .NET Framework objetos.</span><span class="sxs-lookup"><span data-stu-id="eab93-111">When you need an alternative way of creating outgoing message contents (for example, creating a message directly from a file on disk) instead of serializing .NET Framework objects.</span></span>  
  
- <span data-ttu-id="eab93-112">Cuando se necesita una forma alternativa de usar el contenido de los mensajes entrantes (por ejemplo, cuando se desea aplicar una transformación XSLT al contenido XML sin formato) en lugar de deserializar en objetos .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="eab93-112">When you need an alternative way of using incoming message contents (for example, when you want to apply an XSLT transformation to the raw XML contents) instead of deserializing into .NET Framework objects.</span></span>  
  
- <span data-ttu-id="eab93-113">Cuando necesite tratar con mensajes de una manera general sin tener en cuenta el contenido del mensaje (por ejemplo, cuando enrute o reenvíe mensajes al crear un enrutador, equilibrador de carga o un sistema publicación-suscripción</span><span class="sxs-lookup"><span data-stu-id="eab93-113">When you need to deal with messages in a general way regardless of message contents (for example, when routing or forwarding messages when building a router, load-balancer, or a publish-subscribe system).</span></span>  
  
 <span data-ttu-id="eab93-114">Antes de usar la <xref:System.ServiceModel.Channels.Message> clase, familiarícese con la arquitectura de transferencia de datos de WCF en [transferencia de datos información general sobre la arquitectura](data-transfer-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="eab93-114">Before using the <xref:System.ServiceModel.Channels.Message> class, familiarize yourself with the WCF data transfer architecture in [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
 <span data-ttu-id="eab93-115"><xref:System.ServiceModel.Channels.Message> es un contenedor de uso general para los datos, pero su diseño sigue estrechamente el diseño de un mensaje en el protocolo SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-115">A <xref:System.ServiceModel.Channels.Message> is a general-purpose container for data, but its design closely follows the design of a message in the SOAP protocol.</span></span> <span data-ttu-id="eab93-116">Simplemente como en SOAP, un mensaje tiene un cuerpo de mensaje y encabezados.</span><span class="sxs-lookup"><span data-stu-id="eab93-116">Just like in SOAP, a message has both a message body and headers.</span></span> <span data-ttu-id="eab93-117">El cuerpo del mensaje contiene los datos de carga reales, mientras que los encabezados contienen los contenedores de datos con nombre adicionales.</span><span class="sxs-lookup"><span data-stu-id="eab93-117">The message body contains the actual payload data, while the headers contain additional named data containers.</span></span> <span data-ttu-id="eab93-118">Las reglas para leer y escribir el cuerpo y los encabezados son diferentes; Por ejemplo, los encabezados están almacenados siempre en memoria búfer y se puede tener acceso a ellos todas las veces que se quiera, mientras que el cuerpo se puede leer solo una vez y puede ser transmitido.</span><span class="sxs-lookup"><span data-stu-id="eab93-118">The rules for reading and writing the body and the headers are different, for example, the headers are always buffered in memory and may be accessed in any order any number of times, while the body may be read only once and may be streamed.</span></span> <span data-ttu-id="eab93-119">Normalmente, cuando se utiliza SOAP, el cuerpo del mensaje está asignado al cuerpo SOAP y los encabezados del mensaje están asignados a los encabezados SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-119">Normally, when using SOAP, the message body is mapped to the SOAP body and the message headers are mapped to the SOAP headers.</span></span>  
  
## <a name="using-the-message-class-in-operations"></a><span data-ttu-id="eab93-120">Utilizar la clase de mensaje en Operaciones</span><span class="sxs-lookup"><span data-stu-id="eab93-120">Using the Message Class in Operations</span></span>  

 <span data-ttu-id="eab93-121">Puede utilizar la clase <xref:System.ServiceModel.Channels.Message> como un parámetro de entrada de una operación, el valor devuelto de una operación, o ambos.</span><span class="sxs-lookup"><span data-stu-id="eab93-121">You can use the <xref:System.ServiceModel.Channels.Message> class as an input parameter of an operation, the return value of an operation, or both.</span></span> <span data-ttu-id="eab93-122">Si <xref:System.ServiceModel.Channels.Message> se utiliza en cualquier parte en una operación, se aplican las restricciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="eab93-122">If <xref:System.ServiceModel.Channels.Message> is used anywhere in an operation, the following restrictions apply:</span></span>  
  
- <span data-ttu-id="eab93-123">La operación no puede tener ningún `out` o parámetro `ref`.</span><span class="sxs-lookup"><span data-stu-id="eab93-123">The operation cannot have any `out` or `ref` parameters.</span></span>  
  
- <span data-ttu-id="eab93-124">No puede haber más de un parámetro `input`.</span><span class="sxs-lookup"><span data-stu-id="eab93-124">There cannot be more than one `input` parameter.</span></span> <span data-ttu-id="eab93-125">Si el parámetro está presente, debe ser Mensaje o un tipo de contrato de mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-125">If the parameter is present, it must be either Message or a message contract type.</span></span>  
  
- <span data-ttu-id="eab93-126">El tipo de valor devuelto debe ser `void`, `Message`o un tipo de contrato de mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-126">The return type must be either `void`, `Message`, or a message contract type.</span></span>  
  
 <span data-ttu-id="eab93-127">El ejemplo de código siguiente contiene un contrato de operación válido.</span><span class="sxs-lookup"><span data-stu-id="eab93-127">The following code example contains a valid operation contract.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#1)]
 [!code-vb[C_UsingTheMessageClass#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#1)]  
  
## <a name="creating-basic-messages"></a><span data-ttu-id="eab93-128">Creación de mensajes básicos</span><span class="sxs-lookup"><span data-stu-id="eab93-128">Creating Basic Messages</span></span>  

 <span data-ttu-id="eab93-129">La clase <xref:System.ServiceModel.Channels.Message> proporciona métodos de generación estáticos `CreateMessage` que se pueden usar para crear mensajes básicos.</span><span class="sxs-lookup"><span data-stu-id="eab93-129">The <xref:System.ServiceModel.Channels.Message> class provides static `CreateMessage` factory methods that you can use to create basic messages.</span></span>  
  
 <span data-ttu-id="eab93-130">Todas las sobrecargas `CreateMessage` toman un parámetro de versión de tipo <xref:System.ServiceModel.Channels.MessageVersion> que indica el SOAP y versiones de WS-Addressing para utilizarlas para el mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-130">All `CreateMessage` overloads take a version parameter of type <xref:System.ServiceModel.Channels.MessageVersion> that indicates the SOAP and WS-Addressing versions to use for the message.</span></span> <span data-ttu-id="eab93-131">Si desea utilizar las mismas versiones de protocolo que el mensaje de entrada, puede utilizar la propiedad <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A> en la instancia <xref:System.ServiceModel.OperationContext> obtenida de la propiedad <xref:System.ServiceModel.OperationContext.Current%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-131">If you want to use the same protocol versions as the incoming message, you can use the <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A> property on the <xref:System.ServiceModel.OperationContext> instance obtained from the <xref:System.ServiceModel.OperationContext.Current%2A> property.</span></span> <span data-ttu-id="eab93-132">La mayoría de las sobrecargas `CreateMessage` también tienen un parámetro de cadena que indica la acción SOAP que se utilizará en el mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-132">Most `CreateMessage` overloads also have a string parameter that indicates the SOAP action to use for the message.</span></span> <span data-ttu-id="eab93-133">La versión se puede establecer en `None` para deshabilitar la generación de la envoltura SOAP; el mensaje solamente se compone del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="eab93-133">Version can be set to `None` to disable SOAP envelope generation; the message consists of only the body.</span></span>  
  
## <a name="creating-messages-from-objects"></a><span data-ttu-id="eab93-134">Crear mensajes a partir de objetos</span><span class="sxs-lookup"><span data-stu-id="eab93-134">Creating Messages from Objects</span></span>  

 <span data-ttu-id="eab93-135">La sobrecarga `CreateMessage` más básica que toma solo una versión y una acción crea un mensaje con un cuerpo vacío.</span><span class="sxs-lookup"><span data-stu-id="eab93-135">The most basic `CreateMessage` overload that takes only a version and an action creates a message with an empty body.</span></span> <span data-ttu-id="eab93-136">Otra sobrecarga toma un parámetro <xref:System.Object> adicional; esto crea un mensaje cuyo cuerpo es la representación serializada del objeto determinado.</span><span class="sxs-lookup"><span data-stu-id="eab93-136">Another overload takes an additional <xref:System.Object> parameter; this creates a message whose body is the serialized representation of the given object.</span></span> <span data-ttu-id="eab93-137">Utilice <xref:System.Runtime.Serialization.DataContractSerializer> con configuración predeterminada para la serialización.</span><span class="sxs-lookup"><span data-stu-id="eab93-137">Use the <xref:System.Runtime.Serialization.DataContractSerializer> with default settings for serialization.</span></span> <span data-ttu-id="eab93-138">Si desea utilizar un serializador diferente, o quiere que `DataContractSerializer` se configure de manera diferente, utilice la sobrecarga `CreateMessage` que también toma un parámetro `XmlObjectSerializer`.</span><span class="sxs-lookup"><span data-stu-id="eab93-138">If you want to use a different serializer, or you want the `DataContractSerializer` configured differently, use the `CreateMessage` overload that also takes an `XmlObjectSerializer` parameter.</span></span>  
  
 <span data-ttu-id="eab93-139">Por ejemplo, para devolver un objeto en un mensaje, puede utilizar el siguiente código.</span><span class="sxs-lookup"><span data-stu-id="eab93-139">For example, to return an object in a message, you can use the following code.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#2)]
 [!code-vb[C_UsingTheMessageClass#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#2)]  
  
## <a name="creating-messages-from-xml-readers"></a><span data-ttu-id="eab93-140">Crear los mensajes a partir de los lectores XML</span><span class="sxs-lookup"><span data-stu-id="eab93-140">Creating Messages from XML Readers</span></span>  

 <span data-ttu-id="eab93-141">Hay sobrecargas `CreateMessage` que toman <xref:System.Xml.XmlReader> o <xref:System.Xml.XmlDictionaryReader> para el cuerpo en lugar de un objeto.</span><span class="sxs-lookup"><span data-stu-id="eab93-141">There are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> for the body instead of an object.</span></span> <span data-ttu-id="eab93-142">En este caso, el cuerpo del mensaje contiene el XML que se obtiene al leer con el lector XML pasado.</span><span class="sxs-lookup"><span data-stu-id="eab93-142">In this case, the body of the message contains the XML that results from reading from the passed XML reader.</span></span> <span data-ttu-id="eab93-143">Por ejemplo, el código siguiente devuelve un mensaje con el contenido del cuerpo leído desde un archivo XML.</span><span class="sxs-lookup"><span data-stu-id="eab93-143">For example, the following code returns a message with body contents read from an XML file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#3)]
 [!code-vb[C_UsingTheMessageClass#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#3)]  
  
 <span data-ttu-id="eab93-144">Hay además, sobrecargas `CreateMessage` que toman <xref:System.Xml.XmlReader> o <xref:System.Xml.XmlDictionaryReader> que representa el mensaje completo y no simplemente el cuerpo.</span><span class="sxs-lookup"><span data-stu-id="eab93-144">Additionally, there are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> that represents the entire message and not just the body.</span></span> <span data-ttu-id="eab93-145">Estas sobrecargas también toman un parámetro `maxSizeOfHeaders` entero.</span><span class="sxs-lookup"><span data-stu-id="eab93-145">These overloads also take an integer `maxSizeOfHeaders` parameter.</span></span> <span data-ttu-id="eab93-146">Los encabezados siempre se almacenan en búfer en la memoria en cuanto se crea el mensaje, y este parámetro limita la cantidad de almacenamiento en búfer que tiene lugar.</span><span class="sxs-lookup"><span data-stu-id="eab93-146">Headers are always buffered into memory as soon as the message is created, and this parameter limits the amount of buffering that takes place.</span></span> <span data-ttu-id="eab93-147">Es importante establecer este parámetro en un valor seguro si el XML procede de un origen que no es de confianza para mitigar la posibilidad de un ataque por denegación de servicio.</span><span class="sxs-lookup"><span data-stu-id="eab93-147">It is important to set this parameter to a safe value if the XML is coming from an untrusted source to mitigate the possibility of a denial of service attack.</span></span> <span data-ttu-id="eab93-148">El SOAP y versiones de WS-Addressing del mensaje que el lector XML representa deben coincidir con las versiones indicadas utilizando el parámetro de versión.</span><span class="sxs-lookup"><span data-stu-id="eab93-148">The SOAP and WS-Addressing versions of the message the XML reader represents must match the versions indicated using the version parameter.</span></span>  
  
## <a name="creating-messages-with-bodywriter"></a><span data-ttu-id="eab93-149">Crear los mensajes con BodyWriter</span><span class="sxs-lookup"><span data-stu-id="eab93-149">Creating Messages with BodyWriter</span></span>  

 <span data-ttu-id="eab93-150">Una sobrecarga `CreateMessage` toma una instancia `BodyWriter` para describir el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-150">One `CreateMessage` overload takes a `BodyWriter` instance to describe the body of the message.</span></span> <span data-ttu-id="eab93-151">`BodyWriter` es una clase abstracta que se puede derivar para personalizar cómo se crean los cuerpos del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-151">A `BodyWriter` is an abstract class that can be derived to customize how message bodies are created.</span></span> <span data-ttu-id="eab93-152">Puede crear su propia clase `BodyWriter` derivada para describir los cuerpos del mensaje de una manera personalizada.</span><span class="sxs-lookup"><span data-stu-id="eab93-152">You can create your own `BodyWriter` derived class to describe message bodies in a custom way.</span></span> <span data-ttu-id="eab93-153">Debe invalidar el método `BodyWriter.OnWriteBodyContents` que toma <xref:System.Xml.XmlDictionaryWriter>; este método es el responsable de la escritura del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="eab93-153">You must override the `BodyWriter.OnWriteBodyContents` method that takes an <xref:System.Xml.XmlDictionaryWriter>; this method is responsible for writing out the body.</span></span>  
  
 <span data-ttu-id="eab93-154">Los sistemas de escritura del cuerpo se pueden almacenar en búfer o no (se pueden transmitir por secuencias).</span><span class="sxs-lookup"><span data-stu-id="eab93-154">Body writers can be buffered or non-buffered (streamed).</span></span> <span data-ttu-id="eab93-155">Los sistemas de escritura del cuerpo almacenados en búfer pueden escribir su contenido todas las veces que se quiera, mientras que los transmitidos solo pueden escribir sus contenidos una vez.</span><span class="sxs-lookup"><span data-stu-id="eab93-155">Buffered body writers can write out their contents any number of times, while streamed ones can write out their contents only once.</span></span> <span data-ttu-id="eab93-156">La propiedad `IsBuffered` indica si un sistema de escritura del cuerpo está almacenado en búfer o no.</span><span class="sxs-lookup"><span data-stu-id="eab93-156">The `IsBuffered` property indicates whether a body writer is buffered or not.</span></span> <span data-ttu-id="eab93-157">Puede establecerlo para su sistema de escritura de cuerpo mediante una llamada al constructor `BodyWriter` protegido que toma un parámetro booleano `isBuffered`.</span><span class="sxs-lookup"><span data-stu-id="eab93-157">You can set this for your body writer by calling the protected `BodyWriter` constructor that takes an `isBuffered` boolean parameter.</span></span> <span data-ttu-id="eab93-158">Los sistemas de escritura de cuerpo permiten crear un sistema de escritura de cuerpo almacenado en búfer a partir de un sistema de escritura de cuerpo no almacenado en búfer.</span><span class="sxs-lookup"><span data-stu-id="eab93-158">Body writers support creating a buffered body writer from a non-buffered body writer.</span></span> <span data-ttu-id="eab93-159">Puede invalidar el método `OnCreateBufferedCopy` para personalizar este proceso.</span><span class="sxs-lookup"><span data-stu-id="eab93-159">You can override the `OnCreateBufferedCopy` method to customize this process.</span></span> <span data-ttu-id="eab93-160">De forma predeterminada, se usa un búfer en memoria que contiene el XML devuelto por `OnWriteBodyContents`.</span><span class="sxs-lookup"><span data-stu-id="eab93-160">By default, an in-memory buffer that contains the XML returned by `OnWriteBodyContents` is used.</span></span> <span data-ttu-id="eab93-161">`OnCreateBufferedCopy` toma un parámetro entero `maxBufferSize`; si invalida este método, no debe crear búferes mayores que este tamaño máximo.</span><span class="sxs-lookup"><span data-stu-id="eab93-161">`OnCreateBufferedCopy` takes a `maxBufferSize` integer parameter; if you override this method, you must not create buffers larger than this maximum size.</span></span>  
  
 <span data-ttu-id="eab93-162">La clase `BodyWriter` proporciona respectivamente `WriteBodyContents` y los métodos `CreateBufferedCopy`, que son contenedores esencialmente delgados alrededor de `OnWriteBodyContents` y los métodos `OnCreateBufferedCopy`.</span><span class="sxs-lookup"><span data-stu-id="eab93-162">The `BodyWriter` class provides the `WriteBodyContents` and `CreateBufferedCopy` methods, which are essentially thin wrappers around `OnWriteBodyContents` and `OnCreateBufferedCopy` methods, respectively.</span></span> <span data-ttu-id="eab93-163">Estos métodos realizan la comprobación de estado para asegurarse de que no se tiene acceso a un sistema de escritura de cuerpo no almacenado en búfer más de una vez.</span><span class="sxs-lookup"><span data-stu-id="eab93-163">These methods perform state checking to ensure that a non-buffered body writer is not accessed more than once.</span></span> <span data-ttu-id="eab93-164">Solo se llama a estos métodos directamente al crear clases `Message` derivadas personalizadas basadas en `BodyWriters`.</span><span class="sxs-lookup"><span data-stu-id="eab93-164">These methods are called directly only when creating custom `Message` derived classes based on `BodyWriters`.</span></span>  
  
## <a name="creating-fault-messages"></a><span data-ttu-id="eab93-165">Crear los mensajes de error</span><span class="sxs-lookup"><span data-stu-id="eab93-165">Creating Fault Messages</span></span>  

 <span data-ttu-id="eab93-166">Puede utilizar ciertas sobrecargas `CreateMessage` para crear los mensajes del error de SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-166">You can use certain `CreateMessage` overloads to create SOAP fault messages.</span></span> <span data-ttu-id="eab93-167">La más básica toma un objeto <xref:System.ServiceModel.Channels.MessageFault> que describe el error.</span><span class="sxs-lookup"><span data-stu-id="eab93-167">The most basic of these takes a <xref:System.ServiceModel.Channels.MessageFault> object that describes the fault.</span></span> <span data-ttu-id="eab93-168">Otras sobrecargas se proporcionan para comodidad.</span><span class="sxs-lookup"><span data-stu-id="eab93-168">Other overloads are provided for convenience.</span></span> <span data-ttu-id="eab93-169">La primera sobrecarga toma `FaultCode` y una cadena de la razón y crea `MessageFault` mediante `MessageFault.CreateFault` mediante esta información.</span><span class="sxs-lookup"><span data-stu-id="eab93-169">The first such overload takes a `FaultCode` and a reason string and creates a `MessageFault` using `MessageFault.CreateFault` using this information.</span></span> <span data-ttu-id="eab93-170">La otra sobrecarga toma un objeto de datos y también lo pasa a `CreateFault` junto con el código de error y la razón.</span><span class="sxs-lookup"><span data-stu-id="eab93-170">The other overload takes a detail object and also passes it to `CreateFault` together with the fault code and the reason.</span></span> <span data-ttu-id="eab93-171">Por ejemplo, la operación siguiente devuelve un error.</span><span class="sxs-lookup"><span data-stu-id="eab93-171">For example, the following operation returns a fault.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#4)]
 [!code-vb[C_UsingTheMessageClass#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#4)]  
  
## <a name="extracting-message-body-data"></a><span data-ttu-id="eab93-172">Extraer los datos del cuerpo del mensaje</span><span class="sxs-lookup"><span data-stu-id="eab93-172">Extracting Message Body Data</span></span>  

 <span data-ttu-id="eab93-173">La clase `Message` admite varias maneras de extraer información de su cuerpo.</span><span class="sxs-lookup"><span data-stu-id="eab93-173">The `Message` class supports multiple ways of extracting information from its body.</span></span> <span data-ttu-id="eab93-174">Éstos pueden estar clasificados en las categorías siguientes:</span><span class="sxs-lookup"><span data-stu-id="eab93-174">These can be classified into the following categories:</span></span>  
  
- <span data-ttu-id="eab93-175">Obtener el cuerpo del mensaje completo escrito de una vez en un sistema de escritura de XML.</span><span class="sxs-lookup"><span data-stu-id="eab93-175">Getting the entire message body written out at once to an XML writer.</span></span> <span data-ttu-id="eab93-176">Esto se conoce como *escribir un mensaje*.</span><span class="sxs-lookup"><span data-stu-id="eab93-176">This is referred to as *writing a message*.</span></span>  
  
- <span data-ttu-id="eab93-177">Obtener un lector XML sobre el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-177">Getting an XML reader over the message body.</span></span> <span data-ttu-id="eab93-178">Esto le permite al acceso posterior el cuerpo del mensaje parte por parte, según se requiera.</span><span class="sxs-lookup"><span data-stu-id="eab93-178">This enables you to later access the message body piece-by-piece as required.</span></span> <span data-ttu-id="eab93-179">Esto se conoce como *leer un mensaje*.</span><span class="sxs-lookup"><span data-stu-id="eab93-179">This is referred to as *reading a message*.</span></span>  
  
- <span data-ttu-id="eab93-180">El mensaje completo, incluido su cuerpo, se puede copiar en un búfer en memoria del tipo <xref:System.ServiceModel.Channels.MessageBuffer>.</span><span class="sxs-lookup"><span data-stu-id="eab93-180">The entire message, including its body, can be copied to an in-memory buffer of the <xref:System.ServiceModel.Channels.MessageBuffer> type.</span></span> <span data-ttu-id="eab93-181">Esto se conoce como *copia de un mensaje*.</span><span class="sxs-lookup"><span data-stu-id="eab93-181">This is referred to as *copying a message*.</span></span>  
  
 <span data-ttu-id="eab93-182">Solo puede tener acceso una vez al cuerpo de `Message`, independientemente de cómo se tiene acceso.</span><span class="sxs-lookup"><span data-stu-id="eab93-182">You can access the body of a `Message` only once, regardless of how it is accessed.</span></span> <span data-ttu-id="eab93-183">Un objeto de mensaje tiene una propiedad `State`, la cual se establece inicialmente en Creada.</span><span class="sxs-lookup"><span data-stu-id="eab93-183">A message object has a `State` property, which is initially set to Created.</span></span> <span data-ttu-id="eab93-184">Los tres métodos de acceso descritos en la lista anterior establecen el estado en Escrito, Leído, y Copiado, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="eab93-184">The three access methods described in the preceding list set the state to Written, Read, and Copied, respectively.</span></span> <span data-ttu-id="eab93-185">Además, un método `Close` puede establecer el estado en Cerrado cuando ya no se necesita el contenido del cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-185">Additionally, a `Close` method can set the state to Closed when the message body contents are no longer required.</span></span> <span data-ttu-id="eab93-186">Se puede tener acceso al cuerpo del mensaje solo en el estado Creado y no hay ninguna manera de regresar al estado Creado después de que el estado haya cambiado.</span><span class="sxs-lookup"><span data-stu-id="eab93-186">The message body can be accessed only in the Created state, and there is no way to go back to the Created state after the state has changed.</span></span>  
  
## <a name="writing-messages"></a><span data-ttu-id="eab93-187">Escribir los mensajes</span><span class="sxs-lookup"><span data-stu-id="eab93-187">Writing Messages</span></span>  

 <span data-ttu-id="eab93-188">El método <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> escribe el contenido del cuerpo de un `Message` determinado cree instancias a un sistema de escritura XML determinado.</span><span class="sxs-lookup"><span data-stu-id="eab93-188">The <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> method writes out the body contents of a given `Message` instance to a given XML writer.</span></span> <span data-ttu-id="eab93-189">El <xref:System.ServiceModel.Channels.Message.WriteBody%2A> método hace lo mismo, salvo que incluye el contenido del cuerpo en el elemento contenedor adecuado (por ejemplo, <`soap:body`>).</span><span class="sxs-lookup"><span data-stu-id="eab93-189">The <xref:System.ServiceModel.Channels.Message.WriteBody%2A> method does the same, except that it encloses the body contents in the appropriate wrapper element (for example, <`soap:body`>).</span></span> <span data-ttu-id="eab93-190">Finalmente, <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> escribe el mensaje completo, incluso la envoltura SOAP de ajuste y los encabezados.</span><span class="sxs-lookup"><span data-stu-id="eab93-190">Finally, <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> writes out the entire message, including the wrapping SOAP envelope and the headers.</span></span> <span data-ttu-id="eab93-191">Si SOAP está desactivado ( <xref:System.ServiceModel.Channels.Message.Version> es <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType> ), los tres métodos hacen lo mismo: escriben el contenido del cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-191">If SOAP is turned off (<xref:System.ServiceModel.Channels.Message.Version> is <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType>), all three methods do the same thing: they write out the message body contents.</span></span>  
  
 <span data-ttu-id="eab93-192">Por ejemplo, el código siguiente escribe el cuerpo de un mensaje de entrada en un archivo.</span><span class="sxs-lookup"><span data-stu-id="eab93-192">For example, the following code writes out the body of an incoming message to a file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#5)]
 [!code-vb[C_UsingTheMessageClass#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#5)]  
  
 <span data-ttu-id="eab93-193">Dos métodos del asistente adicionales escriben ciertas etiquetas de elemento de inicio de SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-193">Two additional helper methods write out certain SOAP start element tags.</span></span> <span data-ttu-id="eab93-194">Estos métodos no tienen acceso al cuerpo del mensaje, de modo que no cambian el estado del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-194">These methods do not access the message body and so they do not change the message state.</span></span> <span data-ttu-id="eab93-195">Se incluyen los siguientes:</span><span class="sxs-lookup"><span data-stu-id="eab93-195">These include:</span></span>  
  
- <span data-ttu-id="eab93-196"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A> escribe el elemento de cuerpo de inicio, por ejemplo, `<soap:Body>`.</span><span class="sxs-lookup"><span data-stu-id="eab93-196"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A> writes the start body element, for example, `<soap:Body>`.</span></span>  
  
- <span data-ttu-id="eab93-197"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A> escribe el elemento de envoltura de inicio, por ejemplo, `<soap:Envelope>`.</span><span class="sxs-lookup"><span data-stu-id="eab93-197"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A> writes the start envelope element, for example, `<soap:Envelope>`.</span></span>  
  
 <span data-ttu-id="eab93-198">Para escribir las etiquetas de elementos finales correspondientes, llame `WriteEndElement` en el sistema de escritura XML correspondiente.</span><span class="sxs-lookup"><span data-stu-id="eab93-198">To write the corresponding end element tags, call `WriteEndElement` on the corresponding XML writer.</span></span> <span data-ttu-id="eab93-199">Rara vez se llama a estos métodos directamente.</span><span class="sxs-lookup"><span data-stu-id="eab93-199">These methods are rarely called directly.</span></span>  
  
## <a name="reading-messages"></a><span data-ttu-id="eab93-200">Leer mensajes</span><span class="sxs-lookup"><span data-stu-id="eab93-200">Reading Messages</span></span>  

 <span data-ttu-id="eab93-201">La manera principal para leer un cuerpo del mensaje es llamar <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-201">The primary way to read a message body is to call <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>.</span></span> <span data-ttu-id="eab93-202">Se recibe <xref:System.Xml.XmlDictionaryReader>, que se puede usar para leer el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-202">You get back an <xref:System.Xml.XmlDictionaryReader> that you can use to read the message body.</span></span> <span data-ttu-id="eab93-203">Tenga en cuenta que <xref:System.ServiceModel.Channels.Message> pasa al estado Leído en cuanto se llama a <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> y no cuando se usa el lector XML devuelto.</span><span class="sxs-lookup"><span data-stu-id="eab93-203">Note that the <xref:System.ServiceModel.Channels.Message> transitions to the Read state as soon as <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> is called, and not when you use the returned XML reader.</span></span>  
  
 <span data-ttu-id="eab93-204">El método <xref:System.ServiceModel.Channels.Message.GetBody%2A> también le permite tener acceso al cuerpo del mensaje como un objeto con tipo.</span><span class="sxs-lookup"><span data-stu-id="eab93-204">The <xref:System.ServiceModel.Channels.Message.GetBody%2A> method also enables you to access the message body as a typed object.</span></span> <span data-ttu-id="eab93-205">Internamente, este método utiliza `GetReaderAtBodyContents`y así también pasa el estado del mensaje al estado <xref:System.ServiceModel.Channels.MessageState.Read> (vea la propiedad <xref:System.ServiceModel.Channels.Message.State%2A> ).</span><span class="sxs-lookup"><span data-stu-id="eab93-205">Internally, this method uses `GetReaderAtBodyContents`, and so it also transitions the message state to the <xref:System.ServiceModel.Channels.MessageState.Read> state (see the <xref:System.ServiceModel.Channels.Message.State%2A> property).</span></span>  
  
 <span data-ttu-id="eab93-206">Es recomendable comprobar la propiedad <xref:System.ServiceModel.Channels.Message.IsEmpty%2A>, en cuyo caso el cuerpo del mensaje está vacío y <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> inicia <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="eab93-206">It is good practice to check the <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property, in which case the message body is empty and <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> throws an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="eab93-207">Además, si es un mensaje recibido (por ejemplo, la respuesta), es posible que también desee comprobar <xref:System.ServiceModel.Channels.Message.IsFault%2A>, que indica si el mensaje contiene un error.</span><span class="sxs-lookup"><span data-stu-id="eab93-207">Also, if it is a received message (for example, the reply), you may also want to check <xref:System.ServiceModel.Channels.Message.IsFault%2A>, which indicates whether the message contains a fault.</span></span>  
  
 <span data-ttu-id="eab93-208">La sobrecarga más básica de <xref:System.ServiceModel.Channels.Message.GetBody%2A> deserializa el cuerpo del mensaje en una instancia de un tipo (indicado por el parámetro genérico) mediante el uso de un <xref:System.Runtime.Serialization.DataContractSerializer> establecido con la configuración predeterminada y con la cuota <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="eab93-208">The most basic overload of <xref:System.ServiceModel.Channels.Message.GetBody%2A> deserializes the message body into an instance of a type (indicated by the generic parameter) using a <xref:System.Runtime.Serialization.DataContractSerializer> configured with the default settings and with the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> quota disabled.</span></span> <span data-ttu-id="eab93-209">Si desea usar un motor de serialización diferente o configurar `DataContractSerializer` de una manera distinta a la predeterminada, use la sobrecarga <xref:System.ServiceModel.Channels.Message.GetBody%2A> que toma <xref:System.Runtime.Serialization.XmlObjectSerializer>.</span><span class="sxs-lookup"><span data-stu-id="eab93-209">If you want to use a different serialization engine, or configure the `DataContractSerializer` in a non-default way, use the <xref:System.ServiceModel.Channels.Message.GetBody%2A> overload that takes an <xref:System.Runtime.Serialization.XmlObjectSerializer>.</span></span>  
  
 <span data-ttu-id="eab93-210">Por ejemplo, el código siguiente extrae los datos de un cuerpo de mensaje que contiene un objeto `Person` serializado e imprime el nombre de la persona.</span><span class="sxs-lookup"><span data-stu-id="eab93-210">For example, the following code extracts data from a message body that contains a serialized `Person` object and prints out the person’s name.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#6)]
 [!code-vb[C_UsingTheMessageClass#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#6)]  
  
## <a name="copying-a-message-into-a-buffer"></a><span data-ttu-id="eab93-211">Copiar un mensaje en un búfer</span><span class="sxs-lookup"><span data-stu-id="eab93-211">Copying a Message into a Buffer</span></span>  

 <span data-ttu-id="eab93-212">A veces es necesario tener acceso más de una vez al cuerpo del mensaje, por ejemplo, para reenviar el mismo mensaje a varios destinos como parte de un sistema de publicación-suscripción.</span><span class="sxs-lookup"><span data-stu-id="eab93-212">Sometimes it is necessary to access the message body more than once, for example, to forward the same message to multiple destinations as part of a publisher-subscriber system.</span></span> <span data-ttu-id="eab93-213">En este caso, es necesario almacenar en búfer el mensaje completo (incluido el cuerpo) en memoria.</span><span class="sxs-lookup"><span data-stu-id="eab93-213">In this case, it is necessary to buffer the entire message (including the body) in memory.</span></span> <span data-ttu-id="eab93-214">Puede hacerlo llamando <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29>.</span><span class="sxs-lookup"><span data-stu-id="eab93-214">You can do this by calling <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29>.</span></span> <span data-ttu-id="eab93-215">Este método toma un parámetro entero que representa el tamaño máximo de búfer y crea un búfer inferior a este tamaño.</span><span class="sxs-lookup"><span data-stu-id="eab93-215">This method takes an integer parameter that represents the maximum buffer size, and creates a buffer not larger than this size.</span></span> <span data-ttu-id="eab93-216">Es importante establecer esto en un valor seguro si el mensaje procede de un origen que no es de confianza.</span><span class="sxs-lookup"><span data-stu-id="eab93-216">It is important to set this to a safe value if the message is coming from an untrusted source.</span></span>  
  
 <span data-ttu-id="eab93-217">Se devuelve el búfer como una instancia <xref:System.ServiceModel.Channels.MessageBuffer>.</span><span class="sxs-lookup"><span data-stu-id="eab93-217">The buffer is returned as a <xref:System.ServiceModel.Channels.MessageBuffer> instance.</span></span> <span data-ttu-id="eab93-218">Puede tener acceso a los datos del búfer de varias maneras.</span><span class="sxs-lookup"><span data-stu-id="eab93-218">You can access data in the buffer in several ways.</span></span> <span data-ttu-id="eab93-219">El modo principal es llamar <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> para crear las instancias `Message` a partir del búfer.</span><span class="sxs-lookup"><span data-stu-id="eab93-219">The primary way is to call <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> to create `Message` instances from the buffer.</span></span>  
  
 <span data-ttu-id="eab93-220">Otra manera de tener acceso a los datos del búfer es implementar la interfaz <xref:System.Xml.XPath.IXPathNavigable> que la clase <xref:System.ServiceModel.Channels.MessageBuffer> implementa para tener acceso directamente al XML subyacente.</span><span class="sxs-lookup"><span data-stu-id="eab93-220">Another way to access the data in the buffer is to implement the <xref:System.Xml.XPath.IXPathNavigable> interface that the <xref:System.ServiceModel.Channels.MessageBuffer> class implements to access the underlying XML directly.</span></span> <span data-ttu-id="eab93-221">Algunas sobrecargas <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A> permiten crear navegadores <xref:System.Xml.XPath> protegidos por una cuota de nodo que limita el número de nodos XML que se pueden visitar.</span><span class="sxs-lookup"><span data-stu-id="eab93-221">Some <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A> overloads allow you to create <xref:System.Xml.XPath> navigators protected by a node quota, limiting the number of XML nodes that can be visited.</span></span> <span data-ttu-id="eab93-222">Esto ayuda a evitar ataques por denegación de servicio en función del tiempo de procesamiento largo.</span><span class="sxs-lookup"><span data-stu-id="eab93-222">This helps prevent denial of service attacks based on lengthy processing time.</span></span> <span data-ttu-id="eab93-223">Esta cuota está deshabilitada de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="eab93-223">This quote is disabled by default.</span></span> <span data-ttu-id="eab93-224">Algunas sobrecargas `CreateNavigator` le permiten especificar cómo se debería administrar el espacio en blanco en el XML utilizando la enumeración <xref:System.Xml.XmlSpace>, con los valores predeterminados `XmlSpace.None`.</span><span class="sxs-lookup"><span data-stu-id="eab93-224">Some `CreateNavigator` overloads allow you to specify how white space should be handled in the XML using the <xref:System.Xml.XmlSpace> enumeration, with the default being `XmlSpace.None`.</span></span>  
  
 <span data-ttu-id="eab93-225">Una última manera de tener acceso al contenido de un búfer del mensaje es escribir su contenido en una secuencia utilizando <xref:System.ServiceModel.Channels.Message.WriteMessage%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-225">A final way to access the contents of a message buffer is to write out its contents to a stream using <xref:System.ServiceModel.Channels.Message.WriteMessage%2A>.</span></span>  
  
 <span data-ttu-id="eab93-226">El ejemplo siguiente muestra el proceso de trabajar con `MessageBuffer`: un mensaje de entrada se reenvía a varios destinatarios y, a continuación, se registra en un archivo.</span><span class="sxs-lookup"><span data-stu-id="eab93-226">The following example demonstrates the process of working with a `MessageBuffer`: an incoming message is forwarded to multiple recipients, and then logged to a file.</span></span> <span data-ttu-id="eab93-227">Sin el almacenamiento en búfer, esto no es posible, porque se puede tener acceso al cuerpo del mensaje una sola vez.</span><span class="sxs-lookup"><span data-stu-id="eab93-227">Without buffering, this is not possible, because the message body can then be accessed only once.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#7)]
 [!code-vb[C_UsingTheMessageClass#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#7)]  
  
 <span data-ttu-id="eab93-228">La clase `MessageBuffer` tiene otro miembros que hay que tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="eab93-228">The `MessageBuffer` class has other members worth noting.</span></span> <span data-ttu-id="eab93-229">Se puede llamar al método <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A> para liberar recursos cuando ya no se requiera el contenido del búfer.</span><span class="sxs-lookup"><span data-stu-id="eab93-229">The <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A> method can be called to free resources when the buffer contents are no longer required.</span></span> <span data-ttu-id="eab93-230">La propiedad <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A> devuelve el tamaño del búfer asignado.</span><span class="sxs-lookup"><span data-stu-id="eab93-230">The <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A> property returns the size of the allocated buffer.</span></span> <span data-ttu-id="eab93-231">La propiedad <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A> devuelve el tipo de contenido de MIME del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-231">The <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A> property returns the MIME content type of the message.</span></span>  
  
## <a name="accessing-the-message-body-for-debugging"></a><span data-ttu-id="eab93-232">Tener acceso al cuerpo del mensaje para depuración</span><span class="sxs-lookup"><span data-stu-id="eab93-232">Accessing the Message Body for Debugging</span></span>  

 <span data-ttu-id="eab93-233">Para la depuración, puede llamar al método <xref:System.ServiceModel.Channels.Message.ToString%2A> con el fin de obtener una representación del mensaje como una cadena.</span><span class="sxs-lookup"><span data-stu-id="eab93-233">For debugging purposes, you can call the <xref:System.ServiceModel.Channels.Message.ToString%2A> method to get a representation of the message as a string.</span></span> <span data-ttu-id="eab93-234">Esta representación por lo general coincide con la manera en que se mostraría un mensaje en la conexión si estuviera codificado con el codificador de texto, con la excepción de que se le aplicaría un formato más legible que XML.</span><span class="sxs-lookup"><span data-stu-id="eab93-234">This representation generally matches the way a message would look on the wire if it were encoded with the text encoder, except that the XML would be better formatted for human readability.</span></span> <span data-ttu-id="eab93-235">La excepción a esto es el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-235">The one exception to this is the message body.</span></span> <span data-ttu-id="eab93-236">El cuerpo se puede leer una sola vez y `ToString` no cambia el estado del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-236">The body can be read only once, and `ToString` does not change the message state.</span></span> <span data-ttu-id="eab93-237">Por consiguiente, el `ToString` método podría no tener acceso al cuerpo y podría sustituir un marcador de posición (por ejemplo, "..." o tres puntos) en lugar del cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-237">Therefore, the `ToString` method might not be able to access the body and might substitute a placeholder (for example, "…" or three dots) instead of the message body.</span></span> <span data-ttu-id="eab93-238">Por consiguiente, no use `ToString` para registrar los mensajes si el contenido del cuerpo de los mensajes es importante.</span><span class="sxs-lookup"><span data-stu-id="eab93-238">Therefore, do not use `ToString` to log messages if the body content of the messages is important.</span></span>  
  
## <a name="accessing-other-message-parts"></a><span data-ttu-id="eab93-239">Tener acceso a otras partes del mensaje</span><span class="sxs-lookup"><span data-stu-id="eab93-239">Accessing Other Message Parts</span></span>  

 <span data-ttu-id="eab93-240">Se proporcionan varias propiedades para tener acceso a la información del mensaje que no sea el contenido del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="eab93-240">Various properties are provided to access information about the message other than its body contents.</span></span> <span data-ttu-id="eab93-241">Sin embargo, no se puede llamar a éstos una vez se ha cerrado el mensaje:</span><span class="sxs-lookup"><span data-stu-id="eab93-241">However, these cannot be called once the message has been closed:</span></span>  
  
- <span data-ttu-id="eab93-242">La propiedad <xref:System.ServiceModel.Channels.Message.Headers%2A> representa los encabezados del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-242">The <xref:System.ServiceModel.Channels.Message.Headers%2A> property represents the message headers.</span></span> <span data-ttu-id="eab93-243">Vea la sección "trabajar con encabezados" más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="eab93-243">See the section on "Working with Headers" later in this topic.</span></span>  
  
- <span data-ttu-id="eab93-244">La propiedad <xref:System.ServiceModel.Channels.Message.Properties%2A> representa las propiedades del mensaje, que son partes de datos con nombre adjuntadas al mensaje que generalmente no se emiten cuando se envía el mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-244">The <xref:System.ServiceModel.Channels.Message.Properties%2A> property represents the message properties, which are pieces of named data attached to the message that do not generally get emitted when the message is sent.</span></span> <span data-ttu-id="eab93-245">Consulte la sección en "Trabajar con propiedades" más adelante en este tema.</span><span class="sxs-lookup"><span data-stu-id="eab93-245">See the section on "Working with Properties" later in this topic.</span></span>  
  
- <span data-ttu-id="eab93-246">La propiedad <xref:System.ServiceModel.Channels.Message.Version%2A> indica el SOAP y versión WS-Addressing asociada al mensaje o `None` si SOAP está deshabilitado.</span><span class="sxs-lookup"><span data-stu-id="eab93-246">The <xref:System.ServiceModel.Channels.Message.Version%2A> property indicates the SOAP and WS-Addressing version associated with the message, or `None` if SOAP is disabled.</span></span>  
  
- <span data-ttu-id="eab93-247">La propiedad <xref:System.ServiceModel.Channels.Message.IsFault%2A> devuelve `true` si el mensaje es un mensaje de error de SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-247">The <xref:System.ServiceModel.Channels.Message.IsFault%2A> property returns `true` if the message is a SOAP fault message.</span></span>  
  
- <span data-ttu-id="eab93-248">La propiedad <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> devuelve `true` si el mensaje está vacío.</span><span class="sxs-lookup"><span data-stu-id="eab93-248">The <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property returns `true` if the message is empty.</span></span>  
  
 <span data-ttu-id="eab93-249">Puede utilizar el método <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29> para tener acceso a un atributo determinado en el elemento contenedor del cuerpo (por ejemplo, `<soap:Body>`) identificado por un nombre y espacio de nombres determinados.</span><span class="sxs-lookup"><span data-stu-id="eab93-249">You can use the <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29> method to access a particular attribute on the body wrapper element (for example, `<soap:Body>`) identified by a particular name and namespace.</span></span> <span data-ttu-id="eab93-250">Si no se encuentra dicho atributo, se devuelve `null`.</span><span class="sxs-lookup"><span data-stu-id="eab93-250">If such an attribute is not found, `null` is returned.</span></span> <span data-ttu-id="eab93-251">Se puede llamar a este método solo cuando `Message` está en el estado Creado (cuando todavía no se ha tenido acceso al cuerpo del mensaje).</span><span class="sxs-lookup"><span data-stu-id="eab93-251">This method can be called only when the `Message` is in the Created state (when the message body has not yet been accessed).</span></span>  
  
## <a name="working-with-headers"></a><span data-ttu-id="eab93-252">Trabajar con encabezados</span><span class="sxs-lookup"><span data-stu-id="eab93-252">Working with Headers</span></span>  

 <span data-ttu-id="eab93-253">Un `Message` puede contener cualquier número de fragmentos XML con nombre, denominados *encabezados*.</span><span class="sxs-lookup"><span data-stu-id="eab93-253">A `Message` can contain any number of named XML fragments, called *headers*.</span></span> <span data-ttu-id="eab93-254">Cada fragmento asigna normalmente a un encabezado SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-254">Each fragment normally maps to a SOAP header.</span></span> <span data-ttu-id="eab93-255">Se tiene acceso a los encabezados a través de la propiedad `Headers` de tipo <xref:System.ServiceModel.Channels.MessageHeaders>.</span><span class="sxs-lookup"><span data-stu-id="eab93-255">Headers are accessed through the `Headers` property of type <xref:System.ServiceModel.Channels.MessageHeaders>.</span></span> <span data-ttu-id="eab93-256"><xref:System.ServiceModel.Channels.MessageHeaders> es una colección de objetos <xref:System.ServiceModel.Channels.MessageHeaderInfo>, y se puede tener acceso a los encabezados individuales a través de su interfaz <xref:System.Collections.IEnumerable> o a través de su indizador.</span><span class="sxs-lookup"><span data-stu-id="eab93-256"><xref:System.ServiceModel.Channels.MessageHeaders> is a collection of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects, and individual headers can be accessed through its <xref:System.Collections.IEnumerable> interface or through its indexer.</span></span> <span data-ttu-id="eab93-257">Por ejemplo, el código siguiente hace una lista de los nombres de todos los encabezados en `Message`.</span><span class="sxs-lookup"><span data-stu-id="eab93-257">For example, the following code lists the names of all the headers in a `Message`.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#8)]
 [!code-vb[C_UsingTheMessageClass#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#8)]  
  
#### <a name="adding-removing-finding-headers"></a><span data-ttu-id="eab93-258">Agregar, quitar, buscar encabezados</span><span class="sxs-lookup"><span data-stu-id="eab93-258">Adding, Removing, Finding Headers</span></span>  

 <span data-ttu-id="eab93-259">Puede agregar un nuevo encabezado al final de todos los encabezados existentes utilizando el método <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-259">You can add a new header at the end of all existing headers using the <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A> method.</span></span> <span data-ttu-id="eab93-260">Puede utilizar el método <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A> para insertar un encabezado en un índice determinado.</span><span class="sxs-lookup"><span data-stu-id="eab93-260">You can use the <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A> method to insert a header at a particular index.</span></span> <span data-ttu-id="eab93-261">Los encabezados existentes se desplazan para el elemento insertado.</span><span class="sxs-lookup"><span data-stu-id="eab93-261">Existing headers are shifted for the inserted item.</span></span> <span data-ttu-id="eab93-262">Los encabezados se ordenan según su índice y el primer índice disponible es 0.</span><span class="sxs-lookup"><span data-stu-id="eab93-262">Headers are ordered according to their index, and the first available index is 0.</span></span> <span data-ttu-id="eab93-263">Puede usar las distintas sobrecargas del método <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A> para agregar encabezados de una instancia de `Message` o `MessageHeaders` diferente.</span><span class="sxs-lookup"><span data-stu-id="eab93-263">You can use the various <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A> method overloads to add headers from a different `Message` or `MessageHeaders` instance.</span></span> <span data-ttu-id="eab93-264">Algunas sobrecargas copian un encabezado individual, mientras que otras copian todos ellos.</span><span class="sxs-lookup"><span data-stu-id="eab93-264">Some overloads copy one individual header, while others copy all of them.</span></span> <span data-ttu-id="eab93-265">El método <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A> quita todos los encabezados.</span><span class="sxs-lookup"><span data-stu-id="eab93-265">The <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A> method removes all headers.</span></span> <span data-ttu-id="eab93-266">El método <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A> quita un encabezado en un índice determinado (desplazando todos los encabezados después de él).</span><span class="sxs-lookup"><span data-stu-id="eab93-266">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A> method removes a header at a particular index (shifting all headers after it).</span></span> <span data-ttu-id="eab93-267">El método <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A> quita todos los encabezados con un nombre y espacio de nombres determinados.</span><span class="sxs-lookup"><span data-stu-id="eab93-267">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A> method removes all headers with a particular name and namespace.</span></span>  
  
 <span data-ttu-id="eab93-268">Recupere un encabezado determinado mediante el método <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-268">Retrieve a particular header using the <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A> method.</span></span> <span data-ttu-id="eab93-269">Este método toma el nombre y espacio de nombres del encabezado para buscar y devuelve su índice.</span><span class="sxs-lookup"><span data-stu-id="eab93-269">This method takes the name and namespace of the header to find, and returns its index.</span></span> <span data-ttu-id="eab93-270">Si el encabezado se produce más de una vez, se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="eab93-270">If the header occurs more than once, an exception is thrown.</span></span> <span data-ttu-id="eab93-271">Si no se encuentra el encabezado, devuelve -1.</span><span class="sxs-lookup"><span data-stu-id="eab93-271">If the header is not found, it returns -1.</span></span>  
  
 <span data-ttu-id="eab93-272">En el modelo del encabezado SOAP, los encabezados pueden tener un valor `Actor` que especifica el destinatario previsto del encabezado.</span><span class="sxs-lookup"><span data-stu-id="eab93-272">In the SOAP header model, headers can have an `Actor` value that specifies the intended recipient of the header.</span></span> <span data-ttu-id="eab93-273">La sobrecarga `FindHeader` más básica solo busca en los encabezados que están pensados para el receptor definitivo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="eab93-273">The most basic `FindHeader` overload searches only headers intended for the ultimate receiver of the message.</span></span> <span data-ttu-id="eab93-274">Sin embargo, otra sobrecarga le permite especificar qué valores `Actor` están incluidos en la búsqueda.</span><span class="sxs-lookup"><span data-stu-id="eab93-274">However, another overload enables you to specify which `Actor` values are included in the search.</span></span> <span data-ttu-id="eab93-275">Para obtener más información, vea la especificación SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-275">For more information, see the SOAP specification.</span></span>  
  
 <span data-ttu-id="eab93-276">Se proporciona un método <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> para copiar los encabezados de una colección <xref:System.ServiceModel.Channels.MessageHeaders> en una matriz de los objetos <xref:System.ServiceModel.Channels.MessageHeaderInfo>.</span><span class="sxs-lookup"><span data-stu-id="eab93-276">A <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> method is provided to copy headers from a <xref:System.ServiceModel.Channels.MessageHeaders> collection to an array of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects.</span></span>  
  
 <span data-ttu-id="eab93-277">Para tener acceso a los datos XML en un encabezado, puede llamar <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> y devolver un lector XML para el índice del encabezado concreto.</span><span class="sxs-lookup"><span data-stu-id="eab93-277">To access the XML data in a header, you can call <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> and return an XML reader for the specific header index.</span></span> <span data-ttu-id="eab93-278">Si quiere deserializar el contenido del encabezado en un objeto, utilice <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> o una de las otras sobrecargas.</span><span class="sxs-lookup"><span data-stu-id="eab93-278">If you want to deserialize the header contents into an object, use <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> or one of the other overloads.</span></span> <span data-ttu-id="eab93-279">Las sobrecargas más básicas deserializan los encabezados mediante el uso del <xref:System.Runtime.Serialization.DataContractSerializer> configurado de la manera predeterminada.</span><span class="sxs-lookup"><span data-stu-id="eab93-279">The most basic overloads deserialize headers using the <xref:System.Runtime.Serialization.DataContractSerializer> configured in the default way.</span></span> <span data-ttu-id="eab93-280">Si desea utilizar un serializador diferente o una configuración diferente de `DataContractSerializer`, utilice una de las sobrecargas que toman `XmlObjectSerializer`.</span><span class="sxs-lookup"><span data-stu-id="eab93-280">If you want to use a different serializer or a different configuration of the `DataContractSerializer`, use one of the overloads that take an `XmlObjectSerializer`.</span></span> <span data-ttu-id="eab93-281">También hay sobrecarga que toma el nombre del encabezado, espacio de nombres y opcionalmente una lista de los valores `Actor` en lugar de un índice; ésta es una combinación de `FindHeader` y `GetHeader`.</span><span class="sxs-lookup"><span data-stu-id="eab93-281">There are also overloads that take the header name, namespace, and optionally a list of `Actor` values instead of an index; this is a combination of `FindHeader` and `GetHeader`.</span></span>  
  
## <a name="working-with-properties"></a><span data-ttu-id="eab93-282">Trabajar con propiedades</span><span class="sxs-lookup"><span data-stu-id="eab93-282">Working with Properties</span></span>  

 <span data-ttu-id="eab93-283">Una instancia `Message` puede contener un número arbitrario de objetos con nombre de tipos arbitrarios.</span><span class="sxs-lookup"><span data-stu-id="eab93-283">A `Message` instance can contain an arbitrary number of named objects of arbitrary types.</span></span> <span data-ttu-id="eab93-284">Se accede a esta colección a través de la  propiedad`Properties` de tipo `MessageProperties`.</span><span class="sxs-lookup"><span data-stu-id="eab93-284">This collection is accessed through the `Properties` property of type `MessageProperties`.</span></span> <span data-ttu-id="eab93-285">La colección implementa la interfaz <xref:System.Collections.Generic.IDictionary%602> y actúa como una asignación de <xref:System.String> a <xref:System.Object>.</span><span class="sxs-lookup"><span data-stu-id="eab93-285">The collection implements the <xref:System.Collections.Generic.IDictionary%602> interface and acts as a mapping from <xref:System.String> to <xref:System.Object>.</span></span> <span data-ttu-id="eab93-286">Normalmente, los valores de propiedad no se asignan directamente a ninguna parte del mensaje en la conexión, sino que proporcionan varias sugerencias de procesamiento de mensajes a los distintos canales de la pila de canales de WCF o al <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> marco de trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="eab93-286">Normally, property values do not map directly to any part of the message on the wire, but rather provide various message processing hints to the various channels in the WCF channel stack or to the <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> service framework.</span></span> <span data-ttu-id="eab93-287">Para obtener un ejemplo, consulte [información general sobre la arquitectura de transferencia de datos](data-transfer-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="eab93-287">For an example, see [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
## <a name="inheriting-from-the-message-class"></a><span data-ttu-id="eab93-288">Herencia de la clase de mensaje</span><span class="sxs-lookup"><span data-stu-id="eab93-288">Inheriting from the Message Class</span></span>  

 <span data-ttu-id="eab93-289">Si los tipos de mensaje integrados creados mediante `CreateMessage` no cumplen sus requisitos, cree una clase que derive de la clase `Message`.</span><span class="sxs-lookup"><span data-stu-id="eab93-289">If the built-in message types created using `CreateMessage` do not meet your requirements, create a class that derives from the `Message` class.</span></span>  
  
### <a name="defining-the-message-body-contents"></a><span data-ttu-id="eab93-290">Definir el contenido del cuerpo del mensaje</span><span class="sxs-lookup"><span data-stu-id="eab93-290">Defining the Message Body Contents</span></span>  

 <span data-ttu-id="eab93-291">Existen tres técnicas primarias para tener acceso a los datos dentro de un cuerpo del mensaje: escribir, leer y copiar en un búfer.</span><span class="sxs-lookup"><span data-stu-id="eab93-291">Three primary techniques exist for accessing data within a message body: writing, reading, and copying it to a buffer.</span></span> <span data-ttu-id="eab93-292">En última instancia, como consecuencia de estas operaciones se llama a los métodos <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A> y <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A>, respectivamente, en la clase derivada de `Message`.</span><span class="sxs-lookup"><span data-stu-id="eab93-292">These operations ultimately result in the <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A>, and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods being called, respectively, on your derived class of `Message`.</span></span> <span data-ttu-id="eab93-293">La clase base `Message` garantiza que se llamará a uno de estos métodos por cada instancia de `Message` y que no se llama más de una vez.</span><span class="sxs-lookup"><span data-stu-id="eab93-293">The base `Message` class guarantees that only one of these methods is called for each `Message` instance, and that it is not called more than once.</span></span> <span data-ttu-id="eab93-294">La clase base también garantiza que no se llama a los métodos en un mensaje cerrado.</span><span class="sxs-lookup"><span data-stu-id="eab93-294">The base class also ensures that the methods are not called on a closed message.</span></span> <span data-ttu-id="eab93-295">No hay ninguna necesidad de realizar el seguimiento del estado del mensaje en su implementación.</span><span class="sxs-lookup"><span data-stu-id="eab93-295">There is no need to track the message state in your implementation.</span></span>  
  
 <span data-ttu-id="eab93-296"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> es un método abstracto y se implementa.</span><span class="sxs-lookup"><span data-stu-id="eab93-296"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> is an abstract method and must be implemented.</span></span> <span data-ttu-id="eab93-297">La manera más básica de definir el contenido del cuerpo de un mensaje es escribirlo con este método.</span><span class="sxs-lookup"><span data-stu-id="eab93-297">The most basic way to define the body contents of your message is to write using this method.</span></span> <span data-ttu-id="eab93-298">Por ejemplo, el mensaje siguiente contiene 100,000 números aleatorios de 1 a 20.</span><span class="sxs-lookup"><span data-stu-id="eab93-298">For example, the following message contains 100,000 random numbers from 1 to 20.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#9)]
 [!code-vb[C_UsingTheMessageClass#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#9)]  
  
 <span data-ttu-id="eab93-299"><xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> y los métodos <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> tienen implementaciones predeterminadas que funcionan en la mayoría de los casos.  </span><span class="sxs-lookup"><span data-stu-id="eab93-299">The <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods have default implementations that work for most cases.</span></span> <span data-ttu-id="eab93-300">Las implementaciones predeterminadas llaman a <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, almacenan en búfer los resultados y funcionan con el búfer resultante.</span><span class="sxs-lookup"><span data-stu-id="eab93-300">The default implementations call <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, buffer the results, and work with the resulting buffer.</span></span> <span data-ttu-id="eab93-301">Sin embargo, en algunos casos esto puede no ser bastante.</span><span class="sxs-lookup"><span data-stu-id="eab93-301">However, in some cases this may not be enough.</span></span> <span data-ttu-id="eab93-302">En el ejemplo anterior, leer el mensaje resulta en 100,000 elementos XML almacenados en búfer, lo cual podría no ser deseable.</span><span class="sxs-lookup"><span data-stu-id="eab93-302">In the preceding example, reading the message results in 100,000 XML elements being buffered, which might not be desirable.</span></span> <span data-ttu-id="eab93-303">Es posible que desee invalidar <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> para devolver una clase <xref:System.Xml.XmlDictionaryReader> derivada personalizada que proporcione números aleatorios.</span><span class="sxs-lookup"><span data-stu-id="eab93-303">You might want to override <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> to return a custom <xref:System.Xml.XmlDictionaryReader> derived class that serves up random numbers.</span></span> <span data-ttu-id="eab93-304">Después, puede invalidar <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> para usar el lector que <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> devuelve el método, como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="eab93-304">You can then override <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> to use the reader that the <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> method returns, as shown in the following example.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#10)]
 [!code-vb[C_UsingTheMessageClass#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#10)]  
  
 <span data-ttu-id="eab93-305">De igual forma, podría desear invalidar `OnCreateBufferedCopy` para devolver su propia clase derivada `MessageBuffer`.</span><span class="sxs-lookup"><span data-stu-id="eab93-305">Similarly, you might want to override `OnCreateBufferedCopy` to return your own `MessageBuffer` derived class.</span></span>  
  
 <span data-ttu-id="eab93-306">Además de proporcionar el contenido del cuerpo del mensaje, la clase derivada del mensaje también debe invalidar las propiedades `Version`, `Headers` y `Properties`.</span><span class="sxs-lookup"><span data-stu-id="eab93-306">In addition to providing message body contents, your message derived class must also override the `Version`, `Headers`, and `Properties` properties.</span></span>  
  
 <span data-ttu-id="eab93-307">Tenga en cuenta que si crea una copia de un mensaje, la copia utiliza los encabezados del mensaje del original.</span><span class="sxs-lookup"><span data-stu-id="eab93-307">Note that if you create a copy of a message, the copy uses the message headers from the original.</span></span>  
  
### <a name="other-members-that-can-be-overridden"></a><span data-ttu-id="eab93-308">Otros miembros que se pueden invalidar</span><span class="sxs-lookup"><span data-stu-id="eab93-308">Other Members that Can Be Overridden</span></span>  

 <span data-ttu-id="eab93-309">Puede invalidar los <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A> <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A> métodos, y <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> para especificar cómo se escriben los elementos SOAP Envelope, los encabezados SOAP y las etiquetas de inicio del elemento BODY de SOAP. Normalmente, se corresponden con `<soap:Envelope>` , `<soap:Header>` y `<soap:Body>` .</span><span class="sxs-lookup"><span data-stu-id="eab93-309">You can override the <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> methods to specify how the SOAP envelope, SOAP headers, and SOAP body element start tags are written out. These normally correspond to `<soap:Envelope>`, `<soap:Header>`, and `<soap:Body>`.</span></span> <span data-ttu-id="eab93-310">Estos métodos no deberían escribir normalmente nada si la propiedad <xref:System.ServiceModel.Channels.Message.Version> devuelve <xref:System.ServiceModel.Channels.MessageVersion.None>.</span><span class="sxs-lookup"><span data-stu-id="eab93-310">These methods should normally not write anything out if the <xref:System.ServiceModel.Channels.Message.Version> property returns <xref:System.ServiceModel.Channels.MessageVersion.None>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="eab93-311">La implementación predeterminada de `OnGetReaderAtBodyContents` llama `OnWriteStartEnvelope` y `OnWriteStartBody` antes de llamar `OnWriteBodyContents` y almacenar en búfer los resultados.</span><span class="sxs-lookup"><span data-stu-id="eab93-311">The default implementation of `OnGetReaderAtBodyContents` calls `OnWriteStartEnvelope` and `OnWriteStartBody` before calling `OnWriteBodyContents` and buffering the results.</span></span> <span data-ttu-id="eab93-312">Los encabezados no se escriben.</span><span class="sxs-lookup"><span data-stu-id="eab93-312">Headers are not written out.</span></span>  
  
 <span data-ttu-id="eab93-313">Invalide el método <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A> para cambiar la manera de construir el mensaje completo a partir de sus diferentes partes.</span><span class="sxs-lookup"><span data-stu-id="eab93-313">Override the <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A> method to change the way the entire message is constructed from its various pieces.</span></span> <span data-ttu-id="eab93-314">El método `OnWriteMessage` es llamado por <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> y por la implementación predeterminada <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-314">The `OnWriteMessage` method is called from <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> and from the default <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> implementation.</span></span> <span data-ttu-id="eab93-315">Tenga en cuenta que invalidar <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> no es un procedimiento recomendado.</span><span class="sxs-lookup"><span data-stu-id="eab93-315">Note that overriding <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> is not a best practice.</span></span> <span data-ttu-id="eab93-316">Es mejor invalidar los métodos `On` adecuados (por ejemplo, <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>y <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-316">It is better to override the appropriate `On` methods (for example, <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A>.</span></span>  
  
 <span data-ttu-id="eab93-317">Invalide <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A> para invalidar cómo se representa el cuerpo del mensaje durante la depuración.</span><span class="sxs-lookup"><span data-stu-id="eab93-317">Override <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A> to override how your message body is represented during debugging.</span></span> <span data-ttu-id="eab93-318">El valor predeterminado es representarlo con tres puntos ("...").</span><span class="sxs-lookup"><span data-stu-id="eab93-318">The default is to represent it as three dots ("…").</span></span> <span data-ttu-id="eab93-319">Tenga en cuenta que se puede llamar a este método varias veces cuando el estado del mensaje es otro distinto de Cerrado.</span><span class="sxs-lookup"><span data-stu-id="eab93-319">Note that this method can be called multiple times when the message state is anything other than Closed.</span></span> <span data-ttu-id="eab93-320">Una implementación de este método no debería producir nunca una acción que solo se deba realizar una vez (como leer de una secuencia solo hacia adelante).</span><span class="sxs-lookup"><span data-stu-id="eab93-320">An implementation of this method should never cause any action that must be performed only once (such as reading from a forward-only stream).</span></span>  
  
 <span data-ttu-id="eab93-321">Invalide el método <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A> para permitir el acceso a los atributos en el elemento de cuerpo SOAP.</span><span class="sxs-lookup"><span data-stu-id="eab93-321">Override the <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A> method to allow access to attributes on the SOAP body element.</span></span> <span data-ttu-id="eab93-322">Este método se puede llamar todas las veces que se desee, pero el tipo base `Message` garantiza que solo se llama cuando el mensaje se encuentre en estado Creado.</span><span class="sxs-lookup"><span data-stu-id="eab93-322">This method can be called any number of times, but the `Message` base type guarantees that it is only called when the message is in the Created state.</span></span> <span data-ttu-id="eab93-323">No se requiere para comprobar el estado en una implementación.</span><span class="sxs-lookup"><span data-stu-id="eab93-323">It is not required to check the state in an implementation.</span></span> <span data-ttu-id="eab93-324">La implementación predeterminada siempre devuelve `null`, lo que indica que no hay ningún atributo en el elemento del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="eab93-324">The default implementation always returns `null`, which indicates that there are no attributes on the body element.</span></span>  
  
 <span data-ttu-id="eab93-325">Si el objeto `Message` debe llevar a cabo alguna operación de limpieza especial cuando ya no se necesita el cuerpo del mensaje, puede invalidar <xref:System.ServiceModel.Channels.Message.OnClose%2A>.</span><span class="sxs-lookup"><span data-stu-id="eab93-325">If your `Message` object must do any special cleanup when the message body is no longer required, you can override <xref:System.ServiceModel.Channels.Message.OnClose%2A>.</span></span> <span data-ttu-id="eab93-326">La implementación predeterminada no hace nada.</span><span class="sxs-lookup"><span data-stu-id="eab93-326">The default implementation does nothing.</span></span>  
  
 <span data-ttu-id="eab93-327">`IsEmpty` y las propiedades `IsFault` se pueden invalidar.</span><span class="sxs-lookup"><span data-stu-id="eab93-327">The `IsEmpty` and `IsFault` properties can be overridden.</span></span> <span data-ttu-id="eab93-328">De forma predeterminada, ambos devuelven `false`.</span><span class="sxs-lookup"><span data-stu-id="eab93-328">By default, both return `false`.</span></span>
