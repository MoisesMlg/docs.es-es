---
title: Codificadores personalizados
ms.date: 03/30/2017
ms.assetid: fa0e1d7f-af36-4bf4-aac9-cd4eab95bc4f
ms.openlocfilehash: c2ad0c947afd293d0923faa3e9d914b6911ce941
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96254784"
---
# <a name="custom-encoders"></a><span data-ttu-id="cdf8c-102">Codificadores personalizados</span><span class="sxs-lookup"><span data-stu-id="cdf8c-102">Custom Encoders</span></span>

<span data-ttu-id="cdf8c-103">Este tema describe cómo crear codificadores personalizados.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-103">This topic discusses how to create custom encoders.</span></span>  
  
 <span data-ttu-id="cdf8c-104">En Windows Communication Foundation (WCF), se utiliza un *enlace* para especificar cómo se transfieren los datos a través de una red entre los extremos.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-104">In Windows Communication Foundation (WCF), you use a *binding* to specify how to transfer data across a network between endpoints.</span></span> <span data-ttu-id="cdf8c-105">Un enlace se compone de una secuencia de *elementos de enlace*.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-105">A binding is made up of a sequence of *binding elements*.</span></span> <span data-ttu-id="cdf8c-106">Un enlace incluye elementos de enlace de protocolo opcionales como la seguridad, un elemento de enlace del *codificador de mensajes* necesario y un elemento de enlace de transporte necesario.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-106">A binding includes optional protocol binding elements such as security, a required *Message Encoder* binding element, and a required transport binding element.</span></span> <span data-ttu-id="cdf8c-107">Un codificador de mensaje está representado por un elemento de enlace de codificación de mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-107">A message encoder is represented by a message encoding binding element.</span></span> <span data-ttu-id="cdf8c-108">En WCF se incluyen tres codificadores de mensaje: binario, mecanismo de optimización de transmisión de mensajes (MTOM) y texto.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-108">Three message encoders are included in WCF: Binary, Message Transmission Optimization Mechanism (MTOM), and Text.</span></span>  
  
 <span data-ttu-id="cdf8c-109">Un elemento de enlace de codificación de mensajes serializa un <xref:System.ServiceModel.Channels.Message> saliente y lo pasa al transporte, o recibe del transporte la forma serializada de un mensaje y lo pasa al nivel de protocolo, si está presente, o, si no lo está, a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-109">A message encoding binding element serializes an outgoing <xref:System.ServiceModel.Channels.Message> and passes it to the transport, or receives the serialized form of a message from the transport and passes it to the protocol layer if present, or to the application, if not present.</span></span>  
  
 <span data-ttu-id="cdf8c-110">Los codificadores del mensaje transforman las instancias <xref:System.ServiceModel.Channels.Message> a y desde una representación de la conexión.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-110">Message encoders transform <xref:System.ServiceModel.Channels.Message> instances to and from a wire representation.</span></span> <span data-ttu-id="cdf8c-111">Aunque los codificadores se describen como situados encima del nivel de transporte en la pila del canal, en realidad residen en el nivel de transporte.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-111">Although encoders are described as sitting above the transport layer in the channel stack, they reside inside the transport layer.</span></span> <span data-ttu-id="cdf8c-112">Los transportes (por ejemplo HTTP) dan formato al mensaje según los requisitos de la norma de transporte.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-112">Transports (for example HTTP) format the message according to the requirements of the transport standard.</span></span> <span data-ttu-id="cdf8c-113">Los codificadores (por ejemplo texto/Xml) apenas codifican el mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-113">Encoders (for example Text Xml) just encode the message.</span></span>  
  
 <span data-ttu-id="cdf8c-114">Al establecer una conexión con un cliente o servidor existente previamente, puede tener opciones sobre la utilización de una codificación de mensajes determinada.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-114">When connecting to a preexisting client or server, you may not have a choice about using a particular message encoding.</span></span> <span data-ttu-id="cdf8c-115">Sin embargo, se puede tener acceso a los servicios WCF a través de varios puntos de conexión, cada uno con un codificador de mensajes diferente.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-115">However, WCF services can be made accessible through multiple endpoints, each with a different message encoder.</span></span> <span data-ttu-id="cdf8c-116">Cuando un único codificador no abarca toda la audiencia de su servicio, considere la exposición del servicio en varios extremos.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-116">When a single encoder does not cover the entire audience for your service, consider exposing your service over multiple endpoints.</span></span> <span data-ttu-id="cdf8c-117">De este modo, las aplicaciones cliente pueden elegir el extremo que más les convenga.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-117">Client applications can then choose the endpoint that is best for them.</span></span> <span data-ttu-id="cdf8c-118">La utilización de múltiples extremos permite combinar las ventajas de diferentes codificadores de mensaje con otros elementos de enlace.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-118">Using multiple endpoints allows you to combine the advantages of different message encoders with other binding elements.</span></span>  
  
## <a name="system-provided-encoders"></a><span data-ttu-id="cdf8c-119">Codificadores proporcionados por el sistema</span><span class="sxs-lookup"><span data-stu-id="cdf8c-119">System-Provided Encoders</span></span>  

 <span data-ttu-id="cdf8c-120">WCF proporciona varios enlaces proporcionados por el sistema que están diseñados para cubrir los escenarios de aplicación más comunes.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-120">WCF provides several system-provided bindings that are designed to cover the most common application scenarios.</span></span> <span data-ttu-id="cdf8c-121">Cada uno de estos enlaces combina un transporte, un codificador de mensaje y otras opciones (por ejemplo, seguridad).</span><span class="sxs-lookup"><span data-stu-id="cdf8c-121">Each of these bindings combine a transport, message encoder, and other options (security, for example).</span></span> <span data-ttu-id="cdf8c-122">En este tema se describe cómo extender `Text` los `Binary` `MTOM` codificadores de mensajes, y que se incluyen en WCF, o crear su propio Codificador personalizado.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-122">This topic describes how to extend the `Text`, `Binary`, and `MTOM` message encoders that are included in WCF, or create your own custom encoder.</span></span> <span data-ttu-id="cdf8c-123">El codificador de mensajes de texto admite tanto la codificación XML como la codificación SOAP.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-123">The text message encoder supports both a plain XML encoding as well as SOAP encodings.</span></span> <span data-ttu-id="cdf8c-124">El modo de codificación XML sin formato del codificador de mensajes de texto se denomina POX (“XML sin formato"), para distinguirlo de la codificación SOAP basada en texto.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-124">The plain XML encoding mode of the text message encoder is called the POX ("Plain Old XML") encoder to distinguish it from the text-based SOAP encoding.</span></span>  
  
 <span data-ttu-id="cdf8c-125">Para obtener más información sobre las combinaciones de elementos de enlace proporcionados por los enlaces proporcionados por el sistema, vea la sección correspondiente en [elegir un transporte](../feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="cdf8c-125">For more information about the combinations of binding elements provided by the system-provided bindings, see the corresponding section in [Choosing a Transport](../feature-details/choosing-a-transport.md).</span></span>  
  
## <a name="how-to-work-with-system-provided-encoders"></a><span data-ttu-id="cdf8c-126">Cómo trabajar con codificadores proporcionados por el sistema</span><span class="sxs-lookup"><span data-stu-id="cdf8c-126">How to Work with System-Provided Encoders</span></span>  

 <span data-ttu-id="cdf8c-127">Se agrega una codificación a un enlace mediante una clase derivada de <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-127">An encoding is added to a binding using a class derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
 <span data-ttu-id="cdf8c-128">WCF proporciona los siguientes tipos de elementos de enlace derivados de la <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> clase que puede proporcionar la codificación de texto, binaria y del mecanismo de optimización de transmisión de mensajes (MTOM):</span><span class="sxs-lookup"><span data-stu-id="cdf8c-128">WCF provides the following types of binding elements derived from the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> class that can provide for text, binary and Message Transmission Optimization Mechanism (MTOM) encoding:</span></span>  
  
- <span data-ttu-id="cdf8c-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: el codificador más interoperable, pero el menos eficaz con mensajes XML.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: The most interoperable, but the least efficient encoder for XML messages.</span></span> <span data-ttu-id="cdf8c-130">En general, un servicio web, o un cliente de servicios web, pueden entender XML textual.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-130">A Web service or Web service client can generally understand textual XML.</span></span> <span data-ttu-id="cdf8c-131">No obstante, la transmisión de grandes bloques de datos binarios en forma de texto no es eficaz.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-131">However, transmitting large blocks of binary data as text is not efficient.</span></span>  
  
- <span data-ttu-id="cdf8c-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>: representa el elemento de enlace que especifica la codificación de caracteres y el control de versiones del mensaje, utilizados con los mensajes binarios basados en XML.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for binary-based XML messages.</span></span> <span data-ttu-id="cdf8c-133">Esta es la opción más eficaz de las opciones de codificación, pero la menos interoperable, porque solo la admiten los puntos de conexión de WCF.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-133">This is most efficient of the encoding options, but the least interoperable, because it is only supported by WCF endpoints.</span></span>  
  
- <span data-ttu-id="cdf8c-134"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>: representa el elemento de enlace que especifica la codificación de caracteres y el control de versiones del mensaje, utilizados con un mensaje codificado mediante el mecanismo de optimización de la transmisión del mensaje (MTOM).</span><span class="sxs-lookup"><span data-stu-id="cdf8c-134"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for a message using a Message Transmission Optimization Mechanism (MTOM) encoding.</span></span> <span data-ttu-id="cdf8c-135">MTOM es una tecnología eficaz para la transmisión de datos binarios en mensajes de WCF.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-135">MTOM is an efficient technology for transmitting binary data in WCF messages.</span></span> <span data-ttu-id="cdf8c-136">El codificador MTOM intenta equilibrar la eficacia y la interoperabilidad.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-136">The MTOM encoder attempts to balance between efficiency and interoperability.</span></span> <span data-ttu-id="cdf8c-137">El codificador MTOM transmite la mayoría del XML en formato de texto, pero optimiza bloques grandes de datos binarios transmitiéndolos como son, sin convertirlos en texto.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-137">The MTOM encoding transmits most XML in textual form, but optimizes large blocks of binary data by transmitting them as-is, without conversion to text.</span></span>  
  
 <span data-ttu-id="cdf8c-138">El elemento de enlace crea un binario, MTOM, o <xref:System.ServiceModel.Channels.MessageEncoderFactory> de texto.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-138">The binding element creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory>.</span></span> <span data-ttu-id="cdf8c-139">El generador crea un binario, MTOM o una instancia <xref:System.ServiceModel.Channels.MessageEncoderFactory> de texto.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-139">The factory creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory> instance.</span></span> <span data-ttu-id="cdf8c-140">Normalmente, solo existe una instancia.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-140">Typically, there is only a single instance.</span></span> <span data-ttu-id="cdf8c-141">No obstante, si se utilizan sesiones, puede proporcionarse un codificador diferente para cada sesión.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-141">However if sessions are used, a different encoder may be provided to each session.</span></span> <span data-ttu-id="cdf8c-142">El codificador binario utiliza este recurso para coordinar los diccionarios dinámicos (vea, Infrastructura de XML).</span><span class="sxs-lookup"><span data-stu-id="cdf8c-142">The Binary encoder makes use of this to coordinate dynamic dictionaries (see XML Infrastructure).</span></span>  
  
 <span data-ttu-id="cdf8c-143">Los métodos <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> y <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> constituyen el núcleo de los codificadores.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-143">The <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> and <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> methods are the core of the encoders.</span></span> <span data-ttu-id="cdf8c-144">Los métodos proporcionan la lectura de un mensaje desde una secuencia o desde una matriz <xref:System.Byte>.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-144">The methods provide for reading a message from a stream or from a <xref:System.Byte> array.</span></span> <span data-ttu-id="cdf8c-145">Las matrices de bytes se utilizan cuando el transporte está operando en modo de almacenamiento en búfer.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-145">Byte arrays are used when the transport is operating in buffered mode.</span></span> <span data-ttu-id="cdf8c-146">Los mensajes siempre se escriben en secuencias.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-146">Messages are always written to streams.</span></span> <span data-ttu-id="cdf8c-147">Si el transporte debe almacenar el mensaje en búfer, proporciona una secuencia que realiza el almacenamiento en búfer.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-147">If the transport must buffer the message, it provides a stream that does the buffering.</span></span>  
  
 <span data-ttu-id="cdf8c-148">El resto del trabajo de los miembros que admiten contenido, tipos de medio y <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-148">The rest of the members work with support content, media types, and <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span></span> <span data-ttu-id="cdf8c-149">El transporte llama a estos métodos de codificación para probar si puede descodificar el mensaje entrante, o determinar si el mensaje saliente es válido para este codificador.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-149">The transport calls these encoder methods to test whether the incoming message can be decoded by it, or to determine if the outgoing message is valid for this encoder.</span></span>  
  
 <span data-ttu-id="cdf8c-150">Cada una de las tres implementaciones del codificador agrega propiedades que son relevantes para las codificaciones específicas y que son totalmente configurables.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-150">Each of the three encoder implementations adds properties that are relevant to the specific encodings and is fully configurable.</span></span> <span data-ttu-id="cdf8c-151">Los codificadores también exponen cuotas de lector con valores predeterminados seguros.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-151">The encoders also expose reader quotas that have secure defaults.</span></span> <span data-ttu-id="cdf8c-152">Vea Infrastructura de XML para obtener una descripción de las cuotas.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-152">See XML Infrastructure for a discussion of the quotas.</span></span>  
  
## <a name="features-of-system-provided-encoders"></a><span data-ttu-id="cdf8c-153">Características de los codificadores proporcionados por el sistema</span><span class="sxs-lookup"><span data-stu-id="cdf8c-153">Features of System-Provided Encoders</span></span>  

 <span data-ttu-id="cdf8c-154">Los codificadores proporcionados por sistema ofrecen diferentes características.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-154">There are a number of features provided by the system-provided encoders.</span></span>  
  
### <a name="pooling"></a><span data-ttu-id="cdf8c-155">Agrupación</span><span class="sxs-lookup"><span data-stu-id="cdf8c-155">Pooling</span></span>  

 <span data-ttu-id="cdf8c-156">Cada una de las implementaciones del codificador intenta agrupar el máximo posible.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-156">Each of the encoder implementations tries to pool as much as possible.</span></span> <span data-ttu-id="cdf8c-157">La reducción de las asignaciones es una manera clave de mejorar el rendimiento del código administrado.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-157">Reducing allocations is a key way to improve the performance of managed code.</span></span> <span data-ttu-id="cdf8c-158">Para lograr esta agrupación, las implementaciones utilizan la clase `SynchronizedPool`.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-158">To accomplish this pooling, the implementations use the `SynchronizedPool` class.</span></span> <span data-ttu-id="cdf8c-159">El archivo C# contiene una descripción de las optimizaciones adicionales utilizadas por esta clase.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-159">The C# file contains a description of the additional optimizations used by this class.</span></span>  
  
 <span data-ttu-id="cdf8c-160"><xref:System.Xml.XmlDictionaryReader> y las instancias <xref:System.Xml.XmlDictionaryWriter> se agrupan y reinicializan para evitar la asignación de otras nuevas para cada mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-160"><xref:System.Xml.XmlDictionaryReader> and <xref:System.Xml.XmlDictionaryWriter> instances are pooled and reinitialized to prevent allocating new ones for each message.</span></span> <span data-ttu-id="cdf8c-161">Para los lectores, una devolución de llamada `OnClose` reclama al lector cuando se llama a `Close()`.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-161">For the readers, an `OnClose` callback reclaims the reader when `Close()` is called.</span></span> <span data-ttu-id="cdf8c-162">El codificador también recicla algunos objetos de estados del mensaje utilizados al construir los mensajes.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-162">The encoder also recycles some message state objects used when constructing messages.</span></span> <span data-ttu-id="cdf8c-163">Los tamaños de estos grupos pueden configurarse mediante `MaxReadPoolSize` y las propiedades `MaxWritePoolSize`, en cada una de las tres clases derivadas de <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-163">The sizes of these pools are configurable by the `MaxReadPoolSize` and `MaxWritePoolSize` properties on each of the three classes derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
### <a name="binary-encoding"></a><span data-ttu-id="cdf8c-164">Codificación binaria</span><span class="sxs-lookup"><span data-stu-id="cdf8c-164">Binary Encoding</span></span>  

 <span data-ttu-id="cdf8c-165">Cuando la codificación binaria utiliza sesiones, la cadena del diccionario dinámico debe comunicarse con el receptor del mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-165">When binary encoding uses sessions, the dynamic dictionary string must be communicated to the receiver of the message.</span></span> <span data-ttu-id="cdf8c-166">Para ello, las cadenas del diccionario dinámico se incluyen como prefijo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-166">This is done by prefixing the message with the dynamic dictionary strings.</span></span> <span data-ttu-id="cdf8c-167">El receptor quita las cadenas, las agrega a la sesión, y procesa el mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-167">The receiver strips off the strings, adds them to the session, and processes the message.</span></span> <span data-ttu-id="cdf8c-168">Para pasar correctamente las cadenas del diccionario es necesario que el transporte se almacene en búfer.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-168">Correctly passing dictionary strings requires that the transport be buffered.</span></span>  
  
 <span data-ttu-id="cdf8c-169">Las cadenas se anexan al mensaje mediante un método `AddSessionInformationToMessage` interno.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-169">The strings are appended to the message by an internal `AddSessionInformationToMessage` method.</span></span> <span data-ttu-id="cdf8c-170">Agrega las cadenas con formato UTF-8 al principio del mensaje prefijado con su longitud.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-170">It adds the strings as UTF-8 to the front of the message prefixed with their length.</span></span> <span data-ttu-id="cdf8c-171">A continuación, se prefija el encabezado de diccionario completo con la longitud de sus datos.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-171">The entire dictionary header is then prefixed with the length of its data.</span></span> <span data-ttu-id="cdf8c-172">La operación inversa la realiza un método `ExtractSessionInformationFromMessage` interno.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-172">The reverse operation is performed by an internal `ExtractSessionInformationFromMessage` method.</span></span>  
  
 <span data-ttu-id="cdf8c-173">Además de procesar las claves de diccionario dinámico, los mensajes con sesión almacenados en búfer se reciben de una única manera.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-173">In addition to processing dynamic dictionary keys, buffered sessionful messages are received in a unique way.</span></span> <span data-ttu-id="cdf8c-174">En lugar de crear un lector sobre el documento y procesarlo, el codificador binario utiliza la clase `MessagePatterns` interna para deconstruir la secuencia binaria.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-174">Instead of creating a reader over the document and processing it, the binary encoder uses the internal `MessagePatterns` class to deconstruct the binary stream.</span></span> <span data-ttu-id="cdf8c-175">La idea es que la mayoría de los mensajes tienen un determinado conjunto de encabezados que se muestran en un determinado orden cuando se generan mediante WCF.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-175">The idea is that most messages have a certain set of headers that show up in a certain order when generated by WCF.</span></span> <span data-ttu-id="cdf8c-176">El sistema del patrón interrumpe el mensaje basándose en sus expectativas.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-176">The pattern system breaks the message apart based on what it expects.</span></span> <span data-ttu-id="cdf8c-177">Si es correcto, inicializa un objeto <xref:System.ServiceModel.Channels.MessageHeaders> sin analizar el XML.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-177">If it is successful, it initializes a <xref:System.ServiceModel.Channels.MessageHeaders> object without parsing the XML.</span></span> <span data-ttu-id="cdf8c-178">Si no lo es, recurre al método estándar.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-178">If not, it falls back to the standard method.</span></span>  
  
### <a name="mtom-encoding"></a><span data-ttu-id="cdf8c-179">Codificación MTOM</span><span class="sxs-lookup"><span data-stu-id="cdf8c-179">MTOM Encoding</span></span>  

 <span data-ttu-id="cdf8c-180">La clase <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> tiene una propiedad de configuración adicional denominada <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement.MaxBufferSize%2A>.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-180">The <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> class has an additional configuration property called <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement.MaxBufferSize%2A>.</span></span> <span data-ttu-id="cdf8c-181">Esta propiedad establece un límite superior a la cantidad de datos que pueden almacenarse en búfer durante el proceso de lectura de un mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-181">This places an upper bound on how much data it is allowed to buffer during the process of reading a message.</span></span> <span data-ttu-id="cdf8c-182">Puede que sea necesario almacenar en búfer el conjunto de información XML (Infoset), u otras partes MIME, para volver a ensamblar todas las partes MIME en un mensaje único.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-182">The XML Information Set (Infoset), or other MIME parts, may need to be buffered to reassemble all the MIME parts into a single message.</span></span>  
  
 <span data-ttu-id="cdf8c-183">Para trabajar correctamente con HTTP, la clase interna del codificador de mensajes de MTOM proporciona algunas API internas para `GetContentType`, qué también es interno, y `WriteMessage`, que es público y puede invalidarse.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-183">To work correctly with HTTP, the internal MTOM message encoder class provides some internal APIs for `GetContentType` (which is also internal) and `WriteMessage`, which is public and can be overridden.</span></span> <span data-ttu-id="cdf8c-184">Puede producirse una mayor comunicación para garantizar que los valores de los encabezados HTTP coinciden con los valores de los encabezados MIME.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-184">More communication must occur to ensure values in the HTTP headers agree with values in the MIME headers.</span></span>  
  
 <span data-ttu-id="cdf8c-185">Internamente, el codificador de mensajes MTOM utiliza los lectores de texto de WCF y es similar al codificador de texto.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-185">Internally, the MTOM message encoder uses WCF's text readers, and is similar to the Text encoder.</span></span> <span data-ttu-id="cdf8c-186">La diferencia principal es que optimiza grandes fragmentos de datos binarios, o BLOB (grandes objetos binarios), sin convertirlos a la codificación Base 64 antes de incrustarlos en los bytes del mensaje.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-186">The main difference is that it optimizes large chunks of binary, or "Binary Large Objects" (BLOBs), by not converting them to Base-64 encoding prior to being embedded into the message bytes.</span></span> <span data-ttu-id="cdf8c-187">En su lugar, estos BLOB se mantienen extraídos y se les hace referencia como datos adjuntos de MIME.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-187">Instead, these BLOBs are kept extracted, and referenced as the MIME attachments.</span></span>  
  
## <a name="writing-your-own-encoder"></a><span data-ttu-id="cdf8c-188">Escritura de los propios controles</span><span class="sxs-lookup"><span data-stu-id="cdf8c-188">Writing your own Encoder</span></span>  

 <span data-ttu-id="cdf8c-189">Para implementar su propio codificador de mensajes personalizado, debe proporcionar implementaciones personalizadas de las siguientes tres clases base abstractas:</span><span class="sxs-lookup"><span data-stu-id="cdf8c-189">To implement your own custom message encoder, you must provide custom implementations of the following abstract base classes:</span></span>  
  
- <xref:System.ServiceModel.Channels.MessageEncoder>  
  
- <xref:System.ServiceModel.Channels.MessageEncoderFactory>  
  
- <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>  
  
 <span data-ttu-id="cdf8c-190">La conversión de la representación en memoria de un mensaje a una representación que pueda escribirse en una secuencia, se encapsula en la clase <xref:System.ServiceModel.Channels.MessageEncoder>, que actúa como generador para los lectores y sistemas de escritura XML que admiten tipos específicos de codificación XML.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-190">Converting from the in-memory representation of a message to a representation that can be written to a stream is encapsulated within the <xref:System.ServiceModel.Channels.MessageEncoder> class, which serves as a factory for XML readers and XML writers that support specific types of XML encodings.</span></span>  
  
- <span data-ttu-id="cdf8c-191">Los métodos clave de esta clase que deben invalidarse son:</span><span class="sxs-lookup"><span data-stu-id="cdf8c-191">The key methods of this class that you must override are:</span></span>  
  
- <span data-ttu-id="cdf8c-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> que adopta un objeto <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> y lo escribe en un objeto <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> which takes a <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> object and writes it into a <xref:System.IO.Stream> object.</span></span>  
  
- <span data-ttu-id="cdf8c-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> que adopta un objeto <xref:System.IO.Stream> y un tamaño de encabezado máximo, y devuelve un objeto <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> which takes a <xref:System.IO.Stream> object and a maximum header size and returns a <xref:System.ServiceModel.Channels.Message> object.</span></span>  
  
 <span data-ttu-id="cdf8c-194">Es el código que se escribe en los métodos que administran la conversión entre el protocolo de transporte estándar y su codificación personalizada.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-194">It is the code you write in these methods that handles conversion between the standard transport protocol, and your customized encoding.</span></span>  
  
 <span data-ttu-id="cdf8c-195">A continuación, es necesario programar una clase de generador que cree el codificador personalizado.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-195">Next you need to code a factory class that creates your custom encoder.</span></span> <span data-ttu-id="cdf8c-196">Invalide <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> para devolver una instancia de su <xref:System.ServiceModel.Channels.MessageEncoder> personalizado.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-196">Override the <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> to return an instance of your custom <xref:System.ServiceModel.Channels.MessageEncoder>.</span></span>  
  
 <span data-ttu-id="cdf8c-197">A continuación, conecte su <xref:System.ServiceModel.Channels.MessageEncoderFactory> personalizado a la pila de elementos de enlace utilizada para configurar el servicio o el cliente, invalidando el método <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A>, para devolver una instancia de este generador.</span><span class="sxs-lookup"><span data-stu-id="cdf8c-197">Then connect your custom <xref:System.ServiceModel.Channels.MessageEncoderFactory> to the binding element stack used to configure the service or client by overriding the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> method to return an instance of this factory.</span></span>  
  
 <span data-ttu-id="cdf8c-198">Se proporcionan dos ejemplos con WCF que ilustran este proceso con código de ejemplo: codificador de [mensaje personalizado:](../samples/custom-message-encoder-custom-text-encoder.md) codificador de texto personalizado y [codificador de mensajes personalizado: codificador de compresión](../samples/custom-message-encoder-compression-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="cdf8c-198">There are two samples provided with WCF that illustrate this process with sample code: [Custom Message Encoder: Custom Text Encoder](../samples/custom-message-encoder-custom-text-encoder.md) and [Custom Message Encoder: Compression Encoder](../samples/custom-message-encoder-compression-encoder.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cdf8c-199">Vea también</span><span class="sxs-lookup"><span data-stu-id="cdf8c-199">See also</span></span>

- <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>
- <xref:System.ServiceModel.Channels.MessageEncoderFactory>
- <xref:System.ServiceModel.Channels.MessageEncoder>
- [<span data-ttu-id="cdf8c-200">Información general sobre la arquitectura de transferencia de datos</span><span class="sxs-lookup"><span data-stu-id="cdf8c-200">Data Transfer Architectural Overview</span></span>](../feature-details/data-transfer-architectural-overview.md)
- [<span data-ttu-id="cdf8c-201">Elección de un codificador de mensajes</span><span class="sxs-lookup"><span data-stu-id="cdf8c-201">Choosing a Message Encoder</span></span>](../feature-details/choosing-a-message-encoder.md)
- [<span data-ttu-id="cdf8c-202">Elección del transporte</span><span class="sxs-lookup"><span data-stu-id="cdf8c-202">Choosing a Transport</span></span>](../feature-details/choosing-a-transport.md)
